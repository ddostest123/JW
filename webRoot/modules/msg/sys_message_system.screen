<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: weijia.zhou
    $Date: 2017-12-1 20:39:47  
    $Revision: 1.0  
    $Purpose: 云级；系统消息查询，系统消息
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application">
    <a:init-procedure/>
    <a:view>
        <a:link id="sys_user_message_detail_link" url="${/request/@context_path}/modules/msg/sys_message_detail.screen"/>
        <a:link id="msg_sys_email_resend_link" model="msg.sys_message_mail_list" modelaction="execute"/>
        <style><![CDATA[[
        	.item-grid-wrap{
        	    float:left;
        	}
        ]]></style>
        <script><![CDATA[
            function sys_emails_list_query() {
                $('sys_emails_list_result_ds').query();
            }
            
            function sys_emails_ht_query() {
                $('sys_emails_ht_result_ds').query();
            }
            
            function sys_sms_list_query() {
                $('sys_sms_list_result_ds').query();
            }
            
            function sys_sms_ht_query() {
                $('sys_sms_ht_result_ds').query();
            }
            
            function sys_messages_query() {
                $('sys_messages_result_ds').query();
            }
            
            function sys_app_message_sent_query() {
                $('sys_app_message_sent_result_ds').query();
            }
            
            function sys_app_message_sent_ht_query() {
                $('sys_app_message_sent_ht_result_ds').query();
            }
            
            function sys_app_errors_query() {
                $('sys_app_errors_result_ds').query();
            }
            
            function on_sys_app_errors_query_ds_add(dataSet, record, index) {
                var date = new Date();
                var y = date.getFullYear();
                var m = date.getMonth() + 1;
                if (m < 10) {
                    m = '0' + m;
                }
            
                var d = date.getDate();
                if (d < 10) {
                    d = '0' + d;
                }
                var today = y + '-' + m + '-' + d;
            
                record.set('message_date_from', today);
                record.set('message_date_to', today);
            }
            
            
            function sys_messages_grid_renderer(value, record, name) {
                if (name == 'details' && record.get('push_object_type') == 'SINGLE') {
                    var message_id = record.get('message_id');
                    return '<a href="javascript:sys_user_message_detail(' + message_id + ')">接收人明细 </a>';
                }
                return '';
            }
            
            function sys_user_message_detail(message_id) {
                new Aurora.Window({
                    id: 'sys_user_message_detail_win',
                    title: '接收人明细',
                    url: $('sys_user_message_detail_link').getUrl() + '?message_id=' + message_id,
                    fullScreen: false,
                    width: 670,
                    height: 400
                });
            }
            
            /* 邮件待发 */
            
            function resend_emails_list(record_id) {
                var record = $('sys_emails_list_result_ds').find('record_id', record_id);
                Aurora.showConfirm('${l:PROMPT}', '确定重新发送此邮件吗？', function() {
                    Aurora.Masker.mask(Ext.getBody());
                    Aurora.request({
                        url: $('msg_sys_email_resend_link').getUrl(),
                        para: {
                            'record_id': record.get('record_id')
                        },
                        success: function() {
                            Aurora.Masker.unmask(Ext.getBody());
                            Aurora.showMessage('${l:PROMPT}', '邮件已重新发送。');
                        },
                        error: function() {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        failure: function() {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        scope: this
                    });
                }, null, null, 80);
            }
            
            function sys_emails_list_result_ds_load(dataSet) {
                if (dataSet.getAll().length == 0) {
                    window.document.getElementById('sys_emails_list_id').innerHTML = '';
                }
            }
            
            function sys_emails_list_result_ds_indexchange(dataSet, record) {
                var html = window.document.getElementById('sys_emails_list_id');
                var height = document.getElementById('sys_emails_list_grid_wrap').offsetHeight;
                html.style.backgroundColor = '#d0e6f5';
                html.style.height = height + 'px';
                html.style.overflowY = 'auto';
                var recipient_name = record.get('recipient_name');
                var msg_title = record.get('msg_title');
                var note = record.get('request_error_content');
                if (note == 'undefined' || note == '' || note == null) {
                    note = '';
                }
                  var recipient_mail = record.get('recipient_mail');
                if (recipient_mail == 'undefined' || recipient_mail == '' || recipient_mail == null) {
                    recipient_mail = '';
                }
                if (recipient_name == 'undefined' || recipient_name == '' || recipient_name == null) {
                    recipient_name = '';
                }
                if (msg_title == 'undefined' || msg_title == '' || msg_title == null) {
                    msg_title = '';
                }
                var text = '<button onclick="resend_emails_list(' + record.get('record_id') + ')" style="margin-top:15px;background-color: #19a2d5;cursor:pointer;border: 1px solid #19a2d5;color:#fff;margin-left:20px;width:100px;height:50px;font-size:16px;">重新发送</button><p style="font-weight:bold;margin-top:0;padding:30px 0 0 20px;">主题：' + msg_title + '</p><p><t style="font-weight:bold;padding:0 0 0 20px;">收件人：</t><t>' +recipient_mail + '</p><p><t style="font-weight:bold;padding:0 0 0 20px;">时间：</t><t>' + record.get('creation_date_desc') + '</t></p><p style="font-weight:bold;padding:0 20px 0 20px;">正文：</p>' + '<div style="padding:0 20px 0 20px">' + msg_title + '</div>'+ '<br/><p><t style="font-weight:bold;padding:0 20px 0 20px;">错误消息：</t><t>' + note + '</t></p>';;
                html.innerHTML = text;
                html.style.display = 'block';
            }
            
            /*   邮件已发 */
            
            function resend_emails_ht(record_id) {
                var record = $('sys_emails_ht_result_ds').find('record_id', record_id);
                Aurora.showConfirm('${l:PROMPT}', '确定重新发送此邮件吗？', function() {
                    Aurora.Masker.mask(Ext.getBody());
                    Aurora.request({
                        url: $('msg_sys_email_resend_link').getUrl(),
                        para: {
                            'record_id': record.get('record_id')
                        },
                        success: function() {
                            Aurora.Masker.unmask(Ext.getBody());
                            Aurora.showMessage('${l:PROMPT}', '邮件已重新发送。');
                        },
                        error: function() {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        failure: function() {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        scope: this
                    });
                }, null, null, 80);
            }
            
            function sys_emails_ht_result_ds_load(dataSet) {
                if (dataSet.getAll().length == 0) {
                    window.document.getElementById('sys_emails_ht_id').innerHTML = '';
                }
            }
            
            function sys_emails_ht_result_ds_indexchange(dataSet, record) {
                var html = window.document.getElementById('sys_emails_ht_id');
                var height = document.getElementById('sys_emails_ht_grid_wrap').offsetHeight;
                html.style.backgroundColor = '#d0e6f5';
                html.style.height = height + 'px';
                html.style.overflowY = 'auto';
                var recipient_name = record.get('recipient_name');
                if (recipient_name == 'undefined' || recipient_name == '' || recipient_name == null) {
                    recipient_name = '';
                }
                  var note = record.get('request_error_content');
                if (note == 'undefined' || note == '' || note == null) {
                    note = '';
                }
                   var recipient_mail = record.get('recipient_mail');
                if (recipient_mail == 'undefined' || recipient_mail == '' || recipient_mail == null) {
                    recipient_mail = '';
                }
                var text = '<button onclick="resend_emails_ht(' + record.get('record_id') + ')" style="margin-top:15px;background-color: #19a2d5;cursor:pointer;border: 1px solid #19a2d5;color:#fff;margin-left:20px;width:100px;height:50px;font-size:16px;">重新发送</button><p style="font-weight:bold;margin-top:0;padding:30px 0 0 20px;">主题：' + record.get('msg_title') + '</p><p><t style="font-weight:bold;padding:0 0 0 20px;">收件人：</t><t>' + recipient_mail + '</p><p><t style="font-weight:bold;padding:0 0 0 20px;">时间：</t><t>' + record.get('creation_date_desc') + '</t></p><p style="font-weight:bold;padding:0 20px 0 20px;">正文：</p>' + '<div style="padding:0 20px 0 20px">' + record.get('msg_content') + '</div>'+ '<br/><p><t style="font-weight:bold;padding:0 20px 0 20px;">错误消息：</t><t>' + note + '</t></p>';
                html.innerHTML = text;
                html.style.display = 'block';
            }
            
            /* 短信待发 */
            
            function resend_sms_list(record_id) {
                var record = $('sys_sms_list_result_ds').find('record_id', record_id);
                Aurora.showConfirm('${l:PROMPT}', '确定重新发送此短信吗？', function() {
                    Aurora.Masker.mask(Ext.getBody());
                    Aurora.request({
                        url: $('msg_sys_email_resend_link').getUrl(),
                        para: {
                            'record_id': record.get('record_id')
                        },
                        success: function() {
                            Aurora.Masker.unmask(Ext.getBody());
                            Aurora.showMessage('${l:PROMPT}', '短信已重新发送。');
                        },
                        error: function() {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        failure: function() {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        scope: this
                    });
                }, null, null, 80);
            }
            
            function sys_sms_list_result_ds_load(dataSet) {
                if (dataSet.getAll().length == 0) {
                    window.document.getElementById('sys_sms_list_id').innerHTML = '';
                }
            }
            
            function sys_sms_list_result_ds_indexchange(dataSet, record) {
                var html = window.document.getElementById('sys_sms_list_id');
                var height = document.getElementById('sys_sms_list_grid_wrap').offsetHeight;
                html.style.backgroundColor = '#d0e6f5';
                html.style.height = height + 'px';
                html.style.overflowY = 'auto';
                var recipient_name = record.get('recipient_name');
                var note = record.get('request_error_content');
                var recipient_mobile = record.get('recipient_mobile');
                if (recipient_mobile == 'undefined' || recipient_mobile == '' || recipient_mobile == null) {
                    recipient_mobile = '';
                }
                 var msg_title = record.get('msg_title');
                if (msg_title == 'undefined' || msg_title == '' || msg_title == null) {
                    msg_title = '';
                }
                if (note == 'undefined' || note == '' || note == null) {
                    note = '';
                }
                if (recipient_name == 'undefined' || recipient_name == '' || recipient_name == null) {
                    recipient_name = '';
                }
                   var recipient_mobile = record.get('recipient_mobile');
                if (recipient_mobile == 'undefined' || recipient_mobile == '' || recipient_mobile == null) {
                    recipient_mobile = '';
                }
                var text = '<button onclick="resend_sms_list(' + record.get('record_id') + ')" style="margin-top:15px;background-color: #19a2d5;cursor:pointer;border: 1px solid #19a2d5;color:#fff;margin-left:20px;width:100px;height:50px;font-size:16px;">重新发送</button><p style="font-weight:bold;margin-top:0;padding:30px 0 0 20px;">主题：' + msg_title + '</p><p><t style="font-weight:bold;padding:0 0 0 20px;">收件人：</t><t>' + recipient_mobile + '</p><p><t style="font-weight:bold;padding:0 0 0 20px;">时间：</t><t>' + record.get('creation_date_desc') + '</t></p><p style="font-weight:bold;padding:0 20px 0 20px;">正文：</p>' + '<div style="padding:0 20px 0 20px">' + record.get('msg_content') + '</div>'+ '<br/><p><t style="font-weight:bold;padding:0 20px 0 20px;">错误消息：</t><t>' + note + '</t></p>';;
                html.innerHTML = text;
                html.style.display = 'block';
            }
            
            /*   短信已发 */
            
            function resend_sms_ht(record_id) {
                var record = $('sys_sms_ht_result_ds').find('record_id', record_id);
                Aurora.showConfirm('${l:PROMPT}', '确定重新发送此短信吗？', function() {
                    Aurora.Masker.mask(Ext.getBody());
                    Aurora.request({
                        url: $('msg_sys_email_resend_link').getUrl(),
                        para: {
                            'record_id': record.get('record_id')
                        },
                        success: function() {
                            Aurora.Masker.unmask(Ext.getBody());
                            Aurora.showMessage('${l:PROMPT}', '短信已重新发送。');
                        },
                        error: function() {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        failure: function() {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        scope: this
                    });
                }, null, null, 80);
            }
            
            function sys_sms_ht_result_ds_load(dataSet) {
                if (dataSet.getAll().length == 0) {
                    window.document.getElementById('sys_sms_ht_id').innerHTML = '';
                }
            }
            
            function sys_sms_ht_result_ds_indexchange(dataSet, record) {
                var html = window.document.getElementById('sys_sms_ht_id');
                var height = document.getElementById('sys_sms_ht_grid_wrap').offsetHeight;
                html.style.backgroundColor = '#d0e6f5';
                html.style.height = height + 'px';
                html.style.overflowY = 'auto';
                var recipient_name = record.get('recipient_name');
                var recipient_mobile = record.get('recipient_mobile');
                if (recipient_name == 'undefined' || recipient_name == '' || recipient_name == null) {
                    recipient_name = '';
                }
                if (recipient_mobile == 'undefined' || recipient_mobile == '' || recipient_mobile == null) {
                    recipient_mobile = '';
                }
                  var note = record.get('request_error_content');
                if (note == 'undefined' || note == '' || note == null) {
                    note = '';
                }
                    var msg_title = record.get('msg_title');
                if (msg_title == 'undefined' || msg_title == '' || msg_title == null) {
                    msg_title = '';
                }
                var text = '<button onclick="resend_sms_ht(' + record.get('record_id') + ')" style="margin-top:15px;background-color: #19a2d5;cursor:pointer;border: 1px solid #19a2d5;color:#fff;margin-left:20px;width:100px;height:50px;font-size:16px;">重新发送</button><p style="font-weight:bold;margin-top:0;padding:30px 0 0 20px;">主题：' + msg_title+ '</p><p><t style="font-weight:bold;padding:0 0 0 20px;">收件人：</t><t>' + recipient_mobile + '</p><p><t style="font-weight:bold;padding:0 0 0 20px;">时间：</t><t>' + record.get('creation_date_desc') + '</t></p><p style="font-weight:bold;padding:0 20px 0 20px;">正文：</p>' + '<div style="padding:0 20px 0 20px">' + record.get('msg_content') + '</div>'+ '<br/><p><t style="font-weight:bold;padding:0 20px 0 20px;">错误消息：</t><t>' + note + '</t></p>';
                html.innerHTML = text;
                html.style.display = 'block';
            } /* 系统消息 */
            
            
            function sys_msg_ht_result_ds_load(dataSet) {
                if (dataSet.getAll().length == 0) {
                    window.document.getElementById('sys_msg_ht_id').innerHTML = '';
                }
            }
            
            function sys_msg_ht_result_ds_indexchange(dataSet, record) {
                var html = window.document.getElementById('sys_msg_ht_id');
                var height = document.getElementById('sys_msg_ht_grid_wrap').offsetHeight;
                html.style.backgroundColor = '#d0e6f5';
                html.style.height = height + 'px';
                html.style.overflowY = 'auto';
                var note = record.get('request_error_content');
                if (note == 'undefined' || note == '' || note == null) {
                    note = '';
                }
                var text = '<p style="font-weight:bold;margin-top:0;padding:30px 0 0 20px;">主题：' + record.get('msg_title') + '</p><p><t style="font-weight:bold;padding:0 0 0 20px;">收件人：</t><t>' + '' + '</p><p><t style="font-weight:bold;padding:0 0 0 20px;">时间：</t><t>' + record.get('creation_date_desc') + '</t></p><p style="font-weight:bold;padding:0 20px 0 20px;">正文：</p>' + record.get('msg_content') + '<br/><p><t style="font-weight:bold;padding:0 20px 0 20px;">错误消息：</t><t>' + note + '</t></p>';
                html.innerHTML = text;
                html.style.display = 'block';
            }
        ]]></script>
        <a:dataSets>
            <a:dataSet id="sys_push_object_type_ds">
                <a:datas>
                    <a:record code_value="ALL" code_value_name="全部用户"/>
                    <a:record code_value="SINGLE" code_value_name="单一用户"/>
                </a:datas>
            </a:dataSet>
            <!--  邮件待发 -->
            <a:dataSet id="sys_emails_list_query_ds"/>
            <a:dataSet id="sys_emails_list_result_ds" autoCount="true" autoPageSize="true" autoQuery="true" model="msg.sys_message_mail_list" queryDataSet="sys_emails_list_query_ds" selectable="true">
                <a:events>
                    <a:event name="load" handler="sys_emails_list_result_ds_load"/>
                    <a:event name="indexchange" handler="sys_emails_list_result_ds_indexchange"/>
                </a:events>
                <a:fields>
                    <a:field name="resend_flag" checkedValue="Y" defaultValue="Y" readOnly="true" uncheckedValue="N"/>
                </a:fields>
            </a:dataSet>
            <!--  邮件已发 -->
            <a:dataSet id="sys_emails_ht_query_ds"/>
            <a:dataSet id="sys_emails_ht_result_ds" autoCount="true" autoPageSize="true" autoQuery="false" model="msg.sys_message_mail_ht" queryDataSet="sys_emails_ht_query_ds" selectable="true">
                <a:events>
                    <a:event name="load" handler="sys_emails_ht_result_ds_load"/>
                    <a:event name="indexchange" handler="sys_emails_ht_result_ds_indexchange"/>
                </a:events>
                <a:fields>
                    <a:field name="resend_flag" checkedValue="Y" defaultValue="Y" readOnly="true" uncheckedValue="N"/>
                </a:fields>
            </a:dataSet>
            <!--  短信待发 -->
            <a:dataSet id="sys_sms_list_query_ds"/>
            <a:dataSet id="sys_sms_list_result_ds" autoCount="true" autoPageSize="true" autoQuery="false" model="msg.sys_message_sms_list" queryDataSet="sys_sms_list_query_ds" selectable="true">
                <a:events>
                    <a:event name="load" handler="sys_sms_list_result_ds_load"/>
                    <a:event name="indexchange" handler="sys_sms_list_result_ds_indexchange"/>
                </a:events>
                <a:fields>
                    <a:field name="resend_flag" checkedValue="Y" defaultValue="Y" readOnly="true" uncheckedValue="N"/>
                </a:fields>
            </a:dataSet>
            <!--  短信已发 -->
            <a:dataSet id="sys_sms_ht_query_ds"/>
            <a:dataSet id="sys_sms_ht_result_ds" autoCount="true" autoPageSize="true" autoQuery="false" model="msg.sys_message_sms_ht" queryDataSet="sys_sms_ht_query_ds" selectable="true">
                <a:events>
                    <a:event name="load" handler="sys_sms_ht_result_ds_load"/>
                    <a:event name="indexchange" handler="sys_sms_ht_result_ds_indexchange"/>
                </a:events>
                <a:fields>
                    <a:field name="resend_flag" checkedValue="Y" defaultValue="Y" readOnly="true" uncheckedValue="N"/>
                </a:fields>
            </a:dataSet>
            <!--系统消息 -->
            <a:dataSet id="sys_messages_query_ds" autoCreate="true">
                <a:fields>
                    <a:field name="push_object_type"/>
                    <a:field name="push_object_type_desc" displayField="code_value_name" options="sys_push_object_type_ds" returnField="push_object_type" valueField="code_value"/>
                </a:fields>
            </a:dataSet>
            <a:dataSet id="sys_messages_result_ds" autoCount="true" autoPageSize="true" autoQuery="false" model="msg.sys_message_msg_list" queryDataSet="sys_messages_query_ds" selectable="true">
                <a:fields>
                    <a:field name="read_flag" checkedValue="Y" uncheckedValue="N"/>
                    <a:field name="message_content" readOnly="true"/>
                </a:fields>
            </a:dataSet>
            <!--  APP -->
            <a:dataSet id="sys_app_message_sent_query_ds"/>
            <a:dataSet id="sys_app_message_sent_result_ds" autoCount="true" autoPageSize="true" autoQuery="false" model="msg.app_message_send_list" queryDataSet="sys_app_message_sent_query_ds" selectable="true"/>
            <a:dataSet id="sys_app_message_sent_ht_query_ds"/>
            <a:dataSet id="sys_app_message_sent_ht_result_ds" autoCount="true" autoPageSize="true" autoQuery="false" model="msg.app_message_send_ht_list" queryDataSet="sys_app_message_sent_ht_query_ds" selectable="true">
                <a:fields>
                    <a:field name="read_flag" checkedValue="Y" uncheckedValue="N"/>
                </a:fields>
            </a:dataSet>
            <a:dataSet id="sys_app_errors_query_ds">
                <a:fields>
                    <a:field name="message_date_from" required="true"/>
                    <a:field name="message_date_to" required="true"/>
                </a:fields>
                <a:events>
                    <a:event name="add" handler="on_sys_app_errors_query_ds_add"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="sys_app_errors_result_ds" autoCount="true" autoPageSize="true" autoQuery="false" model="msg.sys_raise_app_errors" queryDataSet="sys_app_errors_query_ds" selectable="true">
                <a:fields>
                    <a:field name="read_flag" checkedValue="Y" uncheckedValue="N"/>
                    <a:field name="message_content" readOnly="true"/>
                    <a:field name="push_object_type"/>
                    <a:field name="push_object_type_desc" displayField="code_value_name" options="sys_push_object_type_ds" returnField="push_object_type" valueField="code_value"/>
                </a:fields>
            </a:dataSet>
        </a:dataSets>
        <a:screenBody>
            <a:tabPanel marginWidth="30">
                <a:tabs>
                    <!--  邮件 -->
                    <a:tab prompt="邮件待发列表" selected="true" width="120">
                        <a:queryForm bindTarget="sys_emails_list_query_ds" resultTarget="sys_emails_list_result_ds" style="width:100%;border:none">
                            <a:formToolBar>
                                <a:hBox labelWidth="100">
                                    <a:textField name="msg_title" bindTarget="sys_emails_list_query_ds" prompt="邮件主题">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_emails_list_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="msg_content" bindTarget="sys_emails_list_query_ds" prompt="邮件内容">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_emails_list_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="recipient_mail" bindTarget="sys_emails_list_query_ds" prompt="接收地址">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_emails_list_query"/>
                                        </a:events>
                                    </a:textField>
                                </a:hBox>
                            </a:formToolBar>
                            <a:formBody>
                                <a:hBox labelWidth="100">
                                    <a:datePicker name="creation_date_from" bindTarget="sys_emails_list_query_ds" prompt="发送时间从">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_emails_list_query"/>
                                        </a:events>
                                    </a:datePicker>
                                    <a:datePicker name="creation_date_to" bindTarget="sys_emails_list_query_ds" prompt="发送时间至">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_emails_list_query"/>
                                        </a:events>
                                    </a:datePicker>
                                </a:hBox>
                            </a:formBody>
                        </a:queryForm>
                        <a:grid id="sys_emails_list_grid" bindTarget="sys_emails_list_result_ds" marginHeight="160" navBar="true" style="margin-left:10px;float:left;" width="680">
                            <a:columns>
                                <a:column name="msg_title" prompt="邮件主题" width="200"/>
                                <a:column name="recipient_mail" prompt="接收地址" width="100"/>
                                <a:column name="status" align="center" prompt="发送状态" width="80"/>
                                <a:column name="resend_flag" prompt="重发标志" width="80"/>
                                <a:column name="creation_date_desc" align="center" prompt="创建时间" sortable="true" width="130"/>
                            </a:columns>
                        </a:grid>
                        <div id="sys_emails_list_id" style="margin-right:20px;"/>
                    </a:tab>
                    <a:tab prompt="邮件已发列表" selected="false" width="120">
                        <a:queryForm bindTarget="sys_emails_ht_query_ds" resultTarget="sys_emails_ht_result_ds" style="width:100%;border:none">
                            <a:formToolBar>
                                <a:hBox labelWidth="100">
                                    <a:textField name="msg_title" bindTarget="sys_emails_ht_query_ds" prompt="邮件主题">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_emails_ht_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="msg_content" bindTarget="sys_emails_ht_query_ds" prompt="邮件内容">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_emails_ht_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="recipient_mail" bindTarget="sys_emails_ht_query_ds" prompt="接收地址">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_emails_ht_query"/>
                                        </a:events>
                                    </a:textField>
                                </a:hBox>
                            </a:formToolBar>
                            <a:formBody>
                                <a:hBox labelWidth="100">
                                    <a:datePicker name="creation_date_from" bindTarget="sys_emails_ht_query_ds" prompt="发送时间从">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_emails_ht_query"/>
                                        </a:events>
                                    </a:datePicker>
                                    <a:datePicker name="creation_date_to" bindTarget="sys_emails_ht_query_ds" prompt="发送时间至">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_emails_ht_query"/>
                                        </a:events>
                                    </a:datePicker>
                                </a:hBox>
                            </a:formBody>
                        </a:queryForm>
                        <a:grid id="sys_emails_ht_grid" autoFocus="true" bindTarget="sys_emails_ht_result_ds" marginHeight="160" navBar="true" style="margin-left:10px;float:left;" width="680">
                            <a:columns>
                                <a:column name="msg_title" prompt="邮件主题" width="200"/>
                                <a:column name="recipient_mail" prompt="接收地址" width="100"/>
                                <a:column name="status" align="center" prompt="发送状态" width="80"/>
                                <a:column name="resend_flag" prompt="重发标志" width="80"/>
                                <a:column name="creation_date_desc" align="center" prompt="发送时间" sortable="true" width="130"/>
                            </a:columns>
                        </a:grid>
                        <div id="sys_emails_ht_id" style="margin-right:20px;"/>
                    </a:tab>
                    <!--  短信 -->
                    <a:tab prompt="短信待发列表" selected="false" width="120">
                        <a:queryForm bindTarget="sys_sms_list_query_ds" resultTarget="sys_sms_list_result_ds" style="width:100%;border:none">
                            <a:formToolBar>
                                <a:hBox labelWidth="100">
                                    <a:textField name="msg_title" bindTarget="sys_sms_list_query_ds" prompt="短信主题">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_sms_list_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="msg_content" bindTarget="sys_sms_list_query_ds" prompt="短信内容">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_sms_list_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="recipient_mobile" bindTarget="sys_sms_list_query_ds" prompt="短信地址">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_sms_list_query"/>
                                        </a:events>
                                    </a:textField>
                                </a:hBox>
                            </a:formToolBar>
                            <a:formBody>
                                <a:hBox labelWidth="100">
                                    <a:datePicker name="creation_date_from" bindTarget="sys_sms_list_query_ds" prompt="发送时间从">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_sms_list_query"/>
                                        </a:events>
                                    </a:datePicker>
                                    <a:datePicker name="creation_date_to" bindTarget="sys_sms_list_query_ds" prompt="发送时间至">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_sms_list_query"/>
                                        </a:events>
                                    </a:datePicker>
                                </a:hBox>
                            </a:formBody>
                        </a:queryForm>
                        <a:grid id="sys_sms_list_grid" bindTarget="sys_sms_list_result_ds" marginHeight="160" navBar="true" style="margin-left:10px;float:left;" width="680">
                            <a:columns>
                                <a:column name="msg_title" prompt="短信主题" width="200"/>
                                <a:column name="recipient_mobile" prompt="接收地址" width="100"/>
                                <a:column name="status" align="center" prompt="发送状态" width="80"/>
                                <a:column name="resend_flag" prompt="重发标志" width="80"/>
                                <a:column name="creation_date_desc" align="center" prompt="创建时间" sortable="true" width="130"/>
                            </a:columns>
                        </a:grid>
                        <div id="sys_sms_list_id" style="margin-right:20px;"/>
                    </a:tab>
                    <a:tab prompt="短信已发列表" selected="false" width="120">
                        <a:queryForm bindTarget="sys_sms_ht_query_ds" resultTarget="sys_sms_ht_result_ds" style="width:100%;border:none">
                            <a:formToolBar>
                                <a:hBox labelWidth="100">
                                    <a:textField name="msg_title" bindTarget="sys_sms_ht_query_ds" prompt="短信主题">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_sms_ht_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="msg_content" bindTarget="sys_sms_ht_query_ds" prompt="短信内容">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_sms_ht_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="recipient_mobile" bindTarget="sys_sms_ht_query_ds" prompt="接收地址">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_sms_ht_query"/>
                                        </a:events>
                                    </a:textField>
                                </a:hBox>
                            </a:formToolBar>
                            <a:formBody>
                                <a:hBox labelWidth="100">
                                    <a:datePicker name="creation_date_from" bindTarget="sys_sms_ht_query_ds" prompt="发送时间从">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_sms_ht_query"/>
                                        </a:events>
                                    </a:datePicker>
                                    <a:datePicker name="creation_date_to" bindTarget="sys_sms_ht_query_ds" prompt="发送时间至">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_sms_ht_query"/>
                                        </a:events>
                                    </a:datePicker>
                                </a:hBox>
                            </a:formBody>
                        </a:queryForm>
                        <a:grid id="sys_sms_ht_grid" bindTarget="sys_sms_ht_result_ds" marginHeight="160" navBar="true" style="margin-left:10px;float:left;" width="680">
                            <a:columns>
                                <a:column name="msg_title" prompt="短信主题" width="200"/>
                                <a:column name="recipient_mobile" prompt="接收地址" width="100"/>
                                <a:column name="status" align="center" prompt="发送状态" width="80"/>
                                <a:column name="resend_flag" prompt="重发标志" width="80"/>
                                <a:column name="creation_date_desc" align="center" prompt="发送时间" sortable="true" width="130"/>
                            </a:columns>
                        </a:grid>
                        <div id="sys_sms_ht_id" style="margin-right:20px;"/>
                    </a:tab>
                    <!-- 系统消息 -->
                    <a:tab prompt="系统消息" selected="false" width="120">
                        <a:queryForm bindTarget="sys_messages_query_ds" resultTarget="sys_messages_result_ds" style="width:100%;border:none">
                            <a:formToolBar>
                                <a:hBox labelWidth="100">
                                    <a:textField name="message_title" bindTarget="sys_messages_query_ds" prompt="消息标题">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_messages_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="message_content" bindTarget="sys_messages_query_ds" prompt="消息内容">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_messages_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:datePicker name="message_time_from" bindTarget="sys_messages_query_ds" prompt="消息时间从">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_messages_query"/>
                                        </a:events>
                                    </a:datePicker>
                                    <a:datePicker name="message_time_to" bindTarget="sys_messages_query_ds" prompt="消息时间至">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_messages_query"/>
                                        </a:events>
                                    </a:datePicker>
                                </a:hBox>
                            </a:formToolBar>
                            <a:formBody>
                                <a:hBox labelWidth="100">
                                    <a:comboBox name="push_object_type_desc" bindTarget="sys_messages_query_ds" prompt="接收对象">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_messages_query"/>
                                        </a:events>
                                    </a:comboBox>
                                    <a:textField name="user_code_name" bindTarget="sys_messages_query_ds" emptyText="账号和名称模糊查询" prompt="接收人">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_messages_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="user_name" bindTarget="sys_messages_query_ds" emptyText="账号精确查询" prompt="接收人">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_messages_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="user_desc" bindTarget="sys_messages_query_ds" emptyText="名称精确查询" prompt="接收人">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_messages_query"/>
                                        </a:events>
                                    </a:textField>
                                </a:hBox>
                            </a:formBody>
                        </a:queryForm>
                        <a:grid id="sys_messages_grid" bindTarget="sys_messages_result_ds" marginHeight="160" marginWidth="70" navBar="true" width="1000">
                            <a:columns>
                                <a:column name="message_title" prompt="消息标题" width="100"/>
                                <a:column name="message_content" editor="sys_messages_grid_ta" prompt="消息内容" width="300"/>
                                <a:column name="message_time" align="center" prompt="消息时间" width="100"/>
                                <a:column name="push_object_type_desc" align="center" prompt="接收对象" width="80"/>
                                <a:column name="details" align="center" prompt="接收人明细" renderer="sys_messages_grid_renderer" width="60"/>
                            </a:columns>
                            <a:editors>
                                <a:textArea id="sys_messages_grid_ta" readOnly="true"/>
                            </a:editors>
                        </a:grid>
                    </a:tab>
                    <!--   <div id="sys_msg_ht_id" style="margin-right:20px;"/> -->
                    <a:tab prompt="APP消息待发列表" selected="false" width="120">
                        <a:queryForm bindTarget="sys_app_message_sent_query_ds" resultTarget="sys_app_message_sent_result_ds" style="width:100%;border:none">
                            <a:formToolBar>
                                <a:hBox labelWidth="100">
                                    <a:textField name="title" bindTarget="sys_app_message_sent_query_ds" prompt="消息主题">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_message_sent_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="content" bindTarget="sys_app_message_sent_query_ds" prompt="消息内容">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_message_sent_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="business_group" bindTarget="sys_app_message_sent_query_ds" prompt="集团代码">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_message_sent_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="business_group_name" bindTarget="sys_app_message_sent_query_ds" prompt="集团名称">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_message_sent_query"/>
                                        </a:events>
                                    </a:textField>
                                </a:hBox>
                            </a:formToolBar>
                            <a:formBody>
                                <a:hBox labelWidth="100">
                                    <a:textField name="user_name" bindTarget="sys_app_message_sent_query_ds" prompt="接收账号">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_message_sent_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="user_desc" bindTarget="sys_app_message_sent_query_ds" prompt="接收人">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_message_sent_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:datePicker name="creation_date_from" bindTarget="sys_app_message_sent_query_ds" prompt="发送时间从">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_message_sent_query"/>
                                        </a:events>
                                    </a:datePicker>
                                    <a:datePicker name="creation_date_to" bindTarget="sys_app_message_sent_query_ds" prompt="发送时间至">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_message_sent_query"/>
                                        </a:events>
                                    </a:datePicker>
                                </a:hBox>
                            </a:formBody>
                        </a:queryForm>
                        <a:grid id="sys_app_message_sent_grid" bindTarget="sys_app_message_sent_result_ds" marginHeight="160" marginWidth="70" navBar="true" width="1000">
                            <a:columns>
                                <a:column name="title" editor="sys_app_message_sent_grid_ta" prompt="消息主题" width="100"/>
                                <a:column name="content" editor="sys_app_message_sent_grid_ta" prompt="消息内容" width="150"/>
                                <a:column name="business_group" align="center" prompt="集团代码" width="80"/>
                                <a:column name="business_group_name" prompt="集团名称" width="200"/>
                                <a:column name="user_name" align="center" prompt="接收账号" width="80"/>
                                <a:column name="user_desc" prompt="接收人" width="80"/>
                                <a:column name="creation_date_desc" align="center" prompt="发送时间" width="100"/>
                            </a:columns>
                            <a:editors>
                                <a:textArea id="sys_app_message_sent_grid_ta" readOnly="true"/>
                            </a:editors>
                        </a:grid>
                    </a:tab>
                    <a:tab prompt="APP消息已发列表" selected="false" width="120">
                        <a:queryForm bindTarget="sys_app_message_sent_ht_query_ds" resultTarget="sys_app_message_sent_ht_result_ds" style="width:100%;border:none">
                            <a:formToolBar>
                                <a:hBox labelWidth="100">
                                    <a:textField name="title" bindTarget="sys_app_message_sent_ht_query_ds" prompt="消息主题">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_message_sent_ht_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="content" bindTarget="sys_app_message_sent_ht_query_ds" prompt="消息内容">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_message_sent_ht_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="business_group" bindTarget="sys_app_message_sent_ht_query_ds" prompt="集团代码">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_message_sent_ht_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="business_group_name" bindTarget="sys_app_message_sent_ht_query_ds" prompt="集团名称">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_message_sent_ht_query"/>
                                        </a:events>
                                    </a:textField>
                                </a:hBox>
                            </a:formToolBar>
                            <a:formBody>
                                <a:hBox labelWidth="100">
                                    <a:textField name="user_name" bindTarget="sys_app_message_sent_ht_query_ds" prompt="接收账号">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_message_sent_ht_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="user_desc" bindTarget="sys_app_message_sent_ht_query_ds" prompt="接收人">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_message_sent_ht_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:datePicker name="push_date_from" bindTarget="sys_app_message_sent_ht_query_ds" prompt="接收时间从">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_message_sent_ht_query"/>
                                        </a:events>
                                    </a:datePicker>
                                    <a:datePicker name="push_date_to" bindTarget="sys_app_message_sent_ht_query_ds" prompt="接收时间至">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_message_sent_ht_query"/>
                                        </a:events>
                                    </a:datePicker>
                                </a:hBox>
                            </a:formBody>
                        </a:queryForm>
                        <a:grid id="sys_app_message_sent_ht_grid" bindTarget="sys_app_message_sent_ht_result_ds" marginHeight="160" marginWidth="70" navBar="true" width="1000">
                            <a:columns>
                                <a:column name="title" editor="sys_app_message_sent_ht_grid_ta" prompt="消息主题" width="100"/>
                                <a:column name="content" editor="sys_app_message_sent_ht_grid_ta" prompt="消息内容" width="150"/>
                                <a:column name="business_group" align="center" prompt="集团代码" width="80"/>
                                <a:column name="business_group_name" prompt="集团名称" width="200"/>
                                <a:column name="user_name" align="center" prompt="接收账号" width="80"/>
                                <a:column name="user_desc" prompt="接收人" width="80"/>
                                <a:column name="push_date_desc" align="center" prompt="接收时间" width="100"/>
                                <a:column name="read_flag" prompt="已读" width="80"/>
                            </a:columns>
                            <a:editors>
                                <a:textArea id="sys_app_message_sent_ht_grid_ta" readOnly="true"/>
                            </a:editors>
                        </a:grid>
                    </a:tab>
                    <a:tab prompt="系统错误信息" selected="false" width="120">
                        <a:queryForm bindTarget="sys_app_errors_query_ds" resultTarget="sys_app_errors_result_ds" style="width:100%;border:none">
                            <a:formToolBar>
                                <a:hBox labelWidth="100">
                                    <a:textField name="message_code" bindTarget="sys_app_errors_query_ds" prompt="消息代码">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_errors_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="message" bindTarget="sys_app_errors_query_ds" prompt="消息内容">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_errors_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:datePicker name="message_date_from" bindTarget="sys_app_errors_query_ds" prompt="消息时间从">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_errors_query"/>
                                        </a:events>
                                    </a:datePicker>
                                    <a:datePicker name="message_date_to" bindTarget="sys_app_errors_query_ds" prompt="消息时间至">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_errors_query"/>
                                        </a:events>
                                    </a:datePicker>
                                </a:hBox>
                            </a:formToolBar>
                            <a:formBody>
                                <a:hBox labelWidth="100">
                                    <a:textField name="package_name" bindTarget="sys_app_errors_query_ds" prompt="包名">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_errors_query"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="procedure_function_name" bindTarget="sys_app_errors_query_ds" prompt="过程/方法名">
                                        <a:events>
                                            <a:event name="enterdown" handler="sys_app_errors_query"/>
                                        </a:events>
                                    </a:textField>
                                </a:hBox>
                            </a:formBody>
                        </a:queryForm>
                        <a:grid id="sys_app_errors_grid" bindTarget="sys_app_errors_result_ds" marginHeight="160" marginWidth="70" navBar="true" width="1000">
                            <a:columns>
                                <a:column name="message_code" editor="sys_app_errors_grid_ta" prompt="消息代码" width="100"/>
                                <a:column name="message" editor="sys_app_errors_grid_ta" prompt="消息内容" width="300"/>
                                <a:column name="message_date" align="center" prompt="消息时间" width="100"/>
                                <a:column name="package_name" prompt="包名" width="100"/>
                                <a:column name="procedure_function_name" prompt="过程/方法名" width="100"/>
                                <a:column name="user_name" prompt="触发用户" width="120"/>
                            </a:columns>
                            <a:editors>
                                <a:textArea id="sys_app_errors_grid_ta" readOnly="true"/>
                            </a:editors>
                        </a:grid>
                    </a:tab>
                </a:tabs>
            </a:tabPanel>
        </a:screenBody>
    </a:view>
</a:screen>

<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: hansen  
    $Date: 2015-6-9 上午11:24:22  
    $Revision: 1.0  
    $Purpose: 
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application">
    <a:init-procedure>
        <a:model-query fetchAll="true" model="sys.sys_user_infor" rootPath="sys_user_infor"/>
        <!-- <a:model-query fetchAll="true" model="sys.sys_user_main_message" rootPath="sys_user_main_message"/> -->
    </a:init-procedure>
    <a:view>
        <a:link id="sys_sys_user_authority_save_link" url="${/request/@context_path}/modules/sys/SYS8220/sys_user_authority_save.svc"/>
        <a:link id="sys_user_email_send_link" model="wfl.WFL1001.sys_user_update_email" modelaction="insert"/>
        <a:link id="sys_user_email_update_link" model="wfl.WFL1001.sys_user_update_email" modelaction="update"/>
        <a:link id="sys_user_infor_update_link" model="sys.sys_user_infor" modelaction="update"/>
        <a:link id="sys_user_phone_update_link" model="sys.sys_user_infor" modelaction="insert"/>
        <a:link id="fnd_para_sm_link" url="${/request/@context_path}/modules/sms/sys_sms_para_send.svc"/>
        <link href="${/request/@context_path}/css/main/main-person.css" rel="stylesheet" type="text/css"/>
        <script language="JavaScript" src="${/request/@context_path}/index/js/jquery-1.8.3.min.js"/>
        <script><![CDATA[jQuery.noConflict();]]></script>
        <script><![CDATA[
            var sys_user_mobile = '${/model/sys_user_infor/record/@mobile_phone}';
            var sys_user_email = '${/model/sys_user_infor/record/@email}';
            var sys_user_name = '${/model/sys_user_infor/record/@user_name}';
            
            function init() {
                var p = document.getElementById('sys_user_mobile_id').children;
                var p1 = document.getElementById('sys_user_email_id').children;
                var mobile = getId('sys_user_mobileSet');
                var mail = getId('sys_user_mailSet');
                if (Aurora.isEmpty(sys_user_mobile)) {
                    p[2].style.display = 'block';
                } else {
                    p[0].style.display = 'block';
                }
                if (Aurora.isEmpty(sys_user_email)) {
                    p1[2].style.display = 'block';
                } else {
                    p1[0].style.display = 'block';
                }
                //initLi();
                //sys_user_inforInit();
                //sys_user_scrollInit();
            }
            
            function sys_user_inforInit() {
                var desc = (document.getElementById('sys_userDescription')).getElementsByTagName('input')[0];
                desc.style.backgroundColor = '#fff';
                var description = getId('sys_userDescription');
                description.children[0].children[0].style.fontSize = '14px';
                var span = document.getElementById('sys_user_notRead_count');
                var ul = document.getElementById('sys_user_not_read_list');
                var records = $('sys_userNotRead_ds').getAll();
                debugger;
                span.innerText = records.length;
                ul.innerHTML = '';
                for (var i = 0;i < ((records.length > 3) ? 3 : records.length);i++) {
                    var data = records[i].data;
                    var li = document.createElement('li');
                    var html = '';
                    html += '<div class="left-title">' + data.message_title + '</div>';
                    html += '<div class="left-content">' + data.message_content + '</div>';
                    li.innerHTML = html;
                    ul.appendChild(li);
                }
            }
            
            function getId(id) {
                return document.getElementById(id);
            }
            var liObj = {
                last_li: null,
                last_div: null
            };
            
            function initLi() {
                liObj.last_li = document.getElementById("sys_li_1");
                liObj.last_div = document.getElementById("content_son_1");
                var ul = document.getElementById('sys_user_ul');
                var children = ul.children;
                for (var i = 0;i < children.length;i++) {
                    children[i].index = i;
                    children[i].onclick = function() {
                        sys_user_li_click(this);
                        /* if(this.index == 4){
                         sys_userResultDsGridRendererEdit('${/model/sys_user_infor/record/@user_id}');
                         } */
                    };
                }
            }
            
            function sys_user_li_click(_this) {
                var id = _this.getAttribute('content_id');
                var show_div = document.getElementById(id);
                liObj.last_li.style.backgroundColor = '#333333';
                liObj.last_div.style.display = 'none';
                liObj.last_li.onmouseover = function() {
                    this.style.backgroundColor = '#000';
                };
                liObj.last_li.onmouseout = function() {
                    this.style.backgroundColor = '#333333';
                };
                _this.style.backgroundColor = '#000';
                show_div.style.display = 'block';
                liObj.last_li = _this;
                liObj.last_div = show_div;
                liObj.last_li.onmouseover = null;
                liObj.last_li.onmouseout = null;
            }
            //底部布局初始化
            
            function sys_user_scrollInit() {
                sys_user_bottom_position();
                window.onscroll = function() {
                    sys_user_bottom_position();
                };
            
            }
            
            function sys_user_bottom_position() {
                var foot = jQuery('#sys_user_foot');
                var content = jQuery('#content_son_1');
                if (foot.offset().top - content.offset().top >= content.height() + 70) {
                    foot.css('position', 'relative');
                    var screen_height = jQuery(window).height();
                    var body_height = jQuery('body').height();
                    var total_scroll = body_height - screen_height;
                    var scroll_top = jQuery(window).scrollTop();
                    if (scroll_top < total_scroll - 46 - 60) {
                        foot.css('position', 'fixed');
                    }
                } else {
                    foot.css('position', 'fixed');
                }
            }
            //切换到其他页面
            
            function sys_tab_switch(id) {
                var hide = jQuery('#content_1');
                var show = jQuery('#' + id);
                var width = window.screen.availWidth;
                var hide_height = hide.height() - jQuery(window).scrollTop();
                var margin = width - (width - 1000) / 2;
                /* jQuery('#sys_user_foot').css('display','none');
                 jQuery('#sys_user_bottom').css('display','none'); */
                hide.animate({
                    'left': -margin + 'px'
                }, {
                    queue: false,
                    duration: 500
                });
            
                show.css({
                    'left': margin + 'px',
                    'top': -hide_height + 'px',
                    'display': 'block'
                });
                show.animate({
                    'left': 0 + 'px'
                }, {
                    queue: false,
                    duration: 500,
                    complete: function() {
                        hide.css('display', 'none');
                        show.css('top', '0');
                        jQuery('#sys_user_foot').css('display', 'none');
                        jQuery('#sys_user_bottom').css('display', 'none');
                        document.body.scrollTop = 0;
                        //jQuery('html, body').animate({ scrollTop:0 }, 'fast');
                    }
                });
            }
            //切换到主页面
            
            function sys_tab_switch_back(id) {
                var hide = jQuery('#' + id);
                var show = jQuery('#content_1');
                var width = window.screen.availWidth;
                var show_height = show.height();
                show.css('display', 'block');
                hide.css('top', -show_height + 'px');
                jQuery('#sys_user_foot').css('display', 'block');
                jQuery('#sys_user_bottom').css('display', 'block');
                hide.animate({
                    'left': width + 'px'
                }, {
                    queue: false,
                    duration: 500,
                    complete: function() {
                        hide.css({
                            'top': '0',
                            'left': '0',
                            'display': 'none'
                        });
                    }
                });
                show.animate({
                    'left': 0 + 'px'
                }, {
                    queue: false,
                    duration: 500
                });
            }
            
            function sys_user_message_click() {
                var div = jQuery('#sys_user_msgholder');
                div.slideToggle();
            }
            //基本信息修改
            
            function sys_user_baseInforModefiy(_this) {
                var desc = document.getElementById('sys_userDescription');
                var input = desc.getElementsByTagName('input')[0];
                var ds = $('sys_userInfor_ds').getAll()[0];
                ds.getField('description').setReadOnly(false);
                desc.style.border = '1px solid #bababa';
                input.style.backgroundColor = '#fff';
                _this.innerText = '完成';
                _this.nextSibling.style.display = 'block';
                _this.nextSibling.nextSibling.style.display = 'block';
                _this.onclick = sys_user_baseInforSubmit;
            }
            
            function sys_user_baseInforCancel(_this) {
                var parent = _this.parentNode;
                var desc = document.getElementById('sys_userDescription');
                var input = desc.getElementsByTagName('input')[0];
                desc.style.border = '0';
                input.style.backgroundColor = '#fff';
                parent.children[0].innerText = '修改';
                parent.children[0].onclick = function() {
                    sys_user_baseInforModefiy(this);
                };
                parent.children[1].style.display = 'none';
                parent.children[2].style.display = 'none';
            }
            
            function sys_user_baseInforSubmit() {
                var ds = $('sys_userInfor_ds').getAll()[0];
                Aurora.request({
                    url: $('sys_user_infor_update_link').getUrl(),
                    para: {
                        'user_id': '${/model/sys_user_infor/record/@user_id}',
                        'description': ds.get('description'),
                        'start_date': ds.get('start_date'),
                        'end_date': ds.get('end_date'),
                        'frozen_flag': ds.get('frozen_flag'),
                        'session_user_id': ds.get('session_user_id'),
                        'mobile_phone': ds.get('mobile_phone'),
                        'email': ds.get('email'),
                        'mobile_phone_verify_flag': ds.get('mobile_phone_verify_flag'),
                        'email_verify_flag': ds.get('email_verify_flag')
                    },
                    success: function(res) {
                        var ds = $('sys_userInfor_ds').getAll()[0];
                        var _this = document.getElementById('sys_user_baseInfor_desc');
                        sys_user_baseInforCancel(_this);
                        var div = getId('sys_user_welcome_id');
                        div.innerText = '您好！' + ds.get('description');
                    },
                    scope: this
                });
            }
            
            //密码修改
            
            function updateSelfPassword_updatePasswordsumbit() {
                if ($('updateSelfPassword_ds').validate()) {
                    var record = $('updateSelfPassword_ds').getAt(0);
                    if (record.get('update_password') != record.get('confirm_password')) {
                        Aurora.showMessage('${l:PROMPT}', '${l:FND_PRV_SET_PASS.PWD_NO_EQU}', null, 250, 100);
                    } else {
                        $('updateSelfPassword_ds').submit();
                    }
                }
            }
            
            function updateSelfPassword_updatepasswordsuccess() {
                ///$('update_password_window').close();
                $('updateSelfPassword_ds').reset();
                Aurora.showMessage('${l:PROMPT}', '修改成功', null, 250, 100);
            }
            /*
             *****************手机绑定和修改
             *****************1 手机绑定
             *****************2 手机修改   a.验证身份
             ***************************b.设置新的手机号，发送短信验证
             */
            
            function sys_mobile_query(_this) {
                var id = _this.getAttribute('content_id');
                var ul = jQuery('#' + id);
                if (ul.is(':hidden')) {
                    _this.className = 'icon-angle-up';
                } else {
                    _this.className = 'icon-angle-down';
                }
                ul.slideToggle();
            }
            var mobile_step = 1;
            var sys_user_mobile_key;
            //手机ds初始化
            function sys_mobile_dsInit() {
                var ds = $('updateSelfMobile_ds').getAt(0);
                ds.getField('current_mobile').setRequired(false);
                ds.getField('update_mobile').setRequired(false);
                ds.getField('validate_code').setRequired(false);
                //sys_user_infor_dsInit();
            }
            //手机修改步骤下一步
            function sys_mobile_stepInto() {
                var ds = $('updateSelfMobile_ds').getAt(0);
                if (mobile_step == 1 || ($('updateSelfMobile_ds').validate() && $('sys_userInfor_ds').validate())) {
                    sys_mobile_dsInit();
                } else {
                    return;
                }
                if (mobile_step == 1) {
                    sys_user_mobile_next();
                    //验证码必输
                    //sys_user_infor_validateCodeSet();
                } else if (mobile_step == 2) {
                    sys_user_validateCode_byValidate('phone');
                } else if (mobile_step == 3) {
                    //修改
                    sys_user_validateCode_byValidate('phone_update');
                } else if (mobile_step == 4) {
                    sys_user_mobileBakcQuery();
                }
            }
            //手机修改页面设置下一步
            function sys_user_mobile_next() {
                var step_last = document.getElementById('content_3_step' + mobile_step);
                step_last.style.display = 'none';
                mobile_step = mobile_step == 4 ? 1 : mobile_step + 1;
                var step_next = document.getElementById('content_3_step' + mobile_step);
                step_next.style.display = 'block';
            }
            
            //验证身份时的回调函数
            function sys_user_messageValidata() {
                var ds = $('updateSelfMobile_ds').getAt(0);
                ds.getField('update_mobile').setRequired(true);
                sys_user_mobile_next();
                //设置新的手机号必输
                ds.getField('update_mobile').setRequired(true);
                //清空验证码
                sys_user_validateCode_reset();
            }
            //返回重新选择
            function sys_user_mobileBakcQuery() {
                var h_page = document.getElementById('content_3_step1');
                var n_page = document.getElementById('content_3_step' + mobile_step);
                n_page.style.display = 'none';
                h_page.style.display = 'block';
                mobile_step = 1;
                sys_mobile_dsInit();
                $('updateSelfMobile_ds').reset();
                //清空验证码
                sys_user_validateCode_reset();
            }
            //新手机验证通过后调用后台过程将手机号修改
            function sys_user_mobileSubmit() {
                var ds = $('sys_userInfor_ds').getAll()[0];
                var mobile = $('updateSelfMobile_ds').getCurrentRecord().get('update_mobile');
                Aurora.request({
                    url: $('sys_user_phone_update_link').getUrl(),
                    para: {
                        'user_id': '${/model/sys_user_infor/record/@user_id}',
                        'mobile_phone': mobile
                    },
                    success: function(res) {
                        var ds = $('sys_userInfor_ds').getAll()[0];
                        var p = getId('sys_user_mobile_now');
                        sys_user_mobile = $('updateSelfMobile_ds').getCurrentRecord().get('update_mobile');
                        document.getElementById('sys_user_mobileUpdated').innerText = sys_user_mobile;
                        p.innerText = sys_user_mobile;
                        sys_user_mobile_next();
                        var timeout = setTimeout(function() {
                            sys_mobile_stepInto();
                        }, 3000);
                    },
                    scope: this
                });
            }
            //绑定手机的提交事件
            function sys_user_set_mobile() {
                var ds = $('sys_userInfor_ds').getAll()[0];
                var mobile = $('updateSelfMobile_ds').getCurrentRecord().get('update_mobile');
                Aurora.request({
                    //url: $('sys_user_infor_update_link').getUrl(),
                    url: $('sys_user_phone_update_link').getUrl(),
                    para: {
                        'user_id': '${/model/sys_user_infor/record/@user_id}',
                        'mobile_phone': mobile
                    },
                    success: function(res) {
                        var ds = $('sys_userInfor_ds').getAll()[0];
                        var show = getId('contetn_7_step2');
                        var hide = getId('contetn_7_step1');
                        var span = getId('sys_user_mobile_set');
                        var p = getId('sys_user_mobile_now');
                        sys_user_mobile = $('updateSelfMobile_ds').getCurrentRecord().get('update_mobile');
                        show.style.display = 'block';
                        hide.style.display = 'none';
                        span.innerText = sys_user_mobile;
                        p.innerText = sys_user_mobile;
                        var timeout = setTimeout(function() {
                            sys_tab_switch_back('content_7');
                            var spans = getId('sys_user_mobile_id');
                            spans.children[0].style.display = 'block';
                            spans.children[2].style.display = 'none';
                            $('updateSelfMobile_ds').reset();
                            //清空验证码
                            sys_user_validateCode_reset();
                        }, 3000);
            
                    },
                    scope: this
                });
            }
            
            /*
             ****************验证身份设置（通用）--发送短信
             ****************修改手机和邮箱时首先验证身份
             */
            var vaildate_para = {
                validate_flag: false,
                back_function: null
            };
            //全局变量初始化
            function sys_user_messageValidate_init() {
                vaildate_para.validate_flag = false;
                vaildate_para.back_function = null;
            }
            //清空验证码
            function sys_user_validateCode_reset(){
                $('sys_userInfor_ds').getAt(0).set('validate_code','');
            }
            //设置验证码不必输
            function sys_user_infor_dsInit(){
                var ds = $('sys_userInfor_ds').getAt(0);
                ds.getField('validate_code').setRequired(false);
            }
            //设置验证码必输
            function sys_user_infor_validateCodeSet(){
                var ds = $('sys_userInfor_ds').getAt(0);
                ds.getField('validate_code').setRequired(true);
            }
            
            //绑定新手机时再次校验身份
            function sys_user_getMobileCode_byNewPhone(_this){
                if(!$('updateSelfMobile_ds').validate()){
                    return;
                }
                var user_ds = $('sys_userInfor_ds').getAt(0);
                var update_ds = $('updateSelfMobile_ds').getCurrentRecord();
                user_ds.set('mobile_phone',update_ds.get('update_mobile'));
                sys_user_messageValidate_init();
                sys_user_sendCode(_this);
            }
            //发送短信
            
            function sys_user_getMobileCode_byValidate(_this) {
                sys_user_messageValidate_init();
                sys_user_sendCode(_this);
            }
            
            function sys_user_sendCode(_this) {
                if(!_this.second){
                    _this.innerText = '60秒后重发';
                    _this.second = 60;
                    sys_user_sendMessage();
                }else{
                    Aurora.showMessage('提示','60秒内请勿重复发送！');
                    return;
                }
                var mobile_inter = setInterval(function() {
                    if (_this.second > 0) {
                        _this.second -= 1;
                        _this.innerText = _this.second + '秒后重发';
                    } else {
                        _this.innerText = '获取验证码';
                        clearInterval(mobile_inter);
                    }
                }, 1000);
            }
            //发送短信的api调用
            function sys_user_sendMessage() {
                var mobile = $('sys_userInfor_ds').getAt(0).get('mobile_phone');
                Aurora.request({
                    url: $('fnd_para_sm_link').getUrl(),
                    para: {
                        'action': 'validate_code',
                        //短信发送类型
                        'mobile': mobile,
                        // 手机号码组，支持群发，号码用";"隔开
                        'template': 'SYS_SMS_SEND_CODE',
                        // 短信内容
                        'overdue_date': '3000',
                        //过期时间
                        'reSend_date': '60',
                        //重发时间限制
                        'source': 'fnd9100',
                        //来源
                        'source_id': 'sys_user' + sys_user_name + mobile_step //来源id
                    },
                    success: function(rs) {
                        if (rs.result.action == 'validate_code') {
                            if (rs.result.error_message == null) {
                                sys_user_mobile_key = rs.result.key;
                            } else {
                                Aurora.showMessage('提示',rs.result.error_message);
                            }
                        }
                    },
                    scope: this,
                    sync: true
                });
            }
            //身份验证
            function sys_user_validateCode_byValidate(type) {
                switch (type) {
                case 'mail':
                    vaildate_para.back_function = 'sys_user_showNextStep()';
                    break;
                case 'phone':
                    vaildate_para.back_function = 'sys_user_messageValidata()';
                    break;
                case 'phone_update':
                    vaildate_para.back_function = 'sys_user_mobileSubmit()';
                    break;
                case 'phone_bind':
                    vaildate_para.back_function = 'sys_user_set_mobile()';
                    break;
                default:
                    break;
                }
                sys_user_mobileValidate_byValidate();
                //eval(vaildate_para.back_function);
            }
            //调用api验证短信验证码
            function sys_user_mobileValidate_byValidate() {
                if(!$('sys_userInfor_ds').validate()){
                    return;
                }
                var code = $('sys_userInfor_ds').getAt(0).get('validate_code');
                Aurora.request({
                    url: $('fnd_para_sm_link').getUrl(),
                    para: {
                        'action': 'validation',
                        //短信发送类型
                        'key': sys_user_mobile_key,
                        'code': code
                    },
                    success: function(rs) {
                        if (rs.result.validate_flag == 'Y') {
                            vaildate_para.validate_flag = true;
                            eval(vaildate_para.back_function);
                        } else if (rs.result.validate_flag == 'N') {
                            sys_user_infor_validateCodeSet();
                            Aurora.showMessage('提示', rs.result.error_message);
                        }
                    },
                    scope: this,
                    sync: true
                });
            }
            
            function sys_mobile_modify_password(){
                var p = getId('sys_phone_modify_password');
                var l = getId('content_3_step1');
                p.style.display = 'block';
                l.style.display = 'none';
                var html = '';
                html += '<iframe id="sys_user_modiy_phone_iframe" frameBorder="0" src="${/request/@context_path}/modules/wfl/WFL1001/sys_user_modify_phone.screen" onload="main_iFrameHeight(\'sys_user_modiy_phone_iframe\')"></iframe>';
                p.innerHTML = html;
            }
            
            function main_iFrameHeight(id) {
                var ifm = document.getElementById(id);
                ifm.style.width = '100%';
                ifm.style.height = '100%';
            }
            
            function sys_back(){
                var ifm = getId('sys_user_modiy_phone_iframe');
                ifm.parentNode.removeChild(ifm);
                var p = getId('content_3_step1');
                var l = getId('sys_phone_modify_password');
                p.style.display = 'block';
                l.style.display = 'none';
            }
            /*
             *****************邮箱修改和绑定设置
             *****************1 绑定邮箱无身份校验，发邮件提示，点击邮件链接后返回才修改
             *****************2 修改绑定邮箱 a.短信校验身份
             ***************************b.向新的邮箱发送邮件，点击邮件链接后返回才修改
             */
            var email_step = 1;
            //邮箱ds初始化
            function sys_user_mailDsInit() {
                var ds = $('updateSelfEmail_ds').getAt(0);
                ds.getField('current_email').setRequired(false);
                ds.getField('update_email').setRequired(false);
                ds.getField('email_verification_code').setRequired(false);
            }
            //修改邮箱下一步
            function sys_user_mailStepInto() {
                var ds = $('updateSelfEmail_ds').getAt(0);
                if (!$('updateSelfEmail_ds').validate()) {
                    return;
                } else {
                    sys_user_mailDsInit();
                }
                if (email_step == 1) {
                    sys_user_showNextStep();
                } else if (email_step == 2) {
                    //验证身份
                    sys_user_validateCode_byValidate('mail');
                    ds.getField('update_email').setRequired(true);
                } else if (email_step == 3) {
                    //向新邮箱发送邮件
                    sys_user_sendMail();
                }
            }
            //下一步页面设置
            function sys_user_showNextStep() {
                var step_last = document.getElementById('content_4_step' + email_step);
                step_last.style.display = 'none';
                email_step = email_step == 5 ? 1 : email_step + 1;
                var step_next = document.getElementById('content_4_step' + email_step);
                step_next.style.display = 'block';
                if (email_step == 5) {
                    var _record = $('updateSelfEmail_ds').getAt(0);
                    document.getElementById('sys_user_mailSuccess').innerText = '修改成功，新的邮箱是' + _record.get('update_email') + '！2秒后返回首页';
                    sys_user_email = _record.get('update_email');
                    var timeout = setTimeout(function() {
                        sys_user_showNextStep();
                        $('updateSelfEmail_ds').reset();
                    }, 2000);
                }
            }
            //修改邮箱时发送邮件
            function sys_user_sendMail() {
                var record = $('updateSelfEmail_ds').getAt(0);
                Aurora.request({
                    url: $('sys_user_email_send_link').getUrl(),
                    para: {
                        'user_id': '${/model/sys_user_infor/record/@user_id}',
                        'email': record.get('update_email'),
                        'check_url': window.location.protocol + '//' + window.location.host + '${/request/@context_path}/',
                        'type': 'UPDATE'
                    },
                    success: function(res) {
                        sys_user_showNextStep();
                    },
                    scope: this
                });
            }
            //绑定邮箱时发送邮件
            function sys_user_sendMailInBind() {
                var record = $('updateSelfEmail_ds').getAt(0);
                Aurora.request({
                    url: $('sys_user_email_send_link').getUrl(),
                    para: {
                        'user_id': '${/model/sys_user_infor/record/@user_id}',
                        'email': record.get('update_email'),
                        'check_url': window.location.protocol + '//' + window.location.host + '${/request/@context_path}/',
                        'type': 'BIND'
                    },
                    success: function(res) {
                        var record = $('updateSelfEmail_ds').getAt(0);
                        var show = getId('contetn_8_step2');
                        var hide = getId('contetn_8_step1');
                        show.style.display = 'block';
                        hide.style.display = 'none';
                        sys_user_email = record.get('current_email');
                        var timeout = setTimeout(function() {
                            sys_tab_switch_back('content_8');
                            /* var spans = getId('sys_user_email_id');
                             spans.children[0].style.display = 'block';
                             spans.children[2].style.display = 'none'; */
                            $('updateSelfEmail_ds').reset();
                        }, 2000);
                    },
                    scope: this
                });
            }
            //修改邮箱返回选择
            function sys_user_mailBakcQuery() {
                var h_page = document.getElementById('content_4_step1');
                var n_page = document.getElementById('content_4_step' + email_step);
                var record = $('updateSelfEmail_ds');
                n_page.style.display = 'none';
                h_page.style.display = 'block';
                email_step = 1;
                sys_user_mailDsInit();
                record.reset();
            }
            
            function sys_email_modify_password(){
                var p = getId('sys_email_modify_password');
                var l = getId('content_4_step1');
                p.style.display = 'block';
                l.style.display = 'none';
                var html = '';
                html += '<iframe id="sys_user_modiy_email_iframe" frameBorder="0" src="${/request/@context_path}/modules/wfl/WFL1001/sys_user_modify_email.screen" onload="main_iFrameHeight(\'sys_user_modiy_email_iframe\')"></iframe>';
                p.innerHTML = html;
            }
            
            function sys_back1(){
                var ifm = getId('sys_user_modiy_email_iframe');
                ifm.parentNode.removeChild(ifm);
                var p = getId('content_4_step1');
                var l = getId('sys_email_modify_password');
                p.style.display = 'block';
                l.style.display = 'none';
            }
            
            //角色
            
            var sys_role = {
                role_select: null
            };
            
            function sys_userRoleAssignLoad() {
                var ul = getId('sys_user_role_assign_grid');
                var records = $('sys_user_role_assign_ds').getAll();
                ul.innerHTML = '';
                sys_role_setTableHead(ul);
                for (var i = 0;i < records.length;i++) {
                    var data = records[i].data;
                    var li = document.createElement('li');
                    li.setAttribute('index', i + 1);
                    var html = '';
                    html += '<div class="role-content" style="width:24%">' + sys_user_getValue(data.role_code) + '</div>';
                    html += '<div class="role-content" style="width:23%;text-align:left">' + sys_user_getValue(data.role_name) + '</div>';
                    html += '<div class="role-content" style="width:23%;text-align:left">' + sys_user_getValue(data.role_description) + '</div>';
                    html += '<div class="role-content" style="width:15%">' + sys_user_getValue(Aurora.formatDate(data.start_date)) + '</div>';
                    html += '<div class="role-content" style="width:15%">' + sys_user_getValue(Aurora.formatDate(data.end_date)) + '</div>';
                    if (data.default_flag == 'Y') {
                        sys_role.role_select = i + 1;
                        li.style.border = '1px solid #2dc3e8';
                        html += '<div class="check-img" onclick="sys_role_select(this)"><div><i class="icon-ok"></i></div></div>';
                    } else {
                        li.style.border = '1px solid transparent';
                        html += '<div class="check-img gray" onclick="sys_role_select(this)"><div><i class="icon-ok"/></i></div></div>';
                    }
                    html += '<div style="clear:both"/>';
                    li.innerHTML = html;
                    ul.appendChild(li);
                }
            }
            
            function sys_role_setTableHead(ul) {
                var li = document.createElement('li');
                li.style.backgroundColor = '#2dc3e8';
                var html = '';
                html += '<div class="role-content" style="width:24%;color:#fff">' + '角色代码' + '</div>';
                html += '<div class="role-content" style="width:23%;color:#fff">' + '角色名称' + '</div>';
                html += '<div class="role-content" style="width:23%;color:#fff">' + '描述' + '</div>';
                html += '<div class="role-content" style="width:15%;color:#fff">' + '有效日期从' + '</div>';
                html += '<div class="role-content" style="width:15%;color:#fff">' + '有效日期至' + '</div>';
                html += '<div style="clear:both"/>';
                li.innerHTML = html;
                ul.appendChild(li);
            }
            
            function sys_role_select(_this) {
                var ul = getId('sys_user_role_assign_grid');
                var records = $('sys_user_role_assign_ds').getAll();
                if (!Aurora.isEmpty(sys_role.role_select)) {
                    ul.children[sys_role.role_select].style.border = '1px solid transparent';
                    ul.children[sys_role.role_select].children[5].className = 'check-img gray';
                    records[sys_role.role_select - 1].set('default_flag', 'N');
                }
                _this.className = 'check-img';
                _this.parentNode.style.border = '1px solid #2dc3e8';
                sys_role.role_select = _this.parentNode.getAttribute('index');
                records[sys_role.role_select - 1].set('default_flag', 'Y');
            }
            
            function sys_user_getValue(value) {
                return (Aurora.isEmpty(value)) ? '' : value;
            }
            
            function sys_userEditDsValidator(record, name, value) {
                if (name == 'description') {
                    if (sys8220_getLength(value) >= 240) {
                        return '${l:SYS8210.USER_DESCRIPTION_OVERLENGTH}';
                    }
                    return true;
                }
            
                if (name == 'start_date' || name == 'end_date') {
                    var start_date = record.get('start_date');
                    var end_date = record.get('end_date');
                    if (typeof(end_date) != 'undefined' && !Ext.isEmpty(end_date)) {
                        if (!sys8220_compareDate(start_date, end_date)) {
                            return '${l:START_GREATER_THAN_END}';
                        }
                    }
                    return true;
                }
            }
            
            function sys_userRoleAssignDsAdd(dataset, record, index) {
                var now = new Date();
                var month = now.getMonth() + 1;
                month = month > 9 ? month : '0' + month;
                var day = now.getDate();
                day = day > 9 ? day : '0' + day;
                var date = now.getFullYear() + '-' + month + '-' + day; //STRING类型
                record.set('start_date', date);
            }
            
            function sys_userInfoSubmitsuccess(ds) {
                Aurora.SideBar.enable = true;
                Aurora.SideBar.show({
                    msg: '保存成功',
                    duration: 600
                });
                ds.query();
            }
            
            function sys_userRoleAssignDsUpdate(ds, record, name, value, oldvalue) {
                var records = ds.getAll();
                if (name == 'default_flag') {
                    if (value && value == 'Y') {
                        for (var i = 0;i < records.length;i++) {
                            if (ds.indexOf(record) != ds.indexOf(records[i])) {
                                ds.indexOf(record);
                                records[i].set('default_flag', 'N');
                            }
                        }
                    }
                }
            }
            
            function sys_userRoleAssignGridEditorFunction(record, name) {
                if (name == 'role_code') {
                    if (record.isNew) {
                        return 'sys_add_user_role_assign_grid_lov';
                    }
                }
            }
            
            function save_user_assign() {
                $('sys_user_role_assign_ds').submit();
            }
            //公司
            
            var sys_company = {
                company_select: null
            };
            
            function sys_user_company_load() {
                var ul = getId('sys_user_company_grid');
                var records = $('sys_user_company_ds').getAll();
                ul.innerHTML = '';
                sys_company_setTableHead(ul);
                for (var i = 0;i < records.length;i++) {
                    var data = records[i].data;
                    var li = document.createElement('li');
                    li.setAttribute('index', i + 1);
                    var html = '';
                    html += '<div class="role-content" style="width:25%">' + sys_user_getValue(data.user_name) + '</div>';
                    html += '<div class="role-content" style="width:25%;">' + sys_user_getValue(data.company_code) + '</div>';
                    html += '<div class="role-content" style="width:50%;text-align:left">' + sys_user_getValue(data.company_full_name) + '</div>';
                    if (data.default_flag == 'Y') {
                        sys_company.company_select = i + 1;
                        li.style.border = '1px solid #2dc3e8';
                        html += '<div class="check-img" onclick="sys_company_select(this)"><div><i class="icon-ok"></i></div></div>';
                    } else {
                        li.style.border = '1px solid transparent';
                        html += '<div class="check-img gray" onclick="sys_company_select(this)"><div><i class="icon-ok"></i></div></div>';
                    }
                    html += '<div style="clear:both"/>';
                    li.innerHTML = html;
                    ul.appendChild(li);
                }
            }
            
            function sys_company_setTableHead(ul) {
                var li = document.createElement('li');
                li.style.backgroundColor = '#2dc3e8';
                var html = '';
                html += '<div class="role-content" style="width:25%;color:#fff;">' + '用户名称' + '</div>';
                html += '<div class="role-content" style="width:25%;color:#fff;">' + '公司代码' + '</div>';
                html += '<div class="role-content" style="width:50%;color:#fff;">' + '公司全称' + '</div>';
                html += '<div style="clear:both"/>';
                li.innerHTML = html;
                ul.appendChild(li);
            }
            
            function sys_company_select(_this) {
                var ul = getId('sys_user_company_grid');
                var records = $('sys_user_company_ds').getAll();
                if (!Aurora.isEmpty(sys_company.company_select)) {
                    ul.children[sys_company.company_select].style.border = '1px solid transparent';
                    ul.children[sys_company.company_select].children[3].className = 'check-img gray';
                    records[sys_company.company_select - 1].set('default_flag', 'N');
                }
                _this.className = 'check-img';
                _this.parentNode.style.border = '1px solid #2dc3e8';
                sys_company.company_select = _this.parentNode.getAttribute('index');
                records[sys_company.company_select - 1].set('default_flag', 'Y');
            }
            
            function sys_userCompanyDsUpdate(ds, record, name, value, oldvalue) {
                var records = ds.getAll();
                if (name == 'default_flag') {
                    if (value && value == 'Y') {
                        for (var i = 0;i < records.length;i++) {
                            if (ds.indexOf(record) != ds.indexOf(records[i])) {
                                ds.indexOf(record);
                                records[i].set('default_flag', 'N');
                            }
                        }
                    }
                }
            }
            
            function save_user_company() {
                var datas = {
                    user_id: '${/model/sys_user_infor/record/@user_id}'
                };
                var authority = [];
            
                var record_company = $('sys_user_company_ds').getAll();
                for (var i = 0;i < record_company.length;i++) {
                    //record_company[i].set('user_id', '${/model/sys_user_infor/record/@user_id}');
                    record_company[i].set('authority_type', 'COMPANY');
                    //record_company[i].set('assign_id', record_company[i].get('company_id'));
                    authority.push(record_company[i].data);
                }
                datas['authority'] = authority;
                Aurora.request({
                    url: $('sys_sys_user_authority_save_link').getUrl(),
                    para: datas,
                    success: function(response) {
                        $('sys_user_company_ds').query();
                        sys_userInfoSubmitsuccess();
                    },
                    scope: this
                });
            }
        ]]></script>
        <a:dataSets>
            <!-- 个人资料 -->
            <a:dataSet id="sys_userInfor_ds">
                <a:datas dataSource="/model/sys_user_infor"/>
                <a:fields>
                    <a:field name="validate_code" prompt="验证码" required="true"/>
                </a:fields>
            </a:dataSet>
            <!-- 未读消息 -->
            <a:dataSet id="sys_userNotRead_ds">
                <a:datas dataSource="/model/sys_user_main_message"/>
            </a:dataSet>
            <!-- 密码修改 -->
            <a:dataSet id="updateSelfPassword_ds" autoCreate="true" submitUrl="${/request/@context_path}/update_self_passwrod.svc">
                <a:fields>
                    <!-- <a:field name="user_name" defaultValue="${/parameter/@user_name}"/> -->
                    <a:field name="current_password" prompt="HAP_CURRENT_PASSWORD" required="true"/>
                    <a:field name="update_password" prompt="HAP_PASSWORD" required="true"/>
                    <a:field name="confirm_password" prompt="HAP_CONFIRM_PASSWORD" required="true"/>
                </a:fields>
                <a:events>
                    <a:event name="submitsuccess" handler="updateSelfPassword_updatepasswordsuccess"/>
                </a:events>
            </a:dataSet>
            <!-- 手机修改 -->
            <a:dataSet id="updateSelfMobile_ds" autoCreate="true" submitUrl="${/request/@context_path}/modules/wfl/WFL1001/update_user_infor.svc">
                <a:fields>
                    <a:field name="current_mobile" prompt="当前手机" required="false"/>
                    <a:field name="update_mobile" prompt="新的手机" required="true"/>
                    <a:field name="validate_code" prompt="验证码" required="false"/>
                </a:fields>
            </a:dataSet>
            <!-- 邮箱修改 -->
            <a:dataSet id="updateSelfEmail_ds" autoCreate="true" submitUrl="${/request/@context_path}/modules/wfl/WFL1001/update_user_infor.svc">
                <a:fields>
                    <a:field name="current_email" prompt="当前邮箱" required="false"/>
                    <a:field name="update_email" prompt="新邮箱" required="false"/>
                    <a:field name="email_verification_code" prompt="邮件验证码" required="false"/>
                </a:fields>
            </a:dataSet>
            <!-- 角色修改 -->
            <a:dataSet id="sys_user_role_assign_ds" autoQuery="true" fetchAll="true" model="sys.SYS8220.sys_user_role_assign" queryUrl="${/request/@context_path}/autocrud/sys.SYS8220.sys_user_role_assign/query?ORDER_FIELD=role_code&amp;user_id=${/model/sys_user_infor/record/@user_id}" selectable="true">
                <a:fields>
                    <a:field name="user_role_group_id"/>
                    <a:field name="role_code" autoComplete="true" autoCompleteField="role_name" lovGridHeight="320" lovHeight="460" lovService="public.sys_role_lov_for_business_group" lovWidth="500" required="true" requiredMessage="${l:SYS8110.ROLE_CODE_NOT_NULL}" title="HAP_SELECT_ROLE">
                        <a:mapping>
                            <a:map from="role_id" to="role_id"/>
                            <a:map from="role_code" to="role_code"/>
                            <a:map from="role_name" to="role_name"/>
                            <a:map from="role_description" to="role_description"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="start_date" required="true" requiredMessage="${l:SYS8210.START_DATE_NOT_NULL}" validator="sys_userEditDsValidator"/>
                    <a:field name="end_date" validator="sys_userEditDsValidator"/>
                    <a:field name="default_flag" checkedValue="Y" displayField="N" uncheckedValue="N"/>
                </a:fields>
                <a:events>
                    <a:event name="load" handler="sys_userRoleAssignLoad"/>
                    <a:event name="add" handler="sys_userRoleAssignDsAdd"/>
                    <a:event name="update" handler="sys_userRoleAssignDsUpdate"/>
                    <a:event name="submitsuccess" handler="sys_userInfoSubmitsuccess"/>
                </a:events>
            </a:dataSet>
            <!-- 公司修改 -->
            <a:dataSet id="sys_user_company_ds" autoQuery="true" fetchAll="true" model="sys.SYS8220.sys_user_company" queryUrl="${/request/@context_path}/autocrud/sys.SYS8220.sys_user_company/query?ORDER_FIELD=company_code&amp;user_id=${/model/sys_user_infor/record/@user_id}" selectable="true">
                <a:fields>
                    <a:field name="default_flag" checkedValue="Y" displayField="N" uncheckedValue="N"/>
                </a:fields>
                <a:events>
                    <a:event name="load" handler="sys_user_company_load"/>
                    <a:event name="update" handler="sys_userCompanyDsUpdate"/>
                    <a:event name="submitsuccess" handler="sys_userInfoSubmitsuccess"/>
                </a:events>
            </a:dataSet>
        </a:dataSets>
        <div id="sys_user_body" class="body">
            <div class="head">
                <!-- <div class="head-bell">
                    <div id="sys_user_msgholder" class="user-msg" style="display:none">
                        <div class="msg-title"><![CDATA[
                           用户未读消息
                        ]]></div>
                        <ul id="sys_user_not_read_list" class="user-ms-notRead"/>
                        <div class="msg-title" style="text-align:right;color:#1589cd;cursor:pointer">
                            <i class="icon-angle-right" style="margin-left:5px;font-size:16px"/>
                        </div>
                    </div>
                    <div class="bell" onclick="sys_user_message_click()">
                        <i class="icon-bell"/>
                        <span id="sys_user_notRead_count"/>
                    </div>
                </div> -->
                <div class="infor">
                    <div class="user_image">
                        <img src="${/request/@context_path}/images/headIcon.jpg" style="height:85px"/>
                    </div>
                    <div class="user_infor">
                        <div id="sys_user_welcome_id" class="top"><![CDATA[您好！${/model/sys_user_infor/record/@description}。]]></div>
                        <div class="bottom">
                            <span><![CDATA[账户名：]]></span>
                            <span class="user_id"><![CDATA[${/model/sys_user_infor/record/@user_name}]]></span>
                            <div id="sys_user_mobileSet" class="circle" style="display:none">
                                <i class="icon-mobile-phone"/>
                            </div>
                            <div id="sys_user_mailSet" class="circle" style="padding:0 2px;display:none">
                                <i class="icon-envelope" style="font-size:10px;"/>
                            </div>
                            <span class="divison"><![CDATA[|]]></span>
                            <span><![CDATA[安全等级：]]></span>
                            <span style="color:#d4d647;margin-left:5px"><![CDATA[中]]></span>
                            <span style="color:#0088cc;margin-left:15px"/>
                            <span class="divison"><![CDATA[|]]></span>
                            <span><![CDATA[上次登入时间：]]></span>
                            <span><![CDATA[${/model/sys_user_infor/record/@last_logon_date}]]></span>
                        </div>
                    </div>
                </div>
            </div>
            <div id="content_son_1" class="content">
                <div id="content_1" class="li_content">
                    <div class="row">
                        <div style="float:left;margin:10px">
                            <a:hBox labelWidth="100">
                                <a:label name="user_name" bindTarget="sys_userInfor_ds" prompt="账户名" width="200"/>
                                <div class="modify"/>
                            </a:hBox>
                            <a:hBox labelWidth="100" style="margin-top:10px">
                                <a:textField name="description" id="sys_userDescription" bindTarget="sys_userInfor_ds" prompt="描述" readOnly="true" style="border:0;font-size:14px;background-color:#fff" width="200"/>
                                <div class="modify">
                                    <span onclick="sys_user_baseInforModefiy(this)"><![CDATA[修改]]></span>
                                    <span style="display:none"><![CDATA[|]]></span>
                                    <span id="sys_user_baseInfor_desc" onclick="sys_user_baseInforCancel(this)" style="display:none"><![CDATA[取消]]></span>
                                </div>
                            </a:hBox>
                            <a:hBox labelWidth="100" style="margin-top:10px">
                                <a:label name="business_group_name" bindTarget="sys_userInfor_ds" prompt="所属集团" width="200"/>
                                <div class="modify"/>
                            </a:hBox>
                            <a:hBox labelWidth="100" style="margin-top:10px">
                                <a:label name="start_date" bindTarget="sys_userInfor_ds" prompt="有效期从" width="200"/>
                                <div class="modify"><![CDATA[
                          ]]></div>
                            </a:hBox>
                            <a:hBox labelWidth="100" style="margin-top:10px">
                                <a:label name="end_date" bindTarget="sys_userInfor_ds" prompt="有效期至" width="200"/>
                                <div class="modify"><![CDATA[
                                ]]></div>
                            </a:hBox>
                        </div>
                        <div style="float:right;margin:10px;">
                            <ul class="crack_ul">
                                <!-- <li>
                                    <i class="icon-user"/>
                                    <h3><![CDATA[实名认证]]></h3>
                                    <p><![CDATA[330389792]]></p>
                                    <p/>
                                </li>
                                <li>
                                    <i class="icon-lock"/>
                                    <h3><![CDATA[安全等级]]></h3>
                                    <p><![CDATA[中]]></p>
                                    <p/>
                                </li> -->
                                <li>
                                    <i class="icon-mobile-phone"/>
                                    <h3><![CDATA[手机]]></h3>
                                    <p id="sys_user_mobile_now"><![CDATA[${/model/sys_user_infor/record/@mobile_phone_show}]]></p>
                                    <p id="sys_user_mobile_id" class="non_dis">
                                        <a onclick="sys_tab_switch(&apos;content_3&apos;)"><![CDATA[修改]]></a>
                                        <span style="margin:0 5px"><![CDATA[|]]></span>
                                        <a onclick="sys_tab_switch(&apos;content_7&apos;)"><![CDATA[绑定手机]]></a>
                                        <a onclick=""/>
                                    </p>
                                </li>
                                <li>
                                    <i class="icon-envelope" style="font-size: 32px;top:-3px"/>
                                    <h3><![CDATA[邮箱]]></h3>
                                    <p id="sys_user_email_now"><![CDATA[${/model/sys_user_infor/record/@email_show}]]></p>
                                    <p id="sys_user_email_id" class="non_dis">
                                        <a onclick="sys_tab_switch(&apos;content_4&apos;)"><![CDATA[修改]]></a>
                                        <span style="margin:0 5px"/>
                                        <a onclick="sys_tab_switch(&apos;content_8&apos;)"><![CDATA[绑定邮箱]]></a>
                                        <a onclick=""/>
                                    </p>
                                </li>
                            </ul>
                        </div>
                        <ul class="select_tab">
                            <li style="border-top:1px solid #ededed;">
                                <div class="left">
                                    <span><![CDATA[登入密码]]></span>
                                    <i class="icon-lock"/>
                                </div>
                                <span class="inline desc"><![CDATA[登入汉得云时所需的密码]]></span>
                                <a onclick="sys_tab_switch(&apos;content_2&apos;)"><![CDATA[修改]]></a>
                            </li>
                            <li>
                                <div class="left">
                                    <span><![CDATA[默认角色]]></span>
                                    <i class="icon-user"/>
                                </div>
                                <span class="inline desc"><![CDATA[登入汉得云平台时的默认使用角色]]></span>
                                <a onclick="sys_tab_switch(&apos;content_5&apos;)"><![CDATA[修改]]></a>
                            </li>
                            <li>
                                <div class="left">
                                    <span><![CDATA[默认公司]]></span>
                                    <i class="icon-group"/>
                                </div>
                                <span class="inline desc"><![CDATA[在汉得云平台内更具权限分配的公司中的默认公司选项]]></span>
                                <a onclick="sys_tab_switch(&apos;content_6&apos;)"><![CDATA[修改]]></a>
                            </li>
                        </ul>
                    </div>
                    <a id="sys_user_roll_top" href="#sys_user_body" style="display:none"><![CDATA[页面跳转]]></a>
                </div>
                <div id="content_2" class="li_content">
                    <div class="row">
                        <div class="alter-key">
                            <div class="logo">
                                <div>
                                    <h1><![CDATA[密码修改]]></h1>
                                </div>
                                <a:form column="1" height="200" showBorder="false" style="margin-left:auto;margin-right:auto;text-align:center" width="350">
                                    <a:passWord name="current_password" bindTarget="updateSelfPassword_ds" style="height:30px;padding-top:2px" width="250"/>
                                    <a:passWord name="update_password" bindTarget="updateSelfPassword_ds" style="height:30px;padding-top:2px" width="250"/>
                                    <a:passWord name="confirm_password" bindTarget="updateSelfPassword_ds" style="height:30px;padding-top:2px" width="250"/>
                                    <div style="line-height:30px">
                                        <button class="login_btn" onclick="updateSelfPassword_updatePasswordsumbit();" text="HAP_OK" width="150"><![CDATA[确定]]></button>
                                        <a href="${/request/@context_path}/forgotPassword.screen" style="float:left;" target="_blank"><![CDATA[忘记密码]]></a>
                                    </div>
                                </a:form>
                            </div>
                        </div>
                        <div class="back" onclick="sys_tab_switch_back(&apos;content_2&apos;);">
                            <i class="icon-angle-left"/>
                        </div>
                    </div>
                </div>
                <div id="content_7" class="li_content">
                    <div id="contetn_7_step1">
                        <div class="step_process" style="display:block">
                            <div class="box_tips">
                                <i class="pic1 ii"/>
                                <span><![CDATA[您正在绑定手机]]></span>
                            </div>
                            <div class="main_process">
                                <a:hBox labelWidth="120" style="margin:30px auto" width="350">
                                    <a:textField name="update_mobile" bindTarget="updateSelfMobile_ds" prompt="绑定手机" style="padding:2px;height:30px;*height:22px;" width="250"/>
                                </a:hBox>
                                <a:hBox labelWidth="95" style="margin:30px auto" width="350">
                                    <a:textField name="validate_code" allowDecimals="false" bindTarget="sys_userInfor_ds" prompt="验证码" style="padding:2px;height:30px;*height:22px;" width="160"/>
                                    <span class="inline right_buttom" onclick="sys_user_getMobileCode_byNewPhone(this)"><![CDATA[获取验证码]]></span>
                                </a:hBox>
                                <div class="pic1 btn_w" style="margin-top:30px">
                                    <div class="pic1 btn" onclick="sys_user_validateCode_byValidate(&apos;phone_bind&apos;)" style="padding:0 30px"><![CDATA[提交]]></div>
                                </div>
                                <span class="se_back" onclick="sys_tab_switch_back(&apos;content_4&apos;)" style="margin-top:35px"><![CDATA[返回]]></span>
                            </div>
                        </div>
                    </div>
                    <div id="contetn_7_step2" style="display:none">
                        <div class="step_process">
                            <div class="box_tips">
                                <i class="pic1 ii"/>
                                <span><![CDATA[您正在绑定手机]]></span>
                            </div>
                            <div class="main_process">
                                <div class="tips" style="margin-top:30px">
                                    <div class="warn"/>
                                    <span><![CDATA[绑定成功，新绑定的手机号为]]></span>
                                    <span id="sys_user_mobile_set"/>
                                    <span><![CDATA[！3秒后返回首页]]></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="content_3" class="li_content">
                    <div id="content_3_step1" style="display:block">
                        <div class="tips">
                            <div class="warn"/>
                            <span><![CDATA[基于对您账户及操作环境的检测，我们将提供以下方式供您选择]]></span>
                        </div>
                        <ul class="query_method e_query" style="display:block;margin-top:30px">
                            <li>
                                <div class="left pic1 mail_pic"/>
                                <div class="left text">
                                    <p><![CDATA[能接收短信]]></p>
                                    <span><![CDATA[通过原手机号接收短信校验码的方式修改]]></span>
                                </div>
                                <div class="right btn">
                                    <a:button btnClass="" click="sys_mobile_stepInto" text="立即修改"/>
                                </div>
                            </li>
                            <li>
                                <div class="left icon" style="background-position:0 -52px"/>
                                <div class="left text">
                                    <p><![CDATA[无法接收短信]]></p>
                                    <span><![CDATA[原手机号已丢失或停用，使用非手机身份验证方式修改]]></span>
                                </div>
                                <div class="right btn">
                                    <a:button btnClass="" click="sys_mobile_modify_password" text="立即修改"/>
                                </div>
                            </li>
                        </ul>
                        <div class="back step3" onclick="sys_tab_switch_back(&apos;content_3&apos;);">
                            <i class="icon-angle-left"/>
                        </div>
                    </div>
                    <div id="sys_phone_modify_password" class="phone-modify-password"/>
                    <div id="content_3_step2">
                        <ul class="process">
                            <li>
                                <div class="icon on"><![CDATA[1]]></div>
                                <div class="line"/>
                                <span><![CDATA[验证身份]]></span>
                            </li>
                            <li>
                                <div class="icon non"><![CDATA[2]]></div>
                                <div class="line"/>
                                <span><![CDATA[修改手机]]></span>
                            </li>
                            <li style="margin-right:0">
                                <div class="icon ok"/>
                                <span><![CDATA[修改成功]]></span>
                            </li>
                        </ul>
                        <div class="step_process">
                            <div class="box_tips">
                                <i class="pic1 ii"/>
                                <span><![CDATA[您正在使用 “]]></span>
                                <span style="color:#fd7d23"><![CDATA[短信验证]]></span>
                                <span><![CDATA[” 进行设置。]]></span>
                            </div>
                            <div class="main_process">
                                <a:hBox labelWidth="120" style="margin:30px auto" width="350">
                                    <a:textField name="mobile_phone" bindTarget="sys_userInfor_ds" prompt="手机号" readOnly="true" style="height:30px;padding-top:2px;*height:22px;" width="250"/>
                                    <!-- <a:textField name="current_mobile" bindTarget="updateSelfMobile_ds" style="padding:5px;height:30px" width="250"/> -->
                                </a:hBox>
                                <a:hBox labelWidth="95" style="margin:30px auto" width="350">
                                    <a:textField name="validate_code" allowDecimals="false" bindTarget="sys_userInfor_ds" prompt="验证码" style="padding:2px;height:30px;*height:22px;" width="150"/>
                                    <span class="inline right_buttom" onclick="sys_user_getMobileCode_byValidate(this)"><![CDATA[获取验证码]]></span>
                                </a:hBox>
                                <div class="pic1 btn_w" style="margin-top:30px">
                                    <div class="pic1 btn" onclick="sys_mobile_stepInto()"><![CDATA[下一步]]></div>
                                </div>
                                <span class="se_back" onclick="sys_user_mobileBakcQuery()" style="margin-top:35px"><![CDATA[返回]]></span>
                            </div>
                        </div>
                    </div>
                    <div id="content_3_step3">
                        <ul class="process">
                            <li>
                                <div class="icon on"><![CDATA[1]]></div>
                                <div class="line" style="background-color:#fc9c27;"/>
                                <span><![CDATA[验证身份]]></span>
                            </li>
                            <li>
                                <div class="icon on"><![CDATA[2]]></div>
                                <div class="line"/>
                                <span><![CDATA[修改手机]]></span>
                            </li>
                            <li style="margin-right:0">
                                <div class="icon ok"/>
                                <span><![CDATA[修改成功]]></span>
                            </li>
                        </ul>
                        <div class="step_process">
                            <div class="box_tips">
                                <i class="pic1 ii"/>
                                <span><![CDATA[您正在使用 “]]></span>
                                <span style="color:#fd7d23"><![CDATA[短信验证]]></span>
                                <span><![CDATA[” 进行设置。]]></span>
                            </div>
                            <div class="main_process">
                                <a:vBox labelWidth="120" style="margin:30px auto" width="350">
                                    <a:textField name="update_mobile" bindTarget="updateSelfMobile_ds" style="padding:2px;height:30px;*height:22px;" width="250"/>
                                </a:vBox>
                                <a:hBox labelWidth="95" style="margin:30px auto" width="350">
                                    <a:textField name="validate_code" allowDecimals="false" bindTarget="sys_userInfor_ds" prompt="验证码" style="padding:2px;height:30px;*height:22px;" width="150"/>
                                    <span class="inline right_buttom" onclick="sys_user_getMobileCode_byNewPhone(this)"><![CDATA[获取验证码]]></span>
                                </a:hBox>
                                <div class="pic1 btn_w" style="margin-top:30px">
                                    <div class="pic1 btn" onclick="sys_mobile_stepInto()"><![CDATA[下一步]]></div>
                                </div>
                                <span class="se_back" onclick="sys_user_mobileBakcQuery()" style="margin-top:35px"><![CDATA[返回]]></span>
                            </div>
                        </div>
                    </div>
                    <div id="content_3_step4">
                        <ul class="process">
                            <li>
                                <div class="icon on"><![CDATA[1]]></div>
                                <div class="line" style="background-color:#fc9c27;"/>
                                <span><![CDATA[验证身份]]></span>
                            </li>
                            <li>
                                <div class="icon on"><![CDATA[2]]></div>
                                <div class="line" style="background-color:#fc9c27;"/>
                                <span><![CDATA[修改手机]]></span>
                            </li>
                            <li style="margin-right:0">
                                <div class="icon ok"/>
                                <span><![CDATA[修改成功]]></span>
                            </li>
                        </ul>
                        <div class="step_process">
                            <div class="box_tips">
                                <i class="pic1 ii"/>
                                <span><![CDATA[您正在使用 “]]></span>
                                <span style="color:#fd7d23"><![CDATA[短信验证]]></span>
                                <span><![CDATA[” 进行设置。]]></span>
                            </div>
                            <div class="main_process">
                                <div class="tips" style="margin-top:30px">
                                    <div class="warn"/>
                                    <span><![CDATA[修改成功，新绑定的手机号为]]></span>
                                    <span id="sys_user_mobileUpdated"/>
                                    <span><![CDATA[！2秒后返回首页]]></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="content_8" class="li_content">
                    <div id="contetn_8_step1">
                        <div class="step_process" style="display:block">
                            <div class="box_tips">
                                <i class="pic1 ii"/>
                                <span><![CDATA[您正在绑定邮箱]]></span>
                            </div>
                            <div class="main_process">
                                <a:hBox labelWidth="120" style="margin:30px auto" width="350">
                                    <a:textField name="update_email" bindTarget="updateSelfEmail_ds" prompt="绑定邮箱" style="padding:2px;height:30px;*height:22px;" width="250"/>
                                </a:hBox>
                                <div class="pic1 btn_w" style="margin-top:30px">
                                    <div class="pic1 btn" onclick="sys_user_sendMailInBind()" style="padding:0 30px"><![CDATA[提交]]></div>
                                </div>
                                <span class="se_back" onclick="sys_tab_switch_back(&apos;content_4&apos;)" style="margin-top:35px"><![CDATA[返回]]></span>
                            </div>
                        </div>
                    </div>
                    <div id="contetn_8_step2" style="display:none">
                        <div class="step_process">
                            <div class="box_tips">
                                <i class="pic1 ii"/>
                                <span><![CDATA[您正在绑定邮箱]]></span>
                            </div>
                            <div class="main_process" style="text-align:center">
                                <div class="em_sh">
                                    <i class="pic1 em"/>
                                    <div>
                                        <p><![CDATA[发送成功，请进入您的邮箱查收验证邮件]]></p>
                                        <span><![CDATA[验证邮件已发到您的邮箱，请查收]]></span>
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="content_4" class="li_content">
                    <div id="content_4_step1" style="display:block">
                        <div class="tips">
                            <div class="warn"/>
                            <span><![CDATA[基于对您账户及操作环境的检测，我们将提供以下方式供您选择]]></span>
                        </div>
                        <ul class="query_method e_query" style="display:block;margin-top:30px">
                            <li>
                                <div class="left pic1 mail_pic"/>
                                <div class="left text">
                                    <p><![CDATA[通过“手机号码+电子邮箱”]]></p>
                                    <span><![CDATA[推荐]]></span>
                                </div>
                                <div class="right btn">
                                    <a:button btnClass="" click="sys_user_mailStepInto" text="立即修改"/>
                                </div>
                            </li>
                            <li>
                                <div class="left icon" style="background-position:0 -52px"/>
                                <div class="left text">
                                    <p><![CDATA[通过“登入密码+电子邮箱”]]></p>
                                    <span><![CDATA[不推荐]]></span>
                                </div>
                                <div class="right btn">
                                    <a:button btnClass="" click="sys_email_modify_password" text="立即修改"/>
                                </div>
                            </li>
                        </ul>
                        <div class="back step4" onclick="sys_tab_switch_back(&apos;content_4&apos;);">
                            <i class="icon-angle-left"/>
                        </div>
                    </div>
                    <div id="sys_email_modify_password" class="phone-modify-password"/>
                    <div id="content_4_step2">
                        <ul class="process emai_li">
                            <li>
                                <div class="icon on"><![CDATA[1]]></div>
                                <div class="line"/>
                                <span><![CDATA[验证身份]]></span>
                            </li>
                            <li>
                                <div class="icon non"><![CDATA[2]]></div>
                                <div class="line"/>
                                <span><![CDATA[修改邮箱]]></span>
                            </li>
                            <li>
                                <div class="icon non"><![CDATA[3]]></div>
                                <div class="line"/>
                                <span><![CDATA[发送成功]]></span>
                            </li>
                            <li style="margin-right:0">
                                <div class="icon ok"/>
                                <span><![CDATA[修改成功]]></span>
                            </li>
                        </ul>
                        <div class="step_process">
                            <div class="box_tips">
                                <i class="pic1 ii"/>
                                <span><![CDATA[您正在使用 “]]></span>
                                <span style="color:#fd7d23"><![CDATA[手机号码+电子邮箱]]></span>
                                <span><![CDATA[” 进行设置。]]></span>
                            </div>
                            <div class="main_process">
                                <a:vBox labelWidth="120" style="margin:30px auto" width="350">
                                    <a:textField name="mobile_phone" bindTarget="sys_userInfor_ds" prompt="手机号" readOnly="true" style="height:32px;padding-top:2px" width="250"/>
                                    <!-- <a:textField name="current_email" bindTarget="updateSelfEmail_ds" style="height:32px;padding-top:5px" width="250"/> -->
                                </a:vBox>
                                <a:hBox labelWidth="95" style="margin:30px auto" width="350">
                                    <a:textField name="validate_code" allowDecimals="false" bindTarget="sys_userInfor_ds" prompt="验证码" style="padding:2px;height:30px;*height:22px;" width="150"/>
                                    <span class="inline right_buttom" onclick="sys_user_getMobileCode_byValidate(this)"><![CDATA[获取验证码]]></span>
                                </a:hBox>
                                <div class="pic1 btn_w">
                                    <div class="pic1 btn" onclick="sys_user_mailStepInto()"><![CDATA[下一步]]></div>
                                </div>
                                <span class="se_back" onclick="sys_user_mailBakcQuery()"><![CDATA[返回]]></span>
                            </div>
                        </div>
                    </div>
                    <div id="content_4_step3">
                        <ul class="process emai_li">
                            <li>
                                <div class="icon on"><![CDATA[1]]></div>
                                <div class="line" style="background-color:#fc9c27;"/>
                                <span><![CDATA[验证身份]]></span>
                            </li>
                            <li>
                                <div class="icon on"><![CDATA[2]]></div>
                                <div class="line"/>
                                <span><![CDATA[修改邮箱]]></span>
                            </li>
                            <li>
                                <div class="icon non"><![CDATA[3]]></div>
                                <div class="line"/>
                                <span><![CDATA[发送成功]]></span>
                            </li>
                            <li style="margin-right:0">
                                <div class="icon ok"/>
                                <span><![CDATA[修改成功]]></span>
                            </li>
                        </ul>
                        <div class="step_process">
                            <div class="box_tips">
                                <i class="pic1 ii"/>
                                <span><![CDATA[您正在使用 “]]></span>
                                <span style="color:#fd7d23"><![CDATA[手机号码+电子邮箱]]></span>
                                <span><![CDATA[” 进行设置。]]></span>
                            </div>
                            <div class="main_process">
                                <a:vBox style="margin:30px auto" width="350">
                                    <a:textField name="email" bindTarget="sys_userInfor_ds" prompt="原邮箱" readOnly="true" style="height:32px;padding-top:2px" width="250"/>
                                    <a:textField name="update_email" bindTarget="updateSelfEmail_ds" style="height:32px;padding-top:2px" width="250"/>
                                </a:vBox>
                                <div class="pic1 btn_w">
                                    <div class="pic1 btn" onclick="sys_user_mailStepInto()"><![CDATA[下一步]]></div>
                                </div>
                                <span class="se_back" onclick="sys_user_mailBakcQuery()"><![CDATA[返回]]></span>
                            </div>
                        </div>
                    </div>
                    <div id="content_4_step4">
                        <ul class="process emai_li">
                            <li>
                                <div class="icon on"><![CDATA[1]]></div>
                                <div class="line" style="background-color:#fc9c27;"/>
                                <span><![CDATA[验证身份]]></span>
                            </li>
                            <li>
                                <div class="icon on"><![CDATA[2]]></div>
                                <div class="line" style="background-color:#fc9c27;"/>
                                <span><![CDATA[修改邮箱]]></span>
                            </li>
                            <li>
                                <div class="icon on"><![CDATA[3]]></div>
                                <div class="line"/>
                                <span><![CDATA[发送成功]]></span>
                            </li>
                            <li style="margin-right:0">
                                <div class="icon ok"/>
                                <span><![CDATA[修改成功]]></span>
                            </li>
                        </ul>
                        <div class="step_process">
                            <div class="box_tips">
                                <i class="pic1 ii"/>
                                <span><![CDATA[您正在使用 “]]></span>
                                <span style="color:#fd7d23"><![CDATA[手机号码+电子邮箱]]></span>
                                <span><![CDATA[” 进行设置。]]></span>
                            </div>
                            <div class="main_process" style="text-align:center">
                                <div class="em_sh">
                                    <i class="pic1 em"/>
                                    <div>
                                        <p><![CDATA[发送成功，请进入您的邮箱查收验证邮件]]></p>
                                        <span><![CDATA[验证邮件已发到您的邮箱，请查收]]></span>
                                    </div>
                                </div>
                                <span class="se_back" onclick="sys_user_mailBakcQuery()" style="margin-top:25px;display:block;float:none"><![CDATA[重新选择]]></span>
                            </div>
                        </div>
                    </div>
                    <div id="content_4_step5">
                        <ul class="process emai_li">
                            <li>
                                <div class="icon on"><![CDATA[1]]></div>
                                <div class="line" style="background-color:#fc9c27;"/>
                                <span><![CDATA[验证身份]]></span>
                            </li>
                            <li>
                                <div class="icon on"><![CDATA[2]]></div>
                                <div class="line" style="background-color:#fc9c27;"/>
                                <span><![CDATA[修改邮箱]]></span>
                            </li>
                            <li>
                                <div class="icon on"><![CDATA[3]]></div>
                                <div class="line" style="background-color:#fc9c27;"/>
                                <span><![CDATA[发送成功]]></span>
                            </li>
                            <li style="margin-right:0">
                                <div class="icon ok"/>
                                <span><![CDATA[修改成功]]></span>
                            </li>
                        </ul>
                        <div class="step_process">
                            <div class="box_tips">
                                <i class="pic1 ii"/>
                                <span><![CDATA[您正在使用 “]]></span>
                                <span style="color:#fd7d23"><![CDATA[手机号码+电子邮箱]]></span>
                                <span><![CDATA[” 进行设置。]]></span>
                            </div>
                            <div class="main_process">
                                <div class="tips" style="margin-top:30px">
                                    <div class="warn"/>
                                    <span id="sys_user_mailSuccess"><![CDATA[修改成功，新的邮箱是。。。。。。！3秒后返回首页]]></span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div id="content_5" class="li_content">
                    <!-- <div class="row" style="width:620px"> -->
                    <div class="user-role-div">
                        <div class="role-title">
                            <a:toolbarButton click="save_user_assign" style="width:100px" text="PROMPT.SAVE"/>
                        </div>
                        <div class="role-contnet">
                            <ul id="sys_user_role_assign_grid"/>
                        </div>
                    </div>
                    <!-- </div> -->
                    <div class="back step5" onclick="sys_tab_switch_back(&apos;content_5&apos;);">
                        <i class="icon-angle-left"/>
                    </div>
                </div>
                <div id="content_6" class="li_content">
                    <div class="user-role-div">
                        <div class="role-title">
                            <a:toolbarButton click="save_user_company" style="width:100px" text="PROMPT.SAVE"/>
                        </div>
                        <div class="role-contnet">
                            <ul id="sys_user_company_grid"/>
                        </div>
                    </div>
                    <div class="back step6" onclick="sys_tab_switch_back(&apos;content_6&apos;);">
                        <i class="icon-angle-left"/>
                    </div>
                </div>
                <div style="clear:both"/>
            </div>
            <!-- <div id="sys_user_foot" class="foot" style="display:block;">
                <div class="cont">
                    <div class="left default_trig">
                        <i class="icon-th-large"/>
                        <div><![CDATA[功能助手]]></div>
                    </div>
                    <ul id="sys_user_ul" class="left function">
                        <li id="sys_li_1" content_id="content_son_1" style="background-color:#000">
                            <img src="${/request/@context_path}/index/img/background/business_contact.png"/>
                            <span><![CDATA[个人中心]]></span>
                        </li>
                    </ul>
                    <div class="right triggle">
                        <div>
                            <i class="icon-angle-up"/>
                        </div>
                    </div>
                </div>
            </div> -->
            <div id="sys_user_bottom" class="bottom-desc">
                <div class="bottom-content">
                    <div class="person-main-link">
                        <ul>
                            <li><![CDATA[关于汉得云]]></li>
                            <li><![CDATA[联系我们]]></li>
                            <li><![CDATA[汉得云开放平台]]></li>
                            <li><![CDATA[公司介绍]]></li>
                            <li><![CDATA[团队介绍]]></li>
                            <li><![CDATA[宗旨概念]]></li>
                            <li style="border:0"><![CDATA[服务中心]]></li>
                        </ul>
                    </div>
                    <div class="hand-copyright"><![CDATA[
                       沪ICP备14039535号-1 © Copyright Hand China Co.,Ltd.
                   ]]></div>
                </div>
            </div>
        </div>
        <script><![CDATA[
            init();
        ]]></script>
    </a:view>
</a:screen>

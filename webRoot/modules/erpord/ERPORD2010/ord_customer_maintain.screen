<?xml version="1.0" encoding="UTF-8"?>
<a:screen xmlns:c="aurora.application.action" xmlns:p="uncertain.proc" xmlns:a="http://www.aurora-framework.org/application" trace="true">
    <a:init-procedure>
        <a:model-query defaultWhereClause="business_group =${/session/@business_group} and basic_type = &apos;CUSTOMER&apos;" model="erpord.ERPORD2010.ord_customer_get_manual_flag" rootPath="erpord_2010_manual_flag"/>
        <a:model-query model="erpord.ERPORD2010.fnd_addresses" rootPath="erpord_2010_contact_info"/>
        <!-- <a:model-query model="db.fnd_parameter_pkg.get_amount_precision" rootPath="erpord_2010_amount_percision"/> -->
        <!-- <a:model-query model="db.fnd_precision_pkg.get_price_precision" rootPath="erpord_2010_price_percision"/> -->
        <a:model-query defaultWhereClause="f.partner_id = ${/parameter/@partner_id}" model="erpord.ERPORD2010.ord_customer_basic" rootPath="erpord_2010_basic_result_data"/>
        <a:model-query model="erppublic.get_default_information" rootPath="erpord_2010_default_inf"/>
    </a:init-procedure>
    <a:view>
        <a:link id="erpord_2010_vender_contact_maintain_svc_link" model="erpord.ERPORD2010.fnd_addresses" modelaction="delete"/>
        <a:link id="erpord_2010_vender_contact_default_link" model="erpord.ERPORD2010.ord_customer_contact_default" modelaction="update"/>
        <script><![CDATA[
            var erpord_2010_partner_id = '${/parameter/@partner_id}';
            var erpord_2010_submit_flag = 'N';
            var erpord_2010_contact_id;
            
            function erpord_2010_contact_save_basic() {
                var ds = $('erpord_2010_vender_basic_result_ds');
                if ('${/model/erpord_2010_manual_flag/record/@manual_flag}' == 'N') {
                    var record = ds.getAt(0);
                    var partner_code = record.get('partner_code');
                    if (partner_code == '${l:ERPINV.MESSAGE14}') {
                        record.set('partner_code', null);
                    }
                }
                ds.submit();
            } /*basic数据 submit事件*/
            
            function erpord2010_basic_ds_submit() {
                Aurora.Masker.mask($('erppur_vender_maintain_window').wrap, '${l:MASCLOUD.SUBMITTING}');
            }
            
            function erpord2010_basic_ds_submitfailed() {
                Aurora.Masker.unmask($('erppur_vender_maintain_window').wrap);
            }
            
            function erpord2010_submitsuccess(ds, res) {
                Aurora.Masker.unmask($('erppur_vender_maintain_window').wrap);
                var message = '${l:ERPINV.MESSAGE15}';
                Aurora.SideBar.enable = true;
                Aurora.SideBar.show({
                    msg: message,
                    duration: 6000
                });
                $('erpord_2010_result_main_ds').query();
                if (erpord_2010_submit_flag == 'Y') {
                    erpord_2010_submit_flag = 'N';
                    var record = ds.getAt(0);
                    record.getField('partner_code').setReadOnly(true);
                    $('erpord_2010_maitain_panel').setEnabled(1);
                    $('erpord_2010_maitain_panel').setEnabled(2);
                    erpord_2010_partner_id = res.result.record.partner_id;
                }
            } /*联系人数据 submit事件*/
            
            function erpord2010_contact_ds_submit() {
                Aurora.Masker.mask($('erppur_vender_maintain_window').wrap, '${l:MASCLOUD.SUBMITTING}');
            }
            
            function erpord2010_contact_ds_submitsuccess() {
                Aurora.Masker.unmask($('erppur_vender_maintain_window').wrap);
            } /*采购数据 submit事件*/
            
            function erpord2010_purchase_ds_submit() {
                Aurora.Masker.mask($('erppur_vender_maintain_window').wrap, '${l:MASCLOUD.SUBMITTING}');
            }
            
            function erpord2010_purchase_ds_submitsuccess() {
                Aurora.Masker.unmask($('erppur_vender_maintain_window').wrap);
            }
            
            function erpord_2010_default_contact(address_id, partner_id, record_id) {
                var para = {
                    "address_id": address_id,
                    "partner_id": partner_id
                };
                Aurora.request({
                    url: $('erpord_2010_vender_contact_default_link').getUrl(),
                    para: para,
                    success: function(res) {
                        var ds = $('erpord_2010_vender_contact_result_ds');
                        var old_default_record = ds.findById(erpord_2010_contact_id);
                        if (old_default_record) {
                            old_default_record.set('default_flag', 'N');
                            var default_record = ds.findById(record_id);
                            default_record.set('default_flag', 'Y');
                            old_default_record.commit();
                            default_record.commit();
                        } else {
                            default_record = ds.findById(record_id);
                            default_record.set('default_flag', 'Y');
                            default_record.commit();
                        }
                    }
                });
            }
            
            /*             function erpord_2010_formatMoney(value, record, name) {　　
             return Aurora.formatNumber(value, '${/model/erpord_2010_amount_percision/record/@value}');
             } */
            
            function erpord_2010_ds_update_maintain(ds, record, name, value, oldvalue) {
                if (name == "company_id") {
                    var metadata = record.getMeta();
                    var f1 = metadata.getField('customer_type_desc');
                    // var customer_type_id = '${/parameter/@customer_type_id}';
                    if (!record.get('company_id') || record.get('company_id') == '') {
                        f1.setLovService('');
                    } else {
                        f1.setLovService('erpord.ERPORD1010.fnd_business_partner_types?enabled_flag=Y');
                        f1.setLovPara('company_id', record.get('company_id') || '');
                        // f1.setLovPara('customer_type_id', customer_type_id);
                    }
                }
            
                if (name == 'province_id') {
                    record.set('city_desc', '');
                    record.set('district_desc', '');
                    record.set('city_id', '');
                    record.set('district_id', '');
                    if (!Ext.isEmpty(value)) {
                        record.getField('city_desc').setLovService('erpsys.public.sys_region_city_lov');
                        record.getField('city_desc').setLovPara('province_id', value);
                    } else {
                        record.getField('city_desc').setLovService('');
                    }
                    record.getMeta().getField('district_desc').setLovService('');
                }
            
                if (name == 'city_id') {
                    record.set('district_desc', '');
                    record.set('district_id', '');
                    var address_province_id = record.get('province_id');
                    if (!Ext.isEmpty(value)) {
                        record.getField('district_desc').setLovService('erpsys.public.sys_region_district_lov');
                        record.getField('district_desc').setLovPara('province_id', address_province_id);
                        record.getField('district_desc').setLovPara('city_id', value);
                    } else {
                        record.getField('district_desc').setLovService('');
                    }
                }
            }
            
            
            function erpord_2010_contact_ds_update(ds, record, name, value, oldvalue) {
                if (name == 'province_id') {
                    record.set('city_desc', '');
                    record.set('district_desc', '');
                    record.set('city_id', '');
                    record.set('district_id', '');
                    if (!Ext.isEmpty(value)) {
                        record.getField('city_desc').setLovService('erpsys.public.sys_region_city_lov');
                        record.getField('city_desc').setLovPara('province_id', value);
                    } else {
                        record.getField('city_desc').setLovService('');
                    }
                    record.getMeta().getField('district_desc').setLovService('');
                }
            
                if (name == 'city_id') {
                    record.set('district_desc', '');
                    record.set('district_id', '');
                    var address_province_id = record.get('province_id');
                    if (!Ext.isEmpty(value)) {
                        record.getField('district_desc').setLovService('erpsys.public.sys_region_district_lov');
                        record.getField('district_desc').setLovPara('province_id', address_province_id);
                        record.getField('district_desc').setLovPara('city_id', value);
                    } else {
                        record.getField('district_desc').setLovService('');
                    }
                }
            }
            
            function erpord_2010_conatact_ds_add(ds, record) {
                record.set('partner_id', erpord_2010_partner_id);
            }
            
            function erpord_2010_vender_purchase_ds_add(ds, record) {
                var tax_nature = '${/model/erpord_2010_default_inf/record/@tax_nature}';
                var record_line = $('erpord_2010_vender_purchase_result_ds').getCurrentRecord();
                var result_record = $('erpord_2010_vender_basic_result_ds').getAt(0);
                var company_id;
                company_id = result_record.get('company_id');
                record.set('company_id', company_id);
                record.set('partner_id', erpord_2010_partner_id);
                if (tax_nature == 'SMALL_SCALE_TAXPAYERS') {
                    record.set('tax_include_flag', null);
                    record.set('tax_rate', null);
                }
                record_line.getField('item_code').setLovPara('company_id', result_record.getObject().company_id);
            
            }
            
            
            function erpord_2010_contact_render(value, record, name) {
                var address_id = record.get('address_id');
                if (record.isNew) {
                    return;
                }
                if (value == 'Y') {
                    erpord_2010_contact_id = record.id;
                    return '${l:ERPORD.DEFAULT}';
                }
                var record_id = record.id;
                return '<a href="javascript:erpord_2010_default_contact(' + address_id + ',' + erpord_2010_partner_id + ',' + record_id + ')">${l:ERPORD.SET_AS_DEFAULT}</a>';
            }
            
            function erpord_2010_vender_contact_add() {
                $('erpord_2010_vender_contact_result_grid').showEditorByRecord($('erpord_2010_vender_contact_result_ds').create());
            }
            
            function erpord_2010_vender_contact_delete() {
                var records = $('erpord_2010_vender_contact_result_ds').getSelected();
                if (records.length == 0) {
                    Aurora.showMessage('${l:MASCLOUD.PROMPT}', '${l:ERPINV.MESSAGE16}');
                } else {
                    $('erpord_2010_vender_contact_result_grid').remove();
                }
            }
            
            function erpord_2010_vender_contact_submit() {
                $('erpord_2010_vender_contact_result_ds').submit();
            }
            
            function erpord_2010_purchase_result_add() {
                $('erpord_2010_vender_purchase_result_grid').showEditorByRecord($('erpord_2010_vender_purchase_result_ds').create());
            }
            
            function erpord_2010_purchase_result_delete() {
                var records = $('erpord_2010_vender_purchase_result_ds').getSelected();
                if (records.length == 0) {
                    Aurora.showMessage('${l:MASCLOUD.PROMPT}', '${l:ERPINV.MESSAGE16}');
                } else {
                    $('erpord_2010_vender_purchase_result_ds').remove();
                }
            }
            
            function erpord_2010_purchase_result_submit() {
                $('erpord_2010_vender_purchase_result_ds').submit();
            }
            
            function erpord2010_partner_code_validator(record, name, value) {
                var partner_code = record.get('partner_code');
                var regex = /^[\dA-Z\-]+$/;
                if ('${/model/erpord_2010_manual_flag/record/@manual_flag}' == 'Y') {
                    if (!regex.test(partner_code)) {
                        return '${l:ERPINV.MESSAGE28}';
                    }
                }
                return true;
            }
            
            function erpord2010_gridclick(grid, row, name, record) {
                var company_id = record.get('company_id');
                var metadata = record.getMeta();
                var f1 = metadata.getField('item_code');
            
                f1.setLovService('erpinv.public.inv_items_query_lov');
                f1.setLovPara('enable_flag','Y');
                f1.setLovPara('company_id', record.get('company_id') || '');
                if (name == 'currency_code') {
                    $('erpord_2010_currency_code_ds').setQueryParameter('enable_flag', 'Y');
                    $('erpord_2010_currency_code_ds').setQueryParameter('company_id', company_id);
                    $('erpord_2010_currency_code_ds').query();
                }
                if (name == 'trade_uom_desc') {
                    $('erpord2010_uom_ds').setQueryParameter('enable_flag', 'Y');
                    $('erpord2010_uom_ds').setQueryParameter('company_id', company_id);
                    $('erpord2010_uom_ds').query();
                }
            
            }
            
        ]]></script>
        <a:dataSets>
            <a:dataSet id="erpord2010_uom_ds" fetchAll="true" loadData="true" model="erpinv.public.inv_uom_codes_lov"/>
            <a:dataSet id="erpord_2010_vender_code_rule_ds" autoQuery="true" model="erpord.ERPORD2010.ord_customer_code_rule">
                <a:fields>
                    <a:field name="erpord_2010_manual_flag"/>
                </a:fields>
            </a:dataSet>
            <a:dataSet id="erpord_2010_currency_code_ds" loadData="true" model="erpgld.public.gld_currency"/>
            <!-- 基本信息 -->
            <a:dataSet id="erpord_2010_vender_basic_result_ds" autoCreate="true" model="erpord.ERPORD2010.ord_customer_basic">
                <a:datas dataSource="/model/erpord_2010_basic_result_data"/>
                <a:fields>
                    <a:field name="company_id"/>
                    <a:field name="company_code"/>
                    <a:field name="company_name" autoComplete="true" autoCompleteSize="1" lovGridHeight="350" lovHeight="500" lovService="erppublic.fnd_company_list" lovWidth="450" required="true" title="FND1910.SELECT_COMPANY">
                        <a:mapping>
                            <a:map from="company_full_name" to="company_name"/>
                            <a:map from="company_id" to="company_id"/>
                            <a:map from="company_code" to="company_code"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="partner_id"/>
                    <a:field name="partner_code" typeCase="upper" validator="erpord2010_partner_code_validator"/>
                    <a:field name="partner_name" required="true"/>
                    <a:field name="detail_address"/>
                    <a:field name="enabled_flag" checkedValue="Y" defaultValue="Y" uncheckedValue="N"/>
                    <a:field name="vender_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="customer_flag" defaultValue="Y"/>
                    <a:field name="management_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="province_id"/>
                    <a:field name="city_id"/>
                    <a:field name="district_id"/>
                    <a:field name="province_desc" autoComplete="true" autoCompleteField="province_code_name" autoCompleteSize="1" lovGridHeight="350" lovHeight="500" lovService="erpsys.public.sys_region_province_lov" lovWidth="450" title="ERPFND1010.PROVINCE_INFO">
                        <a:mapping>
                            <a:map from="province_name" to="province_desc"/>
                            <a:map from="province_id" to="province_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="city_desc" autoComplete="true" autoCompleteField="city_code_name" autoCompleteSize="1" lovGridHeight="350" lovHeight="500" lovService="erpsys.public.sys_region_city_lov" lovWidth="450" title="ERPFND1010.CITY_INFO">
                        <a:mapping>
                            <a:map from="city_name" to="city_desc"/>
                            <a:map from="city_id" to="city_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="district_desc" autoComplete="true" autoCompleteField="district_code_name" autoCompleteSize="1" lovGridHeight="350" lovHeight="500" lovService="erpsys.public.sys_region_district_lov" lovWidth="500" title="ERPFND1010.COUNTRY_INFO">
                        <a:mapping>
                            <a:map from="district_name" to="district_desc"/>
                            <a:map from="district_id" to="district_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="sys_customer_desc" autoComplete="true" autoCompleteField="code_name" autoCompleteSize="1" lovGridHeight="350" lovHeight="500" lovService="erpsys.ERPSYS2010.sys_customer_basics?enabled_flag=Y" lovWidth="500" readOnly="true" title="ERPFND_BUSINESS_PARTNER_INTERF.SYS_CUSTOMER_DESC">
                        <a:mapping>
                            <a:map from="code_name" to="sys_customer_desc"/>
                            <a:map from="customer_id" to="sys_customer_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="customer_type_desc" autoComplete="true" autoCompleteField="code_name" autoCompleteSize="1" lovGridHeight="350" lovHeight="500" lovLabelWidth="100" lovWidth="550" title="ERPFND_BUSINESS_PARTNER_INTERF.CUSTOMER_TYPE_DESC">
                        <a:mapping>
                            <a:map from="code_name" to="customer_type_desc"/>
                            <a:map from="partner_type_id" to="customer_type_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="goods_issue_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                </a:fields>
                <a:events>
                    <a:event name="submit" handler="erpord2010_basic_ds_submit"/>
                    <a:event name="submitfailed" handler="erpord2010_basic_ds_submitfailed"/>
                    <a:event name="ajaxfailed" handler="erpord2010_basic_ds_submitfailed"/>
                    <a:event name="submitsuccess" handler="erpord2010_submitsuccess"/>
                    <a:event name="update" handler="erpord_2010_ds_update_maintain"/>
                </a:events>
            </a:dataSet>
            <!-- 联系信息 -->
            <a:dataSet id="erpord_2010_vender_purchase_result_ds" autoPageSize="true" autoQuery="true" model="erpord.ERPORD2010.ord_customer_purchase" queryUrl="${/request/@context_path}/autocrud/erpord.ERPORD2010.ord_customer_purchase/query?partner_id=${/parameter/@partner_id}" selectable="true">
                <a:fields>
                    <a:field name="currency_code" defaultValue="${/model/erpord_2010_default_inf/record/@functional_currency_code}" displayField="currency_code" options="erpord_2010_currency_code_ds" prompt="ERPFND_BUSINESS_PARTNER_ITEMS.CURRENCY_CODE" returnField="currency_code" valueField="currency_code"/>
                    <a:field name="partner_id"/>
                    <a:field name="item_code" autoComplete="true" autoCompleteField="item_code" lovGridHeight="300" lovHeight="430" lovService="erpinv.public.inv_items_query_lov" lovWidth="500" prompt="ERPFND_BUSINESS_PARTNER_ITEMS.ITEM_CODE" required="true" title="HAP_QUERY" typeCase="upper">
                        <a:mapping>
                            <a:map from="item_code" to="item_code"/>
                            <a:map from="item_name" to="item_name"/>
                            <a:map from="item_specs" to="item_specs"/>
                            <a:map from="item_id" to="item_id"/>
                            <a:map from="trade_uom" to="trade_uom"/>
                            <a:map from="trade_uom_desc" to="trade_uom_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="item_id"/>
                    <a:field name="item_name" prompt="ERPFND_BUSINESS_PARTNER_ITEMS.ITEM_NAME" readOnly="true"/>
                    <a:field name="item_specs" prompt="ERPFND_BUSINESS_PARTNER_ITEMS.ITEM_SPECS" readOnly="true"/>
                    <a:field name="partner_item_code" prompt="ERPFND_BUSINESS_PARTNER_ITEMS.PARTNER_ITEM_CODE" typeCase="upper"/>
                    <a:field name="partner_item_name" prompt="ERPFND_BUSINESS_PARTNER_ITEMS.PARTNER_ITEM_NAME"/>
                    <a:field name="trade_uom_desc" displayField="uom_description" options="erpord2010_uom_ds" prompt="ERPFND_BUSINESS_PARTNER_ITEMS.TRADE_UOM_DESC" required="true" returnField="trade_uom" typeCase="upper" valueField="uom_code"/>
                    <a:field name="trade_uom"/>
                    <a:field name="tax_include_flag" checkedValue="Y" defaultValue="${/model/erpord_2010_default_inf/record/@tax_included_flag}" prompt="ERPFND_BUSINESS_PARTNER_ITEMS.TAX_INCLUDE_FLAG" uncheckedValue="N"/>
                    <a:field name="tax_rate" prompt="ERPFND_BUSINESS_PARTNER_ITEMS.TAX_RATE"/>
                    <a:field name="tax_code_id"/>
                    <a:field name="tax_code_desc" autoComplete="true" autoCompleteField="tax_type_code" autoCompleteSize="1" lovGridHeight="320" lovHeight="450" lovService="public.fnd_tax_type_code_lov?business_group=${/session/@business_group}" lovWidth="500" required="true" title="税率查询">
                        <a:mapping>
                            <a:map from="tax_type_id" to="tax_code_id"/>
                            <a:map from="description" to="tax_code_desc"/>
                            <a:map from="tax_type_rate" to="tax_rate"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="price" prompt="FND_BUSINESS_PARTNER_ITEMS.PRICE"/>
                </a:fields>
                <a:events>
                    <a:event name="add" handler="erpord_2010_vender_purchase_ds_add"/>
                    <a:event name="submit" handler="erpord2010_purchase_ds_submit"/>
                    <a:event name="submitfailed" handler="erpord2010_purchase_ds_submitsuccess"/>
                    <a:event name="ajaxfailed" handler="erpord2010_purchase_ds_submitsuccess"/>
                    <a:event name="submitsuccess" handler="erpord2010_purchase_ds_submitsuccess"/>
                </a:events>
            </a:dataSet>
            <!-- 采购信息 -->
            <a:dataSet id="erpord_2010_vender_contact_result_ds" autoPageSize="true" autoQuery="true" model="erpord.ERPORD2010.fnd_addresses" queryUrl="${/request/@context_path}/autocrud/erpord.ERPORD2010.fnd_addresses/query?partner_id=${/parameter/@partner_id}" selectable="true">
                <a:fields>
                    <a:field name="address_id"/>
                    <a:field name="contact_name" required="true"/>
                    <a:field name="province_id"/>
                    <a:field name="city_id"/>
                    <a:field name="district_id"/>
                    <a:field name="province_desc" autoComplete="true" autoCompleteField="province_code_name" autoCompleteSize="1" lovGridHeight="350" lovHeight="500" lovService="erpsys.public.sys_region_province_lov" lovWidth="450" title="ERPFND1010.PROVINCE_INFO">
                        <a:mapping>
                            <a:map from="province_name" to="province_desc"/>
                            <a:map from="province_id" to="province_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="city_desc" autoComplete="true" autoCompleteField="city_code_name" autoCompleteSize="1" lovGridHeight="350" lovHeight="500" lovService="erpsys.public.sys_region_city_lov" lovWidth="450" title="ERPFND1010.CITY_INFO">
                        <a:mapping>
                            <a:map from="city_name" to="city_desc"/>
                            <a:map from="city_id" to="city_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="district_desc" autoComplete="true" autoCompleteField="district_code_name" autoCompleteSize="1" lovGridHeight="350" lovHeight="500" lovService="erpsys.public.sys_region_district_lov" lovWidth="500" title="ERPFND1010.COUNTRY_INFO">
                        <a:mapping>
                            <a:map from="district_name" to="district_desc"/>
                            <a:map from="district_id" to="district_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="address"/>
                    <a:field name="post_code"/>
                    <a:field name="phone_number"/>
                    <a:field name="mobile_phone"/>
                    <a:field name="fax_number"/>
                    <a:field name="email"/>
                    <a:field name="default_flag" defaultValue="N"/>
                </a:fields>
                <a:events>
                    <a:event name="update" handler="erpord_2010_contact_ds_update"/>
                    <a:event name="add" handler="erpord_2010_conatact_ds_add"/>
                    <a:event name="submit" handler="erpord2010_contact_ds_submit"/>
                    <a:event name="submitfailed" handler="erpord2010_contact_ds_submitsuccess"/>
                    <a:event name="ajaxfailed" handler="erpord2010_contact_ds_submitsuccess"/>
                    <a:event name="submitsuccess" handler="erpord2010_contact_ds_submitsuccess"/>
                </a:events>
            </a:dataSet>
        </a:dataSets>
        <a:popupScreen>
            <a:tabPanel id="erpord_2010_maitain_panel" marginHeight="100" marginWidth="50">
                <a:tabs>
                    <!-- 基本信息 -->
                    <a:tab prompt="ERPORD2010.ORD_BASIC_INFORMATION" width="100">
                        <a:screenTopToolbar>
                            <a:toolbarButton id="erpord_2010_save_basic_btn" className="item-rbtn-blue button-save" click="erpord_2010_contact_save_basic" style="margin-left:20px;" text="PROMPT.SAVE" width="100"/>
                        </a:screenTopToolbar>
                        <a:hBox>
                            <a:lov name="company_name" bindTarget="erpord_2010_vender_basic_result_ds" prompt="ERPFND.COMPANY_DESC" width="210"/>
                        </a:hBox>
                        <a:hBox>
                            <a:textField name="partner_code" bindTarget="erpord_2010_vender_basic_result_ds" maxLength="15" prompt="ERPORD2010.ORD_CUSTOMER_CODE" typeCase="upper" width="210"/>
                            <a:vBox labelWidth="150">
                                <a:checkBox name="vender_flag" bindTarget="erpord_2010_vender_basic_result_ds" prompt="ERPORD2010.ORD_CUSTOMER_CUSTOMER_FLAG"/>
                            </a:vBox>
                        </a:hBox>
                        <a:hBox>
                            <a:textField name="partner_name" bindTarget="erpord_2010_vender_basic_result_ds" maxLength="1000" prompt="ERPORD2010.ORD_CUSTOMER_NAME" width="383"/>
                        </a:hBox>
                        <a:hBox>
                            <a:textField name="sys_customer_desc" bindTarget="erpord_2010_vender_basic_result_ds" prompt="ERPORD.SYS_CUSTOMER_DESC" width="383"/>
                        </a:hBox>
                        <a:hBox>
                            <a:lov name="customer_type_desc" bindTarget="erpord_2010_vender_basic_result_ds" prompt="ERPFND_BUSINESS_PARTNER_INTERF.CUSTOMER_TYPE_DESC" width="383"/>
                        </a:hBox>
                        <a:hBox>
                            <a:lov name="province_desc" bindTarget="erpord_2010_vender_basic_result_ds" prompt="ERPORD.PROVINCE_DESC" width="100"/>
                            <div><![CDATA[${l:ERPFND_COMPANIES.ADDRESS_PROVINCE}]]></div>
                            <a:lov name="city_desc" bindTarget="erpord_2010_vender_basic_result_ds" prompt="" width="100"/>
                            <div><![CDATA[${l:ERPFND_COMPANIES.ADDRESS_CITY}]]></div>
                            <a:lov name="district_desc" bindTarget="erpord_2010_vender_basic_result_ds" prompt="" width="100"/>
                            <div><![CDATA[${l:ERPFND_COMPANIES.ADDRESS_COUNTY}]]></div>
                            <a:textField name="detail_address" bindTarget="erpord_2010_vender_basic_result_ds" defaultQueryHint="ORD.DETAIL_ADDRESS" prompt="" width="250"/>
                        </a:hBox>
                        <a:hBox>
                            <a:textField name="legal_representative" bindTarget="erpord_2010_vender_basic_result_ds" prompt="ERPFND_BUSINESS_PARTNERS.LEGAL_REPRESENTATIVE"/>
                            <a:textField name="tax_number" bindTarget="erpord_2010_vender_basic_result_ds" prompt="ERPFND_BUSINESS_PARTNERS.TAX_NUMBER"/>
                        </a:hBox>
                        <a:hBox>
                            <a:textField name="bank_name" bindTarget="erpord_2010_vender_basic_result_ds" prompt="ERPFND_BUSINESS_PARTNERS.BANK_NAME"/>
                            <a:textField name="bank_account" bindTarget="erpord_2010_vender_basic_result_ds" prompt="ERPFND_BUSINESS_PARTNERS.BANK_ACCOUNT"/>
                        </a:hBox>
                        <a:hBox>
                            <a:textField name="homepage" bindTarget="erpord_2010_vender_basic_result_ds" prompt="ERPFND_BUSINESS_PARTNERS.HOMEPAGE" width="383"/>
                        </a:hBox>
                        <a:hBox>
                            <!-- <a:checkBox name="goods_issue_flag" bindTarget="erpord_2010_vender_basic_result_ds" prompt="ERPFND_BUSINESS_PARTNER_INTERF.GOODS_ISSUE_FLAG"/> -->
                            <a:checkBox name="enabled_flag" bindTarget="erpord_2010_vender_basic_result_ds" prompt="ERPFND_BUSINESS_PARTNERS.ENABLED_FLAG"/>
                        </a:hBox>
                    </a:tab>
                    <!-- 联系信息 -->
                    <a:tab prompt="ERPORD2010.CONTACT_INF" width="100">
                        <a:screenTopToolbar>
                            <a:gridButton id="ord_2010_contact_add_btn" bind="erpord_2010_vender_contact_result_grid" style="margin-left:20px;" text="PROMPT.ADD" type="add" width="100"/>
                            <a:gridButton id="ord_2010_contact_save_btn" bind="erpord_2010_vender_contact_result_grid" text="PROMPT.SAVE" type="save" width="100"/>
                            <a:gridButton id="ord_2010_contact_delete_btn" bind="erpord_2010_vender_contact_result_grid" text="PROMPT.DELETE" type="delete" width="100"/>
                        </a:screenTopToolbar>
                        <a:grid id="erpord_2010_vender_contact_result_grid" bindTarget="erpord_2010_vender_contact_result_ds" height="355" marginHeight="127" marginWidth="54" navbar="true" width="855">
                            <a:columns>
                                <a:column name="contact_name" editor="erpord_2010_contact_tef" width="80"/>
                                <a:column name="default_flag" prompt="ERPFND_ADDRESSES.DEFAULT_FLAG" renderer="erpord_2010_contact_render" width="60"/>
                                <a:column prompt="ERPFND_ADDRESSES.CONTACT_ADDRESS">
                                    <a:column name="province_desc" editor="erpord_2010_cantact_lov" prompt="ERPFND_ADDRESSES.PROVINCE_DESC" width="60"/>
                                    <a:column name="city_desc" editor="erpord_2010_cantact_lov" prompt="ERPFND_ADDRESSES.CITY_DESC" width="60"/>
                                    <a:column name="district_desc" editor="erpord_2010_cantact_lov" prompt="ERPFND_ADDRESSES.DISTRICT_DESC" width="60"/>
                                    <a:column name="address" editor="erpord_2010_contact_tef" width="115"/>
                                </a:column>
                                <a:column name="post_code" editor="erpord_2010_contact_tef" width="80"/>
                                <a:column name="phone_number" editor="erpord_2010_contact_tef" width="70"/>
                                <a:column name="mobile_phone" editor="erpord_2010_contact_tef" width="70"/>
                                <a:column name="fax_number" editor="erpord_2010_contact_tef" width="70"/>
                                <a:column name="email" editor="erpord_2010_contact_tef" width="100"/>
                            </a:columns>
                            <a:editors>
                                <a:lov id="erpord_2010_cantact_lov"/>
                                <a:numberField id="erpord_2010_cantact_nbf" allowDecimals="false" allowNegative="false"/>
                                <a:comboBox id="erpord_2010_cantact_cmb"/>
                                <a:textField id="erpord_2010_contact_tef"/>
                            </a:editors>
                        </a:grid>
                    </a:tab>
                    <!-- 采购信息 -->
                    <a:tab id="erpord_2010_vender_tab_id" prompt="ERPORD.SALE_INFO" width="100">
                        <a:screenTopToolbar>
                            <a:gridButton id="ord_2010_purchase_add_btn" bind="erpord_2010_vender_purchase_result_grid" style="margin-left:20px;" text="PROMPT.ADD" type="add" width="100"/>
                            <a:gridButton id="ord_2010_purchase_save_btn" bind="erpord_2010_vender_purchase_result_grid" text="PROMPT.SAVE" type="save" width="100"/>
                            <a:gridButton id="ord_2010_purchase_delete_btn" bind="erpord_2010_vender_purchase_result_grid" text="PROMPT.DELETE" type="delete" width="100"/>
                        </a:screenTopToolbar>
                        <a:grid id="erpord_2010_vender_purchase_result_grid" bindtarget="erpord_2010_vender_purchase_result_ds" height="355" marginHeight="127" marginWidth="54" navbar="true" width="855">
                            <a:columns>
                                <a:column name="item_code" editor="erpord_2010_maintain_lov" sortable="true" width="115"/>
                                <a:column name="item_name" width="115"/>
                                <a:column name="item_specs" width="50"/>
                                <a:column name="partner_item_code" editor="erpord_2010_text_Field1" width="110"/>
                                <a:column name="partner_item_name" editor="erpord_2010_text_Field1" width="110"/>
                                <a:column name="trade_uom_desc" editor="erpord_2010_currency_code_cmb1" width="60"/>
                                <a:column name="currency_code" editor="erpord_2010_currency_code_cmb1" width="60"/>
                                <a:column name="tax_include_flag" editor="erpord_2010_tax_flag_ckb1" width="50"/>
                                <a:column name="tax_code_desc" align="right" editor="erpord_2010_maintain_lov" prompt="税率" sortable="true" width="70"/>
                                <!-- <a:column name="tax_rate" align="right" editor="erpord_2010_number_f" renderer="erpord_2010_formatMoney" sortable="true" width="70"/> -->
                                <a:column name="price" align="right" editor="erpord_2010_number_f1" prompt="ERPORD.PRICE" sortable="true" width="70"/>
                            </a:columns>
                            <a:editors>
                                <a:lov id="erpord_2010_maintain_lov"/>
                                <a:textField id="erpord_2010_text_Field1"/>
                                <a:comboBox id="erpord_2010_currency_code_cmb1"/>
                                <a:checkBox id="erpord_2010_tax_flag_ckb1"/>
                                <a:numberField id="erpord_2010_number_f" allowDecimals="true" allowFormat="true" allowNegative="false" decimalPrecision="8"/>
                                <a:numberField id="erpord_2010_number_f1" allowDecimals="true" allowFormat="true" allowNegative="false"/>
                            </a:editors>
                            <a:events>
                                <a:event name="cellclick" handler="erpord2010_gridclick"/>
                            </a:events>
                        </a:grid>
                    </a:tab>
                </a:tabs>
            </a:tabPanel>
        </a:popupScreen>
        <script><![CDATA[
            function ord_2010_init() {
                var tax_nature = '${/model/erpord_2010_default_inf/record/@tax_nature}';
                var system_mode = '${/model/erpord_2010_default_inf/record/@system_mode}';
                var ds = $('erpord_2010_vender_basic_result_ds');
                var record = ds.getAt(0);
                var metadata = record.getMeta();
                var f1 = metadata.getField('customer_type_desc');
                // var customer_type_id = '${/parameter/@customer_type_id}';
                if (!record.get('company_id') || record.get('company_id') == '') {
                    f1.setLovService('');
                } else {
                    f1.setLovService('erpord.ERPORD1010.fnd_business_partner_types?enabled_flag=Y');
                    f1.setLovPara('enabled_flag', 'Y');
                    f1.setLovPara('company_id', record.get('company_id') || '');
                    // f1.setLovPara('customer_type_id', customer_type_id);
                }
            
                if ('${/model/erpord_2010_manual_flag/record/@manual_flag}' == 'Y') {
                    //手工方式：设置必输
                    record.getField('partner_code').setRequired(true);
                } else {
                    //自动方式：生成供应商编码并赋值
                    //....
                    record.getField('partner_code').setReadOnly(true);
                }
                if (tax_nature == 'SMALL_SCALE_TAXPAYERS') {
                    $('erpord_2010_vender_purchase_result_grid').hideColumn('tax_include_flag');
                    $('erpord_2010_vender_purchase_result_grid').hideColumn('tax_rate');
                }
                /* if(system_mode<3){
                 Ext.get('erpord_2010_vender_tab_id').hide();
                 } */
                if (!Ext.isEmpty(erpord_2010_partner_id)) {
                    erpord_2010_submit_flag = 'N';
                    record.getField('partner_code').setReadOnly(true);
                    var province_id = record.get('province_id');
                    var city_id = record.get('city_id');
                    if (!Ext.isEmpty(province_id)) {
                        record.getField('city_desc').setLovService('erpsys.public.sys_region_city_lov');
                        record.getField('city_desc').setLovPara('province_id', province_id);
                        if (!Ext.isEmpty(city_id)) {
                            record.getMeta().getField('district_desc').setLovService('erpsys.public.sys_region_district_lov');
                            record.getField('district_desc').setLovPara('province_id', province_id);
                            record.getField('district_desc').setLovPara('city_id', city_id);
                        }
                    }
                    var contact_records = $('erpord_2010_vender_contact_result_ds').getAll();
                    for (var i = 0;i < contact_records.length;i++) {
                        var province_id_con = contact_records[i].get('province_id');
                        var city_id_con = contact_records[i].get('city_id');
                        if (!Ext.isEmpty(province_id_con)) {
                            contact_records[i].getField('city_desc').setLovService('erpsys.public.sys_region_city_lov');
                            contact_records[i].getField('city_desc').setLovPara('province_id', province_id_con);
                            if (!Ext.isEmpty(city_id_con)) {
                                contact_records[i].getMeta().getField('district_desc').setLovService('erpsys.public.sys_region_district_lov');
                                contact_records[i].getField('district_desc').setLovPara('province_id', province_id_con);
                                contact_records[i].getField('district_desc').setLovPara('city_id', city_id_con);
                            }
                        }
                    }
                } else {
                    if ('${/model/erpord_2010_manual_flag/record/@manual_flag}' == 'N') {
                        record.set('partner_code', '${l:ERPINV.MESSAGE14}');
                    }
                    erpord_2010_submit_flag = 'Y';
                    $('erpord_2010_maitain_panel').setDisabled(1);
                    $('erpord_2010_maitain_panel').setDisabled(2);
                }
            }
            ord_2010_init();
        ]]></script>
    </a:view>
</a:screen>

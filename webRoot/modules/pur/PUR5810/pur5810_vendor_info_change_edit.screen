<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: Ace
    $Date: 2014-5-4 下午08:27:55  
    $Revision: 1.0  
    $Purpose: 
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application">
    <a:init-procedure>
        <a:model-query fetchAll="true" model="pur.PUR5670.get_session_user_info" rootPath="pur5780_current_user"/>
        <a:model-query model="fnd.FND9100.fnd_company_registed_query" rootPath="company_data"/>
    </a:init-procedure>
    <a:view>
        <a:link id="pur5810_vendor_info_change_save_link" url="${/request/@context_path}/modules/pur/PUR5810/pur5810_vendor_info_change_save.svc"/>
        <a:link id="pur5810_vendor_info_change_submit_link" model="pur.PUR5810.pur5810_vendor_change_edit1_query" modelaction="execute"/>
        <a:link id="pur5810_vendor_info_change_submit2_link" model="pur.PUR5810.pur5810_vendor_change_edit1_query" modelaction="delete"/>
        <a:link id="pur5810_vendor_infoChange_atm_file" url="${/request/@context_path}/attachment_file_upload.screen"/>
        <a:link id="pur5780_attachment_file_download_link" url="${/request/@context_path}/atm_download.svc"/>
        <a:link id="pur5810_vendor_info_change_back_link" model="pur.PUR5810.pur5810_vendor_change_back" modelaction="execute"/>
        <a:link id="pur_5810_vendor_change_back_link" url="${/request/@context_path}/modules/pur/PUR5810/pur5810_vendor_info_change_back_info.screen"/>
        <style><![CDATA[
        	.register-upLoad .up_card{
	            width: 196px;
	            height:20px;
	            margin: 0 0px 0px 0;
             }
             .register-upLoad .up_card .icon-png{
	            background-position: -64px -30px;
 		     }
             .register-upLoad .up_card .icon-jpg {
                background-position: 0 -26px;
             }
             .register-upLoad .up_card .icon{
	            margin: 0px 0 0 4px;
                width: 22px;
                height: 18px;
             }
             .register-upLoad .up_card .j{
	            width: 145px;
                height: 16px;
                white-space: nowrap;
                overflow: hidden;
                text-overflow: ellipsis;
                color: #666;
                position: absolute;
                left: 25px;
                top: 3px;
             }
             .register-upLoad .up_card .l{
	            top: 3px;
             }
             .register-upLoad .up_card .k{
	            display: none;
             }
             body .container .content-div .itemupf > span{
	            background-color: #65cea7;
                float: right;
                margin: 6px 0 0 5px;
                border-radius: 4px;
                color:#fff;
             }
             .upload_icon{
	            position: absolute;
                color: #fff;
                left: -56px;
                top: 9px;
                font-size: 12px;
                font-family: Microsoft Yahei;
                cursor: pointer;
              }
              .register-upLoad.itemupf > span{
	            background-color: #65cea7;
                float: right;
                margin: 0px 0 0 5px;
                border-radius: 4px;
                color:#fff;
              }
              .register-upLoad.itemupf > div{
	            float: left;
	            min-width: 100px;
                min-height: 30px;
              }
              /* ie下upload样式 */
              body .rregisted-ie-upload{
                border: 1px solid silver;
                display: block;
                height: 26px;
                width: 200px;
                float: left;
                border-radius: 5px;
              }
              body .rregisted-ie-upload > div{
	            margin:3px 2px;
               }
              body .rregisted-ieupload-span{
                display: block;
                float: right;
                border: 1px solid #ccc;
                margin-top: 1px;
                margin-left: 2px;
                border-radius: 3px;	
              }
              #pur5810_upload_1 span{
                  display:none;
              } 
              #pur5810_upload_2 span{
                  display:none;
              }
              #pur5810_upload_3 span{
                  margin-top: 15px;
              } 
              #pur5810_upload_4 span{
                  margin-top: 15px;
              }
              #pur5810_upload_5 span{
                  display:none;
              } 
              #pur5810_upload_7 span{
                  display:none;
              } 
              #pur5810_upload_8 span{
                  display:none;
              } 
              #pur5810_upload_6 span{
                  margin-top: 15px;
              }
              #pur5810_upload_9 span{
                  margin-top: 15px;
              }
              #pur5810_upload_10 span{
                  margin-top: 15px;
              }
        ]]></style>
        <script><![CDATA[
            function pur5810_vendor_infoChange_atm_file() {
                var alter_req_id = $('pur5810_vendor_infoChange1_ds').getCurrentRecord().get('alter_req_id');
                if (alter_req_id) {
                    new Aurora.Window({
                        id: 'pur5780_attachment_file_upload_win',
                        title: '${l:ATM.UPLOAD_ATTACHMENT}',
                        url: $('pur5810_vendor_infoChange_atm_file').getUrl() + '?pkvalue=' + alter_req_id + '&table_name=PUR_VENDOR_CLASS_ALTER_REQ',
                        width: 850,
                        height: 500
                    });
            
                    $('pur5780_attachment_file_upload_win').on('close', function() {
            
                        $('pur5780_vendor_class_alter_modify_attachments_ds').setQueryParameter('table_name', 'PUR_VENDOR_CLASS_ALTER_REQ');
                        $('pur5780_vendor_class_alter_modify_attachments_ds').setQueryParameter('pk_value', alter_req_id);
                        $('pur5780_vendor_class_alter_modify_attachments_ds').query();
                    });
                } else {
                    Aurora.showMessage('${l:PROMPT}', '${l:PUR5710.SAVE_FIRST}');
                    return;
                }
            }
            //附件上传和下载
            
            function pur5780_upload_renderer(value, record, name) {
                var attachment_id = record.get('attachment_id'); //附件ID
                if (attachment_id) {
                    return '<a href="' + $('pur5780_attachment_file_download_link').getUrl() + '?attachment_id=' + attachment_id + '">' + value + '</a>';
                }
            }
            
            function pur5810_vendor_infoChange1_ds_submitsuccessFun(dataset, res) {
                var recommend_hds_id = '${/parameter/@recommend_hds_id}' ? '${/parameter/@recommend_hds_id}' : res.result.recommend_hds_id;
            }
            
            function pur5810_mask() {
                Aurora.Masker.mask($('pur5810_vendor_info_change_win').wrap, '${l:LOADING}');
            
            }
            
            function pur5810_unmask() {
                Aurora.Masker.unmask($('pur5810_vendor_info_change_win').wrap);
            }
            
            //保存
            
            function pur5810_vendor_infoChange_save() {
            
            	debugger;
            
                var header_ds = $('pur5810_vendor_infoChange1_ds');
                var account_ds = $('pur5810_companySupplierAccounts_ds');
                var address_ds = $('pur5810_companySupplierAddresses_ds');
                //var purchase_ds = $('pur5810_procurement_information_ds');
                var rep_ds = $('pur5810_legal_rep_information_ds');
            
                if (!header_ds.validate()) {
                    return;
                }
                if (!account_ds.validate()) {
                    return;
                }
                if (!address_ds.validate()) {
                    return;
                }
                //if (!purchase_ds.validate()) {
                    //return;
                //}
                if (!rep_ds.validate()) {
                    return;
                }
            
                var header_record = header_ds.getCurrentRecord();
                var vendor_id = '${/parameter/@vendor_id}';
                header_record.set('vendor_id', vendor_id);
            
                var data = header_record.data;
                if (Aurora.isEmpty(header_record.get('hd_id'))) {
                    data._status = 'insert';
                } else {
                    data._status = 'update';
                } 
            
                data['account_lns'] = account_ds.getJsonData();
                data['address_lns'] = address_ds.getJsonData();
                //data['purchase_lns'] = purchase_ds.getJsonData();
                data['legal_lns'] = rep_ds.getJsonData();
            
                pur5810_mask();
            
                Aurora.request({
                    url: $('pur5810_vendor_info_change_save_link').getUrl(),
                    para: data,
                    success: function(result) {
                        pur5810_unmask();
                        Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.SAVE_SUCCESSFULLY}', function() {
                            header_ds.query();
                            account_ds.query();
                            address_ds.query();
                            //purchase_ds.query();
                            rep_ds.query();
                        });
            
                    },
                    failure: function() {
                        pur5810_unmask();
                        return;
                    },
                    error: function() {
                        pur5810_unmask();
                        return;
                    }
                });
            }
            
            //提交
            
            function pur5810_vendor_infoChange_submit() {
                var data = {};
                data.hd_id = $('pur5810_vendor_infoChange1_ds').getCurrentRecord().get('hd_id');
            
                Aurora.showConfirm('${l:PROMPT}', '${l:PUR5320.SURE_TO_SUBMIT}', function() {
                    if (Aurora.isEmpty(data.hd_id)) {
                        return;
                    }
            
                    pur5810_mask();
            
                    Aurora.request({
                        url: $('pur5810_vendor_info_change_submit_link').getUrl(),
                        para: data,
                        success: function() {
                            pur5810_unmask();
                            Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.SUBMIT_SUCCESS}', function() {
                                $('pur5810_vendor_infoChange1_ds').query();
                                $('pur5810_vendor_infoChange_save_btn').disable();
                                $('pur5810_vendor_infoChange_submit_btn').disable();
                                for (var i = 1;i <= 6;i++) {
                                    var ui = document.getElementById('pur5810_little_bt' + i);
                                    ui.style.display = "none";
                                }
                            });
                        },
                        failure: function() {
                            pur5810_unmask();
                            return;
                        },
                        error: function() {
                            pur5810_unmask();
                            return;
                        }
                    });
                });
            }
            
            //提交审批
            
            function pur5810_vendor_infoChange_submit2() {
                var data = {};
                data.hd_id = $('pur5810_vendor_infoChange1_ds').getCurrentRecord().get('hd_id');
            
                Aurora.showConfirm('${l:PROMPT}', '${l:PUR5320.SURE_TO_SUBMIT}', function() {
                    if (Aurora.isEmpty(data.hd_id)) {
                        return;
                    }
            
                    pur5810_mask();
            
                    Aurora.request({
                        url: $('pur5810_vendor_info_change_submit2_link').getUrl(),
                        para: data,
                        success: function() {
                            pur5810_unmask();
                            Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.SUBMIT_SUCCESS}', function() {
                                $('pur5810_vendor_infoChange1_ds').query();
                                $('pur5810_vendor_infoChange_save_btn').disable();
                                $('pur5810_vendor_infoChange_submit2_btn').disable();
                                for (var i = 1;i <= 6;i++) {
                                    var ui = document.getElementById('pur5810_little_bt' + i);
                                    ui.style.display = "none";
                                }
                            });
            
                        },
                        failure: function() {
                            pur5810_unmask();
                            return;
                        },
                        error: function() {
                            pur5810_unmask();
                            return;
                        }
                    });
                });
            }
            
            //返回
            
            function pur5810_vendor_infoChange_return() {
                $('pur5810_vendor_info_change_win').close();
            }
            
            //头update
            
            function pur5810_vendor_infoChange1_updateFun(ds, record, name, value, oldValue) {
                if (name == 'company_name') {
                    if (value != null && value != '') {
                        var owner_business_group = record.get('owner_business_group');
            
                        record.getField('payment_method_desc').setLovPara('require_business_group', owner_business_group);
                        record.getField('payment_term_desc').setLovPara('business_group', owner_business_group);
                    }
                }
                
                if(name=='erp_vendor_code')
                {
                    if (value != null && value != '') {
                        record.getMeta().getField('payment_method_desc').setReadOnly(false);
                    }
                }
            }
            
            //头load
            
            function pur5810_vendor_infoChange1_loadFun(ds) {
                var record = ds.getCurrentRecord();
            
                var company_name = record.get('company_name');
                if (company_name != null && company_name != '') {
                    var owner_business_group = record.get('owner_business_group');
            
                    record.getField('payment_method_desc').setLovPara('require_business_group', owner_business_group);
                    record.getField('payment_term_desc').setLovPara('business_group', owner_business_group);
                    record.getField('tax_type_name').setLovPara('require_business_group', owner_business_group);
                }
            
            }
            
            function pur5810_onCompanySupplierAddressesDs_submitsuccessFun() {
                $('pur5810_companySupplierAddresses_ds').query();
            }
            
            function pur5810_onCompanySupplierAccountsDs_submitsuccessFun() {
                $('pur5810_companySupplierAccounts_ds').query();
            }
            
            function pur5810_procurementInformationDs_submitsuccessFun() {
                $('pur5810_procurement_information_ds').query();
            }
            
            function pur5810_legal_repDs_submitsuccessFun() {
                $('pur5810_legal_rep_information_ds').query();
            }
            
            //地点tab事件
            
            function pur5810_addressesCellClick_fun(grid, row, name, record) {
                //国家、地区、城市级联更新
                if (Ext.isEmpty(record.get('country_name')) || record.get('country_name') == undefined) {
                    record.set('country_code', '');
                    record.getField("province_name").setLovService('');
                    record.getField("city_name").setLovService('');
            
                    record.getField('province_name').setReadOnly(true);
                    record.getField('city_name').setReadOnly(true);
                } else {
                    var temp_string = record.get('country_code');
                    record.getField("city_name").setLovService('');
                    record.getField("province_name").setLovService('public.fnd_region_province_lov');
                    record.getField("province_name").setLovPara('country_code', temp_string);
            
                    record.getField('province_name').setReadOnly(false);
                }
                if (Ext.isEmpty(record.get('province_name')) || record.get('province_name') == undefined) {
                    record.set('province_id', '');
                    record.getField("city_name").setLovService('');
            
                    record.getField('city_name').setReadOnly(true);
                } else {
                    record.getField("city_name").setLovService('public.fnd_region_city_lov');
                    record.getField("city_name").setLovPara('province_id', record.get('province_id'));
                    record.getField('city_name').setReadOnly(false);
                }
            
            }
            //退回
            function pur5810_vendor_infoChange_back(){
                
                var hd_id = $('pur5810_vendor_infoChange1_ds').getCurrentRecord().get('hd_id');
            
               new Aurora.Window({
                    url: $('pur_5810_vendor_change_back_link').getUrl() + '?hd_id=' + hd_id,
                    title: '退回',
                    id: 'pur5810_change_back_win',
                    width: 500,
                    height: 300
                });
            }
            
            function pur5810_legal_repDs_updateFun(ds, record, name, value, oldValue) {
                if (name == 'legal_rep_name') {
                    if (value != null && value != '') { 
                        record.getMeta().getField('legal_rep_phone').setRequired(true);
                        record.getMeta().getField('legal_rep_identity_type_desc').setRequired(true);
                        record.getMeta().getField('legal_rep_identity_num').setRequired(true); 
                    }
                    else
                    {
                        record.getMeta().getField('legal_rep_phone').setRequired(false);
                        record.getMeta().getField('legal_rep_identity_type_desc').setRequired(false);
                        record.getMeta().getField('legal_rep_identity_num').setRequired(false); 
                    }
                } 
            }
        ]]></script>
        <a:dataSets>
            <a:dataSet id="pur5810_vendor_idCardType_ds" lookupCode="SYS_IDENTITY_CARD_TYPES"/>
            <a:dataSet id="pur5810_vendor_site_ds" lookupCode="PUR_RFX_VENDOR_SITE"/>
            <a:dataSet id="pur5740_tax_ds" loadData="true" model="pur.PUR5740.pur5740_tax_query"/>
            <a:dataSet id="pur5740_pay_description_ds" loadData="true" model="pur.PUR5740.pur5740_pay_description_query"/>
            <a:dataSet id="YESorNO_ds" loadData="true" model="pur.PUR5740.pur5740_VMIno_query"/>
            <a:dataSet id="pur5740_currency_ds" loadData="true" model="pur.PUR5740.pur5740_currency_query"/>
            <a:dataSet id="fnd_identity_card_types_ds" lookupCode="SYS_IDENTITY_CARD_TYPES"/>
            <a:dataSet id="pur5810_vendor_infoChange0_ds" autoQuery="true" model="pur.PUR5810.pur5810_vendor_change_edit0_query" queryUrl="${/request/@context_path}/autocrud/pur.PUR5810.pur5810_vendor_change_edit0_query/query?version=${/parameter/@version}&amp;vendor_id=${/parameter/@vendor_id}">
                <a:fields>
                    <a:field name="three_in_one_flag" readOnly="true"/>
                    <a:field name="one_one_code_flag" readOnly="true"/>
                </a:fields>
            </a:dataSet>
            <a:dataSet id="pur5810_vendor_infoChange1_ds" loadData="true" model="pur.PUR5810.pur5810_vendor_change_edit1_query" queryUrl="${/request/@context_path}/autocrud/pur.PUR5810.pur5810_vendor_change_edit1_query/query?hd_id=${/parameter/@hd_id}">
                <a:fields>
                    <a:field name="status" defaultValue="NEW"/>
                    <a:field name="status_desc" displayField="code_value_name" options="pur5810_vendor_change_stauts_ds" returnField="status" valueField="code_value"/>
                    <a:field name="created_by_name" defaultValue="${/model/pur5780_current_user/record/@description}" readOnly="true"/>
                    <a:field name="creation_date_fmt" defaultValue="${/model/pur5780_current_user/record/@current_date}" readOnly="true"/>
                    <a:field name="owner_business_group"/>
                    <a:field name="company_name" autoComplete="true" autoCompleteField="company_full_name" lovHeight="500" lovService="pur.PUR5810.fnd_cooperative_company_by_supply_lov" lovWidth="500" required="true" requiredMessage="请选择客户信息！" title="PUR_HEADERS_ALL.PURCHASER">
                        <a:mapping>
                            <a:map from="business_group" to="owner_business_group"/>
                            <a:map from="company_id" to="company_id"/>
                            <a:map from="company_full_name" to="company_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="payment_method_id"/>
                    <a:field name="payment_method_desc" lovHeight="500" lovService="pur.PUR5730.pur5730_payment_methods_lov?require_business_group=${/parameter/@require_business_group}" lovWidth="500" prompt="PUR5730.PAYMENT_METHOD_NAME" readOnly="true" title="PUR5730.PAYMENT_METHOD_NAME">
                        <a:mapping>
                            <a:map from="payment_method_id" to="payment_method_id"/>
                            <a:map from="description" to="payment_method_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="payment_term_id"/>
                    <a:field name="payment_term_desc" lovHeight="500" lovService="fnd.FND9220.fnd_9220_payment_terms_lov?business_group=${/parameter/@require_business_group}" lovWidth="500" prompt="PUR5730.PAYMENT_TERMS" title="PUR5730.PAYMENT_TERMS">
                        <a:mapping>
                            <a:map from="payment_term_id" to="payment_term_id"/>
                            <a:map from="description" to="payment_term_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="tax_type_id"/>
                    <a:field name="tax_type_name" lovHeight="500" lovService="pur.PUR5730.pur5730_tax_type_codes_bg_lov?require_business_group=${/parameter/@require_business_group}" lovWidth="500" prompt="PUR5730.TAX_TYPE_NAME" title="PUR5730.TAX_TYPE_NAME">
                        <a:mapping>
                            <a:map from="tax_type_codes_bg_id" to="tax_type_id"/>
                            <a:map from="tax_type_code" to="tax_type_code"/>
                            <a:map from="tax_type_name" to="tax_type_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="contact_identity_type"/>
                    <a:field name="contact_identity_type_desc" displayField="code_value_name" options="pur5810_vendor_idCardType_ds" returnField="contact_identity_type" valueField="code_value"/>
                    <a:field name="display_site_code"/>
                    <a:field name="pur_vendor_site_desc" displayField="code_value_name" options="pur5810_vendor_site_ds" returnField="display_site_code" valueField="code_value_name"/>
                    <a:field name="comments"/>
                    <a:field name="vendor_name" readOnly="true"/>
                    <a:field name="erp_vendor_code" autoComplete="true" autoCompleteField="erp_vendor_code" lovHeight="500" lovService="pur.PUR5810.pur_erp_vendor_code_lov?hd_id=${/parameter/@hd_id}" lovWidth="500" title="ERP供应商编码">
                        <a:mapping>
                            <a:map from="tax_type_name" to="tax_type_name"/>
                            <a:map from="erp_vendor_coding" to="erp_vendor_code"/>
                            <a:map from="payment_method_desc" to="payment_method_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="unified_social_code" readOnly="true"/>
                </a:fields>
                <a:events>
                    <a:event name="update" handler="pur5810_vendor_infoChange1_updateFun"/>
                    <a:event name="load" handler="pur5810_vendor_infoChange1_loadFun"/>
                </a:events>
            </a:dataSet>
            <!-- ACCOUNTS -->
            <a:dataSet id="pur5810_companySupplierAccounts0_ds" autoQuery="true" bindName="account_lns" model="pur.PUR5810.pur5180_vendor_change_accounts0" queryUrl="${/request/@context_path}/autocrud/pur.PUR5810.pur5180_vendor_change_accounts0/query?version=${/parameter/@version}&amp;vendor_id=${/parameter/@vendor_id}">
                <a:fields>
                    <a:field name="primary_account_flag" readOnly="true"/>
                    <a:field name="enabled_flag" readOnly="true"/>
                </a:fields>
            </a:dataSet>
            <a:dataSet id="pur5810_companySupplierAccounts_ds" autoCreate="true" bindName="account_lns" loadData="true" model="pur.PUR5810.pur5180_vendor_change_accounts" queryUrl="${/request/@context_path}/autocrud/pur.PUR5810.pur5180_vendor_change_accounts/query?hd_id=${/parameter/@hd_id}">
                <a:fields>
                    <a:field name="account_id"/>
                    <a:field name="hd_id" defaultValue="${/parameter/@hd_id}"/>
                    <a:field name="bank_code" lovHeight="500" lovService="pur.public.csh_banks_lov" lovWidth="500" title="FND9220.BANK_LOV_TITLE">
                        <a:mapping>
                            <a:map from="bank_code" to="bank_code"/>
                            <a:map from="bank_name" to="bank_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="bank_branch_name"/>
                    <a:field name="bank_account_name"/>
                    <a:field name="bank_account_number"/>
                    <a:field name="primary_account_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="enabled_flag" checkedValue="Y" defaultValue="Y" uncheckedValue="N"/>
                </a:fields>
                <a:events>
                    <a:event name="submitSuccess" handler="pur5810_onCompanySupplierAccountsDs_submitsuccessFun"/>
                </a:events>
            </a:dataSet>
            <!-- ADDRESS -->
            <a:dataSet id="pur5810_companySupplierAddresses0_ds" autoQuery="true" bindName="address_lns" model="pur.PUR5810.pur5180_vendor_change_addresses0" queryUrl="${/request/@context_path}/autocrud/pur.PUR5810.pur5180_vendor_change_addresses0/query?version=${/parameter/@version}&amp;vendor_id=${/parameter/@vendor_id}">
                <a:fields>
                    <a:field name="enabled_flag" readOnly="true"/>
                </a:fields>
            </a:dataSet>
            <a:dataSet id="pur5810_companySupplierAddresses_ds" autoCreate="true" bindName="address_lns" loadData="true" model="pur.PUR5810.pur5180_vendor_change_addresses" queryUrl="${/request/@context_path}/autocrud/pur.PUR5810.pur5180_vendor_change_addresses/query?hd_id=${/parameter/@hd_id}">
                <a:fields>
                    <a:field name="address_id"/>
                    <a:field name="hd_id" defaultValue="${/parameter/@hd_id}"/>
                    <a:field name="country_code"/>
                    <a:field name="country_name" lovHeight="500" lovService="public.fnd_country_lov" lovWidth="500" required="false" requiredMessage="${l:FND_COM_SUP_ADDRESSES.COUNTRY_CODE}${l:PROMPT.INPUT}" title="FND_COM_SUP_ADDRESSES.COUNTRY_CODE_CHOOSE">
                        <a:mapping>
                            <a:map from="country_code" to="country_code"/>
                            <a:map from="country_name" to="country_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="province_id"/>
                    <a:field name="province_name" lovHeight="500" lovService="public.fnd_region_province_lov" lovWidth="500" required="false" requiredMessage="地区不能为空！" title="FND_COM_SUP_ADDRESSES.PROVINCE_CHOOSE">
                        <a:mapping>
                            <a:map from="province_id" to="province_id"/>
                            <a:map from="province_name" to="province_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="city_id"/>
                    <a:field name="city_name" lovHeight="500" lovService="public.fnd_region_city_lov" lovWidth="500" required="false" requiredMessage="城市不能为空！" title="FND_COM_SUP_ADDRESSES.CITY_CHOOSE">
                        <a:mapping>
                            <a:map from="city_id" to="city_id"/>
                            <a:map from="city_name" to="city_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="address_detail_desc" required="false" requiredMessage="${l:FND_COM_SUP_ADDRESSES.ADDRESS_DETAIL_ID}${l:PROMPT.INPUT}"/>
                    <a:field name="enabled_flag" checkedValue="Y" defaultValue="Y" uncheckedValue="N"/>
                </a:fields>
                <a:events>
                    <a:event name="submitSuccess" handler="pur5810_onCompanySupplierAddressesDs_submitsuccessFun"/>
                </a:events>
            </a:dataSet>
            <!-- Procurement information -->
            <a:dataSet id="pur5810_procurement_information0_ds" autoQuery="true" bindName="purchase_lns" model="pur.PUR5810.pur5180_procurement_information0" queryUrl="${/request/@context_path}/autocrud/pur.PUR5810.pur5180_procurement_information0/query?version=${/parameter/@version}&amp;vendor_id=${/parameter/@vendor_id}">
                <a:fields>
                    <a:field name="enabled_flag" readOnly="true"/>
                </a:fields>
            </a:dataSet>
            <a:dataSet id="pur5810_procurement_information_ds" autoCreate="true" bindName="purchase_lns" loadData="true" model="pur.PUR5810.pur5180_procurement_information" queryUrl="${/request/@context_path}/autocrud/pur.PUR5810.pur5180_procurement_information/query?hd_id=${/parameter/@hd_id}">
                <a:fields>
                    <a:field name="address_id"/>
                    <a:field name="hd_id" defaultValue="${/parameter/@hd_id}"/>
                    <a:field name="tax_rate" displayField="tax_type_name" options="pur5740_tax_ds" returnField="tax_type_code" valueField="tax_type_code"/>
                    <a:field name="currency" displayField="currency_name" options="pur5740_currency_ds" returnField="currency_name" valueField="currency_code"/>
                    <a:field name="payment_method" displayField="terms_desc" options="pur5740_pay_description_ds" returnField="terms_code" valueField="terms_code"/>
                    <a:field name="VMIno" displayField="code_value_name" options="YESorNO_ds" returnField="code_value" valueField="code_value"/>
                    <a:field name="erp_vendor_code"/>
                </a:fields>
                <a:events>
                    <a:event name="submitSuccess" handler="pur5810_procurementInformationDs_submitsuccessFun"/>
                </a:events>
            </a:dataSet>
            <!-- 法人信息 -->
            <a:dataSet id="pur5810_legal_rep_information0_ds" autoQuery="true" bindName="legal_lns" model="pur.PUR5810.pur5180_vendor_change_legal_rep0" queryUrl="${/request/@context_path}/autocrud/pur.PUR5810.pur5180_vendor_change_legal_rep0/query?version=${/parameter/@version}&amp;vendor_id=${/parameter/@vendor_id}">
                <a:fields>
                    <a:field name="enabled_flag" readOnly="true"/>
                </a:fields>
            </a:dataSet>
            <a:dataSet id="pur5810_legal_rep_information_ds" autoCreate="true" bindName="legal_lns" loadData="true" model="pur.PUR5810.pur5180_vendor_change_legal_rep" queryUrl="${/request/@context_path}/autocrud/pur.PUR5810.pur5180_vendor_change_legal_rep/query?hd_id=${/parameter/@hd_id}">
                <a:fields>
                    <a:field name="change_rep_id"/>
                    <a:field name="hd_id" defaultValue="${/parameter/@hd_id}"/>
                    <a:field name="legal_rep_name"/>
                    <a:field name="legal_rep_phone"/>
                    <a:field name="legal_rep_identity_type_desc" displayField="code_value_name" options="fnd_identity_card_types_ds" prompt="FND_COMPANY_REGISTED.IDENTITY_CARD_TYPE" returnField="legal_rep_identity_type" valueField="code_value"/>
                    <a:field name="legal_rep_identity_num"/>
                </a:fields>
                <a:events>
                    <a:event name="update" handler="pur5810_legal_repDs_updateFun"/>
                    <a:event name="submitSuccess" handler="pur5810_legal_repDs_submitsuccessFun"/>
                </a:events>
            </a:dataSet>
        </a:dataSets>
        <a:defaultScreen>
            <a:screenTopToolbar>
                <a:toolbarButton id="pur5810_vendor_infoChange_save_btn" click="pur5810_vendor_infoChange_save" text="PROMPT.SAVE" width="100"/>
                <a:toolbarButton id="pur5810_vendor_infoChange_submit_btn" click="pur5810_vendor_infoChange_submit" text="PROMPT.SUBMIT" width="100"/>
                <a:toolbarButton id="pur5810_vendor_infoChange_submit2_btn" click="pur5810_vendor_infoChange_submit2" text="CON202.SUBMIT" width="100"/>
                <a:toolbarButton id="pur5810_vendor_infoChange_back_btn" click="pur5810_vendor_infoChange_return" text="HAP_BACK" width="100"/>
                <a:toolbarButton id="pur5810_vendor_infoChangeBack_btn" click="pur5810_vendor_infoChange_back" text="PUR.RETURN" width="100"/>
            </a:screenTopToolbar>
            <a:fieldSet id="pur5810_cvendor_change_info_id" style="margin-top:10px;margin-left:2px;" title="PUR_VENDORS.APPROVAL_COMMENTS">
                <a:textArea name="comments" id="pur5810_approve_comments_id" bindTarget="pur5810_vendor_infoChange1_ds" readOnly="true" width="823"/>
            </a:fieldSet>
            <a:fieldSet title="PROMPT.BASIC_INFOMATION" width="944">
                <a:hBox labelWidth="100">
                    <a:textField name="status_desc" bindTarget="pur5810_vendor_infoChange1_ds" prompt="PUR5710.STATUS_DESC" readOnly="true" width="200"/>
                    <a:textField name="application_code" bindTarget="pur5810_vendor_infoChange1_ds" prompt="PUR5720.RECOMMEND_HDS_CODE" readOnly="true" width="200"/>
                    <!-- <a:lov name="display_vendor_code" bindTarget="pur5810_vendor_infoChange1_ds" prompt="PUR_VENDORS.VENDOR_CODE" width="200"/> -->
                    <!-- <a:textField name="full_name" bindTarget="pur5810_vendor_infoChange1_ds" prompt="PUR_VENDORS.VENDOR_NAME" readOnly="true" width="130"/> -->
                    <a:lov name="company_name" bindTarget="pur5810_vendor_infoChange1_ds" prompt="FND_COMPANIES.CLIENT" readOnly="true" width="200"/>
                </a:hBox>
                <a:hBox labelWidth="100">
                    <a:textField name="creation_date_fmt" bindTarget="pur5810_vendor_infoChange1_ds" prompt="PUR5710.CREATION_DATE" readOnly="true" width="200"/>
                    <a:textField name="created_by_name" bindTarget="pur5810_vendor_infoChange1_ds" prompt="PUR5710.CREATED_BY_DESC" readOnly="true" width="200"/>
                    <a:lov name="erp_vendor_code" bindTarget="pur5810_vendor_infoChange1_ds" prompt="ERP供应商编码" width="200"/>
                </a:hBox>
            </a:fieldSet>
            <a:fieldSet title="PUR5780.CHANGE_APPLICATION_DETAIL" width="1100">
                <a:hBox labelWidth="100">
                    <a:fieldSet title="WZ_VENDOR_STAGE_CHANGE_REQS.ORIGINAL_STAGE" width="460">
                        <a:vBox labelWidth="100">
                            <a:fieldSet title="供货项目变更" width="460">
                                <a:vBox labelWidth="100">
                                    <a:textField name="supply_project" bindTarget="pur5810_vendor_infoChange0_ds" prompt="供货项目" readOnly="true" width="200"/>
                                </a:vBox>
                            </a:fieldSet>
                            <a:fieldSet title="PUR5710.BUSINESS_INFO" width="450">
                                <a:vBox labelWidth="100">
                                    <a:textField name="vendor_name" bindTarget="pur5810_vendor_infoChange0_ds" prompt="FND_COMPANIES.VENDOR_NAME" readOnly="true" width="200"/>
                                    <a:textField name="payment_method_desc" bindTarget="pur5810_vendor_infoChange0_ds" prompt="PUR_VENDORS.PAYMENT_METHOD" readOnly="true" width="200"/>
                                    <!-- <a:textField name="payment_term_desc" bindTarget="pur5810_vendor_infoChange0_ds" prompt="PUR_VENDORS.PAYMENT_TERM_ID" readOnly="true" width="200"/> -->
                                    <!-- <a:textField name="tax_type_name" bindTarget="pur5810_vendor_infoChange0_ds" prompt="FND_TAX_TYPE_CODES.TAX_TYPE_RATE" readOnly="true" width="200"/> -->
                                    <!-- <a:comboBox name="pur_vendor_site_desc" bindTarget="pur5810_vendor_infoChange0_ds" prompt="PUR_VENDOR_SITES.VENDOR_SITE" readOnly="true" width="200"/> -->
                                </a:vBox>
                            </a:fieldSet>
                            <a:fieldSet title="PUR5660.THREE_CERTIFICATES_INFO" width="450">
                                <a:vBox labelWidth="120">
                                    <a:hBox className="" labelWidth="100" style="margin-top:10px">
                                        <a:checkBox name="three_in_one_flag" bindTarget="pur5810_vendor_infoChange0_ds" prompt="FND_COMPANY_REGISTED.CERTIFICATES_COMBINED" readOnly="true" width="60"/>
                                        <a:checkBox name="one_one_code_flag" bindTarget="pur5810_vendor_infoChange0_ds" prompt="FND_COMPANY_REGISTED.ONE_AS_A_CODE" readOnly="true" width="60"/>
                                    </a:hBox>
                                    <a:hBox className="" labelWidth="120" style="margin-top:10px">
                                        <a:textField name="unified_social_code" bindTarget="pur5810_vendor_infoChange0_ds" prompt="FND_COMPANY_REGISTED.UNIFORM_CODE" readOnly="true" width="200"/>
                                    </a:hBox>
                                    <!--                                     <a:hBox className="" labelWidth="120" style="margin-top:10px">
                                        <a:textField name="national_organization_code" bindTarget="pur5810_vendor_infoChange0_ds" prompt="FND_COMPANIES.NATIONAL_ORGANIZATION_CODE" readOnly="true" width="200"/>
                                    </a:hBox> -->
                                    <a:hBox labelWidth="120" style="margin-top:10px">
                                        <a:upload id="pur5810_upload_5" buttonWidth="75" downloadurl="../../../atm_download_free.svc" pkvalue="${/parameter/@old_hd_id}" prompt="FND_COMPANY_REGISTED.BUSINESS_LICENSE_ATTM" requireSession="false" showdelete="false" sourcetype="VENDOR_CHANGE.BUSINESS_LICENSE" text="FND9100.ATTACHMENT_UPLOAD"/>
                                    </a:hBox>
                                    <a:hBox labelWidth="120" style="margin-top:10px">
                                        <a:datePicker name="business_license_end_date" bindTarget="pur5810_vendor_infoChange0_ds" prompt="营业执照到期时间" readOnly="true" renderer="Aurora.formatDate" width="200"/>
                                    </a:hBox>
                                    <a:hBox labelWidth="120" style="margin-top:10px">
                                        <a:upload id="pur5810_upload_1" buttonWidth="75" downloadurl="../../../atm_download_free.svc" pkvalue="${/parameter/@old_hd_id}" prompt="FND9100.ORGANIZATION_CODE_ATM" requireSession="false" showdelete="false" sourcetype="VENDOR_CHANGE.ORGANIZATION_CODE" text="FND9100.ATTACHMENT_UPLOAD"/>
                                    </a:hBox>
                                    <a:hBox className="" labelWidth="120" style="margin-top:10px">
                                        <a:textField name="tax_id_number" bindTarget="pur5810_vendor_infoChange0_ds" prompt="FND_COMPANY_REGISTED.TAX_NUMBER" readOnly="true" width="200"/>
                                    </a:hBox>
                                    <a:hBox labelWidth="120" style="margin-top:10px">
                                        <a:upload id="pur5810_upload_2" buttonWidth="75" downloadurl="../../../atm_download_free.svc" pkvalue="${/parameter/@old_hd_id}" prompt="FND9100.TAX_REGISTED_SCAN" requireSession="false" showdelete="false" sourcetype="VENDOR_CHANGE.TAX_NUMBER" text="FND9100.ATTACHMENT_UPLOAD"/>
                                    </a:hBox>
                                </a:vBox>
                            </a:fieldSet>
                            <a:fieldSet title="业务负责人信息" width="450">
                                <a:vBox labelWidth="100">
                                    <a:textField name="contact_name" bindTarget="pur5810_vendor_infoChange0_ds" prompt="PUR5660.NAME" readOnly="true"/>
                                    <a:textField name="contact_position" bindTarget="pur5810_vendor_infoChange0_ds" prompt="FND_COM_SUP_CONTACTS.POSITION" readOnly="true"/>
                                    <a:comboBox name="contact_identity_type_desc" bindTarget="pur5810_vendor_infoChange0_ds" prompt="HRM_EMPLOYEE.ID_TYPE" readOnly="true"/>
                                    <a:textField name="contact_identity_num" bindTarget="pur5810_vendor_infoChange0_ds" prompt="FND_COMPANIES.IDENTITY_NUM" readOnly="true"/>
                                    <a:textField name="contact_phone" bindTarget="pur5810_vendor_infoChange0_ds" prompt="CSH_BANK_BRANCHES.PHONE" readOnly="true"/>
                                    <a:textField name="contact_email" bindTarget="pur5810_vendor_infoChange0_ds" prompt="FND_COMPANIES.EMAIL" readOnly="true"/>
                                </a:vBox>
                            </a:fieldSet>
                            <a:fieldSet title="账户信息" width="450">
                                <a:vBox labelWidth="100">
                                    <a:lov name="bank_code" bindTarget="pur5810_companySupplierAccounts0_ds" prompt="FND_COM_SUP_ACCOUNTS.BANK_CODE" readOnly="true"/>
                                    <a:textField name="bank_name" bindTarget="pur5810_companySupplierAccounts0_ds" prompt="FND_COM_SUP_ACCOUNTS.BANK_NAME" readOnly="true"/>
                                    <a:textField name="bank_line_number" bindTarget="pur5810_companySupplierAccounts0_ds" prompt="FND_COM_SUP_ACCOUNTS.BANK_LINE_NUMBER" readOnly="true"/>
                                    <a:textField name="bank_branch_name" bindTarget="pur5810_companySupplierAccounts0_ds" prompt="FND_COM_SUP_ACCOUNTS.OPENING_BANK_NAME" readOnly="true"/>
                                    <a:textField name="bank_account_name" bindTarget="pur5810_companySupplierAccounts0_ds" prompt="FND_COM_SUP_ACCOUNTS.BANK_ACCOUNT_NAME" readOnly="true"/>
                                    <a:textField name="bank_account_number" bindTarget="pur5810_companySupplierAccounts0_ds" prompt="FND_COM_SUP_ACCOUNTS.BANK_ACCOUNT" readOnly="true"/>
                                    <a:checkBox name="primary_account_flag" bindTarget="pur5810_companySupplierAccounts0_ds" prompt="FND_COM_SUP_ACCOUNTS.PRIMARY_ACCOUNT_FLAG" readOnly="true"/>
                                    <a:checkBox name="enabled_flag" bindTarget="pur5810_companySupplierAccounts0_ds" prompt="FND_COM_SUP_ACCOUNTS.ENABLED_FLAG" readOnly="true"/>
                                </a:vBox>
                            </a:fieldSet>
                            <a:fieldSet title="地址信息" width="450">
                                <a:vBox labelWidth="100">
                                    <a:lov name="country_name" bindTarget="pur5810_companySupplierAddresses0_ds" prompt="FND_COM_SUP_ADDRESSES.COUNTRY_CODE" readOnly="true"/>
                                    <a:lov name="province_name" bindTarget="pur5810_companySupplierAddresses0_ds" prompt="FND_COM_SUP_ADDRESSES.PROVINCE_ID" readOnly="true"/>
                                    <a:lov name="city_name" bindTarget="pur5810_companySupplierAddresses0_ds" prompt="FND_COM_SUP_ADDRESSES.CITY_ID" readOnly="true"/>
                                    <a:textField name="address_detail_desc" bindTarget="pur5810_companySupplierAddresses0_ds" prompt="详细地址" readOnly="true"/>
                                    <a:textField name="post_code" bindTarget="pur5810_companySupplierAddresses0_ds" prompt="FND_COM_SUP_ADDRESSES.POST_CODE" readOnly="true"/>
                                    <a:textField name="address_comments" bindTarget="pur5810_companySupplierAddresses0_ds" prompt="FND_COM_SUP_ADDRESSES.ADDRESS_COMMENTS" readOnly="true"/>
                                    <a:checkBox name="enabled_flag" bindTarget="pur5810_companySupplierAddresses0_ds" prompt="FND_COM_SUP_ADDRESSES.ENABLED_FLAG" readOnly="true"/>
                                </a:vBox>
                            </a:fieldSet>
                            <a:fieldSet title="法人信息" width="450">
                                <a:vBox labelWidth="100">
                                    <a:textField name="legal_rep_name" bindTarget="pur5810_legal_rep_information0ds" prompt="姓名" readOnly="true"/>
                                    <a:textField name="legal_rep_phone" bindTarget="pur5810_legal_rep_information0_ds" prompt="手机号" readOnly="true"/>
                                    <a:comboBox name="legal_rep_identity_type_desc" bindTarget="pur5810_legal_rep_information0_ds" prompt="证件类型" readOnly="true"/>
                                    <a:textField name="legal_rep_identity_num" bindTarget="pur5810_legal_rep_information0_ds" prompt="证件号" readOnly="true"/>
                                    <a:upload id="pur5810_upload_7" buttonWidth="75" downloadurl="../../../atm_download_free.svc" pkvalue="${/parameter/@hd_id}" prompt="正面图片" requireSession="false" showdelete="false" sourcetype="FND_COPANY_REGISTED.LEGAL_REP_IDENTITY_FRONT" text="FND9100.ATTACHMENT_UPLOAD"/>
                                    <a:upload id="pur5810_upload_8" buttonWidth="75" downloadurl="../../../atm_download_free.svc" pkvalue="${/parameter/@hd_id}" prompt="背面图片" requireSession="false" showdelete="false" sourcetype="FND_COPANY_REGISTED.LEGAL_REP_IDENTITY_BACK" text="FND9100.ATTACHMENT_UPLOAD"/>
                                </a:vBox>
                            </a:fieldSet>
                            <!--                             <a:fieldSet title="采购信息" width="450">
                                <a:vBox labelWidth="100">
                                    <a:comboBox name="tax_rate" bindTarget="pur5810_procurement_information0_ds" prompt="税率" readOnly="true"/>
                                    <a:comboBox name="currency" bindTarget="pur5810_procurement_information0_ds" prompt="币别" readOnly="true"/>
                                    <a:comboBox name="payment_method" bindTarget="pur5810_procurement_information0_ds" prompt="付款方式" readOnly="true"/>
                                    <a:comboBox name="VMIno" bindTarget="pur5810_procurement_information0_ds" prompt="VMI否" readOnly="true"/>
                                    <a:textField name="erp_vendor_code" bindTarget="pur5810_procurement_information0_ds" prompt="ERP供应商编码" readOnly="true"/>
                                </a:vBox>
                            </a:fieldSet> -->
                        </a:vBox>
                    </a:fieldSet>
                    <a:fieldSet style="margin-left:20px;" title="WZ_VENDOR_STAGE_CHANGE_REQS.UPDATED_STAGE" width="460">
                        <a:vBox labelWidth="100">
                            <a:fieldSet title="供货项目变更" width="450">
                                <a:vBox labelWidth="100">
                                    <a:textField name="supply_project" bindTarget="pur5810_vendor_infoChange1_ds" prompt="供货项目" width="200"/>
                                </a:vBox>
                            </a:fieldSet>
                            <a:fieldSet title="PUR5710.BUSINESS_INFO" width="450">
                                <a:vBox labelWidth="100">
                                    <a:textField name="vendor_name" bindTarget="pur5810_vendor_infoChange1_ds" prompt="FND_COMPANIES.VENDOR_NAME" width="200"/>
                                    <a:lov name="payment_method_desc" bindTarget="pur5810_vendor_infoChange1_ds" prompt="PUR_VENDORS.PAYMENT_METHOD" width="200"/>
                                    <!-- <a:lov name="payment_term_desc" bindTarget="pur5810_vendor_infoChange1_ds" prompt="PUR_VENDORS.PAYMENT_TERM_ID" width="200"/> -->
                                    <!-- <a:lov name="tax_type_name" bindTarget="pur5810_vendor_infoChange1_ds" prompt="FND_TAX_TYPE_CODES.TAX_TYPE_RATE" width="200"/> -->
                                    <!-- <a:comboBox name="pur_vendor_site_desc" bindTarget="pur5810_vendor_infoChange1_ds" prompt="PUR_VENDOR_SITES.VENDOR_SITE" width="200"/> -->
                                </a:vBox>
                            </a:fieldSet>
                            <a:fieldSet title="PUR5660.THREE_CERTIFICATES_INFO" width="450">
                                <a:vBox labelWidth="120">
                                    <a:hBox className="" labelWidth="100" style="margin-top:10px">
                                        <a:checkBox name="three_in_one_flag" bindTarget="pur5810_vendor_infoChange1_ds" prompt="FND_COMPANY_REGISTED.CERTIFICATES_COMBINED" width="60"/>
                                        <a:checkBox name="one_one_code_flag" bindTarget="pur5810_vendor_infoChange1_ds" prompt="FND_COMPANY_REGISTED.ONE_AS_A_CODE" width="60"/>
                                    </a:hBox>
                                    <a:hBox labelWidth="120" style="margin-top:10px">
                                        <a:textField name="unified_social_code" bindTarget="pur5810_vendor_infoChange1_ds" prompt="FND_COMPANY_REGISTED.UNIFORM_CODE" width="200"/>
                                    </a:hBox>
                                    <!--                                     <a:hBox labelWidth="120" style="margin-top:10px">
                                        <a:textField name="national_organization_code" bindTarget="pur5810_vendor_infoChange1_ds" prompt="FND_COMPANIES.NATIONAL_ORGANIZATION_CODE" width="200"/>
                                    </a:hBox> -->
                                    <a:hBox labelWidth="120" style="margin-top:10px">
                                        <a:upload id="pur5810_upload_6" buttonWidth="75" className="register-upLoad" fileType="*.jpg;*.png;*.bmp;*.jpeg;*.pdf" pkvalue="${/parameter/@hd_id}" prompt="FND_COMPANY_REGISTED.BUSINESS_LICENSE_ATTM" requireSession="false" sourcetype="VENDOR_CHANGE.BUSINESS_LICENSE" text="FND9100.ATTACHMENT_UPLOAD" totalfilesize="5000"/>
                                        <span id="pur5810_upload_6_span" class="upload_icon"><![CDATA[上传附件]]></span>
                                    </a:hBox>
                                    <a:hBox labelWidth="120" style="margin-top:10px">
                                        <a:datePicker name="business_license_end_date" bindTarget="pur5810_vendor_infoChange1_ds" prompt="营业执照到期时间" renderer="Aurora.formatDate" width="200"/>
                                    </a:hBox>
                                    <a:hBox labelWidth="120" style="margin-top:10px">
                                        <a:upload id="pur5810_upload_3" buttonWidth="75" className="register-upLoad" fileType="*.jpg;*.png;*.bmp;*.jpeg;*.pdf" pkvalue="${/parameter/@hd_id}" prompt="FND9100.ORGANIZATION_CODE_ATM" requireSession="false" sourcetype="VENDOR_CHANGE.ORGANIZATION_CODE" text="FND9100.ATTACHMENT_UPLOAD" totalfilesize="5000"/>
                                        <span id="pur5810_upload_3_span" class="upload_icon"><![CDATA[上传附件]]></span>
                                    </a:hBox>
                                    <a:hBox labelWidth="120" style="margin-top:10px">
                                        <a:textField name="tax_id_number" bindTarget="pur5810_vendor_infoChange1_ds" prompt="FND_COMPANY_REGISTED.TAX_NUMBER" width="200"/>
                                    </a:hBox>
                                    <a:hBox labelWidth="120" style="margin-top:10px">
                                        <a:upload id="pur5810_upload_4" buttonWidth="75" className="register-upLoad" downloadurl="../../../atm_download_free.svc" fileType="*.*" pkvalue="${/parameter/@hd_id}" prompt="FND9100.TAX_REGISTED_SCAN" requireSession="false" sourcetype="VENDOR_CHANGE.TAX_NUMBER" text="FND9100.ATTACHMENT_UPLOAD"/>
                                        <span id="pur5810_upload_4_span" class="upload_icon"><![CDATA[上传附件]]></span>
                                    </a:hBox>
                                </a:vBox>
                            </a:fieldSet>
                            <a:fieldSet title="业务负责人信息" width="450">
                                <a:vBox labelWidth="100">
                                    <a:textField name="contact_name" bindTarget="pur5810_vendor_infoChange1_ds" prompt="PUR5660.NAME"/>
                                    <a:textField name="contact_position" bindTarget="pur5810_vendor_infoChange1_ds" prompt="FND_COM_SUP_CONTACTS.POSITION"/>
                                    <a:comboBox name="contact_identity_type_desc" bindTarget="pur5810_vendor_infoChange1_ds" prompt="HRM_EMPLOYEE.ID_TYPE"/>
                                    <a:textField name="contact_identity_num" bindTarget="pur5810_vendor_infoChange1_ds" prompt="FND_COMPANIES.IDENTITY_NUM"/>
                                    <a:textField name="contact_phone" bindTarget="pur5810_vendor_infoChange1_ds" prompt="CSH_BANK_BRANCHES.PHONE"/>
                                    <a:textField name="contact_email" bindTarget="pur5810_vendor_infoChange1_ds" prompt="FND_COMPANIES.EMAIL"/>
                                </a:vBox>
                            </a:fieldSet>
                            <a:fieldSet title="账户信息" width="450">
                                <a:vBox labelWidth="100">
                                    <a:lov name="bank_code" bindTarget="pur5810_companySupplierAccounts_ds" prompt="FND_COM_SUP_ACCOUNTS.BANK_CODE"/>
                                    <a:textField name="bank_name" bindTarget="pur5810_companySupplierAccounts_ds" prompt="FND_COM_SUP_ACCOUNTS.BANK_NAME" readOnly="true"/>
                                    <a:textField name="bank_line_number" bindTarget="pur5810_companySupplierAccounts_ds" prompt="FND_COM_SUP_ACCOUNTS.BANK_LINE_NUMBER"/>
                                    <a:textField name="bank_branch_name" bindTarget="pur5810_companySupplierAccounts_ds" prompt="FND_COM_SUP_ACCOUNTS.OPENING_BANK_NAME"/>
                                    <a:textField name="bank_account_name" bindTarget="pur5810_companySupplierAccounts_ds" prompt="FND_COM_SUP_ACCOUNTS.BANK_ACCOUNT_NAME"/>
                                    <a:textField name="bank_account_number" bindTarget="pur5810_companySupplierAccounts_ds" prompt="FND_COM_SUP_ACCOUNTS.BANK_ACCOUNT"/>
                                    <a:checkBox name="primary_account_flag" bindTarget="pur5810_companySupplierAccounts_ds" prompt="FND_COM_SUP_ACCOUNTS.PRIMARY_ACCOUNT_FLAG"/>
                                    <a:checkBox name="enabled_flag" bindTarget="pur5810_companySupplierAccounts_ds" prompt="FND_COM_SUP_ACCOUNTS.ENABLED_FLAG"/>
                                </a:vBox>
                            </a:fieldSet>
                            <a:fieldSet title="地址信息" width="450">
                                <a:vBox labelWidth="100">
                                    <a:lov name="country_name" bindTarget="pur5810_companySupplierAddresses_ds" prompt="FND_COM_SUP_ADDRESSES.COUNTRY_CODE"/>
                                    <a:lov name="province_name" bindTarget="pur5810_companySupplierAddresses_ds" prompt="FND_COM_SUP_ADDRESSES.PROVINCE_ID"/>
                                    <a:lov name="city_name" bindTarget="pur5810_companySupplierAddresses_ds" prompt="FND_COM_SUP_ADDRESSES.CITY_ID"/>
                                    <a:textField name="address_detail_desc" bindTarget="pur5810_companySupplierAddresses_ds" prompt="详细地址"/>
                                    <a:textField name="post_code" bindTarget="pur5810_companySupplierAddresses_ds" prompt="FND_COM_SUP_ADDRESSES.POST_CODE"/>
                                    <a:textField name="address_comments" bindTarget="pur5810_companySupplierAddresses_ds" prompt="FND_COM_SUP_ADDRESSES.ADDRESS_COMMENTS"/>
                                    <a:checkBox name="enabled_flag" bindTarget="pur5810_companySupplierAddresses_ds" prompt="FND_COM_SUP_ADDRESSES.ENABLED_FLAG"/>
                                </a:vBox>
                            </a:fieldSet>
                            <a:fieldSet title="法人信息" width="450">
                                <a:vBox labelWidth="100">
                                    <a:textField name="legal_rep_name" bindTarget="pur5810_legal_rep_information_ds" prompt="姓名"/>
                                    <a:textField name="legal_rep_phone" bindTarget="pur5810_legal_rep_information_ds" prompt="手机号"/>
                                    <a:comboBox name="legal_rep_identity_type_desc" bindTarget="pur5810_legal_rep_information_ds" prompt="证件类型"/>
                                    <a:textField name="legal_rep_identity_num" bindTarget="pur5810_legal_rep_information_ds" prompt="证件号"/>
                                    <a:upload id="pur5810_upload_9" buttonWidth="75" downloadurl="../../../atm_download_free.svc" fileType="*.jpg;*.png;*.bmp;*.jpeg;*.pdf" pkvalue="${/parameter/@hd_id}" prompt="正面图片" requireSession="false" sourcetype="FND_COPANY_REGISTED.LEGAL_REP_IDENTITY_FRONT" text="附件上传" totalfilesize="5000"/>
                                    <span id="pur5810_upload_9_span" class="upload_icon" style="margin-left:-70px"><![CDATA[${l:FND_COMPANY_REGISTED.UPLOAD}]]></span>
                                    <a:upload id="pur5810_upload_10" buttonWidth="75" downloadurl="../../../atm_download_free.svc" fileType="*.jpg;*.png;*.bmp;*.jpeg;*.pdf" pkvalue="${/parameter/@hd_id}" prompt="背面图片" requireSession="false" sourcetype="FND_COPANY_REGISTED.LEGAL_REP_IDENTITY_BACK" text="附件上传" totalfilesize="5000"/>
                                    <span id="pur5810_upload_10_span" class="upload_icon" style="margin-left:-78px"><![CDATA[${l:FND_COMPANY_REGISTED.UPLOAD}]]></span>
                                </a:vBox>
                            </a:fieldSet>
                            <!-- 
                            <a:fieldSet title="采购信息" width="450">
                                <a:vBox labelWidth="100">
                                    <a:comboBox name="tax_rate" bindTarget="pur5810_procurement_information_ds" prompt="税率"/>
                                    <a:comboBox name="currency" bindTarget="pur5810_procurement_information_ds" prompt="币别"/>
                                    <a:comboBox name="payment_method" bindTarget="pur5810_procurement_information_ds" prompt="付款方式"/>
                                    <a:comboBox name="VMIno" bindTarget="pur5810_procurement_information_ds" prompt="VMI否"/>
                                    <a:textField name="erp_vendor_code" bindTarget="pur5810_procurement_information_ds" prompt="ERP供应商编码"/>
                                </a:vBox>
                            </a:fieldSet> -->
                        </a:vBox>
                    </a:fieldSet>
                </a:hBox>
            </a:fieldSet>
            <!-- <a:tabPanel marginHeight="400" marginWidth="100">
                <a:tabs>
                    <a:tab prompt="FND9220.ACCOUNT_INFORMATION" width="100">
                        <a:grid autoAppend="false" bindTarget="pur5810_companySupplierAccounts_ds" height="300" marginWidth="104" navBar="true">
                            <a:toolBar>
                                <a:button id="pur5810_little_bt1" type="add"/>
                                <a:button id="pur5810_little_bt2" type="save"/>
                                <a:button id="pur5810_little_bt3" type="clear"/>
                            </a:toolBar>
                            <a:columns>
                                <a:column name="bank_code" align="center" editor="pur5810_account_lov" prompt="FND_COM_SUP_ACCOUNTS.BANK_CODE" width="60"/>
                                <a:column name="bank_name" align="left" prompt="FND_COM_SUP_ACCOUNTS.BANK_NAME" width="80"/>
                                <a:column name="bank_branch_name" align="left" editor="pur5810_account_tf" prompt="FND_COM_SUP_ACCOUNTS.OPENING_BANK_NAME" width="120"/>
                                <a:column name="bank_account_name" align="left" editor="pur5810_account_tf" prompt="FND_COM_SUP_ACCOUNTS.BANK_ACCOUNT_NAME" width="100"/>
                                <a:column name="bank_account_number" align="left" editor="pur5810_account_tf" prompt="FND_COM_SUP_ACCOUNTS.BANK_ACCOUNT" width="120"/>
                                <a:column name="primary_account_flag" align="center" editor="pur5810_account_cb" prompt="FND_COM_SUP_ACCOUNTS.PRIMARY_ACCOUNT_FLAG" width="60"/>
                                <a:column name="enabled_flag" align="center" editor="pur5810_account_cb" prompt="FND_COM_SUP_ACCOUNTS.ENABLED_FLAG" width="60"/>
                            </a:columns>
                            <a:editors>
                                <a:lov id="pur5810_account_lov"/>
                                <a:textField id="pur5810_account_tf"/>
                                <a:checkBox id="pur5810_account_cb"/>
                            </a:editors>
                        </a:grid>
                    </a:tab>
                    <a:tab prompt="FND9220.ADDRESS_INFORMATION" width="100">
                        <a:grid id="pur5810_site_grid" autoAppend="false" bindTarget="pur5810_companySupplierAddresses_ds" height="300" marginWidth="104" navBar="true">
                            <a:toolBar>
                                <a:button id="pur5810_little_bt4" type="add"/>
                                <a:button id="pur5810_little_bt5" type="save"/>
                                <a:button id="pur5810_little_bt6" type="clear"/>
                            </a:toolBar>
                            <a:columns>
                                <a:column name="country_name" align="left" editor="pur5810_site_lov" prompt="FND_COM_SUP_ADDRESSES.COUNTRY_CODE" width="120"/>
                                <a:column name="province_name" align="left" editor="pur5810_site_lov" prompt="FND_COM_SUP_ADDRESSES.PROVINCE_ID" width="100"/>
                                <a:column name="city_name" align="left" editor="pur5810_site_lov" prompt="FND_COM_SUP_ADDRESSES.CITY_ID" width="100"/>
                                <a:column name="address_detail_desc" align="left" editor="pur5810_site_tf" prompt="FND_COM_SUP_ADDRESSES.ADDRESS_DETAIL_ID" width="150"/>
                                <a:column name="post_code" align="left" editor="pur5810_site_tf" prompt="FND_COM_SUP_ADDRESSES.POST_CODE" width="60"/>
                                <a:column name="address_comments" align="left" editor="pur5810_site_tf" prompt="FND_COM_SUP_ADDRESSES.ADDRESS_COMMENTS" width="150"/>
                                <a:column name="enabled_flag" align="center" editor="pur5810_site_cb" prompt="FND_COM_SUP_ADDRESSES.ENABLED_FLAG" width="60"/>
                            </a:columns>
                            <a:editors>
                                <a:lov id="pur5810_site_lov"/>
                                <a:textField id="pur5810_site_tf"/>
                                <a:checkBox id="pur5810_site_cb"/>
                            </a:editors>
                            <a:events>
                                <a:event name="cellclick" handler="pur5810_addressesCellClick_fun"/>
                            </a:events>
                        </a:grid>
                    </a:tab>
                </a:tabs>
            </a:tabPanel> -->
            <a:label style="margin-bottom:30px;"/>
        </a:defaultScreen>
        <script><![CDATA[
        // Aurora.onReady(function() {
        
            // for (var i = 1;i <= 2;i++) {
                // pur5810_set_upload_init('pur5810_upload_' + i, 205);
            // }
        
            // function pur5810_set_upload_init(id, w) {
                // var div = document.getElementById(id);
                // if (div) {
                    // div.children[1].style.minHeight = '24px';
                    // div.children[1].style.minWidth = w + 'px';
                    // div.children[1].style.border = '1px solid #dfe0e0';
                    // div.children[1].children[1].style.padding = '2px';
                    // div.children[1].style.marginTop = '0px';
                    // div.children[0].children[0].style.opacity = '0';
                    // div.children[0].children[0].style.height = '26px';
                    // var span = document.getElementById(id + '_span');
                    // if (span) {
                        // span.parentNode.style.position = 'relative';
                    // }
                // } else {
                    // div = document.getElementById(id + '_ul').parentNode;
                    // div.className = 'registed-ie-upload';
                    // div.style.border = '1px solid #dfe0e0';
                    // div.previousSibling.className = 'registed-ieupload-span';
                // }
            // }
        // });
        function diaplayTab(id) {
                var ui = document.getElementById(id);
                ui.style.display = "none";
            }
        init_button();
        
        function init_button() {
            var record = $('pur5810_vendor_infoChange1_ds').getCurrentRecord();
            var owner_business_group = record.get('owner_business_group');
            var cooper_business_group = record.get('cooper_business_group');
            var session_business_group = record.get('session_business_group');
            var status = record.get('status');
            
             //审批通过的按钮，只有返回可用
            if((status == 'APPROVING') || status == 'APPROVED'){
                $('pur5810_vendor_infoChange_submit_btn').disable();
                $('pur5810_vendor_infoChange_submit2_btn').disable();
                for (var j = 1;j <= 6;j++) {
                    var uj=document.getElementById('pur5810_upload_'+j);
                    //获取子元素
                    var childNode = uj.childNodes;
                    childNode[1].style.display="none";
                }
            }
             if((status == 'APPROVING') || status == 'APPROVED'||(status == 'SUBMITTED'&& session_business_group != owner_business_group  )){
                
                var record1 = $('pur5810_vendor_infoChange1_ds').getCurrentRecord();
                record1.getField('vendor_name').setReadOnly(true);
                record1.getField('payment_method_desc').setReadOnly(true);
                record1.getField('payment_term_desc').setReadOnly(true);
                record1.getField('tax_type_name').setReadOnly(true);
                record1.getField('pur_vendor_site_desc').setReadOnly(true);
                record1.getField('three_in_one_flag').setReadOnly(true);
                record1.getField('one_one_code_flag').setReadOnly(true);
                record1.getField('unified_social_code').setReadOnly(true);
                record1.getField('national_organization_code').setReadOnly(true);
                record1.getField('tax_id_number').setReadOnly(true);
                record1.getField('contact_name').setReadOnly(true);
                record1.getField('contact_position').setReadOnly(true);
                record1.getField('contact_identity_type_desc').setReadOnly(true);
                record1.getField('contact_identity_num').setReadOnly(true);
                record1.getField('contact_phone').setReadOnly(true);
                record1.getField('contact_email').setReadOnly(true);
                record1.getField('erp_vendor_code').setReadOnly(true);
                for (var i = 1;i <= 6;i++) {
                    var ui=document.getElementById('pur5810_upload_'+i);
                    //获取子元素
                    var childNode1 = ui.childNodes;
                    childNode1[1].style.display="none";
                }
                
                var record2 = $('pur5810_companySupplierAccounts_ds').getCurrentRecord();
                	record2.getField('bank_code').setReadOnly(true);
                	//record2.getField('bank_name').setReadOnly(true);
                	record2.getField('bank_line_number').setReadOnly(true);
                	record2.getField('bank_branch_name').setReadOnly(true);
                	record2.getField('bank_account_name').setReadOnly(true);
                	record2.getField('bank_account_number').setReadOnly(true);
                	record2.getField('primary_account_flag').setReadOnly(true);
                	record2.getField('enabled_flag').setReadOnly(true);
               var record3 = $('pur5810_companySupplierAddresses_ds').getCurrentRecord();
                    record3.getField('country_name').setReadOnly(true);
                    record3.getField('province_name').setReadOnly(true);
                    record3.getField('city_name').setReadOnly(true);
                    record3.getField('address_detail_desc').setReadOnly(true);
                    record3.getField('post_code').setReadOnly(true);
                    record3.getField('address_comments').setReadOnly(true);
                    record3.getField('enabled_flag').setReadOnly(true);
                    
           		var record4 = $('pur5810_procurement_information_ds').getCurrentRecord();
                    record4.getField('tax_rate').setReadOnly(true);
                    record4.getField('currency').setReadOnly(true);
                    record4.getField('payment_method').setReadOnly(true);
                    record4.getField('VMIno').setReadOnly(true);
                    record4.getField('erp_vendor_code').setReadOnly(true); 
            }
            
            
            //保存按钮！！！不可用！！！
            //1. 状态为【已提交】 且 当前登录集团为 【供应商集团】
            //2. 状态为【审批中】or 【审批通过】
            if ((status == 'SUBMITTED' && owner_business_group != session_business_group) || (status == 'APPROVING') || (status == 'APPROVED')) {
                $('pur5810_vendor_infoChange_save_btn').disable();
                
                // for (var i = 1;i <= 6;i++) {
                    // var ui=document.getElementById('pur5810_little_bt'+i);
                    // ui.style.display="none";
                // }
                
            }
            //提交按钮！！！可用！！！
            //1. 仅状态为【新建or审批拒绝】  且为【供应商集团】
            if ((status == 'NEW' || status == 'REJECTED') && (session_business_group != owner_business_group)) {
                $('pur5810_vendor_infoChange_submit_btn').enable();
            } else {
                $('pur5810_vendor_infoChange_submit_btn').disable();
            }
        
            //提交审批按钮！！！可用！！！
            //1. 状态为【已提交】 且为 【核心企业集团】
            //2. 状态为【新建or审批拒绝】且为【核心企业集团】创建的信息变更，可不提交直接提交 审批
            if (((status == 'SUBMITTED') && session_business_group == owner_business_group) || ((status == 'NEW' || status == 'REJECTED') && session_business_group == owner_business_group && session_business_group == cooper_business_group)) {
                $('pur5810_vendor_infoChange_submit2_btn').enable();
            } else {
                $('pur5810_vendor_infoChange_submit2_btn').disable();
            }
            //退回按钮
            //1.状态【已提交】且为供应商创建
            if (((status == 'SUBMITTED') && session_business_group != cooper_business_group && session_business_group == owner_business_group)) {
                $('pur5810_vendor_infoChangeBack_btn').enable();
            } else {
                $('pur5810_vendor_infoChangeBack_btn').disable();
            }
            //审批意见   只有拒绝和同意才能看见审批意见
            if(status == 'NEW' || status == 'SUBMITTED' || status == 'APPROVING'  ){
               	    diaplayTab('pur5810_cvendor_change_info_id');
                    diaplayTab('pur5810_approve_comments_id');
            }
        }
    ]]></script>
    </a:view>
</a:screen>

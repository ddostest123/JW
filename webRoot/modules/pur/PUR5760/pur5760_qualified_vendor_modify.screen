<?xml version="1.0" encoding="UTF-8"?>
<a:screen xmlns:a="http://www.aurora-framework.org/application" trace="true">
    <a:init-procedure>
        <a:model-query fetchAll="true" model="pur.PUR5670.get_session_user_info" rootPath="pur5760_current_user"/>
        <a:model-query defaultWhereClause="flex_value_set_code = &apos;PUR_SUPPLY_EVALUATION_LEVEL&apos;" fetchAll="true" model="public.fnd_flex_value_sets_query" rootPath="pur5760_vendor_evaluation_level_data"/>
        <a:model-query defaultWhereClause="fcp.vendor_id=${/parameter/@vendor_id}" model="pur.PUR5710.pur5710_vendor_query" rootPath="pur5760_vendor_query"/>
    </a:init-procedure>
    <a:view>
        <a:link id="pur5760_qualified_vendor_save_link" url="${/request/@context_path}/modules/pur/PUR5760/pur5760_qualified_vendor_save.svc"/>
        <a:link id="pur5760_vendor_supply_ability_upload_link" url="${/request/@context_path}/modules/public/downloadFile.screen"/>
        <a:link id="pur5760_qualified_vendor_delete_link" model="pur.PUR5760.pur_qualified_vendor_hds_query" modelaction="delete"/>
        <a:link id="pur5760_qualified_vendor_submit_link" model="pur.PUR5760.pur_qualified_vendor_submit" modelaction="execute"/>
        <a:link id="pur5760_qualified_vendor_upload_link" url="${/request/@context_path}/attachment_file_upload.screen"/>
        <a:link id="pur5760_qualified_vendor_element_query" model="pur.PUR5760.pur_qualified_element_query" modelaction="query"/>
        <a:link id="pur5760_attachment_file_download_link" url="${/request/@context_path}/atm_download.svc"/>
        <script><![CDATA[
            function init() {
               
                var qualified_hds_id = '${/parameter/@qualified_hds_id}';
                var vendor_id = '${/parameter/@vendor_id}';
                var element_hds_id = '${/parameter/@element_hds_id}';
                if (qualified_hds_id) {
                    $('pur5760_qualified_vendor_modify_ds').setQueryParameter('qualified_hds_id', qualified_hds_id);
                    $('pur5760_qualified_vendor_modify_ds').query();
            
            
                    $('pur5760_vendor_supply_ability_query').setQueryParameter('vendor_id', vendor_id);
                    $('pur5760_vendor_supply_ability_query').query();
                    $('pur5760_qualified_vendor_lns_query').setQueryParameter('qualified_hds_id', qualified_hds_id);
                    $('pur5760_qualified_vendor_lns_query').setQueryParameter('element_hds_id', element_hds_id);
                    $('pur5760_qualified_vendor_lns_query').query();
            
                    $('pur5760_attachment_info_ds').setQueryParameter('pk_value', qualified_hds_id);
                    $('pur5760_attachment_info_ds').setQueryParameter('table_name', 'PUR_QUALIFIED_VENDOR_FILE');
                    $('pur5760_attachment_info_ds').query();
                } else {
                    $('pur5760_qualified_vendor_modify_ds').create();
                }
            
                if (vendor_id) {
                    var record = $('pur5760_qualified_vendor_modify_ds').getCurrentRecord();
                    record.set('vendor_id', '${/model/pur5760_vendor_query/record/@vendor_id}');
                    record.set('cooper_business_group', '${/model/pur5760_vendor_query/record/@coop_business_group}');
                    record.set('cooper_company_id', '${/model/pur5760_vendor_query/record/@coop_company_id}');
                    record.set('display_vendor_code', '${/model/pur5760_vendor_query/record/@vendor_code}');
                    record.set('full_name', '${/model/pur5760_vendor_query/record/@vendor_name}');
                    record.getField('display_vendor_code').setReadOnly(true);
                }
            }
            
            function pur5760_qualified_vendor_load_handler(ds) {
                var record = ds.getCurrentRecord();
                var qualified_hds_id = record.get('qualified_hds_id');
                var element_hds_id = record.get('element_hds_id');
                var vendor_id = record.get('vendor_id');
            
                record.getField('display_vendor_code').setReadOnly(true);
                record.getField('element_hds_code').setReadOnly(true);
            
                $('pur5760_vendor_supply_ability_query').setQueryParameter('vendor_id', vendor_id);
                $('pur5760_vendor_supply_ability_query').query();
                $('pur5760_qualified_vendor_lns_query').setQueryParameter('qualified_hds_id', qualified_hds_id);
                $('pur5760_qualified_vendor_lns_query').setQueryParameter('element_hds_id', element_hds_id);
                $('pur5760_qualified_vendor_lns_query').query();
            
                $('pur5760_attachment_info_ds').setQueryParameter('pk_value', qualified_hds_id);
                $('pur5760_attachment_info_ds').setQueryParameter('table_name', 'PUR_QUALIFIED_VENDOR_FILE');
                $('pur5760_attachment_info_ds').query();
            }
            
            function pur5760_qualified_vendor_return() {
                $('pur5760_qualified_vendor_modify_win').close();
            }
            
            function pur5760_calc_element_score(parent_element_id) {
                var ds = $('pur5760_qualified_vendor_lns_query');
                var records = ds.getAll();
                var score = 0;
                var id;
                for (var i = 0;i < records.length;i++) {
                    if (records[i].get('element_hds_id') == parent_element_id) {
                        id = records[i].id;
                    }
                    if (records[i].get('parent_element_id') == parent_element_id) {
                        if (records[i].get('score')) {
                            score = score + parseFloat(records[i].get('score'));
                        }
                    }
                }
                $('pur5760_qualified_vendor_modify_ds').getAt(0).set('final_score', score);
                if (id) {
                    ds.findById(id).set('score', score);
                }
            }
            
            function pur5760_qualified_vendor_lns_update_handler(ds, record, name, value, oldvalue) {
                if (name == 'score') {
                    pur5760_calc_element_score(record.get('parent_element_id'));
                }
            }
            
            function pur5760_qualified_vendor_update_handler(ds, record, name, value, oldvalue) {
                if (name == 'display_vendor_code') {
                    if (!value) {
                        record.set('vendor_id', '');
                        record.getField('element_hds_code').setLovService('');
                    } else {
                        $('pur5760_vendor_supply_ability_query').setQueryParameter('vendor_id', record.get('vendor_id'));
                        $('pur5760_vendor_supply_ability_query').query();
                    }
                }
            
                if (name == 'vendor_id') {
                    if (value) {
                        record.getField('element_hds_code').setLovPara('vendor_id', value);
                        record.getField('element_hds_code').setLovService('pur.PUR5760.pur_qualified_element_hds_lov');
                        //查询评分要素
                        $('pur5760_qualified_element_hds_ds').setQueryParameter('vendor_id', value);
                        $('pur5760_qualified_element_hds_ds').query();
                    } else {
                        record.set('element_hds_id', '');
                        record.set('element_hds_code', '');
                        record.set('element_name', '');
            
                        $('pur5760_qualified_vendor_lns_query').setQueryParameter('qualified_hds_id', '-1');
                        $('pur5760_qualified_vendor_lns_query').query();
                        $('pur5760_vendor_supply_ability_query').setQueryParameter('vendor_id', '-1');
                        $('pur5760_vendor_supply_ability_query').query();
                    }
                }
            
                if (name == 'element_hds_id') {
                    $('pur5760_qualified_vendor_lns_query').query();
                    if (value) {
                        Aurora.Masker.mask($('pur5760_qualified_vendor_modify_win').wrap, '${l:LOADING}' + '...');
                        Aurora.request({
                            url: $('pur5760_qualified_vendor_element_query').getUrl(),
                            para: {
                                'element_hds_id': value
                            },
                            success: function(res) {
                                if (res && res.result && res.result.record) {
                                    var records = res.result.record;
                                    var ds = $('pur5760_qualified_vendor_lns_query');
                                    if (records.length) {
                                        if (records.length > 0) {
                                            for (var i = 0;i < records.length;i++) {
                                                ds.create();
                                                var record = ds.getCurrentRecord();
                                                record.set('element_hds_id', records[i].element_hds_id);
                                                record.set('element_hds_code', records[i].element_hds_code);
                                                record.set('element_name', records[i].element_name);
                                                record.set('parent_element_id', records[i].parent_element_id);
                                                record.set('element_score_from', records[i].score_from);
                                                record.set('element_score', records[i].score);
                                                record.set('score', records[i].default_score);//缺省值
                                                record.set('element_level', records[i].element_level);
                                                record.set('leaf_flag', records[i].leaf_flag);
                                                record.set('expended', 'Y');
                                                record.set('_status', 'insert');
                                            }
                                        }
                                    } else {
                                        ds.create();
                                        var new_record = ds.getCurrentRecord();
                                        new_record.set('element_hds_id', records.element_hds_id);
                                        new_record.set('element_hds_code', records.element_hds_code);
                                        new_record.set('element_name', records.element_name);
                                        new_record.set('parent_element_id', records.parent_element_id);
                                        new_record.set('element_score_from', records.score_from);
                                        new_record.set('element_score', records.score);
                                        new_record.set('score', records.default_score);//缺省值
                                        new_record.set('element_level', records.element_level);
                                        new_record.set('leaf_flag', records.leaf_flag);
                                        new_record.set('expended', 'Y');
                                    }
                                } else {
                                    $('pur5760_qualified_vendor_lns_query').setQueryParameter('qualified_hds_id', '-1');
                                    $('pur5760_qualified_vendor_lns_query').query();
                                }
                            },
                            scope: this
                        });
                        Aurora.Masker.unmask($('pur5760_qualified_vendor_modify_win').wrap);
                        $('pur5760_vendor_supply_ability_query').setQueryParameter('vendor_id', record.get('vendor_id'));
                        $('pur5760_vendor_supply_ability_query').query();
                    } else {
                        $('pur5760_qualified_vendor_lns_query').setQueryParameter('qualified_hds_id', '-1');
                        $('pur5760_qualified_vendor_lns_query').query();
                        $('pur5760_vendor_supply_ability_query').setQueryParameter('vendor_id', '-1');
                        $('pur5760_vendor_supply_ability_query').query();
                    }
                }
            }
            
            function pur5760_supply_status_renderer(value, record, name) {
                var supply_status = record.get('supply_status');
                if (supply_status == 'G') {
                    return '<div style="background-color:#33cc33;margin:0 0;">' + value + '</div>';
                } else if (supply_status == 'Y') {
                    return '<div style="background-color:yellow;margin:0 0;">' + value + '</div>';
                } else if (supply_status == 'R') {
                    return '<div style="background-color:red;margin:0 0;">' + value + '</div>';
                } else {
                    return '';
                }
            }
            
            function pur5760_supply_ability_file_renderer(value, record, name) {
                return '<a href="javascript:pur5760_supply_ability_upload(' + record.get('ability_lns_id') + ');">${l:PROMPT.ATTACHMENT_FILE_VIEW}</a>';
            }
            
            function pur5760_supply_ability_upload(ability_lns_id) {
                new Aurora.Window({
                    id: 'pur5760_upload_window',
                    title: '${l:PROMPT.VIEW_ATTACHMENT}',
                    url: $('pur5760_vendor_supply_ability_upload_link').getUrl() + '?header_id=' + ability_lns_id + '&table_name=PUR_VENDOR_SUPPLY_ABILITY_LNS_FILE',
                    width: 850,
                    height: 500
                });
            }
            
            function pur5760_qualified_vendor_save() {
                var ds = $('pur5760_qualified_vendor_modify_ds');
                var lns_ds = $('pur5760_qualified_vendor_lns_query');
                var record = ds.getCurrentRecord();
                Aurora.Masker.mask($('pur5760_qualified_vendor_modify_win').wrap, '${l:LOADING}' + '...');
            
                if (ds.validate() && lns_ds.validate()) {
                    var para = {
                        'qualified_hds_id': record.get('qualified_hds_id'),
                        'cooper_business_group': record.get('cooper_business_group'),
                        'cooper_company_id': record.get('cooper_company_id'),
                        'vendor_id': record.get('vendor_id'),
                        'element_hds_id': record.get('element_hds_id'),
                        'apply_reason': record.get('apply_reason'),
                        'comments': record.get('comments'),
                        'material_used_flag': record.get('material_used_flag'),
                        'review_lines': lns_ds.getJsonData(false),
                        '_status': record.isNew ? 'insert' : 'update'
                    };
                    Aurora.request({
                        url: $('pur5760_qualified_vendor_save_link').getUrl(),
                        para: para,
                        success: function(res) {
                            Aurora.Masker.unmask($('pur5760_qualified_vendor_modify_win').wrap);
                            var qualified_hds_id = '${/parameter/@qualified_hds_id}' ? '${/parameter/@qualified_hds_id}' : res.result.qualified_hds_id;
                            Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.SAVE_SUCCESS}', function() {
                                ds.setQueryParameter('qualified_hds_id', qualified_hds_id);
                                ds.query();
                            });
                            return;
                        },
                        failure: function() {
                            Aurora.Masker.unmask($('pur5760_qualified_vendor_modify_win').wrap);
                        },
                        error: function() {
                            Aurora.Masker.unmask($('pur5760_qualified_vendor_modify_win').wrap);
                        },
                        scope: this
                    });
                } else {
                    Aurora.Masker.unmask($('pur5760_qualified_vendor_modify_win').wrap);
                }
            }
            
            function pur5760_qualified_vendor_delete() {
                var ds = $('pur5760_qualified_vendor_modify_ds');
                var record = ds.getCurrentRecord();
                if (record.get('qualified_hds_id')) {
                    Aurora.showConfirm('${l:PROMPT}', '${l:CONFIRM_TO_DELETE}', function() {
                        Aurora.Masker.mask($('pur5760_qualified_vendor_modify_win').wrap, '${l:LOADING}' + '...');
                        Aurora.request({
                            url: $('pur5760_qualified_vendor_delete_link').getUrl(),
                            para: record.data,
                            success: function() {
                                Aurora.Masker.unmask($('pur5760_qualified_vendor_modify_win').wrap);
                                Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.OPERATION_SUCCESS}', function() {
                                    pur5760_qualified_vendor_return();
                                });
                            },
                            error: Aurora.Masker.unmask($('pur5760_qualified_vendor_modify_win').wrap),
                            failure: Aurora.Masker.unmask($('pur5760_qualified_vendor_modify_win').wrap),
                            scope: this
                        });
                    });
                } else {
                    Aurora.showMessage('${l:PROMPT}', '${l:PUR5720.SAVE_DATA_FIRST}');
                    return;
                }
            }
            
            function pur5760_qualified_vendor_upload() {
                var qualified_hds_id = $('pur5760_qualified_vendor_modify_ds').getCurrentRecord().get('qualified_hds_id');
                if (qualified_hds_id) {
                    new Aurora.Window({
                        id: 'pur5760_attachment_file_upload_win',
                        title: '${l:ATM.UPLOAD_ATTACHMENT}',
                        url: $('pur5760_qualified_vendor_upload_link').getUrl() + '?pkvalue=' + '\''+qualified_hds_id +'\''+ '&table_name=PUR_QUALIFIED_VENDOR_FILE',
                        width: 850,
                        height: 500
                    }).on('close', function() {
                        $('pur5760_attachment_info_ds').setQueryParameter('pk_value', qualified_hds_id);
                        $('pur5760_attachment_info_ds').setQueryParameter('table_name', 'PUR_QUALIFIED_VENDOR_FILE');
                        $('pur5760_attachment_info_ds').query();
                    });
                } else {
                    Aurora.showMessage('${l:PROMPT}', '${l:PUR5720.SAVE_DATA_FIRST}');
                    return;
                }
            }
            
            function pur5760_qualified_vendor_submit() {
                var qualified_hds_id = $('pur5760_qualified_vendor_modify_ds').getCurrentRecord().get('qualified_hds_id');
                if (qualified_hds_id) {
                    if ($('pur5760_qualified_vendor_lns_query').validate()) {
                        Aurora.showConfirm('${l:PROMPT}', '${l:DOCUMNET_SUBMIT_CONFIRM}', function() {
                            Aurora.Masker.mask($('pur5760_qualified_vendor_modify_win').wrap, '${l:LOADING}' + '...');
                            Aurora.request({
                                url: $('pur5760_qualified_vendor_submit_link').getUrl(),
                                para: {
                                    'qualified_hds_id': qualified_hds_id
                                },
                                success: function() {
                                    Aurora.Masker.unmask($('pur5760_qualified_vendor_modify_win').wrap);
                                    Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.SUBMIT_SUCCESS}', function() {
                                        pur5760_qualified_vendor_return();
                                    });
                                },
                                error: function() {
                                    Aurora.Masker.unmask($('pur5760_qualified_vendor_modify_win').wrap);
                                },
                                failure: function() {
                                    Aurora.Masker.unmask($('pur5760_qualified_vendor_modify_win').wrap);
                                },
                                scope: this
                            });
                        });
                    }
                } else {
                    Aurora.showMessage('${l:PROMPT}', '${l:PUR5720.SAVE_DATA_FIRST}');
                    return;
                }
            }
            
            function pur5760_qualified_vendor_score_editFunctioin(record, name) {
                if (name == 'score') {
                    if (record.get('leaf_flag') == 'Y') {
                        record.getField(name).setRequired(true);
                        return 'pur5760_qualified_vendor_lns_grid_nf';
                    } else {
                        record.getField(name).setRequired(false);
                        return '';
                    }
                }
            
                if (name == 'comments') {
                    if (record.get('leaf_flag') == 'Y') {
                        return 'pur5760_qualified_vendor_lns_grid_tf';
                    } else {
                        return '';
                    }
                }
            }
            
            function pur5760_qualified_vendor_score_validate(record, name, value) {
                if (name == 'score') {
                    if (value) {
                        if (record.get('leaf_flag') == 'Y') {
                            var element_score = record.get('element_score');
                            var element_score_from = record.get('element_score_from');
                            if (parseInt(value) > parseInt(element_score)) {
                                return '${l:PUR5760.PUR_qualified_vendor_SCORE_ERROR}';
                            }
                            if (parseInt(value) < parseInt(element_score_from)) {
                                return '${l:PUR5760.PUR_qualified_vendor_LESS_SCORE_ERROR}';
                            }
                        }
                    }
                }
            }
            
            function pur5760_supply_ability_detial_download_renderer(value, record, name) {
                return '<a href="javascript:pur5760_supply_ability_detial_download(' + record.get('ability_lns_id') + ');">${l:PROMPT.ATTACHMENT_INFO}</a>';
            }
            
            function pur5760_supply_ability_detial_download(ability_lns_id) {
                new Aurora.Window({
                    id: 'pur5670_upload_window',
                    title: '${l:PROMPT.ATTACHMENT_INFO}',
                    url: $('pur5760_qualified_vendor_upload_link').getUrl() + '?pkvalue=' + '\''+ability_lns_id +'\''+ '&table_name=PUR_VENDOR_SUPPLY_ABILITY_LNS_FILE',
                    width: 850,
                    height: 500
                });
            }
            
            function pur5760_qualified_vendor_score_validator(record, name, value) {
                if (value) {
                    if (parseInt(value) > parseInt(record.get('element_score'))) {
                        return '${l:PUR5760.SCORING_CAN_NOT_GREATER_THAN_SCORE}';
                    } 
                    else if (parseInt(value) < parseInt(record.get('element_score_from'))) {
                       return '${l:PUR5760.SCORING_CAN_NOT_LESS_THAN_SCORE}';
                            }
                    else {
                        return true;
                    }
                } else {
                    return true;
                }
            }
            
            function pur5760_supply_ability_atm_file_download_renderer(value, record, name) {
                var attachment_id = record.get('attachment_id'); //附件ID
                if (name == "file_name") {
                    if (attachment_id) {
                        return '<a href="' + $('pur5760_attachment_file_download_link').getUrl() + '?attachment_id=' + attachment_id + '">' + value + '</a>';
                    }
                }
            }
            
            function pur5760_qualified_element_hds_ds_update_load(dataSet) {
                var records = dataSet.getAll();
                var record = $('pur5760_qualified_vendor_modify_ds').getAt(0);
                if (records.length == 0) {
                    record.set('element_hds_id', '');
                    record.set('element_hds_code', '');
                    record.set('element_name', '');
                    $('pur5760_qualified_vendor_lns_query').removeAll(true);
                    Aurora.showMessage('${l:PROMPT}', '${l:PUR5760.NO_SCORING_FACTOR_PLEASE_CHECK}');
                } else {
                    if (record.get('element_hds_id') == '' || record.get('element_hds_id') == 'undefined' || record.get('element_hds_id') == null) {
                        record.set('element_hds_id', records[0].get('element_hds_id'));
                        record.set('element_hds_code', records[0].get('element_hds_code'));
                        record.set('element_name', records[0].get('element_name'));
                    }
                }
            }
        ]]></script>
        <a:dataSets>
            <a:dataSet id="pur5760_modify_supply_ability_evaluation_level_ds">
                <a:datas dataSource="pur5760_vendor_evaluation_level_data"/>
            </a:dataSet>
            <a:dataSet id="pur5760_qualified_vendor_modify_ds" model="pur.PUR5760.pur_qualified_vendor_hds_query">
                <a:fields>
                    <a:field name="display_vendor_code" autoComplete="true" autoCompleteField="vendor_code_name" defaultValue="${/model/pur5760_current_user/record/@vendor_code}" lovHeight="500" lovService="pur.PUR5710.pur5710_vendor_lov?qualified_flag=Y" lovWidth="550" required="true" title="PUR5720.VENDOR_SELECT">
                        <a:mapping>
                            <a:map from="vendor_id" to="vendor_id"/>
                            <a:map from="vendor_code" to="display_vendor_code"/>
                            <a:map from="vendor_name" to="full_name"/>
                            <a:map from="coop_business_group" to="cooper_business_group"/>
                            <a:map from="coop_company_id" to="cooper_company_id"/>
                        </a:mapping>
                    </a:field>
                    <!-- <a:field name="cooper_business_group"/> -->
                    <!-- <a:field name="cooper_company_id"/> -->
                    <!-- <a:field name="vendor_id"/> -->
                    <a:field name="vendor_id" defaultValue="${/model/pur5760_current_user/record/@vendor_id}"/>
                    <!-- <a:field name="supplier_id" defaultValue="${/model/pur5760_current_user/record/@supplier_id}"/> -->
                    <a:field name="cooper_business_group" defaultValue="${/model/pur5760_current_user/record/@coop_business_group}"/>
                    <a:field name="cooper_company_id" defaultValue="${/model/pur5760_current_user/record/@coop_company_id}"/>
                    <a:field name="full_name" defaultValue="${/model/pur5760_current_user/record/@vendor_name}" readOnly="true"/>
                    <a:field name="status" defaultValue="NEW"/>
                    <a:field name="special_vendor_flag" readOnly="true"/>
                    <a:field name="status_display" displayField="flex_desc" options="pur5760_qualified_vendor_status_ds" readOnly="true" returnField="status" valueField="flex_value"/>
                    <a:field name="created_by_name" defaultValue="${/model/pur5760_current_user/record/@description}" readOnly="true"/>
                    <a:field name="creation_date" defaultValue="${/model/pur5760_current_user/record/@current_date}" readOnly="true"/>
                    <a:field name="final_score" readOnly="true"/>
                    <a:field name="final_level" readOnly="true"/>
                    <a:field name="qualified_hds_code"/>
                    <a:field name="apply_reason" required="true"/>
                    <!-- <a:field name="element_hds_code" lovHeight="500" lovWidth="530" required="true" title="评分要素选择">
                        <a:mapping>
                            <a:map from="element_hds_id" to="element_hds_id"/>
                            <a:map from="element_hds_code" to="element_hds_code"/>
                            <a:map from="element_name" to="element_name"/>
                        </a:mapping>
                    </a:field> -->
                    <a:field name="material_used_flag" checkedValue="Y" defaultValue="Y" uncheckedValue="N"/>
                </a:fields>
                <a:events>
                    <a:event name="update" handler="pur5760_qualified_vendor_update_handler"/>
                    <a:event name="load" handler="pur5760_qualified_vendor_load_handler"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="pur5760_qualified_vendor_lns_query" fetchAll="true" model="pur.PUR5760.pur_qualified_vendor_lns_query">
                <a:fields>
                    <a:field name="score" validator="pur5760_qualified_vendor_score_validator"/>
                </a:fields>
                <a:events>
                    <a:event name="update" handler="pur5760_qualified_vendor_lns_update_handler"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="pur5760_vendor_supply_ability_query" fetchAll="true" model="pur.PUR5740.pur_supply_ability_lns_detial_query">
                <a:fields>
                    <a:field name="supply_flag" checkedValue="Y" defaultValue="Y" uncheckedValue="N"/>
                    <a:field name="supply_status_display" displayField="flex_desc" options="pur5760_pur_vendor_supply_status_ds" returnField="supply_status" valueField="flex_value"/>
                    <a:field name="psa_evaluation_level_display" displayField="flex_desc" options="pur5760_modify_supply_ability_evaluation_level_ds" returnField="psa_evaluation_level" valueField="flex_value"/>
                    <a:field name="spa_evaluation_level_display" displayField="flex_desc" options="pur5760_modify_supply_ability_evaluation_level_ds" returnField="spa_evaluation_level" valueField="flex_value"/>
                </a:fields>
            </a:dataSet>
            <a:dataSet id="pur5760_attachment_info_ds" fetchAll="true" loadData="true" model="public.fnd_attachment_file_mgr"/>
            <a:dataSet id="pur5760_qualified_element_hds_ds" fetchAll="true" model="pur.PUR5760.pur_qualified_element_hds_lov">
                <!-- <a:events>
                    <a:event name="load" handler="pur5760_qualified_element_hds_ds_update_load"/>
                </a:events> --><![CDATA[
                
                
            ]]></a:dataSet>
        </a:dataSets>
        <a:screenBody>
            <a:screenTopToolbar>
                <a:toolbarButton id="pur5760_qualified_vendor_save_btn" click="pur5760_qualified_vendor_save" text="PROMPT.SAVE" width="100"/>
                <a:toolbarButton click="pur5760_qualified_vendor_submit" text="PROMPT.SUBMIT" width="100"/>
                <a:toolbarButton click="pur5760_qualified_vendor_delete" text="PROMPT.DELETE" width="100"/>
                <a:toolbarButton click="pur5760_qualified_vendor_upload" text="ATM.UPLOAD_ATTACHMENT" width="100"/>
                <a:toolbarButton click="pur5760_qualified_vendor_return" text="HAP_BACK" width="100"/>
            </a:screenTopToolbar>
            <a:fieldSet column="1" title="PROMPT.BASIC_INFOMATION">
                <a:hBox labelWidth="100">
                    <a:textField name="qualified_hds_code" bindTarget="pur5760_qualified_vendor_modify_ds" prompt="PUR5720.RECOMMEND_HDS_CODE" readOnly="true" width="140"/>
                    <a:textField name="status_display" bindTarget="pur5760_qualified_vendor_modify_ds" prompt="PUR5710.STATUS_DESC" width="140"/>
                    <a:textField name="created_by_name" bindTarget="pur5760_qualified_vendor_modify_ds" prompt="PUR5710.CREATED_BY_DESC" width="140"/>
                    <a:checkBox name="material_used_flag" bindTarget="pur5760_qualified_vendor_modify_ds" prompt="物料使用" width="140"/>
                </a:hBox>
                <a:hBox labelWidth="100">
                    <a:lov name="display_vendor_code" bindTarget="pur5760_qualified_vendor_modify_ds" prompt="PUR_RCV_TRX_HEADERS.VENDOR_CODE" width="140"/>
                    <a:textField name="full_name" bindTarget="pur5760_qualified_vendor_modify_ds" prompt="PUR_HEADERS_ALL.VENDOR_NAME" readOnly="true" width="140"/>
                    <a:textField name="creation_date" bindTarget="pur5760_qualified_vendor_modify_ds" prompt="PUR5710.CREATION_DATE" width="140"/>
                </a:hBox>
                <!-- <a:hBox labelWidth="100">
                    <a:lov name="element_hds_code" bindTarget="pur5760_qualified_vendor_modify_ds" prompt="PUR2520.ELEMENT_HDS_CODE" width="140"/>
                    <a:textField name="element_name" bindTarget="pur5760_qualified_vendor_modify_ds" prompt="PUR2520.ELEMENT_NAME" readOnly="true" width="140"/>
                </a:hBox> -->
                <a:hBox labelWidth="100">
                    <a:textArea name="apply_reason" bindTarget="pur5760_qualified_vendor_modify_ds" height="40" prompt="PUR5720.APPLY_REASON" width="632"/>
                </a:hBox>
                <a:hBox labelWidth="100">
                    <a:textField name="comments" bindTarget="pur5760_qualified_vendor_modify_ds" height="40" prompt="PROMPTS.COMMENTS" width="635"/>
                </a:hBox>
            </a:fieldSet>
            <a:tabPanel marginHeight="240" marginWidth="100" style="border:none;">
                <a:tabs>
                    <!-- <a:tab prompt="PUR5760.SCORING_INFO" width="120">
                        <a:vBox style="margin:auto auto;margin-top:10px;">
                            <a:hBox height="30" labelWidth="100">
                                <a:textField name="final_score" bindTarget="pur5760_qualified_vendor_modify_ds" prompt="PUR5760.FINAL_SCORE" readOnly="true" width="140"/>
                                <a:textField name="final_level" bindTarget="pur5760_qualified_vendor_modify_ds" prompt="PUR5760.FINAL_LEVEL" readOnly="true" width="140"/>
                            </a:hBox>
                            <a:treeGrid id="pur5760_qualified_vendor_lns_grid" bindTarget="pur5760_qualified_vendor_lns_query" expandField="expended" idField="element_hds_id" marginHeight="327" marginWidth="108" parentField="parent_element_id" showCheckBox="false" width="1000">
                                <a:columns>
                                    <a:column name="element_hds_code" align="left" prompt="PUR5760.ELEMENT_HDS_CODE" width="200"/>
                                    <a:column name="element_name" align="left" prompt="PUR5760.ELEMENT_NAME" width="200"/>
                                    <a:column name="element_score_range" align="center" prompt="PUR5760.ELEMENT_SCORE" width="70">
                                        <a:column name="element_score_from" prompt="PUR2520.SCORE_FROM"/>
                                        <a:column name="element_score" prompt="PUR2520.SCORE_TO"/>
                                    </a:column>
                                    <a:column name="score" align="right" editorFunction="pur5760_qualified_vendor_score_editFunctioin" prompt="PUR5760.SCORE" width="70"/>
                                    <a:column name="comments" editorFunction="pur5760_qualified_vendor_score_editFunctioin" prompt="PROMPTS.COMMENTS" width="120"/>
                                </a:columns>
                                <a:editors>
                                    <a:textField id="pur5760_qualified_vendor_lns_grid_tf"/>
                                    <a:numberField id="pur5760_qualified_vendor_lns_grid_nf" allowDecimals="true" allowNegative="true" decimalPrecision="2"/>
                                </a:editors>
                            </a:treeGrid>
                        </a:vBox>
                    </a:tab> -->
                    <a:tab prompt="PUR5740.AVAILABILITY_LIST" width="120">
                        <a:grid bindTarget="pur5760_vendor_supply_ability_query" marginHeight="273" marginWidth="102" navBar="true" width="1000">
                            <a:columns>
                                <a:column name="category_code" align="center" prompt="PUR2520.PUR_CATEGORY_CODE" width="80"/>
                                <a:column name="category_name" prompt="PUR2520.PUR_CATEGORY_NAME" width="80"/>
                                <a:column name="certify_status_desc" align="center" prompt="状态"/>
                                <!-- <a:column name="supply_flag" align="center" prompt="PUR5670.SUPPLY_FLAG" width="60"/>
                                <a:column name="supply_status_display" align="center" prompt="PUR5670.SUPPLY_STATUS" renderer="pur5760_supply_status_renderer" width="60"/>
                                <a:column name="psa_evaluation_level_display" align="center" prompt="PUR5670.PSA_EVALUATION_LEVEL" width="70"/>
                                <a:column name="psa_evaluation_score" align="right" prompt="PUR5670.PSA_EVALUATION_SCORE" width="70"/>
                                <a:column name="psa_finish_date" align="center" prompt="PUR5670.PSA_FINISH_DATE" width="80"/>
                                <a:column name="spa_evaluation_level_display" align="center" prompt="PUR5670.SPA_EVALUATION_LEVEL" width="80"/>
                                <a:column name="spa_evaluation_score" align="right" prompt="PUR_VENDORS.SPA_SCORE" width="80"/>
                                <a:column name="spa_finish_date" align="center" prompt="PUR5670.SPA_EVALUATION_SCORE" width="80"/>
                                <a:column name="define_comment" prompt="PUR5720.EVALUATION_INFO_1" width="100"/>
                                <a:column name="approve_comment" prompt="PUR5670.EVALUATION_INFO_2" width="100"/>
                                <a:column name="approve_comment_3" prompt="PUR5670.EVALUATION_INFO_3" width="100"/> -->
                                <a:column name="atm_download" align="center" prompt="PUR2510.TEMPLATE_UPLOAD" renderer="pur5760_supply_ability_detial_download_renderer" width="80"/>
                            </a:columns>
                        </a:grid>
                    </a:tab>
                    <a:tab prompt="PUR2510.TEMPLATE_UPLOAD" width="100">
                        <a:grid bindTarget="pur5760_attachment_info_ds" marginHeight="273" marginWidth="102" navBar="true">
                            <a:columns>
                                <a:column name="file_name" align="left" renderer="pur5760_supply_ability_atm_file_download_renderer" sortable="true" width="230"/>
                                <a:column name="file_size" align="center" sortable="true" width="100"/>
                                <a:column name="upload_user" align="center" prompt="FND_ATM_LINES.UPLOAD_USER_NAME" sortable="true" width="80"/>
                                <a:column name="upload_date" align="center" prompt="FND_ATM_LINES.UPLOAD_DATE" renderer="Aurora.formatDate" sortable="true" width="80"/>
                            </a:columns>
                        </a:grid>
                    </a:tab>
                </a:tabs>
            </a:tabPanel>
            <script><![CDATA[
                init();
            ]]></script>
        </a:screenBody>
    </a:view>
</a:screen>

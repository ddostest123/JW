<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: Leah  
    $Date: 2015-3-17 下午04:43:35  
    $Revision: 1.0  
    $Purpose: 
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application">
    <a:init-procedure>
        <a:model-query fetchAll="true" model="pur.CON5110.con_contract_upload_get_init_info" rootPath="con5110_contract_attm_init"/>
    </a:init-procedure>
    <a:view>
        <a:link id="con5150_contract_trial_confirm_url" url="${/request/@context_path}/autocrud/pur.CON5150.con_contract_trial/execute"/>
        <a:link id="con5150_contract_trial_x3_confirm_url" url="${/request/@context_path}/autocrud/pur.CON5150.con_contract_trial/update"/>
        <style><![CDATA[ 
	     #con5110_contract_iem_detail_area{
      width:910px;
      height:500px;
      border:1px dashed green; padding-left:11px; padding-top:11px; line-height:25px;
    }
    #con5110_contract_iem_detail_area input{border-left:0px;
									        border-right:0px;
									        border-top:0px;
									        border-bottom:1px solid #000;
									         
									        text-align:center;}
									        
									       
   #con5110_contract_iem_detail_area textarea{
	    
	    vertical-align:middle;
	    width:640px;
	   
	}
           ]]></style>
        <script><![CDATA[
            var g_con_item_id;
            var g_contract_type_id;
            
            function con5110_contract_create_fn() {
                var con_header_ds = $('con5110_contract_header_ds');
            
                var con_line_ds = $('con5110_contract_line_ds');
                con_header_ds.submit();
                con_line_ds.submit();
                $('con5110_contract_attm_ds').submit();
                $('con5110_contract_partner_ds').submit();
            
                con5110_contract_item_info_save_fn();
            
            }
            
            function con5110_contract_header_submitSuccess_fn(ds) {
                ds.query();
            }
            
            function con5110_contract_line_submitSuccess_fn(ds) {
                ds.query();
            }
            
            function con5110_contract_delete_fn() {
            
                Aurora.showConfirm('${l:PROMPT}', '${l:PUR_CON5110.DECIDED_TO_DELETE_THE_WHOLE_ORDER}', function() {
                    Aurora.request({
                        url: '${/request/@context_path}/autocrud/pur.CON5110.con_contract_headers_mantaince/delete',
                        para: {
                            'contract_header_id': '${/parameter/@contract_header_id}'
                        },
                        success: function(args) {
                            $('${/parameter/@winid}').close();
                        },
                        scope: this
                    });
                });
            }
            
            
            function con5110_contract_partner_init_fn(partner_type, partner_id) {
            
                Aurora.request({
                    url: '${/request/@context_path}/autocrud/pur.CON5110.con_contract_partners_mantaince/execute',
                    para: {
                        'contract_header_id': '${/parameter/@contract_header_id}',
                        'partner_type': partner_type,
                        'partner_id': partner_id
                    },
                    success: function(args) {
                        $('con5110_contract_partner_ds').query();
                    },
                    scope: this
                });
            
            }
            
            function con5110_contract_header_update_fn(ds, record, name, value, oldvalue) {
            
                if (name == 'contract_type_id') {
                    $('con5110_contract_item_ds').setQueryParameter('contract_type_id', value);
                    $('con5110_contract_item_ds').query();
                    g_contract_type_id = value;
                }
                if (name == 'company_id') {
                    con5110_contract_partner_init_fn('COMPANY', value);
                }
                if (name == 'vendor_id') {
                    con5110_contract_partner_init_fn('VENDOR', value);
                }
            
            }
            
            
            
            
            
            
            //auto textarea
            
            var autoTextarea = function(elem, extra, maxHeight) {
                    extra = extra || 0;
                    var isFirefox = !! document.getBoxObjectFor || 'mozInnerScreenX' in window,
                        isOpera = !! window.opera && !! window.opera.toString().indexOf('Opera'),
                        addEvent = function(type, callback) {
                            elem.addEventListener ? elem.addEventListener(type, callback, false) : elem.attachEvent('on' + type, callback);
                        },
                        getStyle = elem.currentStyle ?
                    function(name) {
                        var val = elem.currentStyle[name];
            
                        if (name === 'height' && val.search(/px/i) !== 1) {
                            var rect = elem.getBoundingClientRect();
                            return rect.bottom - rect.top - parseFloat(getStyle('paddingTop')) - parseFloat(getStyle('paddingBottom')) + 'px';
                        };
            
                        return val;
                    } : function(name) {
                        return getComputedStyle(elem, null)[name];
                    }, minHeight = parseFloat(getStyle('height'));
            
                    elem.style.resize = 'none';
            
                    var change = function() {
                            var scrollTop, height, padding = 0,
                                style = elem.style;
            
                            if (elem._length === elem.value.length) return;
                            elem._length = elem.value.length;
            
                            if (!isFirefox && !isOpera) {
                                padding = parseInt(getStyle('paddingTop')) + parseInt(getStyle('paddingBottom'));
                            };
                            scrollTop = document.body.scrollTop || document.documentElement.scrollTop;
            
                            elem.style.height = minHeight + 'px';
                            if (elem.scrollHeight > minHeight) {
                                if (maxHeight && elem.scrollHeight > maxHeight) {
                                    height = maxHeight - padding;
                                    style.overflowY = 'auto';
                                } else {
                                    height = elem.scrollHeight - padding;
                                    style.overflowY = 'hidden';
                                };
                                style.height = height + extra + 'px';
                                scrollTop += parseInt(style.height) - elem.currHeight;
                                document.body.scrollTop = scrollTop;
                                document.documentElement.scrollTop = scrollTop;
                                elem.currHeight = parseInt(style.height);
                            };
                        };
            
                    addEvent('propertychange', change);
                    addEvent('input', change);
                    addEvent('focus', change);
                    change();
                };
            
            function con5110_contract_item_grid_click(grid, row, record) {
                g_con_item_id = $('con5110_contract_item_ds').getAt(row).get('item_id');
                if (g_con_item_id && g_contract_type_id) {
                    Aurora.request({
                        url: '${/request/@context_path}/autocrud/pur.CON5110.con_contract_items_mantaince/query',
                        para: {
                            'con_item_id': g_con_item_id,
                            'contract_type_id': g_contract_type_id,
                            'contract_id': $('con5110_contract_header_ds').getAt(0).get('contract_header_id')
                        },
                        success: function(args) {
                            var oTarget = document.getElementById('con5110_contract_iem_detail_area');
                            oTarget.innerHTML = args.result.record.item_text;
                            var oInput = oTarget.getElementsByTagName('input');
                            var oTextarea = oTarget.getElementsByTagName('textarea');
                            for (var u = 0;u < oInput.length;u++) {
                                oInput[u].onchange = function() {
                                    this.setAttribute('value', this.value);
                                };
                                oInput[u].readOnly = true;
                            }
                            for (var u1 = 0;u1 < oTextarea.length;u1++) {
                                oTextarea[u1].readOnly = true;
                                autoTextarea(oTextarea[u1]);
                            }
                        },
                        scope: this,
                        sync: true
                    });
                }
            
            
            }
            
            function con5110_contract_item_info_save_fn() {
                v_item_text = document.getElementById('con5110_contract_iem_detail_area').innerHTML;
                if (g_con_item_id && v_item_text) {
                    Aurora.request({
                        url: '${/request/@context_path}/autocrud/pur.CON5110.con_contract_items_mantaince/execute',
                        para: {
                            'con_item_id': g_con_item_id,
                            'item_text': v_item_text
                        },
                        success: function(args) {
                            Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.SAVE_SUCCESSFULLY}');
                        },
                        scope: this,
                        sync: true
                    });
                }
            
            }
            
            function con5110_contract_attm_submitSuccess_fn(ds) {
                ds.query();
            }
            
            function con5110_contract_edit_uploadFile(con_attchment_id) {
                if (!Ext.isEmpty(con_attchment_id)) {
                    var url = "${/request/@context_path}/uploadFile.screen?table_name=CON_CONTRACT_ATTACHMENTS&header_id=" + con_attchment_id;
                    new Aurora.Window({
                        url: url,
                        title: '${l:ATM.UPLOAD_ATTACHMENT}',
                        id: 'con5110_contract_edit_uploadFile_win',
                        width: 830,
                        height: 300
                    }).on('beforeclose', function() {
                        $('con5110_contract_attm_ds').query();
                    });
                }
            }
            
            function con5110_contract_view_uploadFile(con_attchment_id) {
                if (!Ext.isEmpty(con_attchment_id)) {
                    var url = "${/request/@context_path}/uploadFileView.screen?table_name=CON_CONTRACT_ATTACHMENTS&header_id=" + con_attchment_id;
                    new Aurora.Window({
                        url: url,
                        title: '${l:PUR_VENDORS.ATTACHMENT_DOWNLOAD}',
                        id: 'con5110_contract_view_uploadFile_win',
                        width: 830,
                        height: 300
                    });
                }
            }
            
            function con5110_contract_edit_uploadFile_render(value, record, name) {
            
                if (record.isNew) {
                    return '';
                } else {
                    var head_record=$('con5110_contract_header_ds').getAt(0);
                    if(head_record){
                    var v_status = head_record.get('status');
                    var cont_04_item_value = head_record.get('cont_04_item_value');
                    if ((v_status == 'SUBMITTED') || (v_status == 'APPROVALING')) {
                        if (cont_04_item_value == 'Y') {
                            return '<a href="javascript:con5110_contract_edit_uploadFile(' + value + ');">${l:PROMPT.UPLOAD}</a>';
                        } else {
                            return '<a href="javascript:con5110_contract_view_uploadFile(' + value + ');">${l:PROMPT.DOWNLOAD}</a>';
                        }
            
                    } else if ((v_status == 'RELEASED') || (v_status == 'APPROVED') || (v_status == 'FINISHED') || (v_status == 'CANCELED')) {
                        //附件查看
                        return '<a href="javascript:con5110_contract_view_uploadFile(' + value + ');">${l:PROMPT.DOWNLOAD}</a>';
            
                    } else {
                        //附件编辑
                        return '<a href="javascript:con5110_contract_edit_uploadFile(' + value + ');">${l:PROMPT.UPLOAD}</a>';
                    }
                }
            }
            }
            
            function con5110_contract_attm_create_fn() {
                var record = $('con5110_contract_attm_ds').create();
                record.set('contract_header_id', '${/parameter/@contract_header_id}');
            }
            
            function con5110_contract_partner_submitSuccess_fn(ds) {
                ds.query();
            }
            
            function con5110_contract_partner_load_fn(ds) {
                for (var u = 0;u < ds.getAll().length;u++) {
                    var record = ds.getAt(u);
                    var lovField = record.getMeta().getField('partner_desc');
                    if (record.get('partner_type') == 'COMPANY') {
                        lovField.setLovService('public.fnd_companies_lov');
                        lovField.setMapping([{
                            'from': 'company_short_name',
                            'to': 'partner_desc'
                        }, {
                            'from': 'company_id',
                            'to': 'partner_id'
                        }]);
                        lovField.setLovWidth('600');
                        lovField.setLovHeight('500');
                        lovField.setTitle('${l:PUR_CON5110.SELECT_COMPANY}');
                    } else if (record.get('partner_type') == 'VENDOR') {
                        lovField.setLovService('pur.CON5110.pur_vendors_list_lov');
                        lovField.setMapping([{
                            'from': 'short_name',
                            'to': 'partner_desc'
                        }, {
                            'from': 'vendor_id',
                            'to': 'partner_id'
                        }]);
                        lovField.setLovWidth('600');
                        lovField.setLovHeight('500');
                        lovField.setTitle('${l:PUR_CON5110.SELECT_VENDOR}');
                    }
                }
            }
            
            function con5110_contract_submit_fn() {
                Aurora.showConfirm('${l:PROMPT}', '${l:PUR_CON5110.CONFIRM_TO_SUBMIT}', function() {
                    Aurora.request({
                        url: '${/request/@context_path}/autocrud/pur.CON5110.con_contract_headers_mantaince/execute',
                        para: {
                            'contract_header_id': '${/parameter/@contract_header_id}'
                        },
                        success: function(args) {
                            $('${/parameter/@winid}').close();
                        },
                        scope: this
                    });
                });
            }
            
            
            function con5110_contract_line_update_fn(ds, record, name, value, oldvalue) {
                if (name == 'quantity') {
                    Aurora.request({
                        url: '${/request/@context_path}/autocrud/pur.CON5110.con_contract_line_quantity_validate/query',
                        para: record.data,
                        success: function(args) {
                            var v_flag = args.result.record.valid_flag;
                            if (v_flag == 'N') {
                                record.set('quantity', '');
                                Aurora.showErrorMessage('${l:PROMPT}', '${l:PUR_CON5110.QUANTITY_CANNOT_BE_GREATER_THAN_DEMAND_QUANTITY}', function() {
                                    record.set('quantity', '');
                                });
                            }
                        },
                        scope: this
                    });
                }
            }
            
            
            function con5110_contract_header_load_fn(ds) {
                $('con5110_contract_item_ds').setQueryParameter('contract_type_id', ds.getAt(0).get('contract_type_id'));
                $('con5110_contract_item_ds').setQueryParameter('contract_id', ds.getAt(0).get('contract_header_id'));
                $('con5110_contract_item_ds').query();
                g_contract_type_id = ds.getAt(0).get('contract_type_id');
                var cont_04_item_value = ds.getAt(0).get('cont_04_item_value');
                if (cont_04_item_value == 'N') {
                    document.getElementById('con5150_contract_add_btn_id').style.display = 'none';
                    document.getElementById('con5150_contract_save_btn_id').style.display = 'none';
                    document.getElementById('con5150_contract_clear_btn_id').style.display = 'none';
                    document.getElementById('con5150_contract_delete_btn_id').style.display = 'none';
                }
                //合同条款内容设置成只读
            
                /* var oInput=document.getElmentById('con5110_contract_iem_detail_area').getElementsByTagName('input');
                 for (var u=0;u<oInput.length;u++){
                 oInput[u].readOnly='false';
                 } */
            
            }
            //合同初审确认
            
            function con5150_contract_trial_confirm() {
            
                var record = $('con5110_contract_header_ds').getCurrentRecord();
            
                //判断总金额是否大于500000， 不大于的可以直接通过，大于的OA审批
                var v_prompt_text = '${l:PUR_CON5150.SURE}';
                var v_status = 'APPROVED'; //审批通过
            
                Aurora.showConfirm('${l:PROMPT}', v_prompt_text, function() {
                    Aurora.Masker.mask(Ext.get('con5150_contract_trial_area1'), '${l:PUR_CON5150.IN_HANDLE_PLEASE_WAIT}');
                    Aurora.request({
                        url: $('con5150_contract_trial_X3_approve_url').getUrl(),
                        para: {
                            'contract_header_id': record.get('contract_header_id')
                        },
                        success: function(args) {
                            Aurora.Masker.unmask(Ext.get('con5150_contract_trial_area1'));
                            $('${/parameter/@winid}').close();
            
                        },
                        error: function() {
                            Aurora.Masker.unmask(Ext.get('con5150_contract_trial_area1'));
                        },
                        scope: this,
                        sync: true
                    });
            
                });
            
            }
            //合同退回
            
            function con5150_contract_trial_return() {
                var record = $('con5110_contract_header_ds').getCurrentRecord();
                var status;
                if (record.get('status') == 'APPROVALING') {
                    status = 'SUBMITTED';
                } else {
                    status = 'BACKED';
                }
            
            
                Aurora.showConfirm('${l:PROMPT}', '${l:PUR_CON5150.ARE_YOU_SURE_TO_RETURN}', function() {
                    Aurora.request({
                        url: $('con5150_contract_trial_action_url').getUrl(),
                        para: {
                            'status': status,
                            'contract_header_id': '${/parameter/@contract_header_id}'
                        },
                        success: function(args) {
                            $('${/parameter/@winid}').close();
                        },
                        scope: this
                    });
                });
            
            }
            
            function con5150_contract_trial_back() {
                $('${/parameter/@winid}').close();
            }
            
            function con5110_qunantity_render(value, record, name) {
                if (record.get('quantity_required')) {
                    if (record.get('quantity_required') != value) {
                        return '<div style="background:red;">' + value + '</div>';
                    } else {
                        return value;
                    }
                } else {
                    return value;
                }
            }
            
            //点击生成合同文本事件
            //判断合同格式
            function con5150_contract_detail_context_fn(){
                var record = $('con5110_contract_header_ds').getAll();
                console.log(record);
                    Aurora.request({
                        //请求合同格式
                        url: '${/request/@context_path}/autocrud/pur.CON_PRINT.contract_print_format/query',
                        para: {
                            //公司代码和合同类型确定合同格式
                            // 'company_id': record[0].get('company_id'),
                            'contract_type_id': record[0].get('contract_type_id')
                        },
                        success: function(args) {
                            var format_record = args.result.record;
                            var url;
                            var winid = 'con3110_contract_context_win';
                            //判断合同格式是否存在并且是否启用
                            if(format_record.company_id == record[0].get('company_id') && format_record.enabled_flag == 'Y'){

                            // if (format_record.con_format_id != null && format_record.enabled_flag == 'Y') {
                                url = '${/request/@context_path}/'+format_record.file_name+'?contract_header_id=' + record[0].get('contract_header_id') + '&winid='+winid;
                            } else {
                                //默认格式
                                url = '${/request/@context_path}/'+format_record.con_format_default+'?contract_header_id=' + record[0].get('contract_header_id') + '&winid='+winid;
                            }
                            new Aurora.Window({
                                url: url,
                                id: winid,
                                fullScreen: true
                            });
                        }
                    });
                }
        ]]></script>
        <a:dataSets>
            <a:dataSet id="con5110_contract_status_list_ds" loadData="true" model="pur.CON5110.con_contract_status_list"/>
            <a:dataSet id="con5110_contract_header_ds" autoQuery="true" model="pur.CON5110.con_contract_headers_mantaince" queryUrl="${/request/@context_path}/autocrud/pur.CON5110.con_contract_headers_mantaince/query?contract_header_id=${/parameter/@contract_header_id}">
                <a:fields>
                    <a:field name="document_desc" required="true"/>
                    <a:field name="vendor_id"/>
                    <a:field name="vendor_code"/>
                    <a:field name="vendor_desc" lovHeight="520" lovService="pur.CON5110.pur_vendors_list_lov" lovWidth="600" required="true" title="PUR_CON5110.SELECT_VENDOR">
                        <a:mapping>
                            <a:map from="vendor_code" to="vendor_code"/>
                            <a:map from="short_name" to="vendor_desc"/>
                            <a:map from="vendor_id" to="vendor_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="pur_organization_id"/>
                    <a:field name="pur_organization_name" lovGridHeight="350" lovHeight="500" lovService="public.pur_organization_lov" lovWidth="500" required="true" title="PUR_ORGANIZATIONS.PUR_ORGANIZATION">
                        <a:mapping>
                            <a:map from="pur_organization_name" to="pur_organization_name"/>
                            <a:map from="pur_organization_id" to="pur_organization_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="company_id"/>
                    <a:field name="company_desc" autoComplete="true" autoCompleteField="company_short_name" lovGridHeight="350" lovHeight="500" lovService="public.fnd_companies_lov" lovWidth="500" required="true" title="CON_CONTRACT_HEADERS.COMPANY_ID">
                        <a:mapping>
                            <a:map from="company_id" to="company_id"/>
                            <a:map from="company_short_name" to="company_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="currency_code"/>
                    <a:field name="currency_name" lovHeight="530" lovService="public.gld_currency_lov" lovWidth="600" required="true" title="CON_CONTRACT_HEADERS.CURRENCY_CODE">
                        <a:mapping>
                            <a:map from="currency_name" to="currency_name"/>
                            <a:map from="currency_code" to="currency_code"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="pur_buyer_id"/>
                    <a:field name="pur_buyer_desc" lovHeight="510" lovService="pur.CON5110.con_get_pur_buyer_list_lov" lovWidth="600" required="true" title="PUR_PURCHASE_INFO_RECORDS.PUR_ORGANIZATION_NAME">
                        <a:mapping>
                            <a:map from="buyer_code" to="buyer_code"/>
                            <a:map from="buyer_name" to="pur_buyer_desc"/>
                            <a:map from="buyer_id" to="pur_buyer_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="contract_type_desc" lovHeight="500" lovService="pur.CON5110.con_get_contract_type_list_lov" lovWidth="600" required="true" title="CON_CONTRACT_HEADERS.CONTRACT_TYPE_NAME">
                        <a:mapping>
                            <a:map from="type_desc" to="contract_type_desc"/>
                            <a:map from="con_type_id" to="contract_type_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="status_desc" displayField="status_desc" options="con5110_contract_status_list_ds" returnField="status" valueField="status"/>
                    <a:field name="review_person_desc" readOnly="true"/>
                    <a:field name="created_by_desc" readOnly="true"/>
                </a:fields>
                <a:events>
                    <a:event name="submitSuccess" handler="con5110_contract_header_submitSuccess_fn"/>
                    <a:event name="update" handler="con5110_contract_header_update_fn"/>
                    <a:event name="load" handler="con5110_contract_header_load_fn"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="con5110_contract_line_ds" autoQuery="true" fetchAll="true" model="pur.CON5110.con_contract_lines_mantaince" queryUrl="${/request/@context_path}/autocrud/pur.CON5110.con_contract_lines_mantaince/query?contract_header_id=${/parameter/@contract_header_id}" selectable="true">
                <a:fields>
                    <a:field name="quantity" required="true"/>
                    <a:field name="service_include" required="true"/>
                    <a:field name="fare_include" required="true"/>
                    <a:field name="warranty" required="true"/>
                    <a:field name="model" readOnly="true"/>
                </a:fields>
                <a:events>
                    <a:event name="submitSuccess" handler="con5110_contract_line_submitSuccess_fn"/>
                    <a:event name="update" handler="con5110_contract_line_update_fn"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="con5110_contract_item_ds" fetchAll="true" model="pur.CON5110.con_contract_items_mantaince"/>
            <a:dataSet id="con5110_contract_partner_ds" autoQuery="true" model="pur.CON5110.con_contract_partners_mantaince" queryUrl="${/request/@context_path}/autocrud/pur.CON5110.con_contract_partners_mantaince/query?contract_header_id=${/parameter/@contract_header_id}">
                <a:fields/>
                <a:events>
                    <a:event name="submitSuccess" handler="con5110_contract_partner_submitSuccess_fn"/>
                    <a:event name="load" handler="con5110_contract_partner_load_fn"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="con5110_contract_attm_ds" autoQuery="true" model="pur.CON5110.con_contract_attachments_mantaince" queryUrl="${/request/@context_path}/autocrud/pur.CON5110.con_contract_attachments_mantaince/query?contract_header_id=${/parameter/@contract_header_id}" selectable="true">
                <a:fields>
                    <a:field name="file_name" required="true"/>
                    <a:field name="upload_party" defaultValue="${/model/con5110_contract_attm_init/record/@upload_party}"/>
                    <a:field name="upload_party_desc" defaultValue="${/model/con5110_contract_attm_init/record/@upload_party_desc}"/>
                    <a:field name="upload_date" defaultValue="${/model/con5110_contract_attm_init/record/@upload_date}"/>
                </a:fields>
                <a:events>
                    <a:event name="submitSuccess" handler="con5110_contract_attm_submitSuccess_fn"/>
                </a:events>
            </a:dataSet>
        </a:dataSets>
        <a:screenBody>
            <div id="con5150_contract_trial_area1">
                <a:screenTopToolbar>
                    <a:toolbarButton click="con5150_contract_trial_confirm" text="PROMPT.CONFIRM" width="100"/>
                    <a:toolbarButton click="con5150_contract_trial_return" text="PUR.RETURN" width="100"/>
                    <a:toolbarButton click="con5150_contract_trial_back" text="PROMPT.BACK" width="100"/>
                    <a:toolbarButton click="con5150_contract_detail_context_fn" text="CON_CONTRACT_HEADERS.GENERTE_CONTRACT_TEXT" width="100"/>
                </a:screenTopToolbar>
                <a:tabPanel marginWidth="50">
                    <a:tabs>
                        <a:tab prompt="PROMPT.BASIC_INFOMATION" width="100">
                            <a:form marginWidth="75" title="PUR_CON5110.PURCHASING_CONTRACT_DETAILS">
                                <a:box column="3" labelWidth="110">
                                    <a:textField name="contract_number" bindTarget="con5110_contract_header_ds" prompt="PUR_RCV_TRX_DETAILS.SERIAL_NUM" readOnly="true"/>
                                    <a:textField name="document_desc" bindTarget="con5110_contract_header_ds" prompt="CON_CONTRACT_HEADERS.CONTRACT_NUMBER" readOnly="true"/>
                                    <a:lov name="contract_type_desc" bindTarget="con5110_contract_header_ds" prompt="CON_CONTRACT_HEADERS.CONTRACT_TYPE_NAME" readOnly="true"/>
                                    <a:lov name="vendor_desc" bindTarget="con5110_contract_header_ds" prompt="PUR_HEADERS_ALL.VENDOR_ID" readOnly="true"/>
                                    <a:lov name="pur_organization_name" bindTarget="con5110_contract_header_ds" prompt="PUR_ORGANIZATIONS.PUR_ORGANIZATION" readOnly="true"/>
                                    <a:lov name="company_desc" bindTarget="con5110_contract_header_ds" prompt="CON_CONTRACT_HEADERS.COMPANY_ID" readOnly="true"/>
                                    <a:lov name="primary_document_desc" bindTarget="con5110_contract_header_ds" prompt="CON_CONTRACT_HEADERS.MASTER_CONTRACT_NUMBER" readOnly="true"/>
                                    <a:datePicker name="start_date" bindTarget="con5110_contract_header_ds" prompt="PUR_CON5110.CONTRACT_VALIDITY_FROM" readOnly="true" renderer="Aurora.formatDate"/>
                                    <a:datePicker name="end_date" bindTarget="con5110_contract_header_ds" prompt="PUR_CON5110.CONTRACT_VALIDITY_TO" readOnly="true" renderer="Aurora.formatDate"/>
                                    <a:numberField name="amount" bindTarget="con5110_contract_header_ds" prompt="CON_CONTRACT_OBJECT_LINES.AMOUNT" readOnly="true"/>
                                    <a:lov name="currency_name" bindTarget="con5110_contract_header_ds" prompt="CON_CONTRACT_HEADERS.CURRENCY_CODE" readOnly="true"/>
                                    <a:lov name="pur_buyer_desc" bindTarget="con5110_contract_header_ds" prompt="PUR_PURCHASE_INFO_RECORDS.PUR_ORGANIZATION_NAME" readOnly="true"/>
                                    <a:textField name="status_desc" bindTarget="con5110_contract_header_ds" prompt="CON_CONTRACT_HEADERS.STATUS" readOnly="true"/>
                                    <a:textField name="created_by_desc" bindTarget="con5110_contract_header_ds" prompt="CON_CONTRACT_HEADERS.CREATED_BY_NAME" readOnly="true"/>
                                    <a:textField name="review_person_desc" bindTarget="con5110_contract_header_ds" prompt="PUR_CON5110.REVIEWERS"/>
                                    <a:datePicker name="document_date" bindTarget="con5110_contract_header_ds" prompt="CON_CONTRACT_HEADERS.CREATION_DATE" readOnly="true" renderer="Aurora.formatDate"/>
                                </a:box>
                                <a:hBox labelWidth="110">
                                    <a:textArea name="note" bindTarget="con5110_contract_header_ds" height="30" prompt="CON_CONTRACT_HEADERS.NOTE" readOnly="true" width="680"/>
                                </a:hBox>
                            </a:form>
                            <a:tabPanel height="350" marginWidth="70">
                                <a:tabs>
                                    <a:tab prompt="CON5010.CONTRACT_OBJECTS" width="100">
                                        <a:grid bindTarget="con5110_contract_line_ds" height="300" marginWidth="75" navBar="true" showRowNumber="true" width="1000">
                                            <!-- <a:toolBar>
                                            <a:button type="save"/>
                                            <a:button type="delete"/>
                                        </a:toolBar> -->
                                            <a:columns>
                                                 <!-- <a:column name="line_num" align="center" lock="true" prompt="PUR_CON5110.CONTRACT_LINE_NUMBER" sortable="true" width="50"/>
                                                <a:column name="ref_doc_num_line" align="center" lock="true" prompt="PUR_CON5110.PO_NUMBER_LINE_NUMBER" sortable="true" width="90"/>
						-->
                                                <a:column name="pur_num_line" align="center" lock="true" prompt="PUR_CON5110.PO_NUMBER_LINE_NUMBER" sortable="true" width="80"/>
                                                <a:column name="pur_req_num_line" align="center" lock="true" prompt="PUR_CON5110.PR_NUMBER_LINE_NUMBER" sortable="true" width="90"/>
                                                
						<a:column name="item_code" align="center" lock="true" prompt="PUR_ITEM_PRICE_HEADERS.ITEM_CODE" width="70"/>
                                                <a:column name="item_desc" align="center" lock="true" prompt="PUR_ITEM_PRICE_HEADERS.ITEM_NAME" width="90"/>
                                                <a:column name="quantity" align="center" lock="true" prompt="CON_CONTRACT_OBJECT_LINES.PRIMARY_QUANTITY" renderer="con5110_qunantity_render" width="60"/>
                                                <a:column name="unit_price" align="center" lock="true" prompt="CON_CONTRACT_OBJECT_LINES.PRICE" width="60"/>
                                                <a:column name="line_amount" align="center" lock="true" prompt="CON_CONTRACT_OBJECT_LINES.AMOUNT" width="70"/>
                                                <a:column name="quantity_required" align="center" prompt="PUR_RFX_LN_ITEMS.QUANTITY" width="60"/>
                                                <a:column name="tax_rate_desc" align="center" prompt="CON_CONTRACT_OBJECT_LINES.TAX_TYPE_ID" width="60"/>
                                                <a:column name="unit_meas_lookup_code" align="center" prompt="CON_CONTRACT_OBJECT_LINES.UOM_ID" width="60"/>
                                                <a:column name="model" align="center" editor="con5150_line_textArea" prompt="PUR_CON5110.SPECIFICATIONS_MODEL"/>
                                                <a:column name="fare_include" align="center" prompt="SACPUR5210.WHETHER_SHIPPING_IS_INCLUDED" width="60"/>
                                                <a:column name="service_include" align="center" prompt="PUR_CON5110.WHETHER_INCLUDING_INSTALLATION_AND_COMMISSIONING_SERVICES"/>
                                                <a:column name="deliver_date" prompt="PUR_CON5110.DELIVERY_DATES" renderer="Aurora.formatDate" width="60"/>
                                                <a:column name="warranty" align="center" prompt="PUR2510.BASIC_C_ATTRIBUTE10" width="60"/>
                                                <!-- <a:column name="ref_doc_num" align="center" prompt="采购订单/申请"/>
                                                <a:column name="sales_order_num" align="center" prompt="销售订单号|行号" width="70"/> -->
                                                <a:column name="production_place" align="center" prompt="PUR_CON5110.ORIGIN" width="70"/>
                                                <a:column name="line_comment" align="center" prompt="PUR_REQ_LINES.LINE_COMMENTS"/>
                                            </a:columns>
                                            <a:editors>
                                                <a:textField id="con5110_line_txf_edt"/>
                                                <a:numberField id="con5110_line_nf_edt"/>
                                                <a:textArea id="con5150_line_textArea" height="110"/>
                                            </a:editors>
                                        </a:grid>
                                    </a:tab>
                                    <a:tab prompt="PUR_VENDOR_SITE_COMPANY.ASSIGN_CLIENT_QUERY" width="100">
                                        <a:grid bindTarget="con5110_contract_partner_ds" height="310" marginWidth="75" showRowNumber="true">
                                            <!-- <a:toolBar>
                                            <a:button type="save"/>
                                        </a:toolBar> -->
                                            <a:columns>
                                                <a:column name="partner_type_name" prompt="CON_CONTRACT_PARTNER_LINES.PARTNER_TYPE_NAME" width="60"/>
                                                <a:column name="partner_desc" prompt="CON_CONTRACT_PARTNER_LINES.PARTNER" width="90"/>
                                                <a:column name="signing_date" prompt="CONTRACT_DATE" width="70"/>
                                                <a:column name="representative" prompt="CON_CONTRACT_PARTNER_LINES.REPRESENTATIVE" width="60"/>
                                                <a:column name="telphone" prompt="CON_CONTRACT_PARTNER_LINES.TEL_PHONE" width="70"/>
                                                <a:column name="fax" prompt="CON_PARTNER_CONTACTORS.FAX" width="70"/>
                                                <a:column name="address" prompt="CON_CONTRACT_PARTNER_LINES.ADDRESS" width="110"/>
                                                <a:column name="bank_name" prompt="CON_CONTRACT_PARTNER_LINES.BANK_BRANCH_CODE"/>
                                                <a:column name="bank_account" prompt="CON_CONTRACT_PARTNER_LINES.BANK_ACCOUNT_CODE" width="101"/>
                                                <a:column name="tax_number" prompt="CON_CONTRACT_PARTNER_LINES.TAX_ID_NUMBER"/>
                                            </a:columns>
                                            <a:editors>
                                                <!-- <a:textField id="con5110_partner_txf_edt"/>
                                            <a:lov id="con5110_partner_lov_edt"/>
                                            <a:numberField id="con5110_partner_nf_edt"/> --><![CDATA[
                                                
                                                
                                                
                                                
                                                
                                                
                                                 
                                            ]]></a:editors>
                                        </a:grid>
                                    </a:tab>
                                </a:tabs>
                            </a:tabPanel>
                        </a:tab>
                        <a:tab prompt="PUR_CON5110.TERMS_INFORMATION" width="100">
                            <a:hBox>
                                <a:treeGrid bindTarget="con5110_contract_item_ds" height="550" idField="source_ref_id" parentField="parent_item_id" width="250">
                                    <a:columns>
                                        <a:column name="item_title" prompt="PUR_CON5110.CLAUSE_OF_TITLE" width="201"/>
                                    </a:columns>
                                    <a:events>
                                        <a:event name="cellclick" handler="con5110_contract_item_grid_click"/>
                                    </a:events>
                                </a:treeGrid>
                                <a:vBox>
                                    <!-- <a:toolbarButton click="con5110_contract_item_info_save_fn" text="保存条款信息" width="100"/> -->
                                    <div id="con5110_contract_iem_detail_area"/>
                                </a:vBox>
                            </a:hBox>
                        </a:tab>
                        <a:tab prompt="PROMPT.ATTACHMENT_INFORMATION" width="100">
                            <a:grid bindTarget="con5110_contract_attm_ds" height="410" marginWidth="75" navBar="true" showRowNumber="true">
                                <a:toolBar>
                                    <a:button id="con5150_contract_add_btn_id" click="con5110_contract_attm_create_fn" icon="${/request/@context_path}/images/add.gif" text="HAP_NEW"/>
                                    <a:button id="con5150_contract_save_btn_id" type="save"/>
                                    <a:button id="con5150_contract_clear_btn_id" type="clear"/>
                                    <a:button id="con5150_contract_delete_btn_id" type="delete"/>
                                </a:toolBar>
                                <a:columns>
                                    <a:column name="file_name" align="center" editor="con5110_atm_txf_edt" prompt="PUR_CON5110.DOCUMENT_NAME" width="150"/>
                                    <a:column name="upload_party_desc" align="center" prompt="PUR_CON5110.UPLOAD_PARTIES" width="130"/>
                                    <a:column name="upload_date" align="center" prompt="PUR_CON5110.UPLOAD_TIME" renderer="Aurora.formatDate" width="130"/>
                                    <a:column name="con_attchment_id" align="center" prompt="PROMPT.ATTACHMENT" renderer="con5110_contract_edit_uploadFile_render" width="150"/>
                                    <a:column name="comments" align="center" editor="con5110_atm_txf_edt" prompt="CON_CONTRACT_PARTNER_LINES.MEMO" width="200"/>
                                </a:columns>
                                <a:editors>
                                    <a:textField id="con5110_atm_txf_edt"/>
                                    <a:datePicker id="con5110_atm_date_edt"/>
                                </a:editors>
                            </a:grid>
                        </a:tab>
                    </a:tabs>
                </a:tabPanel>
            </div>
            <script><![CDATA[
              (function(){
                  $('con5110_contract_attm_ds').submit();
              })();
                
            ]]></script>
        </a:screenBody>
    </a:view>
</a:screen>

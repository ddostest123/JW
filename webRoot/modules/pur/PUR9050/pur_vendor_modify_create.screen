<?xml version="1.0" encoding="UTF-8"?>
<a:screen xmlns:a="http://www.aurora-framework.org/application" trace="true">
    <a:init-procedure>
        <!--  <a:model-query defaultWhereClause="vendor_modify_id=${/parameter/@vendor_modify_id}" fetchAll="true" model="pur.PUR9050.pur9010_vendor_modify" rootPath="pur9010_vendor_modify"/>
        <a:model-query defaultWhereClause="vendor_modify_id=${/parameter/@vendor_modify_id}" fetchAll="true" model="pur.PUR9050.pur9010_vendor_modify_bank" rootPath="pur9010_vendor_modify_account"/>
        <a:model-query defaultWhereClause="vendor_modify_id=${/parameter/@vendor_modify_id}" fetchAll="true" model="pur.PUR9050.pur9010_vendor_modify_address" rootPath="pur9010_vendor_modify_address"/> -->
        <a:model-query defaultWhereClause="flex_value_set_code = &apos;PUR_MODIFY_UNITS&apos;" fetchAll="true" model="public.fnd_flex_value_v_lov" rootPath="pur9050_modify_units"/>
        <a:model-query defaultWhereClause="flex_value_set_code = &apos;KW_ACCOUNT_PERIOD&apos;" fetchAll="true" model="public.fnd_flex_value_v_lov" rootPath="pur9050_account_period"/>
        <a:model-query defaultWhereClause="flex_value_set_code = &apos;KW_PAYMENT_METHOD&apos;" fetchAll="true" model="public.fnd_flex_value_v_lov" rootPath="pur9010_manufacturer_payment_method"/>
        <a:model-query defaultWhereClause="flex_value_set_code = &apos;KW_PRODUCT_GROUP_NAME&apos;" fetchAll="true" model="public.fnd_flex_value_v_lov" rootPath="pur9010_manufacturer_product_group"/>
        <a:model-query defaultWhereClause=" (${/parameter/@company_id} is null) or (${/parameter/@company_id} is not null and v.vendor_id = ${/parameter/@company_id} )" fetchAll="true" model="pur.PUR9050.pur9050_set_default_vendor_id" rootPath="pur9050_default_data"/>
        <a:model-query defaultWhereClause="flex_value_set_code = &apos;USER_ROLE_DS&apos;" fetchAll="true" model="public.fnd_flex_value_v_lov" rootPath="pur9050_user_role_ds"/>
        <a:model-query defaultWhereClause="flex_value_set_code = &apos;PUR_QUESTIONARY_ATM_TYPE_CODE&apos; and flex_value = &apos;250&apos;" fetchAll="true" model="public.fnd_flex_value_v_lov" rootPath="pur9050_attachment_type"/>
    </a:init-procedure>
    <a:view>
        <a:link id="pur9010_vendor_modify_address_delete_link" model="pur.PUR9050.pur9010_vendor_modify_address" modelaction="delete"/>
        <a:link id="pur9010_vendor_modify_address_save_link" model="pur.PUR9050.pur9010_vendor_modify_address" modelaction="insert"/>
        <a:link id="pur9010_vendor_modify_supply_delete_link" model="pur.PUR9050.pur9010_vendor_modify_supply" modelaction="delete"/>
        <a:link id="pur9010_vendor_modify_supply_save_link" model="pur.PUR9050.pur9010_vendor_modify_supply" modelaction="insert"/>
        <a:link id="pur9010_vendor_modify_contact_save_link" model="pur.PUR9050.pur9050_basic_contract_query" modelaction="batch_update"/>
        <a:link id="pur9010_vendor_modify_attach_save_link" model="pur.PUR9050.pur9050_vendor_modify_attachment" modelaction="insert"/>
        <a:link id="pur9010_vendor_modify_ou_delete_link" model="pur.PUR9050.pur9010_vendor_modify_ou" modelaction="delete"/>
        <a:link id="pur9010_vendor_modify_ou_save_link" model="pur.PUR9050.pur9010_vendor_modify_ou" modelaction="insert"/>
        <a:link id="pur9010_vendor_modify_bank_delete_link" model="pur.PUR9050.pur9010_vendor_modify_bank" modelaction="delete"/>
        <a:link id="pur9010_vendor_modify_bank_save_link" model="pur.PUR9050.pur9010_vendor_modify_bank" modelaction="insert"/>
        <a:link id="pur9010_vendor_modify_header_delete_link" model="pur.PUR9050.pur9010_vendor_modify" modelaction="delete"/>
        <a:link id="pur9010_vendor_modify_header_submit_link" model="pur.PUR9050.pur9010_vendor_modify" modelaction="execute"/>
        <a:link id="pur9010_vendor_modify_header_save_link" model="pur.PUR9050.pur9010_vendor_modify" modelaction="insert"/>
        <a:link id="pur9010_vendor_contract_delete_link" model="pur.PUR9050.pur9050_basic_contract_query" modelaction="batch_update"/>
        <a:link id="pur9050_vendor_modify_bank_query_link" model="pur.PUR9050.pur9050_vendor_modify_bank_temp" modelaction="query"/>
        <a:link id="pur9050_vendor_modify_address_query_link" model="pur.PUR9050.pur9050_vendor_modify_address_temp" modelaction="query"/>
        <a:link id="pur9050_vendor_modify_supply_query_link" model="pur.PUR9050.pur9050_vendor_modify_supply_temp" modelaction="query"/>
        <a:link id="pur9050_vendor_modify_ou_query_link" model="pur.PUR9050.pur9050_vendor_modify_ou_temp" modelaction="query"/>
        <a:link id="pur_vendor_modify_DocumentViewAttachmentFileDownload_link" url="${/request/@context_path}/uploadFile.screen"/>
        <script><![CDATA[
            var create_flag = 'Y';
            
            var vendor_desc_flag = 'N';
            var currency_code_flag = 'N'; //币种
            var payment_method_flag = 'N'; //付款方式
            var account_period_flag = 'N';
            var tax_type_flag = 'N';
            var address_ds_flag = 'N';
            var account_ds_flag = 'N';
            
            
            function pur9010_vendor_modify_query() {
                $('pur9010_vendor_modify_header_ds').query();
            }
            
            function pur9010_vendor_modify_bank_query() {
                $('pur9010_vendor_modify_account_ds').query();
            }
            
            function pur9010_compareDate(start, end) {
                if (typeof(start) == 'string') {
                    start = new Date(start.replace(/-/g, "/"));
                }
            
                if (typeof(end) == 'string') {
                    end = new Date(end.replace(/-/g, "/"));
                }
            
                if (start > end) {
                    return false;
                }
                return true;
            }
            
            //日期校验
            
            function pur9010_founding_dateValidator(record, name, value) {
                if (name == 'business_license_end_date') {
                    var business_license_end_date = record.get('business_license_end_date');
                    var start = new Date();
                    if (!pur9010_compareDate(start, business_license_end_date)) {
                        return '营业期限不能早于当前日期！';
                    }
                    return true;
                }
                if (name == 'iso14000_flag_end_date') {
                    var iso14000_flag_end_date = record.get('iso14000_flag_end_date');
                    var start2 = new Date();
                    if (!pur9010_compareDate(start2, iso14000_flag_end_date)) {
                        return 'ISO14000有效期不能早于当前日期！';
                    }
                    return true;
                }
                if (name == 'iso9001_flag_end_date') {
                    var iso9001_flag_end_date = record.get('iso9001_flag_end_date');
                    var start3 = new Date();
                    if (!pur9010_compareDate(start3, iso9001_flag_end_date)) {
                        return 'ISO9001不能早于当前日期！';
                    }
                    return true;
                }
            }
            
            function init() {
                // var tar1 = document.getElementById('pur9050_iso14000_hBox');
                // tar1.style.display = 'none';
                // var tar2 = document.getElementById('pur9050_iso9001_hBox');
                // tar2.style.display = 'none';
                if (create_flag == 'Y') {
                    $('pur9010_vendor_modify_header_ds').create();
                }
                document.getElementById('pur9050_line_attache_img').style.visibility = "hidden";
                // document.getElementById('pur9050_company_authorise_attache_img').style.visibility = "hidden";
                // document.getElementById('pur9050_business_license_attache_img').style.visibility = "hidden";
                // document.getElementById('pur9050_iso14000_attache_img').style.visibility = "hidden";
                // document.getElementById('pur9050_iso9001_attache_img').style.visibility = "hidden";
            
                var record = $('pur9010_vendor_modify_header_ds').getCurrentRecord();
                record.set('vendor_id', '${/model/pur9050_default_data/record/@vendor_id}');
                //record.set('owner_company_id', '${/model/pur9050_default_data/record/@owner_company_id}');
                // record.set('owner_business_group', '${/model/pur9050_default_data/record/@owner_business_group}');
                record.set('coop_business_group', '${/model/pur9050_default_data/record/@business_group}');
                record.set('coop_company_id', '${/model/pur9050_default_data/record/@vendor_id}');
                record.set('vendor_desc', '${/model/pur9050_default_data/record/@vendor_name}');
                record.set('contact_name', '${/model/pur9050_default_data/record/@contact_name}');
                record.set('position', '${/model/pur9050_default_data/record/@position}');
                record.set('id_type', '${/model/pur9050_default_data/record/@id_type}');
                record.set('id_type_desc', '${/model/pur9050_default_data/record/@id_type_desc}');
                record.set('id_number', '${/model/pur9050_default_data/record/@id_number}');
                record.set('mobile_phone', '${/model/pur9050_default_data/record/@mobile_phone}');
                record.set('email', '${/model/pur9050_default_data/record/@email}');
                record.set('account_period', '${/model/pur9050_default_data/record/@account_period}');
                record.set('account_period_desc', '${/model/pur9050_default_data/record/@account_period_desc}');
            
                record.set('currency_code', '${/model/pur9050_default_data/record/@currency_code}');
                record.set('trade_currency_code', '${/model/pur9050_default_data/record/@trade_currency_code}');
                record.set('payment_method_name', '${/model/pur9050_default_data/record/@payment_method_name}');
                record.set('payment_method_code', '${/model/pur9050_default_data/record/@payment_method_code}');
                record.set('financial_represent_name', '${/model/pur9050_default_data/record/@financial_represent_name}');
                record.set('finance_rep_position', '${/model/pur9050_default_data/record/@finance_rep_position}');
                record.set('finance_rep_identity_type', '${/model/pur9050_default_data/record/@finance_rep_identity_type}');
                record.set('finance_rep_identity_desc', '${/model/pur9050_default_data/record/@finance_rep_identity_desc}');
                record.set('finance_rep_identity_num', '${/model/pur9050_default_data/record/@finance_rep_identity_num}');
                record.set('financial_represent_phone', '${/model/pur9050_default_data/record/@financial_represent_phone}');
                record.set('financial_represent_mail', '${/model/pur9050_default_data/record/@financial_represent_mail}');
                
                record.set('financial_represent_name_t', '${/model/pur9050_default_data/record/@financial_represent_name_t}');
                record.set('finance_rep_position_t', '${/model/pur9050_default_data/record/@finance_rep_position_t}');
                record.set('finance_rep_identity_type_t', '${/model/pur9050_default_data/record/@finance_rep_identity_type_t}');
                record.set('finance_rep_identity_desc_t', '${/model/pur9050_default_data/record/@finance_rep_identity_desc_t}');
                record.set('finance_rep_identity_num_t', '${/model/pur9050_default_data/record/@finance_rep_identity_num_t}');
                record.set('financial_represent_phone_t', '${/model/pur9050_default_data/record/@financial_represent_phone_t}');
                record.set('financial_represent_mail_t', '${/model/pur9050_default_data/record/@financial_represent_mail_t}');
                
                record.set('financial_represent_name_h', '${/model/pur9050_default_data/record/@financial_represent_name_h}');
                record.set('finance_rep_position_h', '${/model/pur9050_default_data/record/@finance_rep_position_h}');
                record.set('finance_rep_identity_type_h', '${/model/pur9050_default_data/record/@finance_rep_identity_type_h}');
                record.set('finance_rep_identity_desc_h', '${/model/pur9050_default_data/record/@finance_rep_identity_desc_h}');
                record.set('finance_rep_identity_num_h', '${/model/pur9050_default_data/record/@finance_rep_identity_num_h}');
                record.set('financial_represent_phone_h', '${/model/pur9050_default_data/record/@financial_represent_phone_h}');
                record.set('financial_represent_mail_h', '${/model/pur9050_default_data/record/@financial_represent_mail_h}');
            
                record.set('tax_type_id', '${/model/pur9050_default_data/record/@tax_type_id}');
                record.set('tax_type_name', '${/model/pur9050_default_data/record/@tax_type_name}');
            
                record.set('business_group_name_id', '${/model/pur9050_default_data/record/@business_group_name_id}');
                record.set('business_group_name', '${/model/pur9050_default_data/record/@business_group_name}');
                var modify_status = record.get('modify_status');
                var vendor_modify_id = '${/parameter/@vendor_modify_id}';
                if (modify_status != 'NEW') {
                    /* $('pur9010_vendor_modify_save_btn').disable();
                     $('pur9010_vendor_modify_submit_btn').disable();
                     $('pur9010_vendor_modify_delete_btn').disable(); */
                    /* record.getField('created_by_desc').setReadOnly(true);
                     record.getField('vendor_desc').setReadOnly(true);
                     record.getField('contact_name').setReadOnly(true); */
                    //record.getField('position').setReadOnly(true);
                    /* record.getField('id_type_desc').setReadOnly(true);
                     record.getField('id_number').setReadOnly(true);
                     record.getField('mobile_phone').setReadOnly(true);
                     record.getField('email').setReadOnly(true); */
                }
            }
            
            //保存
            
            function pur9010_vendor_modify_save() {
                var record = $('pur9010_vendor_modify_header_ds').getAt(0);
                var data = record.data;
                var records = $('pur9010_vendor_modify_account_ds').getAll();
                var supply = $('pur9010_vendor_modify_supply_ds').getAll();
                if (records.length != 0) {
            
                    var count = 0;
                    for (var j = 0;j < records.length;j++) {
                        var primary_account_flag = records[j].get('primary_account_flag');
                        if (primary_account_flag == 'Y') {
                            count++;
                        }
                    }
                    for (var i = 0;i < records.length;i++) {
                        var v_count = 0;
                        var payment_method_code = records[i].get('payment_method_code');
                        var currency_code = records[i].get('currency_code');
                        for (var k = 0;k < records.length;k++) {
                            if ((records[k].get('payment_method_code') == payment_method_code) && (records[k].get('currency_code') == currency_code)) {
                                v_count++;
                            }
                        }
            
                        if (v_count > 1) {
                            Aurora.showMessage('${l:PROMPT}', '同一付款方式同一币种下只允许存在一条银行账户信息，请检查！');
                            return;
                        }
                    }
            
                    if (count == 0) {
                        Aurora.showMessage('${l:PROMPT}', '银行信息必须有一个主账户，不能保存！');
                        return;
                    }
                    if (count > 1) {
                        Aurora.showMessage('${l:PROMPT}', '银行信息有多个主账户，不能保存！');
                        return;
                    }
                }
            
                
                
                 var record_con = $('pur9050_vendor_create_contract_ds').getAll();
                 if(!$('pur9050_vendor_create_contract_ds').validate()){
                    return ;
                }
                 //Aurora.showErrorMessage('${l:PROMPT}', '有且仅有一个主跟单员和业务负责人');
                var role_flag=false;
                var count2=0;
                var count1=0;
                for (var i = 0;i < record_con.length;i++) {
                    if(record_con[i].get('user_role')=='业务负责人'){
                        count2++;
                    }
                    if(record_con[i].get('user_role')=='主跟单员'){
                        count1++;
                    } 
                }
                if(count2!=1||count1!=1){
                      Aurora.showErrorMessage('${l:PROMPT}', '主跟单员与业务负责人必须维护，且每个角色只能维护一个人');
                      return ;
                } 
                // if (supply.length <= 0) {
                // Aurora.showMessage('${l:PROMPT}', '请至少新增一条品类数据！');
                // return;
                // }
                var kw_pcb = record.get('kw_pcb');
                var kw_fpc = record.get('kw_fpc');
                var kw_mpcb = record.get('kw_mpcb');
                if (kw_pcb == 'N' && kw_fpc == 'N' && kw_mpcb == "N") {
                    Aurora.showMessage('${l:PROMPT}', '${l:请至少勾选一项景旺产品线！}', null);
                    return;
                }
                if ($('pur9010_vendor_modify_header_ds').validate()) {
                    if (!$('pur9010_vendor_modify_account_ds').validate()) {
                        return;
                    }
                    if (!$('pur9010_vendor_modify_address_ds').validate()) {
                        return;
                    }
                    if (!$('pur9010_vendor_modify_supply_ds').validate()) {
                        return;
                    }
                    if ($('pur9010_vendor_modify_address_ds').isModified()) {
                        address_ds_flag = 'Y';
                    } else {
                        address_ds_flag = 'N';
                    }
                    if ($('pur9010_vendor_modify_account_ds').isModified()) {
                        account_ds_flag = 'Y';
                    } else {
                        account_ds_flag = 'N';
                    }
                    if (vendor_desc_flag == 'Y' && address_ds_flag == 'Y') {
                        Aurora.showMessage('${l:PROMPT}', '${l:无法同时变更公司名称与地址，请重新走准入流程！}', null);
                        return;
                    }
                    debugger;
                    data['account_ds_flag'] = account_ds_flag;
                    data['vendor_desc_flag'] = vendor_desc_flag;
                    data['account_period_flag'] = account_period_flag;
                    data['tax_type_flag'] = tax_type_flag;
                    data['address_ds_flag'] = address_ds_flag;
                    data['currency_code_flag'] = currency_code_flag; //币种
                    data['payment_method_flag'] = payment_method_flag; //付款方式
            
            
                    Aurora.Masker.mask(Ext.getBody());
                    Aurora.request({
                        url: $('pur9010_vendor_modify_header_save_link').getUrl(),
                        para: data,
                        success: function(res) {
                            create_flag = 'N';
                            var vendor_modify_id = res.result.vendor_modify_id;
                            var vendor_id = res.result.vendor_id;
                            pur9010_vendor_bank_save(vendor_modify_id, vendor_id);
                            pur9010_vendor_address_save(vendor_modify_id, vendor_id);
                            pur9010_vendor_supply_save(vendor_modify_id, vendor_id);
                            pur9010_vendor_attach_save(vendor_modify_id, vendor_id);
                            pur9010_vendor_contract_save(vendor_modify_id, vendor_id);
                            // pur9010_vendor_ou_save(vendor_modify_id, vendor_id);
                            Aurora.Masker.unmask(Ext.getBody());
                            Aurora.showMessage('${l:PROMPT}', '${l:保存成功}', null);
                            // $('pur9010_vendor_modify_header_ds').setQueryParameter('vendor_modify_id', vendor_modify_id);
                            //pur9010_vendor_modify_query();
            
                            // $('pur9010_vendor_modify_account_ds').setQueryUrl($('pur9050_vendor_modify_bank_query_link').getUrl());
                            // $('pur9010_vendor_modify_account_ds').setQueryParameter('vendor_modify_id', vendor_modify_id);
                            // $('pur9010_vendor_modify_account_ds').query();
            
                            // $('pur9010_vendor_modify_address_ds').setQueryUrl($('pur9050_vendor_modify_address_query_link').getUrl());
                            // $('pur9010_vendor_modify_address_ds').setQueryParameter('vendor_modify_id', vendor_modify_id);
                            // $('pur9010_vendor_modify_address_ds').query();
            
                            // $('pur9010_vendor_modify_supply_ds').setQueryUrl($('pur9050_vendor_modify_supply_query_link').getUrl());
                            // $('pur9010_vendor_modify_supply_ds').setQueryParameter('vendor_modify_id', vendor_modify_id);
                            // $('pur9010_vendor_modify_supply_ds').query();
            
            
                            // $('pur9050_companySupplierAttachments_ds').setQueryParameter('vendor_modify_id', vendor_modify_id);
                            // $('pur9050_companySupplierAttachments_ds').query();
            
                            pur9010_vendor_modify_back();
                            // $('pur9010_vendor_modify_ou_ds').setQueryUrl($('pur9050_vendor_modify_ou_query_link').getUrl());
                            // $('pur9010_vendor_modify_ou_ds').setQueryParameter('vendor_modify_id', vendor_modify_id);
                            // $('pur9010_vendor_modify_ou_ds').query();
            
                        },
                        failure: function(args) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        error: function(args) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        async: false,
                        scope: this
                    });
                }
            }
            
            function pur9010_vendor_modify_header_ds_updateFcn(ds, record, name, value, oldvalue) {
            
                if (name == 'vendor_desc') {
                    var vendor_desc = '${/model/pur9050_default_data/record/@vendor_name}';
                    if (value == vendor_desc) {
                        vendor_desc_flag = 'N';
                    } else {
                        vendor_desc_flag = 'Y';
                    }
                } else if (name == 'currency_code') {
                    debugger;
                    var currency_code = '${/model/pur9050_default_data/record/@currency_code}';
                    if (value == currency_code) {
                        currency_code_flag = 'N';
                    } else {
                        currency_code_flag = 'Y';
                    }
                } else if (name == 'payment_method_code') {
                    var payment_method_code = '${/model/pur9050_default_data/record/@payment_method_code}';
                    if (value == payment_method_code) {
                        payment_method_flag = 'N';
                    } else {
                        payment_method_flag = 'Y';
                    }
                } else if (name == 'account_period_desc') {
                    var account_period_desc = '${/model/pur9050_default_data/record/@account_period_desc}';
                    if (value == account_period_desc) {
                        account_period_flag = 'N';
                    } else {
                        account_period_flag = 'Y';
                    }
                } else if (name == 'tax_type_name') {
                    var tax_type_name = '${/model/pur9050_default_data/record/@tax_type_name}';
                    if (value == tax_type_name) {
                        tax_type_flag = 'N';
                    } else {
                        tax_type_flag = 'Y';
                    }
                } else if (name == 'business_license_forever') {
                    if (value == 'Y') {
                        record.set('business_license_end_date', '');
                        record.getField('business_license_end_date').setReadOnly(true);
                    } else {
                        record.getField('business_license_end_date').setReadOnly(false);
                    }
                } else if (name == 'iso14000_flag') {
                    var tar = document.getElementById('pur9050_iso14000_hBox');
                    if (value == 'Y') {
                        tar.style.display = 'block';
                        record.getField('iso14000_flag_end_date').setRequired(true);
                    } else {
                        record.set('iso14000_flag_end_date', '');
                        record.getField('iso14000_flag_end_date').setRequired(false);
                        tar.style.display = 'none';
                    }
                } else if (name == 'iso9001_flag') {
                    var tar = document.getElementById('pur9050_iso9001_hBox');
                    if (value == 'Y') {
                        tar.style.display = 'block';
                        record.getField('iso9001_flag_end_date').setRequired(true);
                    } else {
                        record.set('iso9001_flag_end_date', '');
                        record.getField('iso9001_flag_end_date').setRequired(false);
                        tar.style.display = 'none';
                    }
                }
            }
            //提交
            
            
            function pur9010_vendor_modify_submit() {
                var record = $('pur9010_vendor_modify_header_ds').getAt(0);
                var data = record.data;
                var vendor_modify_id = record.get('vendor_modify_id');
                var stage_code = record.get('stage_code');
                if (vendor_modify_id) {
                    Aurora.showConfirm('${l:PROMPT}', '确定提交？', function() {
                        if ($('pur9010_vendor_modify_header_ds').validate()) {
                            //如果该供应商为非合格供应商则不能进行信息变更提交
                            // if (stage_code != 'QUALIFIED') {
                            // Aurora.showMessage('${l:PROMPT}', '${l:非合格供应商不能发起信息变更！}', null);
                            // return;
                            // }
                            //当地址和名称同时变更，增加提醒功能：需重新走准入流程
                            var ds = $('pur9010_vendor_modify_address_ds');
                            // if (vendor_desc_flag == 'Y' && address_ds_flag == 'Y') {
                            // Aurora.showMessage('${l:PROMPT}', '${l:无法同时变更公司名称与地址，请重新走准入流程！}', null);
                            // return;
                            // }
                            Aurora.Masker.mask(Ext.getBody());
                            Aurora.request({
                                url: $('pur9010_vendor_modify_header_submit_link').getUrl() + '?vendor_modify_id=' + vendor_modify_id,
                                para: data,
                                success: function(res) {
                                    Aurora.Masker.unmask(Ext.getBody());
                                    Aurora.showMessage('${l:PROMPT}', '${l:提交成功}', null);
                                    $('pur9010_vendor_modify_create').close();
                                },
                                failure: function(args) {
                                    Aurora.Masker.unmask(Ext.getBody());
                                },
                                error: function(args) {
                                    Aurora.Masker.unmask(Ext.getBody());
                                },
                                scope: this
                            });
                        }
                    });
                } else {
                    Aurora.showMessage('${l:PROMPT}', '${l:请先保存数据}', null);
                }
            }
            
            function pur9050_addressesCellClick_fun(grid, row, name, record) {
                //国家、地区、城市级联更新
                if (Ext.isEmpty(record.get('country_code_desc')) || record.get('country_code_desc') == undefined) {
                    record.set('country_code', '');
                    record.getField("province_desc").setLovService('');
                    record.getField("city_desc").setLovService('');
            
                    record.getField('province_desc').setReadOnly(true);
                    record.getField('city_desc').setReadOnly(true);
                } else {
                    var temp_string = record.get('country_code');
                    record.getField("city_desc").setLovService('');
                    record.getField("province_desc").setLovService('public.fnd_region_province_lov');
                    record.getField("province_desc").setLovPara('country_code', temp_string);
            
                    record.getField('province_desc').setReadOnly(false);
                }
                if (Ext.isEmpty(record.get('province_desc')) || record.get('province_desc') == undefined) {
                    record.set('province_id', '');
                    record.getField("city_desc").setLovService('');
            
                    record.getField('city_desc').setReadOnly(true);
                } else {
                    record.getField("city_desc").setLovService('public.fnd_region_city_lov');
                    record.getField("city_desc").setLovPara('province_id', record.get('province_id'));
                    record.getField('city_desc').setReadOnly(false);
                }
            
            }
            //银行tab点击事件
            
            
            function pur9050_manufacturer_accountsCellClick_fun(grid, row, name, record) {
                //银行、开户行名称级联更新
                if (Ext.isEmpty(record.get('bank_code_desc')) || record.get('bank_code_desc') == undefined) {
                    record.set('bank_code', '');
                    record.getField("bank_branch_name").setLovService('');
            
                    record.getField('bank_branch_name').setReadOnly(true);
                } else {
                    var temp_string = record.get('bank_code');
                    record.getField("bank_branch_name").setLovService('public.csh_bank_branchs_lov');
                    record.getField("bank_branch_name").setLovPara('bank_code', temp_string);
            
                    record.getField('bank_branch_name').setReadOnly(false);
                }
            }
            //删除
            
            function pur9010_vendor_modify_delete() {
                var record = $('pur9010_vendor_modify_header_ds').getAt(0);
                var data = record.data;
                var vendor_modify_id = record.get('vendor_modify_id');
            
                Aurora.showConfirm('${l:PROMPT}', '确定删除？', function() {
                    if (typeof(vendor_modify_id) == 'undefined') {
                        Aurora.showMessage('${l:PROMPT}', '${l:删除成功}', null);
                        $('pur9010_vendor_modify_create').close();
                    }
                    if ($('pur9010_vendor_modify_header_ds').validate()) {
                        Aurora.Masker.mask(Ext.getBody());
                        Aurora.request({
                            url: $('pur9010_vendor_modify_header_delete_link').getUrl() + '?vendor_modify_id=' + vendor_modify_id,
                            para: data,
                            success: function(res) {
                                Aurora.Masker.unmask(Ext.getBody());
                                Aurora.showMessage('${l:PROMPT}', '${l:删除成功}', null);
                                $('pur9010_vendor_modify_create').close();
                            },
                            scope: this
                        });
                    }
                });
            }
            
            //银行保存
            
            function pur9010_vendor_bank_save(vendor_modify_id, vendor_id) {
            
                var record = $('pur9010_vendor_modify_account_ds').getAll();
                var datas = [];
                for (var i = 0;i < record.length;i++) {
                    var modify_flag = 'N';
                    if (record[i].isNew || record[i].dirty) {
                        modify_flag = 'Y';
                    }
                    var data = record[i].data;
                    data.company_id = vendor_id;
                    data.c_attribute4 = modify_flag;
                    //var vendor_modify_id = $('pur9010_vendor_modify_header_ds').getAt(0).get('vendor_modify_id');
            
                    if ($('pur9010_vendor_modify_account_ds').validate()) {
                        Aurora.request({
                            url: $('pur9010_vendor_modify_bank_save_link').getUrl() + '?vendor_modify_id=' + vendor_modify_id,
                            para: data,
                            success: function(res) {
                                //Aurora.showMessage('${l:PROMPT}', '保存成功！');
                                //pur9010_vendor_modify_bank_query();
                            },
                            scope: this
                        });
                    }
                }
            
            
            }
            
            //银行删除
            
            
            function pur9010_vendor_bank_delete() {
                var ds = $('pur9010_vendor_modify_account_ds');
                var records = $('pur9010_vendor_modify_account_ds').getSelected();
                if (records.length == 0) {
                    Aurora.showMessage('${l:PROMPT}', '请选择一行数据！');
                    return;
                }
                for (var j = 0;j < records.length;j++) {
                    ds.remove(records[j]);
                }
                for (var i = 0;i < records.length;i++) {
                    var data = {};
                    data.account_id = records[i].get('account_id');
                    data.vendor_modify_id = records[i].get('vendor_modify_id');
                    Aurora.Masker.mask(Ext.getBody());
                    Aurora.request({
                        url: $('pur9010_vendor_modify_bank_delete_link').getUrl(),
                        para: data,
                        success: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        failure: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        error: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        scope: this
                    });
                }
            }
            
            //地址保存
            
            function pur9010_vendor_address_save(vendor_modify_id, vendor_id) {
                var record = $('pur9010_vendor_modify_address_ds').getAll();
                for (var i = 0;i < record.length;i++) {
                    var modify_flag = 'N';
                    if (record[i].isNew || record[i].dirty) {
                        modify_flag = 'Y';
                    }
                    var data = record[i].data;
                    data.company_id = vendor_id;
                    data.c_attribute1 = modify_flag;
                    //var vendor_modify_id = $('pur9010_vendor_modify_header_ds').getAt(0).get('vendor_modify_id');
            
                    if ($('pur9010_vendor_modify_address_ds').validate()) {
                        Aurora.request({
                            url: $('pur9010_vendor_modify_address_save_link').getUrl() + '?vendor_modify_id=' + vendor_modify_id,
                            para: data,
                            success: function(res) {
                                // Aurora.showMessage('${l:PROMPT}', '保存成功！');
                                //$('pur9010_vendor_modify_address_ds').query();
                            },
                            scope: this
                        });
                    }
                }
            }
            
            //地址删除
            
            function pur9010_vendor_address_delete() {
                var ds = $('pur9010_vendor_modify_address_ds');
                var records = $('pur9010_vendor_modify_address_ds').getSelected();
                if (records.length == 0) {
                    Aurora.showMessage('${l:PROMPT}', '请选择一行数据！');
                    return;
                }
                for (var j = 0;j < records.length;j++) {
                    ds.remove(records[j]);
                }
                for (var i = 0;i < records.length;i++) {
                    var data = {};
                    data.address_id = records[i].get('address_id');
                    data.vendor_modify_id = records[i].get('vendor_modify_id');
                    Aurora.Masker.mask(Ext.getBody());
                    Aurora.request({
                        url: $('pur9010_vendor_modify_address_delete_link').getUrl(),
                        para: data,
                        success: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        failure: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        error: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        scope: this
                    });
                }
            
            }
            //新增附件保存
            
            
            function pur9010_vendor_attach_save(vendor_modify_id, vendor_id) {
                var record = $('pur9050_companySupplierAttachments_ds').getAll();
                // if (record.length <= 0) {
                // Aurora.showMessage('${l:PROMPT}', '请至少新增一条品类数据！');
                // return;
                // }
                for (var i = 0;i < record.length;i++) {
                    var data = record[i].data;
                    data.company_id = vendor_id;
            
                    if ($('pur9050_companySupplierAttachments_ds').validate()) {
                        Aurora.request({
                            url: $('pur9010_vendor_modify_attach_save_link').getUrl() + '?vendor_modify_id=' + vendor_modify_id,
                            para: data,
                            success: function(res) {},
                            scope: this
                        });
                    }
                }
            }
            //新增品类保存
            
            function pur9010_vendor_supply_save(vendor_modify_id, vendor_id) {
                var record = $('pur9010_vendor_modify_supply_ds').getAll();
                // if (record.length <= 0) {
                // Aurora.showMessage('${l:PROMPT}', '请至少新增一条品类数据！');
                // return;
                // }
                for (var i = 0;i < record.length;i++) {
                    var data = record[i].data;
                    data.company_id = vendor_id;
            
                    if ($('pur9010_vendor_modify_supply_ds').validate()) {
                        Aurora.request({
                            url: $('pur9010_vendor_modify_supply_save_link').getUrl() + '?vendor_modify_id=' + vendor_modify_id,
                            para: data,
                            success: function(res) {},
                            scope: this
                        });
                    }
                }
            }
            
            
              function pur9010_vendor_contract_save(vendor_modify_id, vendor_id) {
                var record = $('pur9050_vendor_create_contract_ds').getAll();
                var data=[];
                if(!$('pur9050_vendor_create_contract_ds').validate()){
                    return ;
                }
               
               
                for (var i = 0;i < record.length;i++) {
                 
                  
                    console.log(record[i].get('flag'));
                     if(record[i].get('flag')=='Y'){
                         record[i].set('change_flag','Y');
                     }else{
                         record[i].set('change_flag','N');
                     }
                    //data.company_id = vendor_id;
                       record[i].set('_status','insert');
                       record[i].set('vendor_modify_id',vendor_modify_id);
                       data.push(record[i].data);  
                    
                }
                
                
                
                 Aurora.request({
		        	        url:$('pur9010_vendor_modify_contact_save_link').getUrl(),
		        	        para:data,
		        	        success:function(){
	        	                
		        	        },
		        	        failure:function(){
		        	        	Aurora.Masker.unmask(Ext.getBody()); 	    
		        	        },
		        	        error:function(){
		        	        	Aurora.Masker.unmask(Ext.getBody()); 	    
		        	        },
		        	        scope:this
		        	    }); 
            }
            //新增品类删除
            
            function pur9010_vendor_supply_delete() {
                var ds = $('pur9010_vendor_modify_supply_ds');
                var records = $('pur9010_vendor_modify_supply_ds').getSelected();
                if (records.length == 0) {
                    Aurora.showMessage('${l:PROMPT}', '请选择一行数据！');
                    return;
                }
                for (var j = 0;j < records.length;j++) {
                    ds.remove(records[j]);
                }
                for (var i = 0;i < records.length;i++) {
                    var data = {};
                    data.ability_lns_id = records[i].get('ability_lns_id');
                    data.vendor_modify_id = records[i].get('vendor_modify_id');
                    Aurora.Masker.mask(Ext.getBody());
                    Aurora.request({
                        url: $('pur9010_vendor_modify_supply_delete_link').getUrl(),
                        para: data,
                        success: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        failure: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        error: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        scope: this
                    });
                }
            }
            
            //新增业务实体
            
            function pur9010_vendor_ou_save(vendor_modify_id, vendor_id) {
                var record = $('pur9010_vendor_modify_ou_ds').getAll();
                if (record.length <= 0) {
                    Aurora.showMessage('${l:PROMPT}', '请至少新增一条业务实体数据！');
                    return;
                }
                for (var i = 0;i < record.length;i++) {
                    var data = record[i].data;
                    data.company_id = vendor_id;
            
                    if ($('pur9010_vendor_modify_ou_ds').validate()) {
                        Aurora.request({
                            url: $('pur9010_vendor_modify_ou_save_link').getUrl() + '?vendor_modify_id=' + vendor_modify_id,
                            para: data,
                            success: function(res) {},
                            scope: this
                        });
                    }
                }
            }
            //业务实体删除
            
           /*     function pur9050_manufacturer_contact_grid_renderer(value, record, name) {
                if (!check_require_ds_is_empty()) {
                    var require_record = $('pur5730_vendor_survey_require_ds').getAt(0);
                    if (name == 'contact_name') {
                        set_required(record, name, require_record.get('contact_name'));
                    }
                    if (name == 'contact_sex_name') {
                        set_required(record, name, require_record.get('contact_sex'));
                    }
                    if (name == 'id_type') {
                        set_required(record, name, require_record.get('contact_id_type'));
                    }
                    if (name == 'id_number') {
                        set_required(record, name, require_record.get('contact_id_number'));
                    }
                    if (name == 'department') {
                        set_required(record, name, require_record.get('contact_department'));
                    }
                    if (name == 'position') {
                        set_required(record, name, require_record.get('contact_position'));
                    }
                    if (name == 'mobile_phone') {
                        set_required(record, name, require_record.get('contact_mobile_phone'));
                    }
                    if (name == 'telephone') {
                        set_required(record, name, require_record.get('contact_telephone'));
                    }
                    if (name == 'email') {
                        set_required(record, name, require_record.get('contact_email'));
                    }
                    if (name == 'c_attribute1') {
                        set_required(record, name, require_record.get('contact_c_attribute1'));
                    }
                    if (name == 'comments') {
                        set_required(record, name, require_record.get('contact_comments'));
                    }
                }
                return value;
            } */
            
            function pur9010_vendor_ou_delete() {
                var ds = $('pur9010_vendor_modify_ou_ds');
                var records = $('pur9010_vendor_modify_ou_ds').getSelected();
                if (records.length == 0) {
                    Aurora.showMessage('${l:PROMPT}', '请选择一行数据！');
                    return;
                }
                for (var j = 0;j < records.length;j++) {
                    ds.remove(records[j]);
                }
                for (var i = 0;i < records.length;i++) {
                    var data = {};
                    data.business_unit_id = records[i].get('business_unit_id');
                    data.vendor_modify_id = records[i].get('vendor_modify_id');
                    Aurora.Masker.mask(Ext.getBody());
                    Aurora.request({
                        url: $('pur9010_vendor_modify_ou_delete_link').getUrl(),
                        para: data,
                        success: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        failure: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        error: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        scope: this
                    });
                }
            }
            
            function pur9010_vendor_modify_back() {
                $('pur9010_vendor_modify_create').close();
            }
            
            
            //银行信息级联
            
            function pur5730_vendor_survey_manufacturer_account_tab_ds_updateFun(dataSet, record, name, value, oldvalue) {
                if (name == 'bank_code') {
                    if (value != null && value != 'undefined' && value != '') {
                        record.getField('bank_branch_name').setLovPara('bank_code', record.get('bank_code'));
                    } else {
                        record.set('bank_branch_name', '');
                    }
                }
            }
            
            function pur5730_vendor_survey_manufacturer_account_tab_ds_loadFun(dataSet) {
                var records = dataSet.getAll();
                if (records.length != 0) {
                    for (var i = 0;i < records.length;i++) {
                        records[i].getField('bank_branch_name').setLovPara('bank_code', records[i].get('bank_code'));
                    }
                }
            }
            
            function pur9050_openUploadAttachmentFun(value, record, name) {
                var counts1 = record.get('counts1');
                var counts2 = record.get('counts2');
                var counts3 = record.get('counts3');
                var counts4 = record.get('counts4');
                var counts5 = record.get('counts5');
                if (record.get('vendor_modify_id')) {
                    if (name == 'line_attachment') {
                        if (counts1 == 0) {
                            document.getElementById('pur9050_line_attache_img').style.visibility = "hidden";
                        } else {
                            document.getElementById('pur9050_line_attache_img').style.visibility = "visible";
                        }
                        return '<a href="javascript:pur9050_UploadAttachmentFun(' + record.get('vendor_modify_id') + ')">' + '上传附件' + '</a>';
                    }
                    if (name == 'company_authorise') {
                        if (counts2 == 0) {
                            document.getElementById('pur9050_company_authorise_attache_img').style.visibility = "hidden";
                        } else {
                            document.getElementById('pur9050_company_authorise_attache_img').style.visibility = "visible";
                        }
                        return '<a href="javascript:pur9050_UploadAuthoriseAttachmentFun(' + record.get('vendor_modify_id') + ')">' + '上传附件' + '</a>';
                    }
                    if (name == 'business_license') {
                        if (counts3 == 0) {
                            document.getElementById('pur9050_business_license_attache_img').style.visibility = "hidden";
                        } else {
                            document.getElementById('pur9050_business_license_attache_img').style.visibility = "visible";
                        }
                        return '<a href="javascript:pur9050_UploadBusinessAttachmentFun(' + record.get('vendor_modify_id') + ')">' + '上传附件' + '</a>';
                    }
                    if (name == 'iso14000') {
                        if (counts4 == 0) {
                            document.getElementById('pur9050_iso14000_attache_img').style.visibility = "hidden";
                        } else {
                            document.getElementById('pur9050_iso14000_attache_img').style.visibility = "visible";
                        }
                        return '<a href="javascript:pur9050_UploadIso14000AttachmentFun(' + record.get('vendor_modify_id') + ')">' + '上传附件' + '</a>';
                    }
                    if (name == 'iso9001') {
                        if (counts5 == 0) {
                            document.getElementById('pur9050_iso9001_attache_img').style.visibility = "hidden";
                        } else {
                            document.getElementById('pur9050_iso9001_attache_img').style.visibility = "visible";
                        }
                        return '<a href="javascript:pur9050_UploadIso9001AttachmentFun(' + record.get('vendor_modify_id') + ')">' + '上传附件' + '</a>';
                    }
                }
            }
            
            function pur9050_UploadAttachmentFun(vendor_modify_id) {
                new Aurora.Window({
                    url: $('pur_vendor_modify_DocumentViewAttachmentFileDownload_link').getUrl() + '?header_id=' + vendor_modify_id + '&table_name=PUR_VENDOR_MODIFY',
                    title: '${l:ATM.UPLOAD_ATTACHMENT}',
                    id: 'pur9050_po_attm_window',
                    width: 610,
                    height: 500
                });
            }
            
            function pur9050_UploadAuthoriseAttachmentFun(vendor_modify_id) {
                new Aurora.Window({
                    url: $('pur_vendor_modify_DocumentViewAttachmentFileDownload_link').getUrl() + '?header_id=' + vendor_modify_id + '&table_name=FND_COPANIES.COMPANY_AUTHORISE_MODIFY',
                    title: '${l:ATM.UPLOAD_ATTACHMENT}',
                    id: 'pur9050_po_attm_window',
                    width: 610,
                    height: 500
                });
            }
            
            function pur9050_UploadBusinessAttachmentFun(vendor_modify_id) {
                new Aurora.Window({
                    url: $('pur_vendor_modify_DocumentViewAttachmentFileDownload_link').getUrl() + '?header_id=' + vendor_modify_id + '&table_name=FND_COPANIES.BUSINESS_LICENSE_MODIFY',
                    title: '${l:ATM.UPLOAD_ATTACHMENT}',
                    id: 'pur9050_po_attm_window',
                    width: 610,
                    height: 500
                });
            }
            
            function pur9050_UploadIso14000AttachmentFun(vendor_modify_id) {
                new Aurora.Window({
                    url: $('pur_vendor_modify_DocumentViewAttachmentFileDownload_link').getUrl() + '?header_id=' + vendor_modify_id + '&table_name=FND_COPANIES.ISO14000_CERTIFICATE_MODIFY',
                    title: '${l:ATM.UPLOAD_ATTACHMENT}',
                    id: 'pur9050_po_attm_window',
                    width: 610,
                    height: 500
                });
            }
            
            function pur9050_UploadIso9001AttachmentFun(vendor_modify_id) {
                new Aurora.Window({
                    url: $('pur_vendor_modify_DocumentViewAttachmentFileDownload_link').getUrl() + '?header_id=' + vendor_modify_id + '&table_name=FND_COPANIES.ISO9001_CERTIFICATE_MODIFY',
                    title: '${l:ATM.UPLOAD_ATTACHMENT}',
                    id: 'pur9050_po_attm_window',
                    width: 610,
                    height: 500
                });
            }
            
            function pur9050_attachment_ds_submitsuccessFun(dataSet) {
                dataSet.query();
            }
            
            //附件上传和下载
            
            function pur9050_upload_renderer(value, record, name) {
                var attachment_id = record.get('attachment_id'); //附件ID
                var atm_counts = record.get('atm_counts'); //附件数
                if (name == "attachment_id") {
                    if (attachment_id) {
                        return '<a href="javascript:pur9050_attachment_add_fun(' + attachment_id + ')">上传/下载</a>';
                    }
                }
                if (name == "atm_flag") {
                    if (atm_counts > 0) {
                        return '<div style="margin-top:3px;margin-left:auto;margin-right:auto;vertical-align:middle;height:20px;line-height:20px;"><img src="${/request/@context_path}/images/paperclip.png"/></div>';
            
                    } else {
                        return '';
                    }
                }
            }
            
            
            //附件新增
            
            function pur9050_attachment_add_fun(id) {
                new Aurora.Window({
                    id: 'pur9050_attachment_file_upload_link_window',
                    title: '${l:HAP_UPLOAD_TITLE}',
                    url: '${/request/@context_path}/attachment_file_upload.screen?pkvalue=' + id + '&table_name=FND_COM_SUP_ATTACHMENT',
                    width: 610,
                    height: 500
                }).on('close', function() {
                    $('pur9050_companySupplierAttachments_ds').query();
                });
            }
            
            
            function pur9050_bank_branch_ef(record, name) {
                var bank_code = record.get('bank_code');
            
                if (bank_code == 'ABROAD') {
            
                    record.getField('c_attribute1').setReadOnly(false);
            
                    return 'fnd9220_account_tf';
            
                } else {
            
                    record.getField('c_attribute1').setReadOnly(true);
            
                    return 'fnd9220_account_lov';
                }
            }
            
            
              
                function pur9050_vendor_create_contract_update(ds, record, name, value, oldvalue) {
                    debugger;
                      if(name=='contact_name'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                           record.set('contact_name_update_flag','Y');
                      } 
                  }
                  
                  
                  if(name=='position'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                           record.set('position_update_flag','Y');
                      } 
                  }
                  
                  if(name=='user_role'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                           record.set('user_role_update_flag','Y');
                     } 
                  }
                  
                  
                   if(name=='enabled_flag'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                           record.set('enabled_flag_update_flag','Y');
                     } 
                  }
                  
                    if(name=='email'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                            record.set('email_update_flag','Y');
                     } 
                  }
                  
                    if(name=='mobile_phone'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                           record.set('mobile_phone_update_flag','Y');
                     } 
                  }
                  
                   if(name=='id_number'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                           record.set('id_number_update_flag','Y');
                     } 
                  }
                  
               
                  
                   if(name=='id_type_name'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                           record.set('id_type_update_flag','Y');
                     } 
                  }
                  
                  
                    if(name=='contact_sex_name'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                           record.set('contact_sex_update_flag','Y');
                     } 
                  }
                }
            
              function setinitdata_create(ds,record,index){
                  var records=$('pur9050_vendor_create_contract_ds').getAll();
                  var records_h=$('pur9010_vendor_modify_header_ds').getCurrentRecord();
                   record.set('user_role','其他跟单员');
                   record.set('company_id',records_h.get('coop_company_id'));
                   record.set('default_flag','N');
             }
            
            
            function pur9050_vendor_contract_deteteFun() {
                var contact_ds = $('pur9050_vendor_create_contract_ds');
                var records=$('pur9050_vendor_create_contract_ds').getSelected();
                
                 if(records.length==0 || Aurora.isEmpty(records)){
                    Aurora.showMessage('${l:PROMPT}', '请勾选一行操作');
                    return ;
                }
                var para = [];
                 for( var n=0;n<records.length;n++){
                       if(records[n].get('default_flag')=='Y'){
                                  Aurora.showMessage('${l:PROMPT}', '此联系人无法删除');
                                  return ;
                       }
                        /* records[n].set('_status', 'delete');
	        	         para.push(records[n].data); */
	        	         contact_ds.remove(records[n]);
                }
               
               /*  Aurora.request({
                        url: $('pur9010_vendor_contract_delete_link').getUrl(),
                        para: para,
                        success: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        failure: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        error: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        scope: this
                    }); */
            }
            
            
                        
            
        ]]></script>
        <a:dataSets>
            <a:dataSet id="pur9010_vendor_modify_type_ds" lookupCode="MODIFY_TYPE"/>
            <a:dataSet id="pur9010_vendor_modify_status_create_ds" lookupCode="VENDOR_MODIFY_STATUS"/>
            <a:dataSet id="pur9010_vendor_modify_id_type_create_ds" lookupCode="ID_TYPE"/>
            <a:dataSet id="pur9010_account_period_valid_ds" lookupCode="KW_ACCOUNT_PERIOD_VALID"/>
            <a:dataSet id="pur9010_vendor_material_type_ds" lookupCode="VENDOR_MATERIAL_TYPE"/>
            <a:dataSet id="pur9050_vendor_survey_idType_ds" lookupCode="FND_COM_SUP_INFOS.ID_TYPE"/>
            <a:dataSet id="pur9050_vendor_survey_sex_ds" lookupCode="PUR_SEX"/>
            <a:dataSet id="pur9010_manufacturer_payment_method_ds">
                <a:datas dataSource="pur9010_manufacturer_payment_method"/>
            </a:dataSet>
            <a:dataSet id="pur9010_manufacturer_product_group_name_ds">
                <a:datas dataSource="pur9010_manufacturer_product_group"/>
            </a:dataSet>
            <a:dataSet id="pur9050_modify_units_ds">
                <a:datas dataSource="pur9050_modify_units"/>
            </a:dataSet>
            <a:dataSet id="fnd9050_account_period_ds">
                <a:datas dataSource="pur9050_account_period"/>
            </a:dataSet>
            <a:dataSet id="fnd9050_user_role_l_ds">
                <a:datas dataSource="pur9050_user_role_ds"/>
            </a:dataSet>
            <a:dataSet id="pur9050_attachment_type_ds">
                <a:datas dataSource="pur9050_attachment_type"/>
            </a:dataSet>
            <a:dataSet id="pur9010_vendor_modify_header_ds" model="pur.PUR9050.pur9010_vendor_modify" queryUrl="${/request/@context_path}/autocrud/pur.PUR9050.pur9010_vendor_modify/query?vendor_modify_id=${/parameter/@vendor_modify_id}">
                <a:fields>
                    <a:field name="vendor_modify_id"/>
                    <a:field name="modify_num"/>
                    <a:field name="modify_reason" required="true"/>
                    <a:field name="business_license_forever" checkedValue="Y" defaultValue="N" prompt="FND_COMPANY_REGISTED.BUSINESS_LICENSE_FOREVER" uncheckedValue="N"/>
                    <a:field name="iso14000_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="iso9001_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="kw_pcb" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="kw_fpc" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="kw_mpcb" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="business_license_end_date" validator="pur9010_founding_dateValidator"/>
                    <a:field name="iso14000_flag_end_date" validator="pur9010_founding_dateValidator"/>
                    <a:field name="iso9001_flag_end_date" validator="pur9010_founding_dateValidator"/>
                    <a:field name="modify_status" readOnly="true"/>
                    <a:field name="currency_code" lovHeight="510" lovLabelWidth="100" lovService="fnd.FND9100.fnd_currency_code_lov" lovWidth="650" prompt="FND_COMPANY_REGISTED.REGISTERED_CURRENCY_CODE" title="CURRENCY_SELECTION">
                        <a:mapping>
                            <a:map from="currency_code" to="currency_code"/>
                            <a:map from="currency_oa_id" to="trade_currency_code"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="account_period_desc" displayField="flex_desc" options="fnd9050_account_period_ds" returnField="account_period" valueField="flex_value"/>
                    <a:field name="account_period"/>
                    <a:field name="trade_currency_code"/>
                    <a:field name="tax_type_id"/>
                    <a:field name="tax_type_name" lovHeight="500" lovService="pur.PUR5730.pur5730_tax_type_codes_bg_lov?require_business_group=${/model/pur9050_default_data/record/@owner_business_group}" lovWidth="500" prompt="PUR5730.TAX_TYPE_NAME" title="PUR5730.TAX_TYPE_NAME">
                        <a:mapping>
                            <a:map from="tax_type_codes_bg_id" to="tax_type_id"/>
                            <a:map from="tax_type_name" to="tax_type_name"/>
                        </a:mapping>
                    </a:field>
                    <!-- <a:field name="payment_method_name" lovHeight="500" lovService="pur.PUR9050.pur9050_payment_methods_lov" lovWidth="500" prompt="PUR5730.PAYMENT_METHOD_NAME" title="PUR5730.PAYMENT_METHOD_NAME">
                        <a:mapping>
                            <a:map from="payment_method_code" to="payment_method_code"/>
                            <a:map from="description" to="payment_method_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="payment_method_code"/> -->
                    <!-- <a:field name="kw_product_group_name" displayField="flex_desc" options="pur9010_manufacturer_product_group_name_ds" required="true" returnField="kw_product_group" valueField="flex_value"/>
                    <a:field name="kw_product_group"/> -->
                    <a:field name="payment_method_name" displayField="flex_desc" options="pur9010_manufacturer_payment_method_ds" returnField="payment_method_code" valueField="flex_value"/>
                    <a:field name="payment_method_code"/>
                    <a:field name="modify_status_desc" displayField="code_value_name" options="pur9010_vendor_modify_status_create_ds" readOnly="true" returnField="modify_status" valueField="code_value"/>
                    <a:field name="created_by"/>
                    <!-- <a:field name="created_by_desc" autoComplete="true" autoCompleteField="user_id_name" lovGridHeight="330" lovHeight="450" lovService="pur.PUR5690.fnd_sys_users_lov" lovWidth="500" title="创建人">
                        <a:mapping>
                            <a:map from="user_id" to="created_by"/>
                            <a:map from="user_desc" to="created_by_desc"/>
                        </a:mapping>
                    </a:field> -->
                    <a:field name="modify_type"/>
                    <a:field name="modify_type_desc" displayField="code_value_name" options="pur9010_vendor_modify_type_ds" returnField="modify_type" valueField="code_value"/>
                    <a:field name="modify_info"/>
                    <a:field name="vendor_id"/>
                    <a:field name="coop_company_id"/>
                    <a:field name="coop_business_group"/>
                    <a:field name="owner_company_id"/>
                    <a:field name="owner_business_group"/>
                    <a:field name="vendor_desc"/>
                    <a:field name="vendor_contact_id"/>
                    <a:field name="contact_name"/>
                    <a:field name="position"/>
                    <a:field name="id_type"/>
                    <a:field name="id_type_desc" displayField="code_value_name" options="pur9010_vendor_modify_id_type_create_ds" returnField="id_type" valueField="code_value"/>
                    <a:field name="finance_rep_identity_desc" displayField="code_value_name" options="pur9010_vendor_modify_id_type_create_ds" returnField="finance_rep_identity_type" valueField="code_value"/>
                    <a:field name="finance_rep_identity_type"/>
                    <a:field name="finance_rep_identity_desc_t" displayField="code_value_name" options="pur9010_vendor_modify_id_type_create_ds" returnField="finance_rep_identity_type_t" valueField="code_value"/>
                    <a:field name="finance_rep_identity_type_t"/>
                    <a:field name="finance_rep_identity_desc_h" displayField="code_value_name" options="pur9010_vendor_modify_id_type_create_ds" returnField="finance_rep_identity_type_h" valueField="code_value"/>
                    <a:field name="finance_rep_identity_type_h"/>
                    <a:field name="account_period_valid_desc" displayField="code_value_name" options="pur9010_account_period_valid_ds" required="true" returnField="account_period_valid" valueField="code_value"/>
                    <a:field name="account_period_valid"/>
                    <a:field name="vendor_type_desc" displayField="code_value_name" options="pur9010_vendor_material_type_ds" required="true" returnField="vendor_type" valueField="code_value"/>
                    <a:field name="vendor_type"/>
                    <a:field name="id_number"/>
                    <a:field name="mobile_phone"/>
                    <a:field name="email"/>
                    <!-- <a:field name="ou_jxpcb" checkedValue="OU_JXPCB" uncheckedValue="N"/>
                    <a:field name="ou_lcfpc" checkedValue="OU_LCFPC" uncheckedValue="N"/>
                    <a:field name="ou_lcmccl" checkedValue="OU_LCMCCL" uncheckedValue="N"/>
                    <a:field name="ou_lcmpcb" checkedValue="OU_LCMPCB" uncheckedValue="N"/>
                    <a:field name="ou_lcpcb" checkedValue="OU_LCPCB" uncheckedValue="N"/>
                    <a:field name="ou_lcsmt" checkedValue="OU_LCSMT" uncheckedValue="N"/>
                    <a:field name="ou_szfpc" checkedValue="OU_SZFPC" uncheckedValue="N"/>
                    <a:field name="ou_szpcb" checkedValue="OU_SZPCB" uncheckedValue="N"/>
                    <a:field name="ou_zhfpc" checkedValue="OU_ZHFPC" uncheckedValue="N"/>
                    <a:field name="ou_zrfpc" checkedValue="OU_ZRFPC" uncheckedValue="N"/>
                    <a:field name="ou_zrsmt" checkedValue="OU_ZRSMT" uncheckedValue="N"/> -->
                    <!-- <a:field name="corresponding_department" autoComplete="true" autoCompleteField="corresponding_department" lovGridHeight="330" lovHeight="450" lovService="pur.PUR9050.pur9050_unit_code_lov" lovWidth="500" required="true" title="部门">
                        <a:mapping>
                            <a:map from="unit_code" to="unit_code"/>
                            <a:map from="corresponding_department" to="corresponding_department"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="unit_code"/> -->
                    <!-- <a:field name="purchasing_engineer" autoComplete="true" autoCompleteField="purchasing_engineer" lovGridHeight="330" lovHeight="450" lovService="pur.PUR9050.pur9050_employee_code" lovWidth="500" required="true" title="采购工程师">
                        <a:mapping>
                            <a:map from="employee_code" to="employee_code"/>
                            <a:map from="purchasing_engineer" to="purchasing_engineer"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="employee_code"/> -->
                </a:fields>
                <a:events>
                    <a:event name="update" handler="pur9010_vendor_modify_header_ds_updateFcn"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="pur9010_vendor_modify_account_ds" autoQuery="true" model="pur.PUR9050.pur9010_vendor_modify_bank" selectable="true">
                <a:fields>
                    <a:field name="bank_code_desc"/>
                    <a:field name="payment_method_name" lovHeight="500" lovService="pur.PUR9050.pur9050_payment_methods_lov" lovWidth="500" prompt="PUR5730.PAYMENT_METHOD_NAME" title="PUR5730.PAYMENT_METHOD_NAME">
                        <a:mapping>
                            <a:map from="payment_method_id" to="payment_method_id"/>
                            <a:map from="payment_method_code" to="payment_method_code"/>
                            <a:map from="description" to="payment_method_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="payment_method_code"/>
                    <a:field name="currency_code" lovHeight="510" lovLabelWidth="100" lovService="fnd.FND9100.fnd_currency_code_lov" lovWidth="650" prompt="FND_COMPANY_REGISTED.REGISTERED_CURRENCY_CODE" title="CURRENCY_SELECTION">
                        <a:mapping>
                            <a:map from="currency_code" to="currency_code"/>
                            <a:map from="currency_oa_id" to="currency_oa_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="currency_oa_id"/>
                    <a:field name="bank_code" autoComplete="true" autoCompleteField="bank_name" lovGridHeight="330" lovHeight="450" lovService="pur.PUR9050.pur_bank_lov" lovWidth="500" required="true" title="银行信息">
                        <a:mapping>
                            <a:map from="bank_code" to="bank_code"/>
                            <a:map from="bank_name" to="bank_code_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="bank_branch_code"/>
                    <a:field name="bank_branch_name" lovHeight="500" lovWidth="500" readOnly="true" title="开户行名称选择">
                        <a:mapping>
                            <a:map from="branch_name" to="bank_branch_name"/>
                            <a:map from="bank_branch_code" to="c_attribute1"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="c_attribute1" readOnly="true"/>
                    <a:field name="bank_account_name"/>
                    <a:field name="bank_account_number"/>
                    <a:field name="primary_account_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="enabled_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                </a:fields>
                <a:events>
                    <a:event name="update" handler="pur5730_vendor_survey_manufacturer_account_tab_ds_updateFun"/>
                    <a:event name="load" handler="pur5730_vendor_survey_manufacturer_account_tab_ds_loadFun"/>
                </a:events>
            </a:dataSet>
            <!-- <a:dataSet id="pur5721_vendor_site_status_list_ds" loadData="true" model="pur.PUR5721.pur5721_vendor_site_combox"/> -->
            <a:dataSet id="pur9010_vendor_modify_address_ds" autoQuery="true" model="pur.PUR9050.pur9010_vendor_modify_address" selectable="true">
                <a:fields>
                    <a:field name="address_id"/>
                    <a:field name="country_code"/>
                    <a:field name="country_code_desc" lovHeight="500" lovService="public.fnd_country_lov" lovWidth="500" required="true" requiredMessage="${l:FND_COM_SUP_ADDRESSES.COUNTRY_CODE}${l:PROMPT.INPUT}" title="FND_COM_SUP_ADDRESSES.COUNTRY_CODE_CHOOSE">
                        <a:mapping>
                            <a:map from="country_code" to="country_code"/>
                            <a:map from="country_name" to="country_code_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="province_id"/>
                    <a:field name="province_desc" lovHeight="500" lovWidth="500" readOnly="true" title="FND_COM_SUP_ADDRESSES.PROVINCE_CHOOSE">
                        <a:mapping>
                            <a:map from="province_id" to="province_id"/>
                            <a:map from="province_name" to="province_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="city_id"/>
                    <a:field name="city_desc" lovHeight="500" lovWidth="500" readOnly="true" title="FND_COM_SUP_ADDRESSES.CITY_CHOOSE">
                        <a:mapping>
                            <a:map from="city_id" to="city_id"/>
                            <a:map from="city_name" to="city_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="address_detail" required="true" requiredMessage="${l:FND_COM_SUP_ADDRESSES.ADDRESS_DETAIL_ID}${l:PROMPT.INPUT}"/>
                    <a:field name="enabled_flag" checkedValue="Y" defaultValue="Y" uncheckedValue="N"/>
                </a:fields>
            </a:dataSet>
            <a:dataSet id="pur9010_vendor_modify_supply_ds" model="pur.PUR9050.pur9010_vendor_modify_supply" selectable="true">
                <a:fields>
                    <a:field name="category_code" autoComplete="false" autoCompleteField="category_name" lovGridHeight="360" lovHeight="500" lovService="cux.KINWONG.fnd.fnd3010.mtl_category_lov" lovWidth="600" required="true" title="品类查询">
                        <a:mapping>
                            <a:map from="category_code" to="category_code"/>
                            <a:map from="category_name" to="category_name"/>
                            <a:map from="category_udf_id" to="category_udf_id"/>
                        </a:mapping>
                    </a:field>
                </a:fields>
            </a:dataSet>
            <!-- ATTACHMENTS -->
            <a:dataSet id="pur9050_vendor_create_contract_ds" autoQuery="true" model="pur.PUR9050.pur9050_basic_contract_query" queryUrl="${/request/@context_path}/autocrud/pur.PUR9050.pur9050_basic_contract_query/query?company_id=${/parameter/@company_id}" selectable="true">
                <a:fields>
                    <a:field name="contact_id"/>
                    <a:field name="contact_new_id"/>
                    <a:field name="contact_name" required="true" requiredMessage="${l:FND_COM_SUP_CONTACTS.CONTACT_NAME}${l:PROMPT.INPUT}"/>
                    <a:field name="contact_sex"/>
                    <a:field name="contact_sex_name" displayField="code_value_name" options="pur9050_vendor_survey_sex_ds" required="true" returnField="contact_sex" valueField="code_value"/>
                    <a:field name="id_type"/>
                    <a:field name="id_type_name" displayField="code_value_name" options="pur9050_vendor_survey_idType_ds" returnField="id_type" valueField="code_value"/>
                    <a:field name="id_number"/>
                    <a:field name="flag"/>
                    <a:field name="change_flag"/>
                    <a:field name="user_role" displayField="flex_desc" options="fnd9050_user_role_l_ds" required="true" returnField="user_role" valueField="flex_value"/>
                    <a:field name="company_id"/>
                    <a:field name="department"/>
                    <a:field name="position"/>
                    <a:field name="contact_name_update_flag"/>
                    <a:field name="user_role_update_flag"/>
                    <a:field name="contact_sex_update_flag"/>
                    <a:field name="enabled_flag_update_flag"/>
                    <a:field name="id_type_update_flag"/>
                    <a:field name="id_number_update_flag"/>
                    <a:field name="department_update_flag"/>
                    <a:field name="position_update_flag"/>
                    <a:field name="email_update_flag"/>
                    <a:field name="enabled_flag_update_flag"/>
                    <a:field name="mobile_phone_update_flag"/>
                    <a:field name="default_flag"/>
                    <a:field name="mobile_phone" requiredMessage="${l:FND_COM_SUP_CONTACTS.MOBIL}${l:PROMPT.INPUT}"/>
                    <a:field name="telephone"/>
                    <a:field name="email" required="true"/>
                    <a:field name="default_contact_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="c_attribute2" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="contact_comments"/>
                    <a:field name="enabled_flag" checkedValue="Y" defaultValue="Y" uncheckedValue="N"/>
                </a:fields>
                <a:events>
                    <!--  <a:event name="submitsuccess" handler="pur9050_vendor_modify_contract_ds_submitsuccessFun"/> -->
                    <a:event name="add" handler="setinitdata_create"/>
                    <a:event name="update" handler="pur9050_vendor_create_contract_update"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="pur9050_companySupplierAttachments_ds" model="pur.PUR9050.pur9050_vendor_modify_attachment" selectable="true">
                <a:fields>
                    <a:field name="attachment_id"/>
                    <a:field name="company_id" defaultValue="${/model/pur9050_default_data/record/@vendor_id}"/>
                    <a:field name="attachment_name"/>
                    <a:field name="attachment_type"/>
                    <a:field name="attachment_type_desc" displayField="flex_desc" options="pur9050_attachment_type_ds" required="true" returnField="attachment_type" valueField="flex_value"/>
                    <a:field name="required_flag" checkedValue="Y" defaultValue="N" readOnly="true" uncheckedValue="N"/>
                    <a:field name="invalid_date"/>
                    <a:field name="last_upload_date"/>
                </a:fields>
                <a:events>
                    <a:event name="submitsuccess" handler="pur9050_attachment_ds_submitsuccessFun"/>
                </a:events>
            </a:dataSet>
            <!-- <a:dataSet id="pur9010_vendor_modify_ou_ds" model="pur.PUR9050.pur9010_vendor_modify_ou" selectable="true">
                <a:fields>
                    <a:field name="business_unit_name" displayField="flex_desc" options="pur9050_modify_units_ds" required="true" returnField="business_unit_name_id" valueField="flex_value"/>
                    <a:field name="business_unit_name_id"/>
                </a:fields>
            </a:dataSet> -->
        </a:dataSets>
        <a:screenBody>
            <a:screenTopToolbar>
                <a:toolbarButton id="pur9010_vendor_modify_save_btn" click="pur9010_vendor_modify_save" text="保存" width="100"/>
                <!-- <a:toolbarButton id="pur9010_vendor_modify_submit_btn" click="pur9010_vendor_modify_submit" text="提交" width="100"/> -->
                <a:toolbarButton id="pur9010_vendor_modify_delete_btn" click="pur9010_vendor_modify_delete" text="删除" width="100"/>
                <a:toolbarButton click="pur9010_vendor_modify_back" text="返回" width="100"/>
            </a:screenTopToolbar>
            <a:fieldSet style="margin-top:10px;margin-left:2px;" title="" width="800">
                <a:hBox labelWidth="120">
                    <a:comboBox name="modify_status_desc" bindTarget="pur9010_vendor_modify_header_ds" prompt="状态" readOnly="true"/>
                    <a:textField name="modify_num" bindTarget="pur9010_vendor_modify_header_ds" prompt="申请编号" readOnly="true"/>
                    <a:lov name="created_by_desc" bindTarget="pur9010_vendor_modify_header_ds" prompt="创建人" readOnly="true"/>
                </a:hBox>
                <a:hBox labelWidth="105">
                    <a:textField name="business_group_name" bindTarget="pur9010_vendor_modify_header_ds" prompt="集团名称" readOnly="true"/>
                    <!--  <a:lov name="corresponding_department" bindTarget="pur9010_vendor_modify_header_ds" prompt="对应部门"/>
                    <a:lov name="purchasing_engineer" bindTarget="pur9010_vendor_modify_header_ds" prompt="采购工程师"/> -->
                    <a:label name="line_attachment" bindTarget="pur9010_vendor_modify_header_ds" prompt="上传附件" renderer="pur9050_openUploadAttachmentFun"/>
                    <img id="pur9050_line_attache_img" alt="有附件" height="20" src="${/request/@context_path}/images/paperclip.png" title="有附件" width="20"/>
                </a:hBox>
                <a:hBox labelWidth="105">
                    <a:textArea name="modify_reason" bindTarget="pur9010_vendor_modify_header_ds" height="60" prompt="变更原因" width="670"/>
                </a:hBox>
            </a:fieldSet>
            <a:fieldSet style="margin-top:10px;margin-left:2px;" title="更新信息" width="800">
                <a:fieldSet title="基本信息">
                    <a:hBox labelWidth="100">
                        <a:textField name="vendor_desc" bindTarget="pur9010_vendor_modify_header_ds" prompt="公司名称"/>
                        <a:comboBox name="account_period_desc" bindTarget="pur9010_vendor_modify_header_ds" prompt="账期"/>
                        <a:lov name="currency_code" bindTarget="pur9010_vendor_modify_header_ds" prompt="ACP_BILL_SOURCE.CURRENCY_CODE"/>
                    </a:hBox>
                    <a:hBox labelWidth="100">
                        <a:comboBox name="account_period_valid_desc" bindTarget="pur9010_vendor_modify_header_ds" prompt="账期生效方式"/>
                        <a:comboBox name="vendor_type_desc" bindTarget="pur9010_vendor_modify_header_ds" prompt="供应商类型"/>
                    </a:hBox>
                    <a:hBox labelWidth="100">
                        <a:comboBox name="payment_method_name" bindTarget="pur9010_vendor_modify_header_ds" prompt="PUR5730.PAYMENT_METHOD_NAME"/>
                        <a:lov name="tax_type_name" bindTarget="pur9010_vendor_modify_header_ds" prompt="PUR5730.TAX_TYPE_NAME"/>
                        <!-- <a:comboBox name="kw_product_group_name" bindTarget="pur9010_vendor_modify_header_ds" prompt="景旺事业部"/> -->
                    </a:hBox>
                    <!-- <a:hBox labelWidth="100">
                        <a:label prompt="景旺事业部" width="0"/>
                        <a:checkBox name="ou_jxpcb" bindTarget="pur9010_vendor_modify_header_ds" prompt="OU_JXPCB" width="0"/>
                        <a:checkBox name="ou_lcfpc" bindTarget="pur9010_vendor_modify_header_ds" prompt="OU_LCFPC" width="0"/>
                        <a:checkBox name="ou_lcmccl" bindTarget="pur9010_vendor_modify_header_ds" prompt="OU_LCMCCL" width="0"/>
                        <a:checkBox name="ou_lcmpcb" bindTarget="pur9010_vendor_modify_header_ds" prompt="OU_LCMPCB" width="0"/>
                    </a:hBox>
                    <a:hBox labelWidth="100">
                        <a:label width="100"/>
                        <a:checkBox name="ou_lcpcb" bindTarget="pur9010_vendor_modify_header_ds" prompt="OU_LCPCB" width="0"/>
                        <a:checkBox name="ou_lcsmt" bindTarget="pur9010_vendor_modify_header_ds" prompt="OU_LCSMT" width="0"/>
                        <a:checkBox name="ou_szfpc" bindTarget="pur9010_vendor_modify_header_ds" prompt="OU_SZFPC" width="0"/>
                        <a:checkBox name="ou_szpcb" bindTarget="pur9010_vendor_modify_header_ds" prompt="OU_SZPCB" width="0"/>
                    </a:hBox>
                    <a:hBox labelWidth="100">
                        <a:label width="100"/>
                        <a:checkBox name="ou_zhfpc" bindTarget="pur9010_vendor_modify_header_ds" prompt="OU_ZHFPC" width="0"/>
                        <a:checkBox name="ou_zrfpc" bindTarget="pur9010_vendor_modify_header_ds" prompt="OU_ZRFPC" width="0"/>
                        <a:checkBox name="ou_zrsmt" bindTarget="pur9010_vendor_modify_header_ds" prompt="OU_ZRSMT" width="0"/>
                    </a:hBox> -->
                    <a:hBox labelWidth="100">
                        <a:label prompt="景旺产品线" width="0"/>
                        <a:checkBox name="kw_pcb" bindTarget="pur9010_vendor_modify_header_ds" prompt="PCB"/>
                        <a:checkBox name="kw_fpc" bindTarget="pur9010_vendor_modify_header_ds" prompt="FPC"/>
                        <a:checkBox name="kw_mpcb" bindTarget="pur9010_vendor_modify_header_ds" prompt="MPCB"/>
                    </a:hBox>
                </a:fieldSet>
                <!-- <a:fieldSet title="附件信息">
                    <a:hBox labelWidth="110">
                        <a:label name="company_authorise" bindTarget="pur9010_vendor_modify_header_ds" prompt="公司授权证明(加盖章)" renderer="pur9050_openUploadAttachmentFun"/>
                        <img id="pur9050_company_authorise_attache_img" alt="有附件" height="20" src="${/request/@context_path}/images/paperclip.png" title="有附件" width="20"/>
                    </a:hBox>
                    <a:hBox labelWidth="110">
                        <a:label name="business_license" bindTarget="pur9010_vendor_modify_header_ds" prompt="公司营业执照" renderer="pur9050_openUploadAttachmentFun"/>
                        <img id="pur9050_business_license_attache_img" alt="有附件" height="20" src="${/request/@context_path}/images/paperclip.png" title="有附件" width="20"/>
                        <a:datePicker name="business_license_end_date" bindTarget="pur9010_vendor_modify_header_ds" prompt="营业期限" width="90"/>
                        <a:checkBox name="business_license_forever" bindTarget="pur9010_vendor_modify_header_ds"/>
                    </a:hBox>
                    <a:hBox labelWidth="110">
                        <a:checkBox name="iso14000_flag" bindTarget="pur9010_vendor_modify_header_ds" prompt="ISO14000认证"/>
                        <a:checkBox name="iso9001_flag" bindTarget="pur9010_vendor_modify_header_ds" prompt="ISO9001认证"/>
                    </a:hBox>
                    <a:hBox id="pur9050_iso14000_hBox" labelWidth="110">
                        <a:datePicker name="iso14000_flag_end_date" bindTarget="pur9010_vendor_modify_header_ds" prompt="ISO14000有效期" width="90"/>
                        <a:label width="50"/>
                        <a:label name="iso14000" bindTarget="pur9010_vendor_modify_header_ds" prompt="ISO14000认证" renderer="pur9050_openUploadAttachmentFun"/>
                        <img id="pur9050_iso14000_attache_img" alt="有附件" height="20" src="${/request/@context_path}/images/paperclip.png" title="有附件" width="20"/>
                    </a:hBox>
                    <a:hBox id="pur9050_iso9001_hBox" labelWidth="110">
                        <a:datePicker name="iso9001_flag_end_date" bindTarget="pur9010_vendor_modify_header_ds" prompt="ISO9001有效期" width="90"/>
                        <a:label width="50"/>
                        <a:label name="iso9001" bindTarget="pur9010_vendor_modify_header_ds" prompt="ISO9001认证" renderer="pur9050_openUploadAttachmentFun"/>
                        <img id="pur9050_iso9001_attache_img" alt="有附件" height="20" src="${/request/@context_path}/images/paperclip.png" title="有附件" width="20"/>
                    </a:hBox>
                </a:fieldSet> -->
            </a:fieldSet>
            <!--   <div style="color:red;font-size:20px;"><![CDATA[填写的三个跟单员的邮箱会接收到后续询价单相关的邮件！]]></div> -->
            <a:tabPanel id="pur9010_vendor_modify_tab" height="380" marginWidth="70">
                <a:tabs>
                    <a:tab prompt="银行信息" width="100">
                        <a:grid id="pur9010_vendor_modify_create_account_grid" bindTarget="pur9010_vendor_modify_account_ds" height="330" marginWidth="80" navBar="true">
                            <a:toolBar>
                                <a:button type="add"/>
                                <a:button click="pur9010_vendor_bank_delete" text="删除"/>
                            </a:toolBar>
                            <a:columns>
                                <a:column name="bank_code" align="center" editor="fnd9220_account_lov" prompt="FND_COM_SUP_ACCOUNTS.BANK_CODE" width="60"/>
                                <a:column name="bank_code_desc" align="left" prompt="FND_COM_SUP_ACCOUNTS.BANK_NAME" width="80"/>
                                <a:column name="bank_branch_name" align="left" editor="fnd9220_account_lov" editorFunction="pur9050_bank_branch_ef" prompt="FND_COM_SUP_ACCOUNTS.OPENING_BANK_NAME" width="80"/>
                                <a:column name="c_attribute1" align="left" editor="fnd9220_account_tf" prompt="CNAPS号" width="80"/>
                                <a:column name="bank_account_name" align="left" editor="fnd9220_account_tf" prompt="FND_COM_SUP_ACCOUNTS.BANK_ACCOUNT_NAME" width="80"/>
                                <a:column name="bank_account_number" align="left" editor="fnd9220_account_tf" prompt="FND_COM_SUP_ACCOUNTS.BANK_ACCOUNT" width="80"/>
                                <a:column name="payment_method_name" align="left" editor="fnd9220_account_lov" prompt="PUR5730.PAYMENT_METHOD_NAME" width="80"/>
                                <a:column name="currency_code" align="left" editor="fnd9220_account_lov" prompt="ACP_BILL_SOURCE.CURRENCY_CODE" width="80"/>
                                <a:column name="primary_account_flag" align="center" editor="fnd9220_account_cb" prompt="FND_COM_SUP_ACCOUNTS.PRIMARY_ACCOUNT_FLAG" width="60"/>
                                <a:column name="enabled_flag" align="center" editor="fnd9220_account_cb" prompt="FND_COM_SUP_ACCOUNTS.ENABLED_FLAG" width="60"/>
                            </a:columns>
                            <a:editors>
                                <a:lov id="fnd9220_account_lov"/>
                                <a:textField id="fnd9220_account_tf"/>
                                <a:checkBox id="fnd9220_account_cb"/>
                            </a:editors>
                            <a:events>
                                <a:event name="cellclick" handler="pur9050_manufacturer_accountsCellClick_fun"/>
                            </a:events>
                        </a:grid>
                    </a:tab>
                    <a:tab prompt="地址信息" width="100">
                        <a:grid id="pur9010_vendor_modify_create_address_grid" bindTarget="pur9010_vendor_modify_address_ds" height="330" marginWidth="80" navBar="true">
                            <a:toolBar>
                                <!-- <a:button type="add"/> -->
                                <a:button click="pur9010_vendor_address_delete" text="删除"/>
                            </a:toolBar>
                            <a:columns>
                                <a:column name="country_code_desc" align="left" editor="fnd9220_site_lov" prompt="FND_COM_SUP_ADDRESSES.COUNTRY_CODE" width="120"/>
                                <a:column name="province_desc" align="left" editor="fnd9220_site_lov" prompt="FND_COM_SUP_ADDRESSES.PROVINCE_ID" width="100"/>
                                <a:column name="city_desc" align="left" editor="fnd9220_site_lov" prompt="FND_COM_SUP_ADDRESSES.CITY_ID" width="100"/>
                                <a:column name="address_detail" align="left" editor="fnd9220_site_tf" prompt="FND_COM_SUP_ADDRESSES.ADDRESS_DETAIL_ID" width="150"/>
                                <a:column name="post_code" align="left" editor="fnd9220_site_tf" prompt="FND_COM_SUP_ADDRESSES.POST_CODE" width="60"/>
                                <a:column name="address_comments" align="left" editor="fnd9220_site_tf" prompt="FND_COM_SUP_ADDRESSES.ADDRESS_COMMENTS" width="150"/>
                                <a:column name="enabled_flag" align="center" editor="fnd9220_site_cb" prompt="FND_COM_SUP_ADDRESSES.ENABLED_FLAG" width="60"/>
                            </a:columns>
                            <a:editors>
                                <a:lov id="fnd9220_site_lov"/>
                                <a:textField id="fnd9220_site_tf"/>
                                <a:checkBox id="fnd9220_site_cb"/>
                            </a:editors>
                            <a:events>
                                <a:event name="cellclick" handler="pur9050_addressesCellClick_fun"/>
                            </a:events>
                        </a:grid>
                    </a:tab>
                    <a:tab prompt="新增可供品类" width="100">
                        <a:grid id="pur9010_vendor_modify_create_supply_grid" bindTarget="pur9010_vendor_modify_supply_ds" height="330" marginWidth="80" navBar="true">
                            <a:toolBar>
                                <a:button type="add"/>
                                <a:button click="pur9010_vendor_supply_delete" text="删除"/>
                            </a:toolBar>
                            <a:columns>
                                <a:column name="category_code" align="center" editor="pur9050_supply_ability_lns_ds_lv" prompt="PUR2520.PUR_CATEGORY_CODE" width="100"/>
                                <a:column name="category_name" prompt="PUR2520.PUR_CATEGORY_NAME" width="120"/>
                            </a:columns>
                            <a:editors>
                                <a:lov id="pur9050_supply_ability_lns_ds_lv"/>
                            </a:editors>
                        </a:grid>
                    </a:tab>
                    <a:tab prompt="FND9220.ATTACHMENT_INFORMATION" width="100">
                        <a:grid bindTarget="pur9050_companySupplierAttachments_ds" height="330" marginWidth="80" navBar="true">
                            <a:toolBar>
                                <a:button type="add"/>
                                <a:button type="clear"/>
                            </a:toolBar>
                            <a:columns>
                                <a:column name="attachment_type_desc" align="center" editor="pur9050_com_sup_attachment_tab_cbb" prompt="附件类型" width="100"/>
                                <a:column name="attachment_name" editor="pur9050_com_sup_attachment_tab_tf" prompt="附件描述" width="200"/>
                                <a:column name="required_flag" align="center" prompt="是否必传" width="80"/>
                                <a:column name="invalid_date" align="center" editor="pur9050_com_sup_attachment_tab_dp" prompt="文件到期日" renderer="Aurora.formatDate" width="100"/>
                                <a:column name="last_upload_date" align="center" prompt="最后上传时间" width="130"/>
                                <a:column name="attachment_id" align="center" prompt="附件信息" renderer="pur9050_upload_renderer" width="100"/>
                                <a:column name="atm_flag" align="center" renderer="pur9050_upload_renderer" width="20"/>
                            </a:columns>
                            <a:editors>
                                <a:comboBox id="pur9050_com_sup_attachment_tab_cbb"/>
                                <a:textField id="pur9050_com_sup_attachment_tab_tf"/>
                                <a:datePicker id="pur9050_com_sup_attachment_tab_dp"/>
                            </a:editors>
                        </a:grid>
                    </a:tab>
                    <a:tab prompt="FND9220.CONTACT_INFORMATION" width="90">
                        <a:grid bindTarget="pur9050_vendor_create_contract_ds" marginHeight="280" marginWidth="45" navBar="true" width="1000">
                            <a:toolBar>
                                <a:button type="add"/>
                                <a:label width="10"/>
                                <!--  <a:button click="pur9050_vendor_contract_saveFun" text="PROMPT.SAVE"/>
                                <a:label width="10"/> -->
                                <a:button click="pur9050_vendor_contract_deteteFun" text="PROMPT.DELETE"/>
                            </a:toolBar>
                            <a:columns>
                                <a:column name="contact_name" align="left" editor="pur9050_vendor_contact_tf" prompt="FND_COM_SUP_CONTACTS.CONTACT_NAME" width="65"/>
                                <a:column name="contact_sex_name" align="left" editor="pur9050_vendor_contact_cbx" prompt="FND_COM_SUP_CONTACTS.SEX" width="40"/>
                                <a:column name="user_role" align="left" editor="pur9050_vendor_contact_cbx" prompt="角色" width="80"/>
                                <a:column name="position" align="left" editor="pur9050_vendor_contact_tf" prompt="FND_COM_SUP_CONTACTS.POSITION" width="80"/>
                                <a:column name="mobile_phone" align="left" editor="pur9050_vendor_contact_tf" prompt="FND_COM_SUP_CONTACTS.MOBIL" width="100"/>
                                <a:column name="email" align="left" editor="pur9050_vendor_contact_tf" prompt="FND_COM_SUP_CONTACTS.EMAIL" width="120"/>
                                <a:column name="id_type_name" align="left" editor="pur9050_vendor_contact_cbx" prompt="FND_COM_SUP_CONTACTS.ID_TYPE" width="60"/>
                                <a:column name="id_number" align="left" editor="pur9050_vendor_contact_tf" prompt="FND_COM_SUP_CONTACTS.ID_NUMBER" width="120"/>
                                <!--     <a:column name="default_contact_flag" align="center" editor="pur9050_vendor_contact_cb" prompt="业务负责人" width="65"/> -->
                                <!-- FND_COM_SUP_CONTACTS.CONTACT_COMMENTS -->
                                <a:column name="enabled_flag" align="center" editor="pur9050_vendor_contact_cb" prompt="FND_COM_SUP_CONTACTS.ENABLED_FLAG" width="40"/>
                            </a:columns>
                            <a:editors>
                                <a:textField id="pur9050_vendor_contact_tf"/>
                                <a:comboBox id="pur9050_vendor_contact_cbx"/>
                                <a:checkBox id="pur9050_vendor_contact_cb"/>
                            </a:editors>
                        </a:grid>
                    </a:tab>
                </a:tabs>
            </a:tabPanel>
        </a:screenBody>
        <script><![CDATA[
            init();
        ]]></script>
    </a:view>
</a:screen>

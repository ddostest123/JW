<?xml version="1.0" encoding="UTF-8"?>
<a:screen xmlns:a="http://www.aurora-framework.org/application">
    <a:init-procedure>
        <a:model-query defaultWhereClause="vendor_modify_id=${/parameter/@vendor_modify_id}" fetchAll="true" model="pur.PUR9050.pur9010_vendor_modify" rootPath="pur9010_vendor_modify"/>
        <a:model-query defaultWhereClause="flex_value_set_code = &apos;PUR_MODIFY_UNITS&apos;" fetchAll="true" model="public.fnd_flex_value_v_lov" rootPath="pur9050_modify_units"/>
        <a:model-query defaultWhereClause="flex_value_set_code = &apos;KW_ACCOUNT_PERIOD&apos;" fetchAll="true" model="public.fnd_flex_value_v_lov" rootPath="pur9050_account_period"/>
        <a:model-query defaultWhereClause="flex_value_set_code = &apos;KW_PAYMENT_METHOD&apos;" fetchAll="true" model="public.fnd_flex_value_v_lov" rootPath="pur9050_manufacturer_payment_method"/>
        <a:model-query defaultWhereClause="flex_value_set_code = &apos;KW_PRODUCT_GROUP_NAME&apos;" fetchAll="true" model="public.fnd_flex_value_v_lov" rootPath="pur9010_manufacturer_product_group"/>
        <a:model-query defaultWhereClause="flex_value_set_code = &apos;PUR_QUESTIONARY_ATM_TYPE_CODE&apos; and flex_value = &apos;250&apos;" fetchAll="true" model="public.fnd_flex_value_v_lov" rootPath="pur9050_attachment_type"/>
        <a:model-query fetchAll="true" model="pur.PUR9050.pur9050_set_default_vendor_id" rootPath="pur9050_default_data"/>
        <a:model-query defaultWhereClause="flex_value_set_code = &apos;USER_ROLE_DS&apos;" fetchAll="true" model="public.fnd_flex_value_v_lov" rootPath="fnd9050_de"/>
        <!-- <a:model-query defaultWhereClause="vendor_modify_id=${/parameter/@vendor_modify_id}" fetchAll="true" model="pur.PUR9050.pur9010_vendor_modify_bank" rootPath="pur9010_vendor_modify_account"/>
        <a:model-query defaultWhereClause="vendor_modify_id=${/parameter/@vendor_modify_id}" fetchAll="true" model="pur.PUR9050.pur9010_vendor_modify_address" rootPath="pur9010_vendor_modify_address"/> -->
    </a:init-procedure>
    <a:view>
        <a:link id="pur9010_vendor_modify_address_delete_link" model="pur.PUR9050.pur9010_vendor_modify_address" modelaction="delete"/>
        <a:link id="pur9010_vendor_modify_address_save_link" model="pur.PUR9050.pur9010_vendor_modify_address" modelaction="insert"/>
        <a:link id="pur90101_vendor_modify_contact_save_link" model="pur.PUR9050.pur9050_basic_contract_query" modelaction="batch_update"/>
        <a:link id="pur9010_vendor_modify_attach_save_link" model="pur.PUR9050.pur9050_vendor_modify_attachment" modelaction="insert"/>
        <a:link id="pur9010_vendor_modify_supply_delete_link" model="pur.PUR9050.pur9010_vendor_modify_supply" modelaction="delete"/>
        <a:link id="pur9010_vendor_modify_supply_save_link" model="pur.PUR9050.pur9010_vendor_modify_supply" modelaction="insert"/>
        <a:link id="pur9010_vendor_modify_ou_delete_link" model="pur.PUR9050.pur9010_vendor_modify_ou" modelaction="delete"/>
        <a:link id="pur9010_vendor_modify_ou_save_link" model="pur.PUR9050.pur9010_vendor_modify_ou" modelaction="insert"/>
        <a:link id="pur9010_vendor_modify_bank_delete_link" model="pur.PUR9050.pur9010_vendor_modify_bank" modelaction="delete"/>
        <a:link id="pur9010_vendor_modify_bank_save_link" model="pur.PUR9050.pur9010_vendor_modify_bank" modelaction="insert"/>
        <a:link id="pur9010_vendor_contract_detail_delete_link" model="pur.PUR9050.pur9050_basic_contract_query" modelaction="batch_update"/>
        <a:link id="pur9010_vendor_modify_header_delete_link" model="pur.PUR9050.pur9010_vendor_modify" modelaction="delete"/>
        <a:link id="pur9010_vendor_modify_header_submit_link" model="pur.PUR9050.pur9010_vendor_modify" modelaction="execute"/>
        <a:link id="pur9010_vendor_modify_header_save_link" model="pur.PUR9050.pur9010_vendor_modify" modelaction="insert"/>
        <a:link id="pur_vendor_modify_details_DocumentViewAttachmentFileDownload_link" url="${/request/@context_path}/uploadFile.screen"/>
        <a:link id="pur_vendor_modify_details_DocumentDownAttachmentFileDownload_link" url="${/request/@context_path}/check_uploadFile.screen"/>
        <script><![CDATA[
            var load_flag = 0;
            var vendor_desc_flag = 'N';
            var account_period_flag = 'N';
            var tax_type_flag = 'N';
            var address_ds_flag = 'N';
            var account_ds_flag = 'N';
            var currency_code_flag = 'N'; //币种
            var payment_method_flag = 'N'; //付款方式
            
            function pur9010_compareDate(start, end) {
                if (typeof(start) == 'string') {
                    start = new Date(start.replace(/-/g, "/"));
                }
            
                if (typeof(end) == 'string') {
                    end = new Date(end.replace(/-/g, "/"));
                }
            
                if (start > end) {
                    return false;
                }
                return true;
            }
            
            //日期校验
            
            function pur9010_founding_dateValidator(record, name, value) {
                if (name == 'business_license_end_date') {
                    var business_license_end_date = record.get('business_license_end_date');
                    var start = new Date();
                    if (!pur9010_compareDate(start, business_license_end_date)) {
                        return '营业期限不能早于当前日期！';
                    }
                    return true;
                }
                if (name == 'iso14000_flag_end_date') {
                    var iso14000_flag_end_date = record.get('iso14000_flag_end_date');
                    var start = new Date();
                    if (!pur9010_compareDate(start, iso14000_flag_end_date)) {
                        return 'ISO14000有效期不能早于当前日期！';
                    }
                    return true;
                }
                if (name == 'iso9001_flag_end_date') {
                    var iso9001_flag_end_date = record.get('iso9001_flag_end_date');
                    var start = new Date();
                    if (!pur9010_compareDate(start, iso9001_flag_end_date)) {
                        return 'ISO9001不能早于当前日期！';
                    }
                    return true;
                }
            }
            
            function pur9010_vendor_modify_query() {
                $('pur9010_vendor_modify_header_ds').query();
            }
            
            function pur9010_vendor_modify_bank_query() {
                $('pur9010_vendor_modify_account_ds').query();
            }
            
            function pur9010_vendor_modify_address_query() {
                $('pur9010_vendor_modify_address_ds').query();
            }
            
            function pur9010_vendor_modify_supply_query() {
                $('pur9010_vendor_modify_supply_ds').query();
            }
            
            function pur9010_vendor_modify_ou_query() {
                $('pur9010_vendor_modify_ou_ds').query();
            }
            
            function init() {
                var record = $('pur9010_vendor_modify_header_ds').getAt(0);
                var iso14000_flag = record.get('iso14000_flag');
                var iso9001_flag = record.get('iso9001_flag');
                var tar1 = document.getElementById('pur9050_iso14000_hBox');
                var tar2 = document.getElementById('pur9050_iso9001_hBox');
                if (iso14000_flag == 'Y') {
                    tar1.style.display = 'block';
                    record.getField('iso14000_flag_end_date').setRequired(true);
                } else {
                    tar1.style.display = 'none';
                }
                if (iso9001_flag == 'Y') {
                    tar2.style.display = 'block';
                    record.getField('iso9001_flag_end_date').setRequired(true);
                } else {
                    tar2.style.display = 'none';
                }
            
                var modify_status = record.get('modify_status');
                var vendor_modify_id = '${/parameter/@vendor_modify_id}';
                console.log(vendor_modify_id);
                var hBox = document.getElementById('pur9050_reject_reason_id');
                if (modify_status == 'REJECT' || modify_status == 'APPROVE') {
                    hBox.style.display = 'block';
                } else {
                    hBox.style.display = 'none';
                }
                if (modify_status == 'SUBMITTED' || modify_status == 'APPROVE') {
                    load_flag = 1;
            
                    $('pur9010_vendor_modify_save_btn').disable();
                    $('pur9010_vendor_modify_submit_btn').disable();
                    $('pur9010_vendor_modify_delete_btn').disable();
                    record.getField('created_by_desc').setReadOnly(true);
                    record.getField('vendor_desc').setReadOnly(true);
                    record.getField('account_period_desc').setReadOnly(true);
                    record.getField('contact_name').setReadOnly(true);
                    record.getField('position').setReadOnly(true);
                    record.getField('id_type_desc').setReadOnly(true);
                    record.getField('id_number').setReadOnly(true);
                    record.getField('mobile_phone').setReadOnly(true);
                    record.getField('email').setReadOnly(true);
            
                    record.getField('currency_code').setReadOnly(true);
                    record.getField('payment_method_name').setReadOnly(true);
                    record.getField('financial_represent_name').setReadOnly(true);
                    record.getField('finance_rep_position').setReadOnly(true);
                    record.getField('finance_rep_identity_desc').setReadOnly(true);
                    record.getField('finance_rep_identity_num').setReadOnly(true);
                    record.getField('financial_represent_phone').setReadOnly(true);
                    record.getField('financial_represent_mail').setReadOnly(true);
                    
                     record.getField('financial_represent_name_t').setReadOnly(true);
                    record.getField('finance_rep_position_t').setReadOnly(true);
                    record.getField('finance_rep_identity_desc_t').setReadOnly(true);
                    record.getField('finance_rep_identity_num_t').setReadOnly(true);
                    record.getField('financial_represent_phone_t').setReadOnly(true);
                    record.getField('financial_represent_mail_t').setReadOnly(true);
                    
                     record.getField('financial_represent_name_h').setReadOnly(true);
                    record.getField('finance_rep_position_h').setReadOnly(true);
                    record.getField('finance_rep_identity_desc_h').setReadOnly(true);
                    record.getField('finance_rep_identity_num_h').setReadOnly(true);
                    record.getField('financial_represent_phone_h').setReadOnly(true);
                    record.getField('financial_represent_mail_h').setReadOnly(true);
            
                    record.getField('account_period_valid_desc').setReadOnly(true);
                    record.getField('vendor_type_desc').setReadOnly(true);
            
                    record.getField('business_license_end_date').setReadOnly(true);
                    record.getField('business_license_forever').setReadOnly(true);
                    record.getField('iso14000_flag_end_date').setReadOnly(true);
                    record.getField('iso9001_flag_end_date').setReadOnly(true);
                    record.getField('iso14000_flag').setReadOnly(true);
                    record.getField('iso9001_flag').setReadOnly(true);
            
                    record.getField('modify_reason').setReadOnly(true);
                    record.getField('tax_type_name').setReadOnly(true);
                    record.getField('kw_product_group_name').setReadOnly(true);
                    record.getField('kw_pcb').setReadOnly(true);
                    record.getField('kw_fpc').setReadOnly(true);
                    record.getField('kw_mpcb').setReadOnly(true);
            
            
                    record.getField('business_group_name').setReadOnly(true);
            
                }
            }
            
            //银行tab点击事件
            
            
            function pur9050_manufacturer_accountsCellClick_fun(grid, row, name, record) {
                //银行、开户行名称级联更新
                if (Ext.isEmpty(record.get('bank_code_desc')) || record.get('bank_code_desc') == undefined) {
                    record.set('bank_code', '');
                    record.getField("bank_branch_name").setLovService('');
            
                    record.getField('bank_branch_name').setReadOnly(true);
                } else {
                    var temp_string = record.get('bank_code');
                    record.getField("bank_branch_name").setLovService('public.csh_bank_branchs_lov');
                    record.getField("bank_branch_name").setLovPara('bank_code', temp_string);
            
                    record.getField('bank_branch_name').setReadOnly(false);
                }
            }
            
            //保存
            
            function pur9010_vendor_modify_save() {
                var record = $('pur9010_vendor_modify_header_ds').getAt(0);
                var data = record.data;
                var records = $('pur9010_vendor_modify_account_ds').getAll();
                var supply = $('pur9010_vendor_modify_supply_ds').getAll();
                if (records.length != 0) {
                    var count = 0;
                    for (var j = 0;j < records.length;j++) {
                        var primary_account_flag = records[j].get('primary_account_flag');
                        if (primary_account_flag == 'Y') {
                            count++;
                        }
                    }
                    for (var i = 0;i < records.length;i++) {
                        var v_count = 0;
                        var payment_method_code = records[i].get('payment_method_code');
                        var currency_code = records[i].get('currency_code');
                        for (var k = 0;k < records.length;k++) {
                            if ((records[k].get('payment_method_code') == payment_method_code) && (records[k].get('currency_code') == currency_code)) {
                                v_count++;
                            }
                        }
                        if (v_count > 1) {
                            Aurora.showMessage('${l:PROMPT}', '同一付款方式同一币种下只允许存在一条银行账户信息，请检查！');
                            return;
                        }
                    }
                    if (count == 0) {
                        Aurora.showMessage('${l:PROMPT}', '银行信息必须有一个主账户，不能保存！');
                        return;
                    }
                    if (count > 1) {
                        Aurora.showMessage('${l:PROMPT}', '银行信息有多个主账户，不能保存！');
                        return;
                    }
                }
                
                
                  var record_con = $('pur9050_vendor_modify_contract_ds').getAll();
                 if(!$('pur9050_vendor_modify_contract_ds').validate()){
                    return ;
                }
                var role_flag=false;
                var count2=0;
                var count1=0;
                for (var i = 0;i < record_con.length;i++) {
                    if(record_con[i].get('user_role')=='业务负责人'){
                        count2++;
                    }
                    if(record_con[i].get('user_role')=='主跟单员'){
                        count1++;
                    } 
                }
                if(count2!=1||count1!=1){
                      Aurora.showErrorMessage('${l:PROMPT}', '主跟单员与业务负责人必须维护，且每个角色只能维护一个人');
                      return ;
                } 
                // if (supply.length <= 0) {
                // Aurora.showMessage('${l:PROMPT}', '请至少新增一条品类数据！');
                // return;
                // }
                var kw_pcb = record.get('kw_pcb');
                var kw_fpc = record.get('kw_fpc');
                var kw_mpcb = record.get('kw_mpcb');
                if (kw_pcb == 'N' && kw_fpc == 'N' && kw_mpcb == "N") {
                    Aurora.showMessage('${l:PROMPT}', '${l:请至少勾选一项景旺产品线！}', null);
                    return;
                }
                if ($('pur9010_vendor_modify_header_ds').validate()) {
                    if (!$('pur9010_vendor_modify_account_ds').validate()) {
                        return;
                    }
                    if (!$('pur9010_vendor_modify_address_ds').validate()) {
                        return;
                    }
                    var old_address_flag = record.get('address_ds_flag');
                    if ($('pur9010_vendor_modify_address_ds').isModified()) {
                        address_ds_flag = 'Y';
                    } else {
                        if (old_address_flag == 'Y') {
                            address_ds_flag = 'Y';
                        } else {
                            address_ds_flag = 'N';
                        }
                    }
                    var old_account_flag = record.get('account_ds_flag');
                    if ($('pur9010_vendor_modify_account_ds').isModified()) {
                        account_ds_flag = 'Y';
                    } else {
                        if (old_account_flag == 'Y') {
                            account_ds_flag = 'Y';
                        } else {
                            account_ds_flag = 'N';
                        }
                    }
                    if (vendor_desc_flag == 'Y' && address_ds_flag == 'Y') {
                        Aurora.showMessage('${l:PROMPT}', '${l:无法同时变更公司名称与地址，请重新走准入流程！}', null);
                        return;
                    }
                    data['account_ds_flag'] = account_ds_flag;
                    data['vendor_desc_flag'] = vendor_desc_flag;
                    data['account_period_flag'] = account_period_flag;
                    data['tax_type_flag'] = tax_type_flag;
                    data['address_ds_flag'] = address_ds_flag;
                    data['currency_code_flag'] = currency_code_flag;
                    data['payment_method_flag'] = payment_method_flag;
            
            
                    Aurora.Masker.mask(Ext.getBody());
                    Aurora.request({
                        url: $('pur9010_vendor_modify_header_save_link').getUrl(),
                        para: data,
                        success: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                            var vendor_modify_id = res.result.vendor_modify_id;
                            var vendor_id = res.result.vendor_id;
                            pur9010_vendor_bank_save();
                            pur9010_vendor_address_save();
                            pur9010_vendor_supply_save();
                            pur9010_vendor_contract_save();
                            pur9010_vendor_attach_save();
                            //pur9010_vendor_ou_save();
                            Aurora.showMessage('${l:PROMPT}', '${l:保存成功}', null);
                            $('pur9010_vendor_modify_header_ds').setQueryParameter('vendor_modify_id', vendor_modify_id);
                            $('pur9010_vendor_modify_account_ds').setQueryParameter('vendor_modify_id', vendor_modify_id);
                            $('pur9010_vendor_modify_address_ds').setQueryParameter('vendor_modify_id', vendor_modify_id);
                            $('pur9010_vendor_modify_supply_ds').setQueryParameter('vendor_modify_id', vendor_modify_id);
                            //$('pur9010_vendor_modify_ou_ds').setQueryParameter('vendor_modify_id', vendor_modify_id);
            
                            $('pur9050_companySupplierAttachments_ds').setQueryParameter('vendor_modify_id', vendor_modify_id);
            
                            pur9010_vendor_modify_query();
                            pur9010_vendor_modify_bank_query();
                            pur9010_vendor_modify_address_query();
                            pur9010_vendor_modify_supply_query();
                            //pur9010_vendor_modify_ou_query();
                            $('pur9050_companySupplierAttachments_ds').query();
                        },
                        failure: function(args) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        error: function(args) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        scope: this
                    });
                }
            }
            
            function pur9010_vendor_modify_header_ds_loadFcn(ds) {
                var record = ds.getAt(0);
                vendor_desc_flag = record.get('vendor_desc_flag');
                account_period_flag = record.get('account_period_flag');
                tax_type_flag = record.get('tax_type_flag');
                currency_code_flag = record.get('currency_code_flag');
                payment_method_flag = record.get('payment_method_flag');
            }
            
            function pur9010_vendor_modify_header_ds_updateFcn(ds, record, name, value, oldvalue) {
                if (name == 'vendor_desc') {
                    var vendor_desc = '${/model/pur9050_default_data/record/@vendor_name}';
                    if (value == vendor_desc) {
                        vendor_desc_flag = 'N';
                    } else {
                        vendor_desc_flag = 'Y';
                    }
                } else if (name == 'currency_code') {
                    debugger;
                    var currency_code = '${/model/pur9050_default_data/record/@currency_code}';
                    if (value == currency_code) {
                        currency_code_flag = 'N';
                    } else {
                        currency_code_flag = 'Y';
                    }
                } else if (name == 'payment_method_code') {
                    var payment_method_code = '${/model/pur9050_default_data/record/@payment_method_code}';
                    if (value == payment_method_code) {
                        payment_method_flag = 'N';
                    } else {
                        payment_method_flag = 'Y';
                    }
                } else if (name == 'account_period_desc') {
                    debugger;
                    var account_period_desc = '${/model/pur9050_default_data/record/@account_period_desc}';
                    if (value == account_period_desc) {
                        account_period_flag = 'N';
                    } else {
                        account_period_flag = 'Y';
                    }
                } else if (name == 'tax_type_name') {
                    var tax_type_name = '${/model/pur9050_default_data/record/@tax_type_name}';
                    if (value == tax_type_name) {
                        tax_type_flag = 'N';
                    } else {
                        tax_type_flag = 'Y';
                    }
                } else if (name == 'business_license_forever') {
                    if (value == 'Y') {
                        record.set('business_license_end_date', '');
                        record.getField('business_license_end_date').setReadOnly(true);
                    } else {
                        record.getField('business_license_end_date').setReadOnly(false);
                    }
                } else if (name == 'iso14000_flag') {
                    var tar = document.getElementById('pur9050_iso14000_hBox');
                    if (value == 'Y') {
                        tar.style.display = 'block';
                        record.getField('iso14000_flag_end_date').setRequired(true);
                    } else {
                        record.set('iso14000_flag_end_date', '');
                        record.getField('iso14000_flag_end_date').setRequired(false);
                        tar.style.display = 'none';
                    }
                } else if (name == 'iso9001_flag') {
                    var tar = document.getElementById('pur9050_iso9001_hBox');
                    if (value == 'Y') {
                        tar.style.display = 'block';
                        record.getField('iso9001_flag_end_date').setRequired(true);
                    } else {
                        record.set('iso9001_flag_end_date', '');
                        record.getField('iso9001_flag_end_date').setRequired(false);
                        tar.style.display = 'none';
                    }
                }
            }
            //提交
            
            
            function pur9010_vendor_modify_submit() {
                var record = $('pur9010_vendor_modify_header_ds').getAt(0);
                var data = record.data;
                var vendor_modify_id = record.get('vendor_modify_id');
                var stage_code = record.get('stage_code');
                if (!$('pur9010_vendor_modify_header_ds').isModified() && !$('pur9010_vendor_modify_account_ds').isModified() && !$('pur9010_vendor_modify_address_ds').isModified() && !$('pur9010_vendor_modify_supply_ds').isModified() && !$('pur9050_companySupplierAttachments_ds').isModified()) {
                    Aurora.showConfirm('${l:PROMPT}', '确定提交？', function() {
                        if ($('pur9010_vendor_modify_header_ds').validate()) {
                            //如果该供应商为非合格供应商则不能进行信息变更提交
                            // if (stage_code != 'QUALIFIED') {
                            // Aurora.showMessage('${l:PROMPT}', '${l:非合格供应商不能发起信息变更！}', null);
                            // return;
                            // }
                            //当地址和名称同时变更，增加提醒功能：需重新走准入流程
                            var ds = $('pur9010_vendor_modify_address_ds');
                            if (vendor_desc_flag == 'Y' && address_ds_flag == 'Y') {
                                Aurora.showMessage('${l:PROMPT}', '${l:无法同时变更公司名称与地址，请重新走准入流程！}', null);
                                return;
                            }
                            Aurora.Masker.mask(Ext.getBody());
                            Aurora.request({
                                url: $('pur9010_vendor_modify_header_submit_link').getUrl() + '?vendor_modify_id=' + vendor_modify_id,
                                para: data,
                                success: function(res) {
                                    Aurora.Masker.unmask(Ext.getBody());
                                    Aurora.showMessage('${l:PROMPT}', '${l:提交成功}', null);
                                    $('pur9010_vendor_modify_new').close();
                                },
                                failure: function(args) {
                                    Aurora.Masker.unmask(Ext.getBody());
                                },
                                error: function(args) {
                                    Aurora.Masker.unmask(Ext.getBody());
                                },
                                scope: this
                            });
                        }
                    });
                } else {
                    Aurora.showMessage('${l:PROMPT}', '${l:请先保存数据}', null);
                }
            }
            
            //删除
            
            function pur9010_vendor_modify_delete() {
                var record = $('pur9010_vendor_modify_header_ds').getAt(0);
                var data = record.data;
                var vendor_modify_id = record.get('vendor_modify_id');
                Aurora.showConfirm('${l:PROMPT}', '确定删除？', function() {
                    if ($('pur9010_vendor_modify_header_ds').validate()) {
                        Aurora.request({
                            url: $('pur9010_vendor_modify_header_delete_link').getUrl() + '?vendor_modify_id=' + vendor_modify_id,
                            para: data,
                            success: function(res) {
                                Aurora.showMessage('${l:PROMPT}', '${l:删除成功}', null);
                                $('pur9010_vendor_modify_new').close();
                            },
                            scope: this
                        });
                    }
                });
            }
            
            function pur9050_addressesCellClick_fun(grid, row, name, record) {
                //国家、地区、城市级联更新
                if (Ext.isEmpty(record.get('country_code_desc')) || record.get('country_code_desc') == undefined) {
                    record.set('country_code', '');
                    record.getField("province_desc").setLovService('');
                    record.getField("city_desc").setLovService('');
            
                    record.getField('province_desc').setReadOnly(true);
                    record.getField('city_desc').setReadOnly(true);
                } else {
                    var temp_string = record.get('country_code');
                    record.getField("city_desc").setLovService('');
                    record.getField("province_desc").setLovService('public.fnd_region_province_lov');
                    record.getField("province_desc").setLovPara('country_code', temp_string);
            
                    record.getField('province_desc').setReadOnly(false);
                }
                if (Ext.isEmpty(record.get('province_desc')) || record.get('province_desc') == undefined) {
                    record.set('province_id', '');
                    record.getField("city_desc").setLovService('');
            
                    record.getField('city_desc').setReadOnly(true);
                } else {
                    record.getField("city_desc").setLovService('public.fnd_region_city_lov');
                    record.getField("city_desc").setLovPara('province_id', record.get('province_id'));
                    record.getField('city_desc').setReadOnly(false);
                }
            
            }
            //银行保存
            
            function pur9010_vendor_bank_save() {
                var record = $('pur9010_vendor_modify_account_ds').getAll();
                for (var i = 0;i < record.length;i++) {
                    var modify_flag = 'N';
                    var old_flag = record[i].get('c_attribute4');
                    if (old_flag == 'Y') {
                        modify_flag = old_flag;
                    }
                    if (record[i].isNew || record[i].dirty) {
                        modify_flag = 'Y';
                    }
                    var data = record[i].data;
                    data.c_attribute4 = modify_flag;
                    var company_id = $('pur9010_vendor_modify_header_ds').getAt(0).get('vendor_id');
                    data.vendor_modify_id = $('pur9010_vendor_modify_header_ds').getAt(0).get('vendor_modify_id');
                    if (company_id) {
                        if ($('pur9010_vendor_modify_account_ds').validate()) {
                            Aurora.request({
                                url: $('pur9010_vendor_modify_bank_save_link').getUrl() + '?company_id=' + company_id,
                                para: data,
                                success: function(res) {
                                    /* Aurora.showMessage('${l:PROMPT}', '保存成功！');
                                     $('pur9010_vendor_modify_account_ds').query(); */
            
                                },
                                scope: this
                            });
                        }
                    } else {
                        Aurora.showMessage('${l:PROMPT}', '${l:请先保存头数据}', null);
                    }
                }
            
            }
            //银行删除
            
            
            function pur9010_vendor_bank_delete() {
                var ds = $('pur9010_vendor_modify_account_ds');
                var records = $('pur9010_vendor_modify_account_ds').getSelected();
                if (records.length == 0) {
                    Aurora.showMessage('${l:PROMPT}', '请选择一行数据！');
                    return;
                }
                for (var i = 0;i < records.length;i++) {
                    var data = {};
                    data.account_id = records[i].get('account_id');
                    data.vendor_modify_id = records[i].get('vendor_modify_id');
                    Aurora.Masker.mask(Ext.getBody());
                    Aurora.request({
                        url: $('pur9010_vendor_modify_bank_delete_link').getUrl(),
                        para: data,
                        success: function(res) {
                            $('pur9010_vendor_modify_account_ds').query();
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        failure: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        error: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        scope: this
                    });
                }
            }
            
            //地址保存
            
            function pur9010_vendor_address_save() {
                var record = $('pur9010_vendor_modify_address_ds').getAll();
                for (var i = 0;i < record.length;i++) {
                    var modify_flag = 'N';
                    if (record[i].isNew || record[i].dirty) {
                        modify_flag = 'Y';
                    }
                    var data = record[i].data;
                    data.c_attribute1 = modify_flag;
                    data.vendor_modify_id = $('pur9010_vendor_modify_header_ds').getAt(0).get('vendor_modify_id');
                    var company_id = $('pur9010_vendor_modify_header_ds').getAt(0).get('vendor_id');
                    if (company_id) {
                        if ($('pur9010_vendor_modify_address_ds').validate()) {
                            Aurora.request({
                                url: $('pur9010_vendor_modify_address_save_link').getUrl() + '?company_id=' + company_id,
                                para: data,
                                success: function(res) {
                                    /* Aurora.showMessage('${l:PROMPT}', '保存成功！');
                                     $('pur9010_vendor_modify_address_ds').query(); */
                                },
                                scope: this
                            });
                        }
                    } else {
                        Aurora.showMessage('${l:PROMPT}', '${l:请先保存头数据}', null);
                    }
                }
            }
            
            //地址删除
            
            function pur9010_vendor_address_delete() {
                var records = $('pur9010_vendor_modify_address_ds').getSelected();
                if (records.length == 0) {
                    Aurora.showMessage('${l:PROMPT}', '请选择一行数据！');
                    return;
                }
                for (var i = 0;i < records.length;i++) {
                    var data = {};
                    data.address_id = records[i].get('address_id');
                    data.vendor_modify_id = records[i].get('vendor_modify_id');
                    Aurora.Masker.mask(Ext.getBody());
                    Aurora.request({
                        url: $('pur9010_vendor_modify_address_delete_link').getUrl(),
                        para: data,
                        success: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                            $('pur9010_vendor_modify_address_ds').query();
                        },
                        failure: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        error: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        scope: this
                    });
                }
            }
            //附件保存
            
            function pur9010_vendor_attach_save() {
                var record = $('pur9050_companySupplierAttachments_ds').getAll();
                for (var i = 0;i < record.length;i++) {
                    var data = record[i].data;
                    var company_id = $('pur9010_vendor_modify_header_ds').getAt(0).get('vendor_id');
                    data.vendor_modify_id = $('pur9010_vendor_modify_header_ds').getAt(0).get('vendor_modify_id');
                    if (company_id) {
                        if ($('pur9050_companySupplierAttachments_ds').validate()) {
                            Aurora.request({
                                url: $('pur9010_vendor_modify_attach_save_link').getUrl() + '?company_id=' + company_id,
                                para: data,
                                success: function(res) {},
                                scope: this
                            });
                        }
                    } else {
                        Aurora.showMessage('${l:PROMPT}', '${l:请先保存头数据}', null);
                    }
                }
            }
            //新增品类保存
            
            function pur9010_vendor_supply_save() {
            
                var record = $('pur9010_vendor_modify_supply_ds').getAll();
                for (var i = 0;i < record.length;i++) {
                    var data = record[i].data;
                    data.vendor_modify_id = $('pur9010_vendor_modify_header_ds').getAt(0).get('vendor_modify_id');
                    var company_id = $('pur9010_vendor_modify_header_ds').getAt(0).get('vendor_id');
                    if (company_id) {
                        if ($('pur9010_vendor_modify_supply_ds').validate()) {
                            Aurora.request({
                                url: $('pur9010_vendor_modify_supply_save_link').getUrl() + '?company_id=' + company_id,
                                para: data,
                                success: function(res) {},
                                scope: this
                            });
                        }
                    } else {
                        Aurora.showMessage('${l:PROMPT}', '${l:请先保存头数据}', null);
                    }
                }
            }
            
            
            function pur9010_vendor_contract_save() {
                var record = $('pur9050_vendor_modify_contract_ds').getAll();
                console.log(record[0].get('vendor_modify_id'));
                var data=[];
                if(!$('pur9050_vendor_modify_contract_ds').validate()){
                    return ;
                }
                for (var i = 0;i < record.length;i++) {
                    console.log(record[i].get('flag'));
                     if(record[i].isNew){
                         record[i].set('change_flag','Y');
                         record[i].set('_status','insert');
                         record[i].set('vendor_modify_id',record[0].get('vendor_modify_id'));
                     }else{
                           if(record[i].get('flag')=='Y'){
                            record[i].set('change_flag','Y');
                           }
                    //data.company_id = vendor_id;
                       record[i].set('_status','update'); 
                     }
                       data.push(record[i].data);  
                    
                }
                
                
                 Aurora.request({
		        	        url:$('pur90101_vendor_modify_contact_save_link').getUrl(),
		        	        para:data,
		        	        success:function(){
	        	                
		        	        },
		        	        failure:function(){
		        	        	Aurora.Masker.unmask(Ext.getBody()); 	    
		        	        },
		        	        error:function(){
		        	        	Aurora.Masker.unmask(Ext.getBody()); 	    
		        	        },
		        	        scope:this
		        	    }); 
            }
            //新增品类删除
            
            function pur9010_vendor_supply_delete() {
                var ds = $('pur9010_vendor_modify_supply_ds');
                var records = $('pur9010_vendor_modify_supply_ds').getSelected();
                if (records.length == 0) {
                    Aurora.showMessage('${l:PROMPT}', '请选择一行数据！');
                    return;
                }
                // for (var j = 0;j < records.length;j++) {
                // ds.remove(records[j]);
                // }
                for (var i = 0;i < records.length;i++) {
                    var data = {};
                    data.ability_lns_id = records[i].get('ability_lns_id');
                    data.vendor_modify_id = records[i].get('vendor_modify_id');
                    Aurora.Masker.mask(Ext.getBody());
                    Aurora.request({
                        url: $('pur9010_vendor_modify_supply_delete_link').getUrl(),
                        para: data,
                        success: function(res) {
                            $('pur9010_vendor_modify_supply_ds').query();
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        failure: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        error: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        scope: this
                    });
                }
            }
            
            //新增业务实体
            
            function pur9010_vendor_ou_save(vendor_modify_id, vendor_id) {
                var record = $('pur9010_vendor_modify_ou_ds').getAll();
                for (var i = 0;i < record.length;i++) {
                    var data = record[i].data;
                    data.vendor_modify_id = $('pur9010_vendor_modify_header_ds').getAt(0).get('vendor_modify_id');
                    var company_id = $('pur9010_vendor_modify_header_ds').getAt(0).get('vendor_id');
                    if (company_id) {
                        if ($('pur9010_vendor_modify_ou_ds').validate()) {
                            Aurora.request({
                                url: $('pur9010_vendor_modify_ou_save_link').getUrl() + '?company_id=' + company_id,
                                para: data,
                                success: function(res) {},
                                scope: this
                            });
                        }
                    } else {
                        Aurora.showMessage('${l:PROMPT}', '${l:请先保存头数据}', null);
                    }
                }
            }
            //业务实体删除
            
            function pur9010_vendor_ou_delete() {
                var ds = $('pur9010_vendor_modify_ou_ds');
                var records = $('pur9010_vendor_modify_ou_ds').getSelected();
                if (records.length == 0) {
                    Aurora.showMessage('${l:PROMPT}', '请选择一行数据！');
                    return;
                }
                for (var j = 0;j < records.length;j++) {
                    ds.remove(records[j]);
                }
                for (var i = 0;i < records.length;i++) {
                    var data = {};
                    data.business_unit_id = records[i].get('business_unit_id');
                    data.vendor_modify_id = records[i].get('vendor_modify_id');
                    Aurora.Masker.mask(Ext.getBody());
                    Aurora.request({
                        url: $('pur9010_vendor_modify_ou_delete_link').getUrl(),
                        para: data,
                        success: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        failure: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        error: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        scope: this
                    });
                }
            }
            
            function pur9050_bank_ds_loadFun(dataSet) {
                var records = dataSet.getAll();
                if (records.length != 0) {
                    for (var i = 0;i < records.length;i++) {
                        records[i].getField('bank_branch_name').setLovPara('bank_code', records[i].get('bank_code'));
                    }
                }
                var record = $('pur9010_vendor_modify_header_ds').getAt(0);
                var modify_status = record.get('modify_status');
                if (modify_status != 'NEW') {
                    $('pur9010_vendor_bank_add_btn').disable();
                    $('pur9010_vendor_bank_delete_btn').disable();
                }
            }
            
            function pur9050_address_ds_loadFun() {
                var record = $('pur9010_vendor_modify_header_ds').getAt(0);
                var modify_status = record.get('modify_status');
                if (modify_status != 'NEW') {
                    // $('pur9010_vendor_address_add_btn').disable();
                    $('pur9010_vendor_address_delete_btn').disable();
                }
            }
            
             function pur9050_contract_ds_loadFun() {
                var record = $('pur9010_vendor_modify_header_ds').getAt(0);
                var modify_status = record.get('modify_status');
                if (modify_status != 'NEW') {
                    $('pur9050_contract_addBtn').disable();
                    $('pur9050_contract_deleteBtn').disable();
                }
            }
            
            function pur9050_supply_ds_loadFun() {
                var record = $('pur9010_vendor_modify_header_ds').getAt(0);
                var modify_status = record.get('modify_status');
                if (modify_status != 'NEW') {
                    $('pur9010_vendor_supply_add_btn').disable();
                    $('pur9010_vendor_supply_delete_btn').disable();
                }
            }
            
            function pur9050_ou_ds_loadFun() {
                var record = $('pur9010_vendor_modify_header_ds').getAt(0);
                var modify_status = record.get('modify_status');
                if (modify_status != 'NEW') {
                    $('pur9010_vendor_ou_add_btn').disable();
                    $('pur9010_vendor_ou_delete_btn').disable();
                }
            }
            
            function pur9050_attach_ds_loadFun() {
                var record = $('pur9010_vendor_modify_header_ds').getAt(0);
                var modify_status = record.get('modify_status');
                if (modify_status != 'NEW') {
                    $('pur9010_vendor_attach_add_btn').disable();
                    $('pur9010_vendor_attach_clear_btn').disable();
                }
            }
            
            function pur9010_vendor_modify_back() {
                $('pur9010_vendor_modify_new').close();
            }
           
           
           
            function pur9050_vendor_contract_deleteDetailFun() {
                var contact_ds = $('pur9050_vendor_modify_contract_ds');
                var records=$('pur9050_vendor_modify_contract_ds').getSelected();
                
                 if(records.length==0 || Aurora.isEmpty(records)){
                    Aurora.showMessage('${l:PROMPT}', '请勾选一行操作');
                    return ;
                }
                var para = [];
                 for( var n=0;n<records.length;n++){
                       if(records[n].get('default_flag')=='Y'){
                                  Aurora.showMessage('${l:PROMPT}', '此联系人无法删除');
                                  return ;
                       }
                        records[n].set('_status', 'delete');
	        	        para.push(records[n].data);
                }
               
                Aurora.request({
                        url: $('pur9010_vendor_contract_detail_delete_link').getUrl(),
                        para: para,
                        success: function(res) {
                            $('pur9050_vendor_modify_contract_ds').query();
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        failure: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        error: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        scope: this
                    });
            }
            
            
            
            function pur9050_details_openUploadAttachmentFun(value, record, name) {
                var modify_status = record.get('modify_status');
                var counts1 = record.get('counts1');
                var counts2 = record.get('counts2');
                var counts3 = record.get('counts3');
                var counts4 = record.get('counts4');
                var counts5 = record.get('counts5');
                if (name == 'line_attachment') {
                    if (modify_status == 'NEW') {
                        return '<a href="javascript:pur9050_details_UploadAttachmentFun(' + record.get('vendor_modify_id') + ')">' + '上传附件' + '</a>';
                    } else {
                        return '<a href="javascript:pur9050_details_checkUploadAttachmentFun(' + record.get('vendor_modify_id') + ',' + "'PUR_VENDOR_MODIFY'" + ')">' + '查看附件' + '</a>';
            
                    }
                }
                if (name == 'company_authorise') {
                    if (counts2 == 0) {
                        document.getElementById('pur9050_company_authorise_attache_img').style.visibility = "hidden";
                    } else {
                        document.getElementById('pur9050_company_authorise_attache_img').style.visibility = "visible";
                    }
                    if (modify_status == 'NEW') {
                        return '<a href="javascript:pur9050_UploadAuthoriseAttachmentFun(' + record.get('vendor_modify_id') + ')">' + '上传附件' + '</a>';
                    } else {
                        return '<a href="javascript:pur9050_details_checkUploadAttachmentFun(' + record.get('vendor_modify_id') + ',' + "'FND_COPANIES.COMPANY_AUTHORISE_MODIFY'" + ')">' + '查看附件' + '</a>';
                    }
                }
                if (name == 'business_license') {
                    if (counts3 == 0) {
                        document.getElementById('pur9050_business_license_attache_img').style.visibility = "hidden";
                    } else {
                        document.getElementById('pur9050_business_license_attache_img').style.visibility = "visible";
                    }
                    if (modify_status == 'NEW') {
                        return '<a href="javascript:pur9050_UploadBusinessAttachmentFun(' + record.get('vendor_modify_id') + ')">' + '上传附件' + '</a>';
                    } else {
                        return '<a href="javascript:pur9050_details_checkUploadAttachmentFun(' + record.get('vendor_modify_id') + ',' + "'FND_COPANIES.BUSINESS_LICENSE_MODIFY'" + ')">' + '查看附件' + '</a>';
                    }
                }
                if (name == 'iso14000') {
                    if (counts4 == 0) {
                        document.getElementById('pur9050_iso14000_attache_img').style.visibility = "hidden";
                    } else {
                        document.getElementById('pur9050_iso14000_attache_img').style.visibility = "visible";
                    }
                    if (modify_status == 'NEW') {
                        return '<a href="javascript:pur9050_UploadIso14000AttachmentFun(' + record.get('vendor_modify_id') + ')">' + '上传附件' + '</a>';
                    } else {
                        return '<a href="javascript:pur9050_details_checkUploadAttachmentFun(' + record.get('vendor_modify_id') + ',' + "'FND_COPANIES.ISO14000_CERTIFICATE_MODIFY'" + ')">' + '查看附件' + '</a>';
                    }
                }
                if (name == 'iso9001') {
                    if (counts5 == 0) {
                        document.getElementById('pur9050_iso9001_attache_img').style.visibility = "hidden";
                    } else {
                        document.getElementById('pur9050_iso9001_attache_img').style.visibility = "visible";
                    }
                    if (modify_status == 'NEW') {
                        return '<a href="javascript:pur9050_UploadIso9001AttachmentFun(' + record.get('vendor_modify_id') + ')">' + '上传附件' + '</a>';
                    } else {
                        return '<a href="javascript:pur9050_details_checkUploadAttachmentFun(' + record.get('vendor_modify_id') + ',' + "'FND_COPANIES.ISO9001_CERTIFICATE_MODIFY'" + ')">' + '查看附件' + '</a>';
                    }
                }
            }
            
            
            
            function pur9050_UploadAttachmentFun(vendor_modify_id) {
                new Aurora.Window({
                    url: $('pur_vendor_modify_details_DocumentViewAttachmentFileDownload_link').getUrl() + '?header_id=' + vendor_modify_id + '&table_name=PUR_VENDOR_MODIFY',
                    title: '${l:ATM.UPLOAD_ATTACHMENT}',
                    id: 'pur9050_po_attm_window',
                    width: 610,
                    height: 500
                });
            }
            
            function pur9050_UploadAuthoriseAttachmentFun(vendor_modify_id) {
                new Aurora.Window({
                    url: $('pur_vendor_modify_details_DocumentViewAttachmentFileDownload_link').getUrl() + '?header_id=' + vendor_modify_id + '&table_name=FND_COPANIES.COMPANY_AUTHORISE_MODIFY',
                    title: '${l:ATM.UPLOAD_ATTACHMENT}',
                    id: 'pur9050_po_attm_window',
                    width: 610,
                    height: 500
                });
            }
            
            function pur9050_UploadBusinessAttachmentFun(vendor_modify_id) {
                new Aurora.Window({
                    url: $('pur_vendor_modify_details_DocumentViewAttachmentFileDownload_link').getUrl() + '?header_id=' + vendor_modify_id + '&table_name=FND_COPANIES.BUSINESS_LICENSE_MODIFY',
                    title: '${l:ATM.UPLOAD_ATTACHMENT}',
                    id: 'pur9050_po_attm_window',
                    width: 610,
                    height: 500
                });
            }
            
            function pur9050_UploadIso14000AttachmentFun(vendor_modify_id) {
                new Aurora.Window({
                    url: $('pur_vendor_modify_details_DocumentViewAttachmentFileDownload_link').getUrl() + '?header_id=' + vendor_modify_id + '&table_name=FND_COPANIES.ISO14000_CERTIFICATE_MODIFY',
                    title: '${l:ATM.UPLOAD_ATTACHMENT}',
                    id: 'pur9050_po_attm_window',
                    width: 610,
                    height: 500
                });
            }
            
            function pur9050_UploadIso9001AttachmentFun(vendor_modify_id) {
                new Aurora.Window({
                    url: $('pur_vendor_modify_details_DocumentViewAttachmentFileDownload_link').getUrl() + '?header_id=' + vendor_modify_id + '&table_name=FND_COPANIES.ISO9001_CERTIFICATE_MODIFY',
                    title: '${l:ATM.UPLOAD_ATTACHMENT}',
                    id: 'pur9050_po_attm_window',
                    width: 610,
                    height: 500
                });
            }
            
            function pur9050_details_checkUploadAttachmentFun(vendor_modify_id, table_name) {
                var url = "${/request/@context_path}/check_uploadFile.screen?table_name=" + table_name + "&header_id=" + vendor_modify_id;
                new Aurora.Window({
                    url: url,
                    title: '${l:HAP_DOWNLOAD}',
                    id: 'pur9050_details_ck_attm_window',
                    width: 610,
                    height: 500
                });
            }
            
            function pur9050_details_UploadAttachmentFun(vendor_modify_id) {
                new Aurora.Window({
                    url: $('pur_vendor_modify_details_DocumentViewAttachmentFileDownload_link').getUrl() + '?header_id=' + vendor_modify_id + '&table_name=PUR_VENDOR_MODIFY',
                    title: '${l:ATM.UPLOAD_ATTACHMENT}',
                    id: 'pur9050_details_po_attm_window',
                    width: 610,
                    height: 500
                });
            }
            
            function pur9050_attachment_ds_submitsuccessFun(dataSet) {
                dataSet.query();
            }
            
            //附件上传和下载
            
            function pur9050_upload_renderer(value, record, name) {
                var header_record = $('pur9010_vendor_modify_header_ds').getAt(0);
                var modify_status = header_record.get('modify_status');
            
                var attachment_id = record.get('attachment_id'); //附件ID
                var atm_counts = record.get('atm_counts'); //附件数
                if (name == "attachment_id") {
                    if (attachment_id) {
                        if (modify_status != 'NEW') {
                            return '<a href="javascript:pur9050_details_checkUploadAttachmentFun(' + attachment_id + ',' + "'FND_COM_SUP_ATTACHMENT'" + ')">查看</a>';
                        } else {
                            return '<a href="javascript:pur9050_attachment_add_fun(' + attachment_id + ')">上传/下载</a>';
                        }
                    }
                }
                if (name == "atm_flag") {
                    if (atm_counts > 0) {
                        return '<div style="margin-top:3px;margin-left:auto;margin-right:auto;vertical-align:middle;height:20px;line-height:20px;"><img src="${/request/@context_path}/images/paperclip.png"/></div>';
            
                    } else {
                        return '';
                    }
                }
            }
            
            function pur9010_bank_branch_ef(record, name) {
                var bank_code = record.get('bank_code');
            
                if (bank_code == 'ABROAD') {
            
                    record.getField('c_attribute1').setReadOnly(false);
            
                    return 'pur9010_bank_code_tf';
            
                } else {
            
                    record.getField('c_attribute1').setReadOnly(true);
            
                    return 'pur9010_bank_code_lov';
                }
            }
            
            
              function setinitdata(ds,record,index){
                  var records_h=$('pur9010_vendor_modify_header_ds').getCurrentRecord();
                  record.set('user_role','其他跟单员');
                   record.set('company_id',records_h.get('coop_company_id'));
                  record.set('default_flag','N');
             }
             
             
              function pur9050_vendor_detail_contract_update(ds, record, name, value, oldvalue) {
                    debugger;
                      if(name=='contact_name'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                           record.set('contact_name_update_flag','Y');
                      } 
                  }
                  
                  
                  if(name=='position'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                           record.set('position_update_flag','Y');
                      } 
                  }
                  
                  if(name=='user_role'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                           record.set('user_role_update_flag','Y');
                     } 
                  }
                  
                  
                   if(name=='enabled_flag'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                           record.set('enabled_flag_update_flag','Y');
                     } 
                  }
                  
                    if(name=='email'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                            record.set('email_update_flag','Y');
                     } 
                  }
                  
                    if(name=='mobile_phone'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                           record.set('mobile_phone_update_flag','Y');
                     } 
                  }
                  
                   if(name=='id_number'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                           record.set('id_number_update_flag','Y');
                     } 
                  }
                  
               
                  
                   if(name=='id_type_name'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                           record.set('id_type_update_flag','Y');
                     } 
                  }
                  
                  
                    if(name=='contact_sex_name'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                           record.set('contact_sex_update_flag','Y');
                     } 
                  }
                }
            
            //附件新增
            
            function pur9050_attachment_add_fun(id) {
                new Aurora.Window({
                    id: 'pur9050_attachment_file_upload_link_window',
                    title: '${l:HAP_UPLOAD_TITLE}',
                    url: '${/request/@context_path}/attachment_file_upload.screen?pkvalue=' + id + '&table_name=FND_COM_SUP_ATTACHMENT',
                    width: 610,
                    height: 500
                }).on('close', function() {
                    $('pur9050_companySupplierAttachments_ds').query();
                });
            }
        ]]></script>
        <a:dataSets>
            <a:dataSet id="pur9050_modify_units_ds">
                <a:datas dataSource="pur9050_modify_units"/>
            </a:dataSet>
            <a:dataSet id="pur9050_user_ds">
                <a:datas dataSource="fnd9050_de"/>
            </a:dataSet>
            <a:dataSet id="fnd9050_account_period_ds">
                <a:datas dataSource="pur9050_account_period"/>
            </a:dataSet>
            <a:dataSet id="pur9050_manufacturer_payment_method_ds">
                <a:datas dataSource="pur9050_manufacturer_payment_method"/>
            </a:dataSet>
            <a:dataSet id="pur9010_manufacturer_product_group_name_ds">
                <a:datas dataSource="pur9010_manufacturer_product_group"/>
            </a:dataSet>
            <a:dataSet id="pur9050_attachment_type_ds">
                <a:datas dataSource="pur9050_attachment_type"/>
            </a:dataSet>
            <a:dataSet id="pur9050_vendor_detail_idType_ds" lookupCode="FND_COM_SUP_INFOS.ID_TYPE"/>
            <a:dataSet id="pur9050_vendor_detail_sex_ds" lookupCode="PUR_SEX"/>
            <a:dataSet id="pur9010_vendor_modify_type_ds" lookupCode="MODIFY_TYPE"/>
            <a:dataSet id="pur9010_vendor_modify_status_create_ds" lookupCode="VENDOR_MODIFY_STATUS"/>
            <a:dataSet id="pur9010_vendor_modify_id_type_create_ds" lookupCode="ID_TYPE"/>
            <a:dataSet id="pur9010_account_period_valid_ds" lookupCode="KW_ACCOUNT_PERIOD_VALID"/>
            <a:dataSet id="pur9010_vendor_material_type_ds" lookupCode="VENDOR_MATERIAL_TYPE"/>
            <a:dataSet id="pur9010_vendor_modify_header_ds" model="pur.PUR9050.pur9010_vendor_modify" queryUrl="${/request/@context_path}/autocrud/pur.PUR9050.pur9010_vendor_modify/query?vendor_modify_id=${/parameter/@vendor_modify_id}">
                <a:datas dataSource="pur9010_vendor_modify"/>
                <a:fields>
                    <a:field name="vendor_modify_id"/>
                    <a:field name="modify_num"/>
                    <a:field name="modify_reason" required="true"/>
                    <a:field name="iso14000_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="iso9001_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="kw_pcb" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="kw_fpc" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="kw_mpcb" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <!-- <a:field name="kw_product_group_name" displayField="flex_desc" options="pur9010_manufacturer_product_group_name_ds" required="true" returnField="kw_product_group" valueField="flex_value"/>
                    <a:field name="kw_product_group"/> -->
                    <a:field name="tax_type_id"/>
                    <a:field name="tax_type_name" lovHeight="500" lovService="pur.PUR5730.pur5730_tax_type_codes_bg_lov?require_business_group=${/model/pur9050_default_data/record/@owner_business_group}" lovWidth="500" prompt="PUR5730.TAX_TYPE_NAME" title="PUR5730.TAX_TYPE_NAME">
                        <a:mapping>
                            <a:map from="tax_type_codes_bg_id" to="tax_type_id"/>
                            <a:map from="tax_type_name" to="tax_type_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="modify_status" readOnly="true"/>
                    <a:field name="modify_status_desc" displayField="code_value_name" options="pur9010_vendor_modify_status_create_ds" readOnly="true" returnField="modify_status" valueField="code_value"/>
                    <a:field name="created_by"/>
                    <a:field name="modify_type"/>
                    <a:field name="modify_type_desc" displayField="code_value_name" options="pur9010_vendor_modify_type_ds" returnField="modify_type" valueField="code_value"/>
                    <a:field name="modify_info"/>
                    <a:field name="vendor_id"/>
                    <a:field name="currency_code" lovHeight="510" lovLabelWidth="100" lovService="fnd.FND9100.fnd_currency_code_lov" lovWidth="650" prompt="FND_COMPANY_REGISTED.REGISTERED_CURRENCY_CODE" title="CURRENCY_SELECTION">
                        <a:mapping>
                            <a:map from="currency_code" to="currency_code"/>
                            <a:map from="currency_oa_id" to="trade_currency_code"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="account_period_desc" displayField="flex_desc" options="fnd9050_account_period_ds" returnField="account_period" valueField="flex_value"/>
                    <a:field name="account_period"/>
                    <a:field name="trade_currency_code"/>
                    <a:field name="business_license_forever" checkedValue="Y" defaultValue="N" prompt="FND_COMPANY_REGISTED.BUSINESS_LICENSE_FOREVER" uncheckedValue="N"/>
                    <a:field name="business_license_end_date" validator="pur9010_founding_dateValidator"/>
                    <a:field name="iso14000_flag_end_date" validator="pur9010_founding_dateValidator"/>
                    <a:field name="iso9001_flag_end_date" validator="pur9010_founding_dateValidator"/>
                    <a:field name="payment_method_name" displayField="flex_desc" options="pur9050_manufacturer_payment_method_ds" returnField="payment_method_code" valueField="flex_value"/>
                    <a:field name="payment_method_code"/>
                    <a:field name="coop_company_id"/>
                    <a:field name="coop_business_group"/>
                    <a:field name="owner_company_id"/>
                    <a:field name="owner_business_group"/>
                    <a:field name="vendor_desc"/>
                    <a:field name="vendor_contact_id"/>
                    <a:field name="contact_name"/>
                    <a:field name="position"/>
                    <a:field name="id_type"/>
                    <a:field name="id_type_desc" displayField="code_value_name" options="pur9010_vendor_modify_id_type_create_ds" returnField="id_type" valueField="code_value"/>
                    <a:field name="finance_rep_identity_desc" displayField="code_value_name" options="pur9010_vendor_modify_id_type_create_ds" returnField="finance_rep_identity_type" valueField="code_value"/>
                    <a:field name="finance_rep_identity_type"/>
                    <a:field name="account_period_valid_desc" displayField="code_value_name" options="pur9010_account_period_valid_ds" required="true" returnField="account_period_valid" valueField="code_value"/>
                    <a:field name="account_period_valid"/>
                    <a:field name="vendor_type_desc" displayField="code_value_name" options="pur9010_vendor_material_type_ds" required="true" returnField="vendor_type" valueField="code_value"/>
                    <a:field name="vendor_type"/>
                    <a:field name="id_number"/>
                    <a:field name="mobile_phone"/>
                    <a:field name="email"/>
                </a:fields>
                <a:events>
                    <a:event name="load" handler="pur9010_vendor_modify_header_ds_loadFcn"/>
                    <a:event name="update" handler="pur9010_vendor_modify_header_ds_updateFcn"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="pur9010_vendor_modify_account_ds" autoQuery="true" model="pur.PUR9050.pur9050_vendor_modify_bank_temp" queryUrl="${/request/@context_path}/autocrud/pur.PUR9050.pur9050_vendor_modify_bank_temp/query?vendor_modify_id=${/parameter/@vendor_modify_id}" selectable="true">
                <!-- <a:datas dataSource="pur9010_vendor_modify_account"/> -->
                <a:fields>
                    <a:field name="vendor_account_modify_id"/>
                    <a:field name="vendor_account_id"/>
                    <a:field name="modify_status"/>
                    <a:field name="vendor_modify_id"/>
                    <a:field name="currency_code" lovHeight="510" lovLabelWidth="100" lovService="fnd.FND9100.fnd_currency_code_lov" lovWidth="650" prompt="FND_COMPANY_REGISTED.REGISTERED_CURRENCY_CODE" title="CURRENCY_SELECTION">
                        <a:mapping>
                            <a:map from="currency_code" to="currency_code"/>
                            <a:map from="currency_oa_id" to="trade_currency_code"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="payment_method_name" lovHeight="500" lovService="pur.PUR9050.pur9050_payment_methods_lov" lovWidth="500" prompt="PUR5730.PAYMENT_METHOD_NAME" title="PUR5730.PAYMENT_METHOD_NAME">
                        <a:mapping>
                            <a:map from="payment_method_code" to="payment_method_code"/>
                            <a:map from="description" to="payment_method_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="bank_code_desc" readOnly="true"/>
                    <a:field name="bank_code" autoComplete="true" autoCompleteField="bank_code" lovGridHeight="330" lovHeight="450" lovService="pur.PUR9050.pur_bank_lov" lovWidth="500" required="true" title="银行信息">
                        <a:mapping>
                            <a:map from="bank_code" to="bank_code"/>
                            <a:map from="bank_name" to="bank_code_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="bank_branch_code"/>
                    <a:field name="bank_branch_name" lovHeight="500" lovWidth="500" readOnly="true" title="开户行名称选择">
                        <a:mapping>
                            <a:map from="branch_name" to="bank_branch_name"/>
                            <a:map from="bank_branch_code" to="c_attribute1"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="c_attribute1" readOnly="true"/>
                    <a:field name="bank_account_name"/>
                    <a:field name="bank_account_number"/>
                    <a:field name="b_comment"/>
                    <a:field name="primary_account_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="enabled_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                </a:fields>
                <a:events>
                    <a:event name="load" handler="pur9050_bank_ds_loadFun"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="pur9050_vendor_modify_contract_ds" autoQuery="true" model="pur.PUR9050.pur9050_contract_query" queryUrl="${/request/@context_path}/autocrud/pur.PUR9050.pur9050_contract_query/query?vendor_modify_id=${/parameter/@vendor_modify_id}" selectable="true">
                <a:fields>
                    <a:field name="contact_id"/>
                    <a:field name="user_role" displayField="flex_desc" options="pur9050_user_ds" required="true" returnField="user_role" valueField="flex_value"/>
                    <a:field name="vendor_modify_id"/>
                    <a:field name="contact_new_id"/>
                    <a:field name="contact_name" required="true" requiredMessage="${l:FND_COM_SUP_CONTACTS.CONTACT_NAME}${l:PROMPT.INPUT}"/>
                    <a:field name="contact_sex"/>
                    <a:field name="contact_sex_name" displayField="code_value_name" options="pur9050_vendor_detail_sex_ds" required="true" returnField="contact_sex" valueField="code_value"/>
                    <a:field name="id_type"/>
                    <a:field name="id_type_name" displayField="code_value_name" options="pur9050_vendor_detail_idType_ds" returnField="id_type" valueField="code_value"/>
                    <a:field name="id_number"/>
                    <a:field name="department"/>
                    <a:field name="flag"/>
                    <a:field name="company_id"/>
                    <a:field name="change_flag"/>
                    <a:field name="position"/>
                    <a:field name="contact_name_update_flag"/>
                    <a:field name="user_role_update_flag"/>
                    <a:field name="contact_sex_update_flag"/>
                    <a:field name="enabled_flag_update_flag"/>
                    <a:field name="id_type_update_flag"/>
                    <a:field name="id_number_update_flag"/>
                    <a:field name="department_update_flag"/>
                    <a:field name="position_update_flag"/>
                    <a:field name="email_update_flag"/>
                    <a:field name="enabled_flag_update_flag"/>
                    <a:field name="mobile_phone_update_flag"/>
                    <a:field name="default_flag"/>
                    <a:field name="mobile_phone" requiredMessage="${l:FND_COM_SUP_CONTACTS.MOBIL}${l:PROMPT.INPUT}"/>
                    <a:field name="telephone"/>
                    <a:field name="email" required="true"/>
                    <a:field name="default_contact_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="c_attribute2" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="contact_comments"/>
                    <a:field name="enabled_flag" checkedValue="Y" defaultValue="Y" uncheckedValue="N"/>
                </a:fields>
                <a:events>
                    <a:event name="load" handler="pur9050_contract_ds_loadFun"/>
                    <a:event name="update" handler="pur9050_vendor_detail_contract_update"/>
                    <a:event name="add" handler="setinitdata"/>
                </a:events>
            </a:dataSet>
            <!-- <a:dataSet id="pur5721_vendor_site_status_list_ds" loadData="true" model="pur.PUR5721.pur5721_vendor_site_combox"/> -->
            <a:dataSet id="pur9010_vendor_modify_address_ds" autoQuery="true" model="pur.PUR9050.pur9050_vendor_modify_address_temp" queryUrl="${/request/@context_path}/autocrud/pur.PUR9050.pur9050_vendor_modify_address_temp/query?vendor_modify_id=${/parameter/@vendor_modify_id}" selectable="true">
                <a:fields>
                    <a:field name="address_id"/>
                    <a:field name="country_code"/>
                    <a:field name="country_code_desc" lovHeight="500" lovService="public.fnd_country_lov" lovWidth="500" required="true" requiredMessage="${l:FND_COM_SUP_ADDRESSES.COUNTRY_CODE}${l:PROMPT.INPUT}" title="FND_COM_SUP_ADDRESSES.COUNTRY_CODE_CHOOSE">
                        <a:mapping>
                            <a:map from="country_code" to="country_code"/>
                            <a:map from="country_name" to="country_code_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="province_id"/>
                    <a:field name="province_desc" lovHeight="500" lovWidth="500" readOnly="true" title="FND_COM_SUP_ADDRESSES.PROVINCE_CHOOSE">
                        <a:mapping>
                            <a:map from="province_id" to="province_id"/>
                            <a:map from="province_name" to="province_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="city_id"/>
                    <a:field name="city_desc" lovHeight="500" lovWidth="500" readOnly="true" title="FND_COM_SUP_ADDRESSES.CITY_CHOOSE">
                        <a:mapping>
                            <a:map from="city_id" to="city_id"/>
                            <a:map from="city_name" to="city_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="address_detail" required="true" requiredMessage="${l:FND_COM_SUP_ADDRESSES.ADDRESS_DETAIL_ID}${l:PROMPT.INPUT}"/>
                    <a:field name="enabled_flag" checkedValue="Y" defaultValue="Y" uncheckedValue="N"/>
                </a:fields>
                <a:events>
                    <a:event name="load" handler="pur9050_address_ds_loadFun"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="pur9010_vendor_modify_supply_ds" autoQuery="true" model="pur.PUR9050.pur9050_vendor_modify_supply_temp" queryUrl="${/request/@context_path}/autocrud/pur.PUR9050.pur9050_vendor_modify_supply_temp/query?vendor_modify_id=${/parameter/@vendor_modify_id}" selectable="true">
                <a:fields>
                    <a:field name="category_code" autoComplete="false" autoCompleteField="category_name" lovGridHeight="360" lovHeight="500" lovService="cux.KINWONG.fnd.fnd3010.mtl_category_lov" lovWidth="600" required="true" title="品类查询">
                        <a:mapping>
                            <a:map from="category_code" to="category_code"/>
                            <a:map from="category_name" to="category_name"/>
                            <a:map from="category_udf_id" to="category_udf_id"/>
                        </a:mapping>
                    </a:field>
                </a:fields>
                <a:events>
                    <a:event name="load" handler="pur9050_supply_ds_loadFun"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="pur9050_companySupplierAttachments_ds" autoQuery="true" model="pur.PUR9050.pur9050_vendor_modify_attachment" queryUrl="${/request/@context_path}/autocrud/pur.PUR9050.pur9050_vendor_modify_attachment/query?vendor_modify_id=${/parameter/@vendor_modify_id}" selectable="true">
                <a:fields>
                    <a:field name="attachment_id"/>
                    <a:field name="company_id"/>
                    <a:field name="attachment_name"/>
                    <a:field name="attachment_type"/>
                    <a:field name="attachment_type_desc" displayField="flex_desc" options="pur9050_attachment_type_ds" required="true" returnField="attachment_type" valueField="flex_value"/>
                    <a:field name="required_flag" checkedValue="Y" defaultValue="N" readOnly="true" uncheckedValue="N"/>
                    <a:field name="invalid_date"/>
                    <a:field name="last_upload_date"/>
                </a:fields>
                <a:events>
                    <a:event name="submitsuccess" handler="pur9050_attachment_ds_submitsuccessFun"/>
                    <a:event name="load" handler="pur9050_attach_ds_loadFun"/>
                </a:events>
            </a:dataSet>
            <!--  <a:dataSet id="pur9010_vendor_modify_ou_ds" autoQuery="true" model="pur.PUR9050.pur9050_vendor_modify_ou_temp" queryUrl="${/request/@context_path}/autocrud/pur.PUR9050.pur9050_vendor_modify_ou_temp/query?vendor_modify_id=${/parameter/@vendor_modify_id}" selectable="true">
                <a:fields>
                    <a:field name="business_unit_name" displayField="flex_desc" options="pur9050_modify_units_ds" required="true" returnField="business_unit_name_id" valueField="flex_value"/>
                    <a:field name="business_unit_name_id"/>
                </a:fields>
                <a:events>
                    <a:event name="load" handler="pur9050_ou_ds_loadFun"/>
                </a:events>
            </a:dataSet> -->
        </a:dataSets>
        <a:screenBody>
            <a:screenTopToolbar>
                <a:toolbarButton id="pur9010_vendor_modify_save_btn" click="pur9010_vendor_modify_save" text="保存" width="100"/>
                <a:toolbarButton id="pur9010_vendor_modify_submit_btn" click="pur9010_vendor_modify_submit" text="提交" width="100"/>
                <a:toolbarButton id="pur9010_vendor_modify_delete_btn" click="pur9010_vendor_modify_delete" text="删除" width="100"/>
                <a:toolbarButton click="pur9010_vendor_modify_back" text="返回" width="100"/>
            </a:screenTopToolbar>
            <a:fieldSet style="margin-top:10px;margin-left:2px;" title="" width="800">
                <a:hBox labelWidth="120">
                    <a:comboBox name="modify_status_desc" bindTarget="pur9010_vendor_modify_header_ds" prompt="状态" readOnly="true"/>
                    <a:textField name="modify_num" bindTarget="pur9010_vendor_modify_header_ds" prompt="申请编号" readOnly="true"/>
                    <a:lov name="created_by_desc" bindTarget="pur9010_vendor_modify_header_ds" prompt="创建人" readOnly="true"/>
                </a:hBox>
                <a:hBox labelWidth="105">
                    <a:textField name="business_group_name" bindTarget="pur9010_vendor_modify_header_ds" prompt="集团名称" readOnly="true"/>
                    <a:label name="line_attachment" bindTarget="pur9010_vendor_modify_header_ds" prompt="上传附件" renderer="pur9050_details_openUploadAttachmentFun"/>
                </a:hBox>
                <a:hBox labelWidth="105">
                    <a:textArea name="modify_reason" bindTarget="pur9010_vendor_modify_header_ds" height="60" prompt="变更原因" width="670"/>
                </a:hBox>
                <a:hBox id="pur9050_reject_reason_id" labelWidth="105">
                    <a:textArea name="reject_reason" bindTarget="pur9010_vendor_modify_header_ds" height="60" prompt="审批意见" readOnly="true" width="670"/>
                </a:hBox>
            </a:fieldSet>
            <a:fieldSet style="margin-top:10px;margin-left:2px;" title="更新信息" width="800">
                <a:fieldSet title="基本信息">
                    <a:hBox>
                        <a:textField name="vendor_desc" bindTarget="pur9010_vendor_modify_header_ds" prompt="公司名称"/>
                        <a:comboBox name="account_period_desc" bindTarget="pur9010_vendor_modify_header_ds" prompt="账期"/>
                        <a:lov name="currency_code" bindTarget="pur9010_vendor_modify_header_ds" prompt="ACP_BILL_SOURCE.CURRENCY_CODE"/>
                    </a:hBox>
                    <a:hBox>
                        <a:comboBox name="account_period_valid_desc" bindTarget="pur9010_vendor_modify_header_ds" prompt="账期生效方式"/>
                        <a:comboBox name="vendor_type_desc" bindTarget="pur9010_vendor_modify_header_ds" prompt="供应商类型"/>
                    </a:hBox>
                    <a:hBox>
                        <a:comboBox name="payment_method_name" bindTarget="pur9010_vendor_modify_header_ds" prompt="PUR5730.PAYMENT_METHOD_NAME"/>
                        <a:lov name="tax_type_name" bindTarget="pur9010_vendor_modify_header_ds" prompt="PUR5730.TAX_TYPE_NAME"/>
                        <!-- <a:comboBox name="kw_product_group_name" bindTarget="pur9010_vendor_modify_header_ds" prompt="景旺事业部"/> -->
                    </a:hBox>
                    <a:hBox>
                        <a:label prompt="景旺产品线" width="0"/>
                        <a:checkBox name="kw_pcb" bindTarget="pur9010_vendor_modify_header_ds" prompt="PCB"/>
                        <a:checkBox name="kw_fpc" bindTarget="pur9010_vendor_modify_header_ds" prompt="FPC"/>
                        <a:checkBox name="kw_mpcb" bindTarget="pur9010_vendor_modify_header_ds" prompt="MPCB"/>
                    </a:hBox>
                </a:fieldSet>
                <a:fieldSet title="附件信息">
                    <a:hBox labelWidth="110">
                        <a:label name="company_authorise" bindTarget="pur9010_vendor_modify_header_ds" prompt="公司授权证明(加盖章)" renderer="pur9050_details_openUploadAttachmentFun"/>
                        <img id="pur9050_company_authorise_attache_img" alt="有附件" height="20" src="${/request/@context_path}/images/paperclip.png" title="有附件" width="20"/>
                    </a:hBox>
                    <a:hBox labelWidth="110">
                        <a:label name="business_license" bindTarget="pur9010_vendor_modify_header_ds" prompt="公司营业执照" renderer="pur9050_details_openUploadAttachmentFun"/>
                        <img id="pur9050_business_license_attache_img" alt="有附件" height="20" src="${/request/@context_path}/images/paperclip.png" title="有附件" width="20"/>
                        <a:datePicker name="business_license_end_date" bindTarget="pur9010_vendor_modify_header_ds" prompt="营业期限" width="90"/>
                        <a:checkBox name="business_license_forever" bindTarget="pur9010_vendor_modify_header_ds"/>
                    </a:hBox>
                    <a:hBox labelWidth="110">
                        <a:checkBox name="iso14000_flag" bindTarget="pur9010_vendor_modify_header_ds" prompt="ISO14000认证"/>
                        <a:checkBox name="iso9001_flag" bindTarget="pur9010_vendor_modify_header_ds" prompt="ISO9001认证"/>
                    </a:hBox>
                    <a:hBox id="pur9050_iso14000_hBox" labelWidth="110">
                        <a:datePicker name="iso14000_flag_end_date" bindTarget="pur9010_vendor_modify_header_ds" prompt="ISO14000有效期" width="90"/>
                        <a:label width="50"/>
                        <a:label name="iso14000" bindTarget="pur9010_vendor_modify_header_ds" prompt="ISO14000认证" renderer="pur9050_details_openUploadAttachmentFun"/>
                        <img id="pur9050_iso14000_attache_img" alt="有附件" height="20" src="${/request/@context_path}/images/paperclip.png" title="有附件" width="20"/>
                    </a:hBox>
                    <a:hBox id="pur9050_iso9001_hBox" labelWidth="110">
                        <a:datePicker name="iso9001_flag_end_date" bindTarget="pur9010_vendor_modify_header_ds" prompt="ISO9001有效期" width="90"/>
                        <a:label width="50"/>
                        <a:label name="iso9001" bindTarget="pur9010_vendor_modify_header_ds" prompt="ISO9001认证" renderer="pur9050_details_openUploadAttachmentFun"/>
                        <img id="pur9050_iso9001_attache_img" alt="有附件" height="20" src="${/request/@context_path}/images/paperclip.png" title="有附件" width="20"/>
                    </a:hBox>
                </a:fieldSet>
            </a:fieldSet>
            <a:tabPanel id="pur9010_vendor_modify_tab" height="380" marginWidth="70">
                <a:tabs>
                    <a:tab prompt="银行信息" width="100">
                        <a:grid id="pur9010_vendor_modify_create_account_grid" bindTarget="pur9010_vendor_modify_account_ds" height="330" marginWidth="80" navBar="true">
                            <a:toolBar>
                                <a:button id="pur9010_vendor_bank_add_btn" type="add"/>
                                <!-- <a:button id="pur9010_vendor_bank_save_btn" click="pur9010_vendor_bank_save" text="保存"/> -->
                                <a:button id="pur9010_vendor_bank_delete_btn" click="pur9010_vendor_bank_delete" text="删除"/>
                            </a:toolBar>
                            <a:columns>
                                <a:column name="bank_code" align="center" editor="pur9010_bank_code_lov" prompt="银行代码" width="60"/>
                                <a:column name="bank_code_desc" align="center" prompt="银行名称" width="80"/>
                                <!-- <a:column name="bank_code_desc" align="center" prompt="银行名称" width="150"/> -->
                                <a:column name="bank_branch_name" align="center" editorFunction="pur9010_bank_branch_ef" prompt="开户行名称" width="80"/>
                                <a:column name="c_attribute1" align="left" editor="pur9010_bank_code_tf" prompt="CNAPS号" width="80"/>
                                <a:column name="bank_account_name" align="center" editor="pur9010_bank_code_tf" prompt="账户名称" width="80"/>
                                <a:column name="bank_account_number" align="center" editor="pur9010_bank_code_tf" prompt="银行账号" width="80"/>
                                <a:column name="payment_method_name" align="left" editor="pur9010_bank_code_lov" prompt="PUR5730.PAYMENT_METHOD_NAME" width="80"/>
                                <a:column name="currency_code" align="left" editor="pur9010_bank_code_lov" prompt="ACP_BILL_SOURCE.CURRENCY_CODE" width="80"/>
                                <!-- <a:column name="b_comment" align="center" editor="pur9010_bank_code_tf" prompt="银行备注" width="200"/> -->
                                <a:column name="primary_account_flag" align="center" editor="pur9010_bank_code_cb" prompt="主账户" width="60"/>
                                <a:column name="enabled_flag" align="center" editor="pur9010_bank_code_cb" prompt="启用" width="60"/>
                            </a:columns>
                            <a:editors>
                                <a:textField id="pur9010_bank_code_tf"/>
                                <a:lov id="pur9010_bank_code_lov"/>
                                <a:checkBox id="pur9010_bank_code_cb"/>
                            </a:editors>
                            <a:events>
                                <a:event name="cellclick" handler="pur9050_manufacturer_accountsCellClick_fun"/>
                            </a:events>
                        </a:grid>
                    </a:tab>
                    <a:tab prompt="地址信息" width="100">
                        <a:grid id="pur9010_vendor_modify_create_address_grid" bindTarget="pur9010_vendor_modify_address_ds" height="330" marginWidth="80" navBar="true">
                            <a:toolBar>
                                <!-- <a:button id="pur9010_vendor_address_add_btn" type="add"/> -->
                                <!-- <a:button id="pur9010_vendor_address_save_btn" click="pur9010_vendor_address_save" text="保存"/> -->
                                <a:button id="pur9010_vendor_address_delete_btn" click="pur9010_vendor_address_delete" text="删除"/>
                            </a:toolBar>
                            <a:columns>
                                <a:column name="country_code_desc" align="left" editor="fnd9220_site_lov" prompt="FND_COM_SUP_ADDRESSES.COUNTRY_CODE" width="120"/>
                                <a:column name="province_desc" align="left" editor="fnd9220_site_lov" prompt="FND_COM_SUP_ADDRESSES.PROVINCE_ID" width="100"/>
                                <a:column name="city_desc" align="left" editor="fnd9220_site_lov" prompt="FND_COM_SUP_ADDRESSES.CITY_ID" width="100"/>
                                <a:column name="address_detail" align="left" editor="fnd9220_site_tf" prompt="FND_COM_SUP_ADDRESSES.ADDRESS_DETAIL_ID" width="150"/>
                                <a:column name="post_code" align="left" editor="fnd9220_site_tf" prompt="FND_COM_SUP_ADDRESSES.POST_CODE" width="60"/>
                                <a:column name="address_comments" align="left" editor="fnd9220_site_tf" prompt="FND_COM_SUP_ADDRESSES.ADDRESS_COMMENTS" width="150"/>
                                <a:column name="enabled_flag" align="center" editor="fnd9220_site_cb" prompt="FND_COM_SUP_ADDRESSES.ENABLED_FLAG" width="60"/>
                            </a:columns>
                            <a:editors>
                                <a:lov id="fnd9220_site_lov"/>
                                <a:textField id="fnd9220_site_tf"/>
                                <a:checkBox id="fnd9220_site_cb"/>
                            </a:editors>
                            <a:events>
                                <a:event name="cellclick" handler="pur9050_addressesCellClick_fun"/>
                            </a:events>
                        </a:grid>
                    </a:tab>
                    <a:tab prompt="新增可供品类" width="100">
                        <a:grid id="pur9010_vendor_modify_create_supply_grid" bindTarget="pur9010_vendor_modify_supply_ds" height="330" marginWidth="80" navBar="true">
                            <a:toolBar>
                                <a:button id="pur9010_vendor_supply_add_btn" type="add"/>
                                <a:button id="pur9010_vendor_supply_delete_btn" click="pur9010_vendor_supply_delete" text="删除"/>
                            </a:toolBar>
                            <a:columns>
                                <a:column name="category_code" align="center" editor="pur9050_supply_ability_lns_ds_lv" prompt="PUR2520.PUR_CATEGORY_CODE" width="100"/>
                                <a:column name="category_name" prompt="PUR2520.PUR_CATEGORY_NAME" width="120"/>
                            </a:columns>
                            <a:editors>
                                <a:lov id="pur9050_supply_ability_lns_ds_lv"/>
                            </a:editors>
                        </a:grid>
                    </a:tab>
                    <a:tab prompt="FND9220.ATTACHMENT_INFORMATION" width="100">
                        <a:grid bindTarget="pur9050_companySupplierAttachments_ds" height="330" marginWidth="80" navBar="true">
                            <a:toolBar>
                                <a:button id="pur9010_vendor_attach_add_btn" type="add"/>
                                <a:button id="pur9010_vendor_attach_clear_btn" type="clear"/>
                            </a:toolBar>
                            <a:columns>
                                <a:column name="attachment_type_desc" align="center" editor="pur9050_com_sup_attachment_tab_cbb" prompt="附件类型" width="100"/>
                                <a:column name="attachment_name" editor="pur9050_com_sup_attachment_tab_tf" prompt="附件描述" width="200"/>
                                <a:column name="required_flag" align="center" prompt="是否必传" width="80"/>
                                <a:column name="invalid_date" align="center" editor="pur9050_com_sup_attachment_tab_dp" prompt="文件到期日" renderer="Aurora.formatDate" width="100"/>
                                <a:column name="last_upload_date" align="center" prompt="最后上传时间" width="130"/>
                                <a:column name="attachment_id" align="center" prompt="附件信息" renderer="pur9050_upload_renderer" width="100"/>
                                <a:column name="atm_flag" align="center" renderer="pur9050_upload_renderer" width="20"/>
                            </a:columns>
                            <a:editors>
                                <a:comboBox id="pur9050_com_sup_attachment_tab_cbb"/>
                                <a:textField id="pur9050_com_sup_attachment_tab_tf"/>
                                <a:datePicker id="pur9050_com_sup_attachment_tab_dp"/>
                            </a:editors>
                        </a:grid>
                    </a:tab>
                    <!-- <a:tab prompt="新增业务实体" width="100">
                        <a:grid id="pur9010_vendor_modify_create_ou_grid" bindTarget="pur9010_vendor_modify_ou_ds" height="330" marginWidth="80" navBar="true">
                            <a:toolBar>
                                <a:button id="pur9010_vendor_ou_add_btn" type="add"/>
                                <a:button id="pur9010_vendor_ou_delete_btn" click="pur9010_vendor_ou_delete" text="删除"/>
                            </a:toolBar>
                            <a:columns>
                                <a:column name="business_unit_name" align="center" editor="pur9050_vendor_ou_ds_cbb" prompt="业务实体" width="100"/>
                            </a:columns>
                            <a:editors>
                                <a:comboBox id="pur9050_vendor_ou_ds_cbb"/>
                            </a:editors>
                        </a:grid>
                    </a:tab> -->
                    <a:tab prompt="FND9220.CONTACT_INFORMATION" width="90">
                        <a:grid bindTarget="pur9050_vendor_modify_contract_ds" marginHeight="280" marginWidth="45" navBar="true" width="1000">
                            <a:toolBar>
                                <a:button id="pur9050_contract_addBtn" type="add"/>
                                <a:label width="10"/>
                                <!--    <a:button click="pur9050_vendor_contract_saveFun" text="PROMPT.SAVE"/>
                                <a:label width="10"/> -->
                                <a:button id="pur9050_contract_deleteBtn" click="pur9050_vendor_contract_deleteDetailFun" text="删除"/>
                            </a:toolBar>
                            <a:columns>
                                <a:column name="contact_name" align="left" editor="pur9050_manufacturer_contact_tf" prompt="FND_COM_SUP_CONTACTS.CONTACT_NAME" width="65"/>
                                <a:column name="contact_sex_name" align="left" editor="pur9050_manufacturer_contact_cbx" prompt="FND_COM_SUP_CONTACTS.SEX" width="40"/>
                                <a:column name="user_role" align="left" editor="pur9050_manufacturer_contact_cbx" prompt="角色" width="80"/>
                                <a:column name="position" align="left" editor="pur9050_manufacturer_contact_tf" prompt="FND_COM_SUP_CONTACTS.POSITION" width="80"/>
                                <a:column name="mobile_phone" align="left" editor="pur9050_manufacturer_contact_tf" prompt="FND_COM_SUP_CONTACTS.MOBIL" width="100"/>
                                <a:column name="email" align="left" editor="pur9050_manufacturer_contact_tf" prompt="FND_COM_SUP_CONTACTS.EMAIL" width="120"/>
                                <a:column name="id_type_name" align="left" editor="pur9050_manufacturer_contact_cbx" prompt="FND_COM_SUP_CONTACTS.ID_TYPE" width="60"/>
                                <a:column name="id_number" align="left" editor="pur9050_manufacturer_contact_tf" prompt="FND_COM_SUP_CONTACTS.ID_NUMBER" width="120"/>
                                <!--  <a:column name="default_contact_flag" align="center" editor="pur9050_manufacturer_contact_cb" prompt="业务负责人" width="65"/> -->
                                <!-- FND_COM_SUP_CONTACTS.CONTACT_COMMENTS -->
                                <a:column name="enabled_flag" align="center" editor="pur9050_manufacturer_contact_cb" prompt="FND_COM_SUP_CONTACTS.ENABLED_FLAG" width="40"/>
                            </a:columns>
                            <a:editors>
                                <a:textField id="pur9050_manufacturer_contact_tf"/>
                                <a:comboBox id="pur9050_manufacturer_contact_cbx"/>
                                <a:checkBox id="pur9050_manufacturer_contact_cb"/>
                            </a:editors>
                        </a:grid>
                    </a:tab>
                </a:tabs>
            </a:tabPanel>
        </a:screenBody>
        <script><![CDATA[
            init();
            // Aurora.onReady(function() {
            
                // fnd9220_set_upload_init('vendor_modify_upload_au', 150);
                // fnd9220_set_upload_init('vendor_modify_upload_1', 150);
                // fnd9220_set_upload_init('vendor_modify_upload_2', 150);
                // fnd9220_set_upload_init('vendor_modify_upload_3', 150);
            
                // function fnd9220_set_upload_init(id, w) {
                    // var div = document.getElementById(id);
                    // if (div) {
                        // div.children[1].style.minHeight = '24px';
                        // div.children[1].style.minWidth = w + 'px';
                        // div.children[1].style.border = '1px solid #dfe0e0';
                        // div.children[1].children[1].style.padding = '2px';
                        // div.children[1].style.marginTop = '0px';
                        // div.children[0].children[0].style.opacity = '0';
                        // div.children[0].children[0].style.height = '26px';
                        // var span = document.getElementById(id + '_span');
                        // if (span) {
                            // span.parentNode.style.position = 'relative';
                        // }
                    // } else {
                        // div = document.getElementById(id + '_ul').parentNode;
                        // div.className = 'registed-ie-upload';
                        // div.style.border = '1px solid #dfe0e0';
                        // //div.parentNode.children[0].className = 'registed-ieupload-span';
                    // }
            
                // }
            // });
        ]]></script>
    </a:view>
</a:screen>

<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: IsaacF  
    $Date: 2013-6-25 下午7:34:51  
    $Revision: 1.0  
    $Purpose: 
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application" xmlns:s="aurora.plugin.script" trace="true">
    <a:init-procedure>
        <a:model-query fetchAll="true" model="public.pur_rfx_types_list" rootPath="pur51302_rfx_types_source"/>
        <a:model-query fetchAll="true" model="public.csh_payment_methods_list" rootPath="pur51302_payment_methods_source"/>
        <a:model-query fetchAll="true" model="public.currency_list" rootPath="pur51302_currency_source"/>
        <a:model-query fetchAll="true" model="pur.PUR5130.pur_bg_rfx_type" rootPath="pur51302_bg_rfx_type"/>
        <!-- <a:model-query fetchAll="true" model="public.fnd_tax_type_code_lov" rootPath="pur51302_tax_type_code_source"/> -->
    </a:init-procedure>
    <a:view>
        <a:link id="pur51302_rfx_first_trial_save_link" url="${/request/@context_path}/modules/pur/PUR5130/pur_rfx_save.svc"/>
        <a:link id="pur51302_rfx_first_trial_issue_link" url="${/request/@context_path}/modules/pur/PUR5130/pur_rfx_first_trial_issue.svc"/>
        <a:link id="pur51302_rfx_quote_link" url="${/request/@context_path}/modules/pur/PUR5130/pur_rfx_quote_edit.screen"/>
        <a:link id="pur51302_rfx_quote_create_link" url="${/request/@context_path}/modules/pur/PUR5130/pur_rfx_quote_create.screen"/>
        <a:link id="bid5040_eidt_random_choose_link" url="${/request/@context_path}/modules/bid/BID5040/bid_entrustment_expert_random_choose.screen"/>
        <a:link id="pur51302_attachment_file_upload_link" url="${/request/@context_path}/attachment_file_upload.screen"/>
        <a:link id="pur5130_rfx_password_define_link" url="${/request/@context_path}/modules/pur/PUR5130/pur_rfx_password_define.screen"/>
        <a:link id="pur51302_rfx_operation_records_link" url="${/request/@context_path}/modules/pur/public/pur_rfx_operation_records.screen"/>
        <a:link id="pur51302_ladderInquiryEdit_link" url="${/request/@context_path}/modules/pur/PUR5130/pur_rfx_ladder_inquiry.screen"/>
        <a:link id="pur_rfx_element_expert_assign_link" url="${/request/@context_path}/modules/pur/PUR5130/pur_rfx_element_expert_assign.screen"/>
        <a:link id="pur51302_expressFrame_maintain_link" url="${/request/@context_path}/modules/pur/PUR5130/pur_rfx_express_frame_maintain.screen"/>
        <a:link id="pur51302_logisticsFrame_maintain_link" url="${/request/@context_path}/modules/pur/PUR5130/pur_rfx_domestic_logistics_frame_maintain.screen"/>
        <a:link id="pur51302_vehicleFrame_maintain_link" url="${/request/@context_path}/modules/pur/PUR5130/pur_rfx_vehicle_logistics_frame_maintain.screen"/>
        <style><![CDATA[
  .desc-a-part{
    text-indent: 1em;
    font-size:14px;
    color:#444;
}
   .desc-a-part a{
    color:#19a2d5;
}     
        ]]></style>
        <script><![CDATA[
            function pur51302_rfx_headers_ds_update(ds, record, name, value, oldvalue) {
            
                if (name == 'rfx_category') {
                    pur51302_set_rfx_header_rules(record, value);
            
                    if (value == 'RFU') {
                        record.getMeta().getField('rfx_method_desc').setReadOnly(true);
                        record.set('rfx_method', 'INVITE');
                        record.set('rfx_method_desc', '${l:PUR5611.INVITATION}');
                    } else {
                        record.getMeta().getField('rfx_method_desc').setReadOnly(false);
                    }
            
                } else if (name == 'owner_business_unit_id') {
                    var item_records = $("pur51302_rfx_ln_items_ds").getAll();
                    for (var i = 0;i < item_records.length;i++) {
                        item_records[i].set('owner_business_unit_id', value);
                    }
                } else if (name == 'currency_code' || name == 'functional_currency_code') {
                    var functional_currency_code = record.get('functional_currency_code');
                    var currency_code = record.get('currency_code');
                    if (functional_currency_code != currency_code) {
                        record.set('exchange_rate', '');
                        //record.getMeta().getField('exchange_rate').setRequired(true);
                        record.getMeta().getField('exchange_rate').setReadOnly(false);
                    } else {
                        record.set('exchange_rate', 1);
                        record.getMeta().getField('exchange_rate').setRequired(false);
                        record.getMeta().getField('exchange_rate').setReadOnly(true);
                    }
                } else if (name == 'tax_included_flag') {
                    record.set('tax_type_id', '');
                    record.set('tax_type_code', '');
                    record.set('tax_type_desc', '');
                    record.set('tax_type_rate', '');
                    if (value == 'Y') {
                        record.getMeta().getField('tax_type_desc').setRequired(true);
                        record.getMeta().getField('tax_type_desc').setReadOnly(false);
                    } else {
                        record.getMeta().getField('tax_type_desc').setRequired(false);
                        record.getMeta().getField('tax_type_desc').setReadOnly(true);
                    }
                } else if (name == 'sealed_bid_flag') {
                    if (value == 'Y' && record.get('password_flag') == 'Y') {
                        document.getElementById("pur_rfx_password_div").style.visibility = "visible"; //显示
                    } else {
            
                        document.getElementById("pur_rfx_password_div").style.visibility = "hidden"; //隐藏
                    }
                } else if (name == 'password_flag') {
                    if (value == 'Y') {
                        document.getElementById("pur_rfx_password_div").style.visibility = "visible"; //显示
                    } else {
            
                        document.getElementById("pur_rfx_password_div").style.visibility = "hidden"; //隐藏
                    }
                } else if (name == 'score_mode') {
                    if (value == 'TECH_BIZ') {
                        record.set('team_1', 'TECHNOLOGY');
                        record.set('team_2', 'BUSINESS');
                        record.set('sequence_num_1', '1');
                        record.set('sequence_num_2', '2');
                        record.set('team_1_desc', '${l:BID_ENTRUSTMENT_TECHNOLOGY_TEAM}');
                        record.set('team_2_desc', '${l:BID_ENTRUSTMENT_BUSINESS_TEAM}');
                        document.getElementById('bid5040_expertScore_div').style.display = "block";
                        document.getElementById('bid5040_expertScore_no_div').style.display = "none";
                    } else if (value == 'BIZ_TECH') {
                        record.set('team_1', 'BUSINESS');
                        record.set('team_2', 'TECHNOLOGY');
                        record.set('sequence_num_1', '1');
                        record.set('sequence_num_2', '2');
                        record.set('team_1_desc', '${l:BID_ENTRUSTMENT_BUSINESS_TEAM}');
                        record.set('team_2_desc', '${l:BID_ENTRUSTMENT_TECHNOLOGY_TEAM}');
                        document.getElementById('bid5040_expertScore_div').style.display = "block";
                        document.getElementById('bid5040_expertScore_no_div').style.display = "none";
                    } else if (value == 'SAME_TIME') {
                        record.set('team_1', 'BUSINESS');
                        record.set('team_2', 'TECHNOLOGY');
                        record.set('sequence_num_1', '1');
                        record.set('sequence_num_2', '1');
                        record.set('team_1_desc', '${l:BID_ENTRUSTMENT_BUSINESS_TEAM}');
                        record.set('team_2_desc', '${l:BID_ENTRUSTMENT_TECHNOLOGY_TEAM}');
                        document.getElementById('bid5040_expertScore_div').style.display = "block";
                        document.getElementById('bid5040_expertScore_no_div').style.display = "none";
                    } else if (value == 'NONDISTINCTION') {
                        record.set('team_1', 'NONDISTINCTION');
                        record.set('team_2', '');
                        record.set('sequence_num_1', '1');
                        record.set('sequence_num_2', '');
                        record.set('team_1_desc', '');
                        record.set('team_2_desc', '');
                        document.getElementById('bid5040_expertScore_div').style.display = "none";
                        document.getElementById('bid5040_expertScore_no_div').style.display = "block";
                    }
            
                    if (value == 'TECH_BIZ' || value == 'BIZ_TECH' || value == 'SAME_TIME') {
                        //专家与评分要素查询
                        $('bid5040_ln_expert_1_ds').setQueryParameter('sequence_num', record.get('sequence_num_1'));
                        $('bid5040_ln_expert_1_ds').setQueryParameter('team', record.get('team_1'));
                        $('bid5040_ln_expert_2_ds').setQueryParameter('sequence_num', record.get('sequence_num_2'));
                        $('bid5040_ln_expert_2_ds').setQueryParameter('team', record.get('team_2'));
                        $('bid5040_scoring_elements_1_assign_ds').setQueryParameter('sequence_num', record.get('sequence_num_1'));
                        $('bid5040_scoring_elements_1_assign_ds').setQueryParameter('team', record.get('team_1'));
                        $('bid5040_scoring_elements_2_assign_ds').setQueryParameter('sequence_num', record.get('sequence_num_2'));
                        $('bid5040_scoring_elements_2_assign_ds').setQueryParameter('team', record.get('team_2'));
                    } else if (value == 'NONDISTINCTION') {
                        //专家与评分要素查询
                        $('bid5040_ln_expert_ds').setQueryParameter('sequence_num', record.get('sequence_num_1'));
                        $('bid5040_ln_expert_ds').setQueryParameter('team', record.get('team_1'));
                        $('bid5040_scoring_elements_assign_ds').setQueryParameter('sequence_num', record.get('sequence_num_1'));
                        $('bid5040_scoring_elements_assign_ds').setQueryParameter('team', record.get('team_1'));
                    }
            
                    bid5040_ExpertScoreTeamChange(record.get('team_1'), record.get('sequence_num_1'), record.get('team_2'), record.get('sequence_num_2'));
                } else if (name == 'pur_organization_require_flag') {
            
                    if (value == 'Y') {
                        record.getField('pur_organization_name').setRequired(true);
                    } else {
                        record.getField('pur_organization_name').setRequired(false);
                    }
                }
            
                if (name == 'item_classify_require_flag') {
            
                    //配置中心，判断物料分类是否必输
                    var item_ds = $('pur51302_rfx_ln_items_ds');
                    var item_records = item_ds.getAll();
                    if (value == 'Y') {
                        for (i = 0;i < item_records.length;i++) {
                            item_records[i].getField('item_category_desc').setRequired(true);
                        }
                    } else {
                        for (i = 0;i < item_records.length;i++) {
                            item_records[i].getField('item_category_desc').setRequired(false);
                        }
                    }
                }
            
                if (record.getField('pur_organization_name').isRequired()) {
                    record.getField('pur_organization_name').setRequired(false);
                    record.getField('pur_organization_name').setRequired(true);
                } else {
                    record.getField('pur_organization_name').setRequired(true);
                    record.getField('pur_organization_name').setRequired(false);
                }
                record.getField('business_unit_name').setRequired(false);
                record.getField('business_unit_name').setRequired(true);
            }
            
            function pur51302_rfx_headers_ds_load(dataSet) {
                var record = dataSet.getCurrentRecord();
            
                if (record.get('sealed_bid_flag') == 'N') {
                    document.getElementById("pur_rfx_password_div").style.visibility = "hidden"; //隐藏
                } else {
                    document.getElementById("pur_rfx_password_div").style.visibility = "visible"; //显示
                }
            
            
                if (record.get('rfx_category') == 'RFU') {
                    record.getMeta().getField('rfx_method_desc').setReadOnly(true);
                }
            
            
                pur51302_set_rfx_header_rules(record, record.get('rfx_category'));
            
                var functional_currency_code = record.get('functional_currency_code');
                var currency_code = record.get('currency_code');
                if (functional_currency_code != currency_code) {
                    //record.getMeta().getField('exchange_rate').setRequired(true);
                    record.getMeta().getField('exchange_rate').setReadOnly(false);
                } else {
                    record.set('exchange_rate', 1);
                    record.getMeta().getField('exchange_rate').setRequired(false);
                    record.getMeta().getField('exchange_rate').setReadOnly(true);
                }
            
                var tax_included_flag = record.get('tax_included_flag');
                if (tax_included_flag == 'Y') {
                    record.getMeta().getField('tax_type_desc').setRequired(true);
                    record.getMeta().getField('tax_type_desc').setReadOnly(false);
                } else {
                    record.getMeta().getField('tax_type_desc').setRequired(false);
                    record.getMeta().getField('tax_type_desc').setReadOnly(true);
                }
                if (Aurora.isEmpty(record.get("tax_included_flag"))) {
                    record.set("tax_included_flag", 'N');
                }
            
            
                var prequal_flag = record.get('prequal_flag');
                if (prequal_flag == 'Y') {
                    document.getElementById('bid5040_prequal_div').style.display = "block";
                    document.getElementById('bid5040_prequal').innerText = '${l:BID_ENTRUSTMENT_HEADERS.CANCEL_PREQUAL}';
                } else {
                    document.getElementById('bid5040_prequal_div').style.display = "none";
                    document.getElementById('bid5040_prequal').innerText = '${l:BID_ENTRUSTMENT_HEADERS.ADD_PREQUAL}';
                }
            
                var score_mode = record.get('score_mode');
                if (score_mode == 'TECH_BIZ') {
                    record.getField('score_mode_desc').setRequired(true);
                    record.set('team_1', 'TECHNOLOGY');
                    record.set('team_2', 'BUSINESS');
                    record.set('sequence_num_1', '1');
                    record.set('sequence_num_2', '2');
                    record.set('team_1_desc', '${l:BID_ENTRUSTMENT_TECHNOLOGY_TEAM}');
                    record.set('team_2_desc', '${l:BID_ENTRUSTMENT_BUSINESS_TEAM}');
                    document.getElementById('bid5040_expertScore_div').style.display = "block";
                    document.getElementById('bid5040_expertScore_no_div').style.display = "none";
            
                } else if (score_mode == 'BIZ_TECH') {
                    record.getField('score_mode_desc').setRequired(true);
                    record.set('team_1', 'BUSINESS');
                    record.set('team_2', 'TECHNOLOGY');
                    record.set('sequence_num_1', '1');
                    record.set('sequence_num_2', '2');
                    record.set('team_1_desc', '${l:BID_ENTRUSTMENT_BUSINESS_TEAM}');
                    record.set('team_2_desc', '${l:BID_ENTRUSTMENT_TECHNOLOGY_TEAM}');
                    document.getElementById('bid5040_expertScore_div').style.display = "block";
                    document.getElementById('bid5040_expertScore_no_div').style.display = "none";
            
                } else if (score_mode == 'SAME_TIME') {
                    record.getField('score_mode_desc').setRequired(true);
                    record.set('team_1', 'BUSINESS');
                    record.set('team_2', 'TECHNOLOGY');
                    record.set('sequence_num_1', '1');
                    record.set('sequence_num_2', '1');
                    record.set('team_1_desc', '${l:BID_ENTRUSTMENT_BUSINESS_TEAM}');
                    record.set('team_2_desc', '${l:BID_ENTRUSTMENT_TECHNOLOGY_TEAM}');
                    document.getElementById('bid5040_expertScore_div').style.display = "block";
                    document.getElementById('bid5040_expertScore_no_div').style.display = "none";
            
                } else if (score_mode == 'NONDISTINCTION') {
                    record.getField('score_mode_desc').setRequired(true);
                    record.set('team_1', 'NONDISTINCTION');
                    record.set('team_1_desc', '');
                    record.set('team_2_desc', '');
                    record.set('sequence_num_1', '1');
                    record.set('sequence_num_2', '');
                    document.getElementById('bid5040_expertScore_div').style.display = "none";
                    document.getElementById('bid5040_expertScore_no_div').style.display = "block";
            
                } else {
                    record.getField('score_mode_desc').setRequired(false);
                }
            
                if (score_mode == 'TECH_BIZ' || score_mode == 'BIZ_TECH' || score_mode == 'SAME_TIME') {
                    //专家与评分要素查询
                    $('bid5040_ln_expert_1_ds').setQueryParameter('sequence_num', record.get('sequence_num_1'));
                    $('bid5040_ln_expert_1_ds').setQueryParameter('team', record.get('team_1'));
                    $('bid5040_ln_expert_1_ds').query();
                    $('bid5040_ln_expert_2_ds').setQueryParameter('sequence_num', record.get('sequence_num_2'));
                    $('bid5040_ln_expert_2_ds').setQueryParameter('team', record.get('team_2'));
                    $('bid5040_ln_expert_2_ds').query();
                    $('bid5040_scoring_elements_1_assign_ds').setQueryParameter('sequence_num', record.get('sequence_num_1'));
                    $('bid5040_scoring_elements_1_assign_ds').setQueryParameter('team', record.get('team_1'));
                    $('bid5040_scoring_elements_1_assign_ds').query();
                    $('bid5040_scoring_elements_2_assign_ds').setQueryParameter('sequence_num', record.get('sequence_num_2'));
                    $('bid5040_scoring_elements_2_assign_ds').setQueryParameter('team', record.get('team_2'));
                    $('bid5040_scoring_elements_2_assign_ds').query();
                } else if (score_mode == 'NONDISTINCTION') {
                    //专家与评分要素查询
                    $('bid5040_ln_expert_ds').setQueryParameter('sequence_num', record.get('sequence_num_1'));
                    $('bid5040_ln_expert_ds').setQueryParameter('team', record.get('team_1'));
                    $('bid5040_ln_expert_ds').query();
                    $('bid5040_scoring_elements_assign_ds').setQueryParameter('sequence_num', record.get('sequence_num_1'));
                    $('bid5040_scoring_elements_assign_ds').setQueryParameter('team', record.get('team_1'));
                    $('bid5040_scoring_elements_assign_ds').query();
                }
            
                var expert_score_flag = record.get('expert_score_flag');
                if (expert_score_flag == 'Y') {
                    document.getElementById('bid5040_expertScore').innerText = '${l:BID_ENTRUSTMENT_HEADERS.NO_EXPERT_SCORE}';
                } else {
                    document.getElementById('bid5040_expertScore').innerText = '${l:BID_ENTRUSTMENT_HEADERS.EXPERT_SCORE}';
            
                }
                var pur_organization_require_flag = record.get('pur_organization_require_flag');
                if (pur_organization_require_flag == 'Y') {
                    record.getField('pur_organization_name').setRequired(true);
                } else {
                    record.getField('pur_organization_require_flag').setRequired(false);
                }
            
            
            
                var head_rec = $('pur51302_rfx_headers_ds').getCurrentRecord();
                var item_classify_require_flag = head_rec.get('item_classify_require_flag');
                //配置中心，判断物料分类是否必输
                var item_ds = $('pur51302_rfx_ln_items_ds');
                var item_records = item_ds.getAll();
                if (item_classify_require_flag == 'Y') {
                    for (i = 0;i < item_records.length;i++) {
                        item_records[i].getField('item_category_desc').setRequired(true);
                    }
                }
                $('pur51302_rfx_ln_items_ds').query();
            }
            
            function pur51302_set_rfx_header_rules(record, rfx_category) {
                if (rfx_category == 'RLF') {
            
                    record.set('quotation_title', '');
                    record.set('quotation_id', '');
                    document.getElementById('logistics_quotation_desc_id').style.display = 'block';
                    document.getElementById('quotation_title_id').style.display = 'none';
            
                    $('pur51302_rfx_ln_items_grid').hideColumn('item_code');
                    $('pur51302_rfx_ln_items_grid').hideColumn('item_desc');
                    $('pur51302_rfx_ln_items_grid').hideColumn('item_category_desc');
                    $('pur51302_rfx_ln_items_grid').hideColumn('quote_name');
                    $('pur51302_rfx_ln_items_grid').hideColumn('kw_customer');
                    $('pur51302_rfx_ln_items_grid').hideColumn('ladder_inquiry_desc');
                    $('pur51302_rfx_ln_items_grid').hideColumn('ladder_inquiry_flag');
                    $('pur51302_rfx_ln_items_grid').hideColumn('ladder_inquiry');
                    $('pur51302_rfx_ln_items_grid').hideColumn('quantity');
                    $('pur51302_rfx_ln_items_grid').hideColumn('purchase_amount');
                    $('pur51302_rfx_ln_items_grid').hideColumn('pur_uom_desc');
                    $('pur51302_rfx_ln_items_grid').hideColumn('uom_desc');
                    $('pur51302_rfx_ln_items_grid').hideColumn('need_by_date');
                    $('pur51302_rfx_ln_items_grid').hideColumn('tax_included_flag');
                    $('pur51302_rfx_ln_items_grid').hideColumn('tax_type_rate');
                    $('pur51302_rfx_ln_items_grid').hideColumn('req_number');
                    $('pur51302_rfx_ln_items_grid').hideColumn('req_line_num');
                    $('pur51302_rfx_ln_items_grid').hideColumn('item_note');
                    $('pur51302_rfx_ln_items_grid').hideColumn('item_parameter_config');
                    $('pur51302_rfx_ln_items_grid').hideColumn('samples_requested');
                    $('pur51302_rfx_ln_items_grid').hideColumn('feedback_range');
                    $('pur51302_rfx_ln_items_grid').hideColumn('limit_price');
                    $('pur51302_rfx_ln_items_grid').hideColumn('cost_price');
            
                    // $('pur51302_rfx_ln_items_grid').hideColumn('inv_organization_desc');
                    // $('pur51302_rfx_ln_items_grid').hideColumn('atm_flag');
                } else {
                    record.set('logistics_quotation_desc', '');
                    record.set('logistics_quotation_code', '');
                    document.getElementById('logistics_quotation_desc_id').style.display = 'none';
                    document.getElementById('quotation_title_id').style.display = 'block';
                    $('pur51302_rfx_ln_items_grid').hideColumn('logistics_quotation');
            
                }
                if (rfx_category == 'RFA') { //竞价单
                    record.getMeta().getField('open_rule_desc').setRequired(true);
                    record.getMeta().getField('open_rule_desc').setReadOnly(false);
            
                    record.getMeta().getField('auction_ranking_desc').setRequired(true);
                    record.getMeta().getField('auction_ranking_desc').setReadOnly(false);
            
                    // record.set('sealed_bid_flag', 'Y');
                    // record.getMeta().getField('sealed_bid_flag').setReadOnly(true);
                } else { //不为竞价单
                    record.set('open_rule', '');
                    record.set('open_rule_desc', '');
                    record.getMeta().getField('open_rule_desc').setRequired(false);
                    record.getMeta().getField('open_rule_desc').setReadOnly(true);
            
                    record.set('auction_ranking', '');
                    record.set('auction_ranking_desc', '');
                    record.getMeta().getField('auction_ranking_desc').setRequired(false);
                    record.getMeta().getField('auction_ranking_desc').setReadOnly(true);
                    record.getMeta().getField('sealed_bid_flag').setReadOnly(false);
                }
            
            
            
            }
            
            
            function pur51302_rfx_first_trial_maintain_save() {
                var header_ds = $('pur51302_rfx_headers_ds');
                var item_ds = $('pur51302_rfx_ln_items_ds');
                var vendor_ds = $('pur51302_rfx_ln_vendors_ds');
                var attachments_ds = $('pur51302_rfx_ln_attachments');
                var prequal_ds = $('bid5040_edit_entrustment_prequal');
                var header_record = header_ds.getCurrentRecord();
                header_record.set('source_from', 'MANUAL');
            
                var expert_ds = $('bid5040_ln_expert_ds');
                var expert_1_ds = $('bid5040_ln_expert_1_ds');
                var expert_2_ds = $('bid5040_ln_expert_2_ds');
                var element_ds = $('bid5040_scoring_elements_assign_ds');
                var element_1_ds = $('bid5040_scoring_elements_1_assign_ds');
                var element_2_ds = $('bid5040_scoring_elements_2_assign_ds');
                debugger;
                if (!header_ds.validate()) {
                    return;
                }
                if (!item_ds.validate()) {
                    return;
                }
            
                var item_records = item_ds.getAll();
                for (i = 0;i < item_records.length;i++) {
                    if (item_records[i].dirty) {
                        var quote_lines = item_records[i].get('quote_lines');
                        if (quote_lines) {
                            for (m = 0;m < quote_lines.data.length;m++) {
                                quote_lines.data[m].dirty = true;
                            }
            
                        }
                    }
                }
                if (!vendor_ds.validate()) {
                    return;
                }
                if (!attachments_ds.validate()) {
                    return;
                }
            
                var prequal_flag = header_ds.getCurrentRecord().get('prequal_flag');
                if (prequal_flag == 'Y' && !prequal_ds.validate()) {
                    return;
                }
            
                var data = header_record.data;
                if (Aurora.isEmpty(header_record.get('rfx_header_id'))) {
                    data._status = 'insert';
                } else {
                    data._status = 'update';
                }
            
                if (prequal_flag == 'Y') {
                    data['prequal'] = prequal_ds.getJsonData();
                }
            
                var score_mode = header_ds.getCurrentRecord().get('score_mode');
            
                if (score_mode == 'TECH_BIZ' || score_mode == 'BIZ_TECH' || score_mode == 'SAME_TIME') {
                    if (!expert_1_ds.validate() || !expert_2_ds.validate() || !element_1_ds.validate() || !element_2_ds.validate()) {
                        return;
                    }
            
                    data['experts_1'] = expert_1_ds.getJsonData();
                    data['experts_2'] = expert_2_ds.getJsonData();
                    data['elements_1'] = element_1_ds.getJsonData();
                    data['elements_2'] = element_2_ds.getJsonData();
                } else if (score_mode == 'NONDISTINCTION') {
                    if (!expert_ds.validate() || !element_ds.validate()) {
                        return;
                    }
            
                    data['experts_1'] = expert_ds.getJsonData();
                    data['elements_1'] = element_ds.getJsonData();
                }
            
                data['items'] = item_ds.getJsonData();
                data['vendors'] = vendor_ds.getJsonData();
                data['attachments'] = attachments_ds.getJsonData();
                pur51302_mask();
                Aurora.request({
                    url: $('pur51302_rfx_first_trial_save_link').getUrl(),
                    para: data,
                    success: function(result) {
                        pur51302_unmask();
                        Aurora.showMessage('${l:PROMPT}', '${l:PUR5140.RFX_SAVE_SUCCESSFULLY}', function() {
                            header_ds.query();
                            item_ds.query();
                            vendor_ds.query();
                            attachments_ds.query();
                        });
            
                    },
                    failure: function() {
                        pur51302_unmask();
                        return;
                    },
                    error: function() {
                        pur51302_unmask();
                        return;
                    }
                });
            }
            
            function pur51302_rfx_first_trail_maintain_issue() {
            
                var header_ds = $('pur51302_rfx_headers_ds');
                var item_ds = $('pur51302_rfx_ln_items_ds');
                var vendor_ds = $('pur51302_rfx_ln_vendors_ds');
                var attachments_ds = $('pur51302_rfx_ln_attachments');
                var prequal_ds = $('bid5040_edit_entrustment_prequal');
                var header_record = header_ds.getCurrentRecord();
                header_record.set('source_from', 'MANUAL');
                var expert_ds = $('bid5040_ln_expert_ds');
                var expert_1_ds = $('bid5040_ln_expert_1_ds');
                var expert_2_ds = $('bid5040_ln_expert_2_ds');
                var element_ds = $('bid5040_scoring_elements_assign_ds');
                var element_1_ds = $('bid5040_scoring_elements_1_assign_ds');
                var element_2_ds = $('bid5040_scoring_elements_2_assign_ds');
            
                // $('pur51202_rfx_quote_create_ds').query();
            
                if (!header_ds.validate()) {
                    return;
                }
                if (!item_ds.validate()) {
                    return;
                }
            
                var item_records = item_ds.getAll();
                for (i = 0;i < item_records.length;i++) {
                    if (item_records[i].dirty) {
                        var quote_lines = item_records[i].get('quote_lines');
                        if (quote_lines) {
                            for (m = 0;m < quote_lines.data.length;m++) {
                                quote_lines.data[m].dirty = true;
                            }
            
                        }
                    }
                }
            
            
                if (!vendor_ds.validate()) {
                    return;
                }
                if (!attachments_ds.validate()) {
                    return;
                }
            
            
                var prequal_flag = header_ds.getCurrentRecord().get('prequal_flag');
                if (prequal_flag == 'Y' && !prequal_ds.validate()) {
                    return;
                }
            
                var data = header_record.data;
                if (Aurora.isEmpty(header_record.get('rfx_header_id'))) {
                    data._status = 'insert';
                } else {
                    data._status = 'update';
                }
            
                if (prequal_flag == 'Y') {
                    data['prequal'] = prequal_ds.getJsonData();
                }
            
                var score_mode = header_ds.getCurrentRecord().get('score_mode');
            
                if (score_mode == 'TECH_BIZ' || score_mode == 'BIZ_TECH' || score_mode == 'SAME_TIME') {
                    if (!expert_1_ds.validate() || !expert_2_ds.validate() || !element_1_ds.validate() || !element_2_ds.validate()) {
                        return;
                    }
            
                    data['experts_1'] = expert_1_ds.getJsonData();
                    data['experts_2'] = expert_2_ds.getJsonData();
                    data['elements_1'] = element_1_ds.getJsonData();
                    data['elements_2'] = element_2_ds.getJsonData();
                } else if (score_mode == 'NONDISTINCTION') {
                    if (!expert_ds.validate() || !element_ds.validate()) {
                        return;
                    }
            
                    data['experts_1'] = expert_ds.getJsonData();
                    data['elements_1'] = element_ds.getJsonData();
                }
            
                data['items'] = item_ds.getJsonData();
                data['vendors'] = vendor_ds.getJsonData();
                data['attachments'] = attachments_ds.getJsonData();
                Aurora.showConfirm('${l:PROMPT}', '${l:PUR5140.RFX_RELEASE_CONFIRM}', function() {
                    pur51302_mask();
                    Aurora.request({
                        url: $('pur51302_rfx_first_trial_issue_link').getUrl(),
                        para: data,
                        success: function() {
                            pur51302_unmask();
                            Aurora.showMessage('${l:PROMPT}', '${l:PUR5140.RFX_RELEASE_SUCCESSFULLY}', function() {
                                pur51302_reback();
                            });
                        },
                        failure: function() {
                            pur51302_unmask();
                            return;
                        },
                        error: function() {
                            pur51302_unmask();
                            return;
                        }
                    });
                });
            }
            
            function pur51302_rfxFirstTrialMaintainBack() {
                pur51302_reback();
            }
            
            function pur51302_reback() {
                $('pur5130_rfx_first_trail_maintain_window').close();
            }
            
            function pur51302_rfx_ln_items_ds_load(ds) {
                var records = ds.getAll();
                for (var i = 0;i < records.length;i++) {
                    var owner_business_unit_id = records[i].get('owner_business_unit_id');
                    var inv_organization_id = records[i].get('inv_organization_id');
                    var item_category_id = records[i].get('item_category_id');
                    if (!Aurora.isEmpty(owner_business_unit_id)) {
                        records[i].getField('inv_organization_desc').setLovPara('owner_business_unit_id', owner_business_unit_id);
                    }
                    if (!Aurora.isEmpty(inv_organization_id)) {
                        records[i].getField('item_code').setLovPara('inv_organization_id', inv_organization_id);
                    }
                    if (!Aurora.isEmpty(item_category_id)) {
                        records[i].getField('item_code').setLovPara('item_category_id', item_category_id);
                    }
                }
            
                var head_record = $('pur51302_rfx_headers_ds').getAt(0);
                //配置中心，判断物料分类是否必输
                var item_classify_require_flag = head_record.get('item_classify_require_flag');
                if (item_classify_require_flag == 'Y') {
                    for (i = 0;i < records.length;i++) {
                        records[i].getField('item_category_desc').setRequired(true);
                    }
                }
            
                var rfx_category = head_record.get('rfx_category');
                if (rfx_category == 'RLF') {
                    for (i = 0;i < records.length;i++) {
                        records[i].getField('uom_desc').setRequired(false);
                        records[i].getField('item_desc').setRequired(false);
                    }
                }
            }
            
            function pur51302_rfx_ln_items_grid_cellclick(grid, row, name, record) {
                var owner_business_unit_id = record.get('owner_business_unit_id');
            
                if (name == 'item_code') {
                    record.getField('item_code').setLovPara('owner_business_unit_id', owner_business_unit_id);
            
                    if (Aurora.isEmpty(record.get('inv_organization_id'))) {
                        record.getField('item_code').setLovPara('inv_organization_id', -1);
                    } else {
                        record.getField('item_code').setLovPara('inv_organization_id', record.get('inv_organization_id'));
                    }
            
                    var item_category_id = record.get('item_category_id');
                    if (Aurora.isEmpty(item_category_id)) {
                        record.getField('item_code').setLovPara('item_category_id', -1);
                    } else {
                        record.getField('item_code').setLovPara('item_category_id', item_category_id);
                    }
                } else if (name == 'quote_name') {
                    grid.focusRow(row);
                }
            }
            
            function pur51302_rfx_ln_items_ds_update(ds, record, name, value, oldvalue) {
            
                if (name == 'owner_business_unit_id') {
                    record.set('inv_organization_id', '');
                    record.set('inv_organization_code', '');
                    record.set('inv_organization_desc', '');
                    record.getField('inv_organization_desc').setLovPara('owner_business_unit_id', value);
                } else if (name == 'inv_organization_id') {
                    record.set('item_id', '');
                    record.set('item_code', '');
                    record.set('item_desc', '');
                    record.getField('item_code').setLovPara('inv_organization_id', value);
                } else if (name == 'item_category_desc') {
                    if (Aurora.isEmpty(value)) {
                        record.set('item_category_id', '');
                    }
                } else if (name == 'item_category_id') {
                    //自主品类变更,清除当前record下的对应的报价模板创建ds中数据
                    var quote_lines = record.get('quote_lines');
                    if (quote_lines) {
                        for (var i = quote_lines.data.length - 1;i >= 0;i--) {
                            var quote_line_rec = quote_lines.data[i];
                            $('pur51202_rfx_quote_create_ds').remove(quote_line_rec);
                        }
                    }
            
                    if (!Aurora.isEmpty(value)) {
                        pur51302_mask();
                        $('pur51302_rfx_quote_query_ds').setQueryParameter('item_category_id', value);
                        $('pur51302_rfx_quote_query_ds').setQueryParameter('rfx_line_item_id', record.get('rfx_line_item_id'));
                        $('pur51302_rfx_quote_query_ds').query();
                    }
                }
            }
            
            function pur51302_rfx_quote_query_ds_loadFun(ds) {
                pur51302_unmask();
                var records = ds.getAll();
                for (var i = 0;i < records.length;i++) {
                    $('pur51202_rfx_quote_create_ds').add(records[i]);
                }
            }
            
            function pur51302_rfx_ln_items_ds_add(ds, record, index) {
                var owner_business_unit_id = $('pur51302_rfx_headers_ds').getCurrentRecord().get('owner_business_unit_id');
                if (Aurora.isEmpty(owner_business_unit_id)) {
                    Aurora.showMessage('${l:PROMPT}', '${l:PUR5130.CHOOSE_BU_FIRST_THEN_ADD_ITEM}');
                    return false;
                }
                record.set('owner_business_unit_id', owner_business_unit_id);
            
                var tax_type_id = $('pur51302_rfx_headers_ds').getCurrentRecord().get('tax_type_id');
                var tax_type_code = $('pur51302_rfx_headers_ds').getCurrentRecord().get('tax_type_code');
                var description = $('pur51302_rfx_headers_ds').getCurrentRecord().get('description');
                var tax_type_rate = $('pur51302_rfx_headers_ds').getCurrentRecord().get('tax_type_rate');
                var tax_included_flag = $('pur51302_rfx_headers_ds').getCurrentRecord().get('tax_included_flag');
            
                record.set('tax_type_id', tax_type_id);
                record.set('tax_type_code', tax_type_code);
                record.set('description', description);
                record.set('tax_type_rate', tax_type_rate);
                record.set('tax_included_flag', tax_included_flag);
            
            }
            
            function pur51302_rfx_ln_items_ef(record, name) {
                if (name == 'item_category_desc') {
                    var item_id = record.get('item_id');
                    if (Aurora.isEmpty(item_id)) {
                        return 'pur51302_item_category_desc_lov';
                    }
                    return 'pur51302_item_category_desc_lov';
                }
                if (name == 'ladder_inquiry_desc') {
                    var ladder_inquiry_flag = record.get('ladder_inquiry_flag');
                    if (ladder_inquiry_flag == 'Y') {
                        record.getField('ladder_inquiry_desc').setRequired(true);
                        return 'pur51302_ladder_inquiry_code_cb';
                    }
                    record.set('ladder_inquiry_desc', '');
                    record.set('ladder_inquiry_code', '');
                    record.getField('ladder_inquiry_desc').setRequired(false);
                    return '';
                }
            }
            
            function pur51302_rfx_ln_vendors_ds_load(ds) {
                var records = ds.getAll();
                for (var i = 0;i < records.length;i++) {
                    var vendor_company_id = records[i].get('coop_company_id');
                    if (!Aurora.isEmpty(vendor_company_id)) {
                        records[i].getField('contact_person').setLovPara('vendor_company_id', vendor_company_id);
                        records[i].getField('contact_person').setReadOnly(false);
                    }
                }
            }
            
            function pur51302_rfx_ln_vendors_ds_update(ds, record, name, value, oldvalue) {
                if (name == 'coop_company_id') {
                    // record.set('vendor_contact_id', '');
                    // record.set('contact_person', '');
                    // record.set('contact_mobile', '');
                    // record.set('e_mail', '');
                    if (Ext.isEmpty(value)) {
                        record.getField('contact_person').setLovPara('vendor_company_id', -1);
                        record.getField('contact_person').setReadOnly(true);
                    } else {
                        record.getField('contact_person').setLovPara('vendor_company_id', value);
                        record.getField('contact_person').setReadOnly(false);
                    }
                }
            }
            
            function pur51302_rfx_ln_vendors_ds_beforecreate(ds, object) {
                var rfx_method = $('pur51302_rfx_headers_ds').getCurrentRecord().get('rfx_method');
                if (rfx_method == 'OPEN') {
                    Aurora.showMessage('${l:PROMPT}', '${l:PUR5120.OPEN_RFX_VENDOR_REMAIN}');
                    return false;
                }
                return true;
            }
            
            function pur51302_mask() {
                Aurora.Masker.mask($('pur5130_rfx_first_trail_maintain_window').wrap, '${l:LOADING}');
            
            }
            
            function pur51302_unmask() {
                Aurora.Masker.unmask($('pur5130_rfx_first_trail_maintain_window').wrap);
            }
            
            //上传附件
            
            function pur51302_atch_num_rd(value, record, name) {
                var ds = $('pur51302_rfx_ln_attachments');
                var line_num = ds.indexOf(record);
            
                return (line_num + 1) * 10;
            
            }
            
            function pur51302_upload_render(value, record, name) {
                var atm_line_id = record.get('atm_line_id');
                var atm_counts = record.get('atm_counts');
            
                if (name == "attachment") {
                    if (!record.isNew && atm_line_id) {
                        return '<a href="javascript:pur51302_upload_file(' + atm_line_id + ')">${l:PROMPT.UPLOAD_DOWNLOAD}</a>';
                    }
                }
            
                if (name == "atm_flag") {
                    if (atm_counts > 0) {
                        return '<div style="margin-top:3px;margin-left:auto;margin-right:auto;vertical-align:middle;height:20px;line-height:20px;"><img src="${/request/@context_path}/images/paperclip.png"/></div>';
            
                    } else {
                        return '';
                    }
                }
            }
            
            function pur51302_upload_file(id) {
                var url = "${/request/@context_path}/uploadFile.screen?table_name=PUR_RFX_HEADERS&header_id=" + id;
                new Aurora.Window({
                    url: url,
                    title: '${l:ATM.UPLOAD_ATTACHMENT}',
                    id: 'pur51302_upload_window',
                    width: 850,
                    height: 500
                }).on('beforeclose', function() {
                    $('pur51302_rfx_ln_attachments').query();
                });
            }
            
            //比较两个日期的大小
            
            function pur51302_compareDate(start, end) {
            
                if (typeof(start) == 'string') {
                    start = new Date(start.replace(/-/g, '/'));
                }
            
                if (typeof(end) == 'string') {
                    end = new Date(end.replace(/-/g, '/'));
                }
            
                if (start > end) {
                    return false;
                }
                return true;
            }
            
            //发布日期校验
            
            function pur51302_release_dateValidator(record, name, value) {
                if (name == 'feedback_start_time' || name == 'feedback_end_time') {
                    var start = record.get('feedback_start_time');
                    var end = record.get('feedback_end_time');
            
                    if ( !! end) {
                        if (!pur51302_compareDate(start, end)) {
                            return '${l:PUR5120.QUOTATION_START_END_DATE_ERROR}';
                        }
            
                        var sysdate = new Date();
            
                        if (!pur51302_compareDate(sysdate, end)) {
                            return '${l:PUR5130.CLOSING_MUST_BE_LATER_THAN_CURRENT}';
                        }
                    }
                    return true;
                }
            
                if (name == 'sealing_cutoff_date' || name == 'feedback_end_time') {
                    var sealing_cutoff_date = record.get('sealing_cutoff_date');
                    var end = record.get('feedback_end_time');
            
                    if ( !! end) {
                        if (!pur51302_compareDate(sealing_cutoff_date, end)) {
                            return '${l:PUR5130.SEALED_DEADLINE_MUST_BE_EARLIER_THAN_CLOSING}';
                        }
                    }
                    return true;
                }
            }
            
            
            function pur51302_vendors_grid_cellclick(grid, row, name, record) {
                var head_record = $('pur51302_rfx_headers_ds').getCurrentRecord();
                var company_id = head_record.get('company_id');
                if (name == 'vendor_code') {
                    record.getField('vendor_code').setLovPara('company_id', company_id);
                }
            }
            
            function pur51302_rfx_ln_vendors_ds_add(ds, record, index) {
                var owner_business_unit_id = $('pur51302_rfx_headers_ds').getCurrentRecord().get('owner_business_unit_id');
                if (Aurora.isEmpty(owner_business_unit_id)) {
                    Aurora.showMessage('${l:PROMPT}', '${l:PUR5130.CHOOSE_BU_FIRST_THEN_ADD_VENDOR}');
                    return false;
                }
            }
            
            function pur51302_rfx_operation_record_fun() {
                new Aurora.Window({
                    url: '${/request/@context_path}/modules/pur/public/pur_rfx_operation_records.screen?rfx_header_id=${/parameter/@rfx_header_id}',
                    title: '${l:PROMPT.OPERATION_RECORD}',
                    id: 'pur_publicRfxOperationRecord_window',
                    width: 500,
                    height: 350
                });
            }
            
            function pur51302_quoteRendererFun(value, record, name) {
                var rfx_line_item_id = record.get('rfx_line_item_id');
                var item_category_id = record.get('item_category_id');
                var quote_tmpl_flag = record.get('quote_tmpl_flag');
            
                if (!Aurora.isEmpty(item_category_id) && quote_tmpl_flag == 'Y') {
                    return '<a href="javascript:pur51202_quoteCreateFun(' + record.id + "," + item_category_id + ')">${l:PUR_RFX_QUOTE_TITLE}</a>';
                }
                return '';
            
            }
            
            function pur51202_quoteEditFun(rfx_line_item_id) {
                new Aurora.Window({
                    url: $('pur51302_rfx_quote_link').getUrl() + '?rfx_line_item_id=' + rfx_line_item_id,
                    title: '${l:PUR_RFX_QUOTE_TITLE}',
                    id: 'pur51302_rfx_quote_window',
                    width: 500,
                    height: 380
                });
            }
            
            var open_renderer_flag = 'N';
            var item_record_id = -1;
            var item_category_id2 = -1;
            
            function pur51202_quoteCreateFun(id, item_category_id) {
                var record = $('pur51302_rfx_ln_items_ds').findById(id);
                $('pur51202_rfx_quote_edit_ds').removeAll();
                var quote_lines = record.get('quote_lines');
                if (quote_lines) {
                    for (var i = quote_lines.data.length - 1;i >= 0;i--) {
                        var quote_line_rec = quote_lines.data[i];
                        if (quote_line_rec.get('template_line_id')) {
                            $('pur51202_rfx_quote_edit_ds').create({
                                'quote_line_id': quote_line_rec.get('quote_line_id'),
                                'quote_header_id': quote_line_rec.get('quote_header_id'),
                                'config_item': quote_line_rec.get('config_item'),
                                'parameter_requirements': quote_line_rec.get('parameter_requirements'),
                                'template_id': quote_line_rec.get('template_id'),
                                'template_line_id': quote_line_rec.get('template_line_id'),
                                'item_category_id': quote_line_rec.get('item_category_id'),
                                'rfx_line_item_id': quote_line_rec.get('rfx_line_item_id'),
                            });
                        }
                    }
                    new Aurora.Window({
                        url: $('pur51302_rfx_quote_create_link').getUrl() + '?id=' + id + '&item_category_id=' + item_category_id,
                        title: '${l:PUR_RFX_QUOTE_TITLE}',
                        id: 'pur51302_rfx_quote_create_window',
                        width: 520,
                        height: 420
                    });
                    open_renderer_flag = 'N';
                    item_record_id = -1;
                    item_category_id2 = -1;
                } else {
                    open_renderer_flag = 'Y';
                    item_record_id = id;
                    item_category_id2 = item_category_id;
                }
            }
            
            function pur51202_rfx_quote_create_queryFun() {
                pur51302_mask();
            }
            
            function pur51202_rfx_quote_create_loadFun(ds) {
                pur51302_unmask();
                if (open_renderer_flag == 'Y') {
                    setTimeout(function() {
                        pur51202_quoteCreateFun(item_record_id, item_category_id2);
                    }, 500)
            
                }
            }
            
            function pur51202_rfx_quote_create_updateFun(ds, record, name, valud, oldvalue) {
            
                if (!record.isNew) {
            
                   }
            }
            
            //资格预审
            
            
            function bid5040_onEditEntrustmentPrequal_loadFun(ds) {
                if (ds.getAll().length > 0) {
                    var record = ds.getAt(0);
                    var review_method = record.get('review_method');
                    if (review_method == 'QUALIFICATION') {
                        record.getField('qualified_limit').setReadOnly(true);
                        record.getField('qualified_limit').setRequired(false);
                    } else if (review_method == 'QUANTITY') {
                        record.getField('qualified_limit').setReadOnly(false);
                        record.getField('qualified_limit').setRequired(true);
                    }
            
                    var file_free_flag = record.get('file_free_flag');
                    if (file_free_flag == 'Y') {
                        record.getField('proqual_file_expense').setReadOnly(true);
                        record.getField('proqual_file_expense').setRequired(false);
                    } else {
                        record.getField('proqual_file_expense').setReadOnly(false);
                        record.getField('proqual_file_expense').setRequired(true);
                    }
                }
            }
            
            function bid5040_onEditEntrustmentPrequal_updateFun(ds, record, name, value, oldvalue) {
                if (name == 'review_method') {
                    record.set('qualified_limit', '');
                    if (value == 'QUALIFICATION') {
                        record.getField('qualified_limit').setReadOnly(true);
                        record.getField('qualified_limit').setRequired(false);
                    } else if (value == 'QUANTITY') {
                        record.getField('qualified_limit').setReadOnly(false);
                        record.getField('qualified_limit').setRequired(true);
                    }
                } else if (name == 'file_free_flag') {
                    record.set('proqual_file_expense', '');
                    if (value == 'Y') {
                        record.getField('proqual_file_expense').setReadOnly(true);
                        record.getField('proqual_file_expense').setRequired(false);
                    } else {
                        record.getField('proqual_file_expense').setReadOnly(false);
                        record.getField('proqual_file_expense').setRequired(true);
                    }
                }
            }
            
            function bid5040_prequalFun() {
                var header_rec = $('pur51302_rfx_headers_ds').getAt(0);
                var prequal_flag = header_rec.get('prequal_flag');
                if (prequal_flag == 'Y') {
                    Aurora.showConfirm('${l:PROMPT}', '${l:BID_ENTRUSTMENT.CONFIRM_CANCEL}', function() {
                        header_rec.set('prequal_flag', 'N');
                        document.getElementById('bid5040_prequal_div').style.display = "none";
                        document.getElementById('bid5040_prequal').innerText = '${l:BID_ENTRUSTMENT_HEADERS.ADD_PREQUAL}';
                    });
                } else {
                    header_rec.set('prequal_flag', 'Y');
                    document.getElementById('bid5040_prequal_div').style.display = "block";
                    document.getElementById('bid5040_prequal').innerText = '${l:BID_ENTRUSTMENT_HEADERS.CANCEL_PREQUAL}';
                }
            }
            
            //专家评分
            //-----------------------------------------------------------------------------------------------------------
            
            
            function bid5040_onLnExper_updateFun(ds, record, name, value, oldValue) {
                if (name == 'leader_flag') {
                    var records = ds.getAll();
                    if (value == 'Y') {
                        for (var i = 0;i < records.length;i++) {
                            if (ds.indexOf(record) != ds.indexOf(records[i])) {
                                records[i].set('leader_flag', 'N');
                            }
                        }
                    }
                }
            }
            
            function bid5040_onLnExpert1_updateFun(ds, record, name, value, oldValue) {
                bid5040_onLnExper_updateFun(ds, record, name, value, oldValue);
            }
            
            function bid5040_onLnExpert2_updateFun(ds, record, name, value, oldValue) {
                bid5040_onLnExper_updateFun(ds, record, name, value, oldValue);
            }
            
            function bid5040_onLnExpert_updateFun(ds, record, name, value, oldValue) {
                bid5040_onLnExper_updateFun(ds, record, name, value, oldValue);
            }
            
            function bid5040_ln_expert_1_grid_Editor(record, name) {
                if (name == 'expert_user_name') {
                    if (record.isNew) {
                        return 'bid5040_ln_expert_1_grid_lov';
                    } else {
                        var source_type = record.get('source_type');
                        if (source_type == 'RANDOM') {
                            return '';
                        }
                        return 'bid5040_ln_expert_1_grid_lov';
                    }
                }
            }
            
            function bid5040_ln_expert_2_grid_Editor(record, name) {
                if (name == 'expert_user_name') {
                    if (record.isNew) {
                        return 'bid5040_ln_expert_2_grid_lov';
                    } else {
                        var source_type = record.get('source_type');
                        if (source_type == 'RANDOM') {
                            return '';
                        }
                        return 'bid5040_ln_expert_2_grid_lov';
                    }
                }
            }
            
            function bid5040_ln_expert_grid_Editor(record, name) {
                if (name == 'expert_user_name') {
                    if (record.isNew) {
                        return 'bid5040_ln_expert_grid_lov';
                    } else {
                        var source_type = record.get('source_type');
                        if (source_type == 'RANDOM') {
                            return '';
                        }
                        return 'bid5040_ln_expert_grid_lov';
                    }
                }
            }
            
            function bid5040_ln_expert_1_RandomChoose() {
                if (!$('bid5040_ln_expert_1_ds').validate()) {
                    return;
                }
            
                var header_rec = $('pur51302_rfx_headers_ds').getAt(0);
                var score_mode = header_rec.get('score_mode');
            
                if (Ext.isEmpty(score_mode)) {
                    Aurora.showMessage('${l:PROMPT}', '${l:BID_ENTRUSTMENT_HEADERS.CHOOSE_SCORE_MODE}');
                    return;
                }
            
                new Aurora.Window({
                    id: 'bid5040_entrustment_expert_random_choose_window',
                    title: '${l:BID_ENTRUSTMENT_RANDOM_CHOOSE}',
                    url: $('bid5040_eidt_random_choose_link').getUrl() + '?entrustment_header_id=-${/parameter/@rfx_header_id}&sequence_num=' + header_rec.get('sequence_num_1') + '&team=' + header_rec.get('team_1'),
                    height: 460,
                    width: 540
                }).on('beforeclose', function() {
                    $('bid5040_ln_expert_1_ds').query();
                });
            }
            
            function bid5040_ln_expert_2_RandomChoose() {
                if (!$('bid5040_ln_expert_2_ds').validate()) {
                    return;
                }
                var header_rec = $('pur51302_rfx_headers_ds').getAt(0);
                var score_mode = header_rec.get('score_mode');
            
                if (Ext.isEmpty(score_mode)) {
                    Aurora.showMessage('${l:PROMPT}', '${l:BID_ENTRUSTMENT_HEADERS.CHOOSE_SCORE_MODE}');
                    return;
                }
            
                new Aurora.Window({
                    id: 'bid5040_entrustment_expert_random_choose_window',
                    title: '${l:BID_ENTRUSTMENT_RANDOM_CHOOSE}',
                    url: $('bid5040_eidt_random_choose_link').getUrl() + '?entrustment_header_id=-${/parameter/@rfx_header_id}&sequence_num=' + header_rec.get('sequence_num_2') + '&team=' + header_rec.get('team_2'),
                    height: 460,
                    width: 540
                }).on('beforeclose', function() {
                    $('bid5040_ln_expert_2_ds').query();
                });
            }
            
            function bid5040_ln_expert_RandomChoose() {
                if (!$('bid5040_ln_expert_ds').validate()) {
                    return;
                }
                var header_rec = $('pur51302_rfx_headers_ds').getAt(0);
                var score_mode = header_rec.get('score_mode');
            
                if (Ext.isEmpty(score_mode)) {
                    Aurora.showMessage('${l:PROMPT}', '${l:BID_ENTRUSTMENT_HEADERS.CHOOSE_SCORE_MODE}');
                    return;
                }
            
                new Aurora.Window({
                    id: 'bid5040_entrustment_expert_random_choose_window',
                    title: '${l:BID_ENTRUSTMENT_RANDOM_CHOOSE}',
                    url: $('bid5040_eidt_random_choose_link').getUrl() + '?rfx_header_id=${/parameter/@rfx_header_id}&sequence_num=' + header_rec.get('sequence_num_1') + '&team=' + header_rec.get('team_1'),
                    height: 460,
                    width: 540
                }).on('beforeclose', function() {
                    $('bid5040_ln_expert_ds').query();
                });
            }
            
            function bid5040_expertScoreFun() {
                var header_rec = $('pur51302_rfx_headers_ds').getAt(0);
                var expert_score_flag = header_rec.get('expert_score_flag');
                if (expert_score_flag == 'Y') {
                    Aurora.showConfirm('${l:PROMPT}', '${l:BID_ENTRUSTMENT.CONFIRM_CANCEL}', function() {
                        header_rec.set('expert_score_flag', 'N');
                        header_rec.set('score_mode', '');
                        header_rec.getField('score_mode_desc').setRequired(false);
                        document.getElementById('bid5040_expertScore_div').style.display = "none";
                        document.getElementById('bid5040_expertScore_no_div').style.display = "none";
                        document.getElementById('bid5040_expertScore').innerText = '${l:BID_ENTRUSTMENT_HEADERS.EXPERT_SCORE}';
                    });
                } else {
                    header_rec.set('expert_score_flag', 'Y');
                    header_rec.getField('score_mode_desc').setRequired(true);
                    document.getElementById('bid5040_expertScore_div').style.display = "block";
                    document.getElementById('bid5040_expertScore_no_div').style.display = "none";
                    document.getElementById('bid5040_expertScore').innerText = '${l:BID_ENTRUSTMENT_HEADERS.NO_EXPERT_SCORE}';
                }
            }
            
            function bid5040_edit_onLnExpertScore_expert1_addFun(ds, record, index) {
                var header_rec = $('pur51302_rfx_headers_ds').getAt(0);
                var score_mode = header_rec.get('score_mode');
            
                if (Ext.isEmpty(score_mode)) {
                    Aurora.showMessage('${l:PROMPT}', '${l:BID_ENTRUSTMENT_HEADERS.CHOOSE_SCORE_MODE}');
                    return false;
                }
            
                record.set('team', header_rec.get('team_1'));
                record.set('sequence_num', header_rec.get('sequence_num_1'));
            }
            
            function bid5040_edit_onLnExpertScore_expert2_addFun(ds, record, index) {
                var header_rec = $('pur51302_rfx_headers_ds').getAt(0);
                var score_mode = header_rec.get('score_mode');
            
                if (Ext.isEmpty(score_mode)) {
                    Aurora.showMessage('${l:PROMPT}', '${l:BID_ENTRUSTMENT_HEADERS.CHOOSE_SCORE_MODE}');
                    return false;
                }
            
                record.set('team', header_rec.get('team_2'));
                record.set('sequence_num', header_rec.get('sequence_num_2'));
            }
            
            function bid5040_edit_onLnExpertScore_expert_addFun(ds, record, index) {
                var header_rec = $('pur51302_rfx_headers_ds').getAt(0);
                var score_mode = header_rec.get('score_mode');
            
                if (Ext.isEmpty(score_mode)) {
                    Aurora.showMessage('${l:PROMPT}', '${l:BID_ENTRUSTMENT_HEADERS.CHOOSE_SCORE_MODE}');
                    return false;
                }
            
                record.set('team', header_rec.get('team_1'));
                record.set('sequence_num', header_rec.get('sequence_num_1'));
            }
            
            function bid5040_edit_onLnExpertScore_element1_addFun(ds, record, index) {
                var header_rec = $('pur51302_rfx_headers_ds').getAt(0);
                var score_mode = header_rec.get('score_mode');
            
                if (Ext.isEmpty(score_mode)) {
                    Aurora.showMessage('${l:PROMPT}', '${l:BID_ENTRUSTMENT_HEADERS.CHOOSE_SCORE_MODE}');
                    return false;
                }
            
                record.set('team', header_rec.get('team_1'));
                record.set('sequence_num', header_rec.get('sequence_num_1'));
            }
            
            function bid5040_edit_onLnExpertScore_element2_addFun(ds, record, index) {
                var header_rec = $('pur51302_rfx_headers_ds').getAt(0);
                var score_mode = header_rec.get('score_mode');
            
                if (Ext.isEmpty(score_mode)) {
                    Aurora.showMessage('${l:PROMPT}', '${l:BID_ENTRUSTMENT_HEADERS.CHOOSE_SCORE_MODE}');
                    return false;
                }
            
                record.set('team', header_rec.get('team_2'));
                record.set('sequence_num', header_rec.get('sequence_num_2'));
            }
            
            function bid5040_edit_onLnExpertScore_element_addFun(ds, record, index) {
                var header_rec = $('pur51302_rfx_headers_ds').getAt(0);
                var score_mode = header_rec.get('score_mode');
            
                if (Ext.isEmpty(score_mode)) {
                    Aurora.showMessage('${l:PROMPT}', '${l:BID_ENTRUSTMENT_HEADERS.CHOOSE_SCORE_MODE}');
                    return false;
                }
            
                record.set('team', header_rec.get('team_1'));
                record.set('sequence_num', header_rec.get('sequence_num_1'));
            }
            
            function bid5040_ExpertScoreTeamChangeLoop(ds, team, sequence) {
                var records = ds.getAll();
                for (var i = 0;i < records.length;i++) {
                    records[i].set('team', team);
                    records[i].set('sequence_num', sequence);
                }
            }
            
            function bid5040_ExpertScoreTeamChange(team_1, sequence_num_1, team_2, sequence_num_2) {
                bid5040_ExpertScoreTeamChangeLoop($('bid5040_ln_expert_1_ds'), team_1, sequence_num_1);
                bid5040_ExpertScoreTeamChangeLoop($('bid5040_ln_expert_2_ds'), team_2, sequence_num_2);
                bid5040_ExpertScoreTeamChangeLoop($('bid5040_ln_expert_ds'), team_1, sequence_num_1);
            
                bid5040_ExpertScoreTeamChangeLoop($('bid5040_scoring_elements_1_assign_ds'), team_1, sequence_num_1);
                bid5040_ExpertScoreTeamChangeLoop($('bid5040_scoring_elements_2_assign_ds'), team_2, sequence_num_2);
                bid5040_ExpertScoreTeamChangeLoop($('bid5040_scoring_elements_assign_ds'), team_1, sequence_num_1);
            }
            
            function pur51302_quotationRendererFunction(value, record, name) {
                var rfx_line_item_id = record.get('rfx_line_item_id');
                if (!rfx_line_item_id) {
                    return '-';
                } else {
                    return '<a href="javascript:pur51302_quotationEditFunction(' + rfx_line_item_id + ')">报价模型</a>';
                }
            }
            
            function pur51302_quotationEditFunction(rfx_line_item_id) {
                var record = $('pur51302_rfx_headers_ds').getCurrentRecord();
                var logistics_quotation_code = record.get('logistics_quotation_code');
                var url;
                var id;
                var title;
                if (logistics_quotation_code == 'EXPRESS_FRAME') {
                    url = $('pur51302_expressFrame_maintain_link').getUrl();
                    id = 'pur5130_expressFrameEdit_window';
                    title = '快递框架模型';
                } else if (logistics_quotation_code == 'DOMESTIC_LOGISTICS_FRAME') {
                    url = $('pur51302_logisticsFrame_maintain_link').getUrl();
                    id = 'pur5130_logisticsFrameEdit_window';
                    title = '国内物流框架模型';
                } else if (logistics_quotation_code == 'VEHICLE_LOGISTICS_FRAME') {
                    url = $('pur51302_vehicleFrame_maintain_link').getUrl();
                    id = 'pur5130_vehicleFrameEdit_window';
                    title = '整车物流框架模型';
                }
            
                new Aurora.Window({
                    url: url + '?rfx_line_item_id=' + rfx_line_item_id,
                    title: title,
                    id: id,
                    width: 600,
                    height: 350
                });
            }
            
            function pur51302_upload_attachment(value, record, name) {
                var rfx_line_item_id = record.get('rfx_line_item_id');
                var atm_counts = record.get('atm_counts');
                if (name == "item_attachment") {
                    if (Aurora.isEmpty(rfx_line_item_id)) {
                        return '-';
                    } else {
                        return '<a href="javascript:pur51302_attach_upload_function(' + rfx_line_item_id + ')">${l:ATM.UPLOAD_ATTACHMENT}</a>';
                    }
                }
            
                if (name == "atm_flag") {
                    if (atm_counts > 0) {
                        return '<div style="margin-top:3px;margin-left:auto;margin-right:auto;vertical-align:middle;height:20px;line-height:20px;"><img src="${/request/@context_path}/images/paperclip.png"/></div>';
            
                    } else {
                        return '';
                    }
                }
            }
            
            function pur51302_attach_upload_function(rfx_line_item_id) {
                new Aurora.Window({
                    id: 'pur51302_attachment_file_upload_link_window',
                    title: '${l:HAP_UPLOAD_TITLE}',
                    url: $('pur51302_attachment_file_upload_link').getUrl() + '?pkvalue=' + rfx_line_item_id + '&table_name=PUR_RFX_LN_ITEMS',
                    width: 500,
                    height: 500
                });
            }
            
            function PUR5130_rfxPassword() {
                var ds = $('pur51302_rfx_headers_ds');
                var record = ds.getCurrentRecord();
                var rfx_header_id = record.get('rfx_header_id');
                new Aurora.Window({
                    id: 'pur5130_rfx_password_define_window',
                    url: $('pur5130_rfx_password_define_link').getUrl() + '?rfx_header_id=' + rfx_header_id + '&temp_rfx_header_id=-1',
                    title: '${l:PUR5130.BID_OPENING_PASSWORD_DEFINITION}',
                    height: 400,
                    width: 600
                });
            }
            
            function bid5040_UploadPrequalAttachmentFun() {
                var url = "${/request/@context_path}/uploadFile.screen?table_name=BID_PREQUAL_HEADERS&header_id=-${/parameter/@rfx_header_id}";
                new Aurora.Window({
                    url: url,
                    title: '${l:ATM.UPLOAD_ATTACHMENT}',
                    id: 'bid5040_prequal_window',
                    width: 610,
                    height: 500
                });
            }
            
            function pur51302_rfx_operation_records_window() {
                new Aurora.Window({
                    url: $('pur51302_rfx_operation_records_link').getUrl() + '?rfx_header_id=${/parameter/@rfx_header_id}',
                    title: '${l:PROMPT.OPERATION_RECORD}',
                    id: 'pur_publicRfxOperationRecord_window',
                    width: 510,
                    height: 370
                });
            }
            
            function pur51302_ladderInquiryEditFunction(rfx_line_item_id) {
                new Aurora.Window({
                    url: $('pur51302_ladderInquiryEdit_link').getUrl() + '?rfx_line_item_id=' + rfx_line_item_id,
                    title: '${l:PUR5130.LADDER_LEVEL}',
                    id: 'pur51302_ladderInquiryEdit_window',
                    width: 500,
                    height: 350
                });
            }
            
            function pur51302_ladderInquiryRendererFunction(value, record, name) {
                var rfx_line_item_id = record.get('rfx_line_item_id');
                var ladder_inquiry_flag = record.get('ladder_inquiry_flag');
                if (Aurora.isEmpty(rfx_line_item_id) || rfx_line_item_id == 'undefined' || ladder_inquiry_flag != 'Y') {
                    return '-';
                } else {
                    return '<a href="javascript:pur51302_ladderInquiryEditFunction(' + rfx_line_item_id + ')">${l:PUR5130.LADDER_LEVEL}</a>';
                }
            }
            
            function expert_assign_render(value, record, name) {
                var score_element_assign_id = record.get('score_element_assign_id');
                //  var team = record.get('team');
            
                if (score_element_assign_id) {
                    return '<a href="javascript:pur_rfx_element_expert_assign_detail(' + score_element_assign_id + ')">${l:PUR_RFX_EXPERT_ASSIGN}</a>';
                }
            
            }
            
            function pur_rfx_element_expert_assign_detail(score_element_assign_id) {
                new Aurora.Window({
                    url: $('pur_rfx_element_expert_assign_link').getUrl() + '?score_element_assign_id=' + score_element_assign_id,
                    title: '${l:PUR_RFX_EXPERT_ASSIGN}',
                    id: 'pur_rfx_element_expert_assign_window',
                    width: 500,
                    height: 350
                });
            }
        ]]></script>
        <a:dataSets>
            <a:dataSet id="pur51302_bg_rfx_type_ds" autoCreate="true" loadData="true">
                <a:datas dataSource="/model/pur51302_bg_rfx_type"/>
            </a:dataSet>
            <a:dataSet id="pur51302_rfx_category_ds" lookupCode="PUR_RFX_CATEGORY"/>
            <a:dataSet id="pur51302_rfx_method_ds" lookupCode="PUR_RFX_METHOD"/>
            <a:dataSet id="pur51302_rfx_auction_direction_ds" lookupCode="PUR_RFX_AUCTION_DIRECTION"/>
            <a:dataSet id="pur51302_rfx_auction_rule_ds" lookupCode="PUR_RFX_AUCTION_RULE"/>
            <a:dataSet id="pur51302_rfx_open_rule_ds" lookupCode="PUR_RFX_OPEN_RULE"/>
            <a:dataSet id="pur51302_rfx_ranking_rule_ds" lookupCode="PUR_RFX_RANKING_RULE"/>
            <a:dataSet id="pur51302_rfx_auction_ranking_ds" lookupCode="PUR_RFX_AUCTION_RANKING"/>
            <a:dataSet id="pur51202_rfx_logistics_quotation_ds" lookupCode="PUR_RFX_LOGISTICS_QUOTATION"/>
            <!-- 评分模式 -->
            <a:dataSet id="bid5040_edit_score_modes_ds" lookupCode="BID_ENTRUSTMENT_SCORE_MODES"/>
            <a:dataSet id="pur51302_rfx_types_ds" autoCreate="true" loadData="true">
                <a:datas dataSource="/model/pur51302_rfx_types_source"/>
            </a:dataSet>
            <a:dataSet id="pur51302_payment_method_ds" autoCreate="true" loadData="true">
                <a:datas dataSource="/model/pur51302_payment_methods_source"/>
            </a:dataSet>
            <a:dataSet id="pur51302_currency_ds" autoCreate="true" loadData="true">
                <a:datas dataSource="/model/pur51302_currency_source"/>
            </a:dataSet>
            <!-- 阶梯报价类型 -->
            <a:dataSet id="rfx_ladder_inquiry_type_ds" lookupCode="PUR_RFX_LADDER_INQUIRY_TYPE_CODE"/>
            <!--寻源类型-->
            <a:dataSet id="pur51302_source_type_ds" lookupCode="PUR_RFX_SOURCE_TYPE"/>
            <a:dataSet id="pur51302_price_category_ds" lookupCode="PUR_RFX_PRICE_CATEGORY"/>
            <a:dataSet id="pur51302_rfx_headers_ds" autoQuery="true" queryUrl="${/request/@context_path}/autocrud/pur.PUR5120.pur_rfx_headers/query?rfx_header_id=${/parameter/@rfx_header_id}">
                <a:fields>
                    <a:field name="logistics_quotation_code"/>
                    <a:field name="logistics_quotation_desc" displayField="code_value_name" options="pur51202_rfx_logistics_quotation_ds" readOnly="true" returnField="logistics_quotation_code" valueField="code_value"/>
                    <a:field name="rfx_type_desc" displayField="rfx_type_desc" options="pur51302_bg_rfx_type_ds" readOnly="true" required="true" returnField="rfx_type_id" valueField="rfx_type_id">
                        <a:mapping>
                            <a:map from="rfx_type_desc" to="rfx_type_desc"/>
                            <a:map from="tax_flag" to="tax_included_flag"/>
                            <a:map from="rfx_type_code" to="rfx_type_code"/>
                            <a:map from="rfx_category" to="rfx_category"/>
                            <a:map from="rfx_category_desc" to="rfx_category_desc"/>
                            <a:map from="default_rfx_method_desc" to="rfx_method_desc"/>
                            <a:map from="default_rfx_method" to="rfx_method"/>
                            <a:map from="default_auction_direction_desc" to="auction_direction_desc"/>
                            <a:map from="default_auction_direction" to="auction_direction"/>
                            <a:map from="default_open_rule_desc" to="open_rule_desc"/>
                            <a:map from="default_open_rule" to="open_rule"/>
                            <a:map from="default_auction_ranking_desc" to="auction_ranking_desc"/>
                            <a:map from="default_auction_ranking" to="auction_ranking"/>
                            <a:map from="default_seal_quote" to="sealed_bid_flag"/>
                            <a:map from="tax_type_desc" to="tax_type_desc"/>
                            <a:map from="tax" to="tax_type_rate"/>
                            <a:map from="tax_code" to="tax_type_code"/>
                            <a:map from="tax_id" to="tax_type_id"/>
                            <a:map from="password_flag" to="password_flag"/>
                            <a:map from="pur_organization_name" to="pur_organization_name"/>
                            <a:map from="pur_organization_id" to="pur_organization_id"/>
                            <a:map from="item_classify_require_flag" to="item_classify_require_flag"/>
                            <a:map from="pur_organization_require_flag" to="pur_organization_require_flag"/>
                            <a:map from="department_approve_flag" to="department_approve_flag"/>
                            <a:map from="price_category" to="price_category"/>
                            <a:map from="price_category_desc" to="price_category_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="quotation_title" autoComplete="true" autoCompleteField="quotation_title" lovHeight="480" lovService="cux.KINWONG.rfx.rfx5010.quotation_template_lov" lovWidth="500" ovGridHeight="320" title="报价模板">
                        <a:mapping>
                            <a:map from="quotation_title" to="quotation_title"/>
                            <a:map from="quotation_id" to="quotation_id"/>
                            <a:map from="quotation_header_id" to="quotation_header_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="rfx_header_id"/>
                    <a:field name="source_from" defaultValue="MANUAL"/>
                    <a:field name="department_approve_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="rfx_number" readOnly="true"/>
                    <a:field name="company_id"/>
                    <a:field name="pur_organization_name" autoComplete="true" autoCompleteField="pur_organization_code_name" lovHeight="480" lovService="public.pur_organization_lov" lovWidth="510" title="PUR_ORGANIZATIONS.PUR_ORGANIZATION">
                        <a:mapping>
                            <a:map from="pur_organization_id" to="pur_organization_id"/>
                            <a:map from="pur_organization_code" to="pur_organization_code"/>
                            <a:map from="pur_organization_name" to="pur_organization_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="business_unit_name" autoComplete="true" autoCompleteField="business_unit_code_name" lovHeight="480" lovService="public.fnd_business_unit_lov" lovWidth="500" readOnly="true" title="FND_BUSINESS_UNITS.BUSINESS_UNIT_QUERY">
                        <a:mapping>
                            <a:map from="owner_business_unit_id" to="owner_business_unit_id"/>
                            <a:map from="business_unit_code" to="business_unit_code"/>
                            <a:map from="business_unit_name" to="business_unit_name"/>
                            <a:map from="company_id" to="company_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="rfx_category"/>
                    <a:field name="rfx_category_desc" displayField="code_value_name" options="pur51302_rfx_category_ds" required="true" returnField="rfx_category" valueField="code_value"/>
                    <a:field name="title" required="true" requiredMessage="${l:PUR5130.PLEASE_FILL_RFX_TITLE}"/>
                    <a:field name="rfx_method"/>
                    <a:field name="rfx_method_desc" displayField="code_value_name" options="pur51302_rfx_method_ds" required="true" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_RFX_MODE}" returnField="rfx_method" valueField="code_value"/>
                    <a:field name="auction_direction"/>
                    <a:field name="auction_direction_desc" displayField="code_value_name" options="pur51302_rfx_auction_direction_ds" required="true" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_BIDDING_DIRECTION}" returnField="auction_direction" valueField="code_value"/>
                    <a:field name="auction_rule"/>
                    <a:field name="auction_rule_desc" displayField="code_value_name" options="pur51302_rfx_auction_rule_ds" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_BIDDING_RULE}" returnField="auction_rule" valueField="code_value"/>
                    <a:field name="open_rule"/>
                    <a:field name="open_rule_desc" displayField="code_value_name" options="pur51302_rfx_open_rule_ds" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_OPEN_RULE}" returnField="open_rule" valueField="code_value"/>
                    <a:field name="ranking_rule"/>
                    <a:field name="ranking_rule_desc" displayField="code_value_name" options="pur51302_rfx_ranking_rule_ds" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_RANK_RULE}" returnField="ranking_rule" valueField="code_value"/>
                    <a:field name="auction_ranking"/>
                    <a:field name="auction_ranking_desc" displayField="code_value_name" options="pur51302_rfx_auction_ranking_ds" returnField="auction_ranking" valueField="code_value"/>
                    <a:field name="payment_method_id"/>
                    <a:field name="payment_method_desc" displayField="payment_method_desc" options="pur51302_payment_method_ds" returnField="payment_method_id" valueField="payment_method_id"/>
                    <a:field name="currency_code"/>
                    <a:field name="currency_desc" displayField="currency_name" options="pur51302_currency_ds" required="true" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_CURRENCY}" returnField="currency_code" valueField="currency_code">
                        <a:mapping>
                            <a:map from="currency_name" to="currency_desc"/>
                            <a:map from="currency_code" to="currency_code"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="exchange_rate" readOnly="true" requiredMessage="${l:PUR5130.PLEASE_FILL_EXCHANGE_RATE}"/>
                    <a:field name="tax_included_flag" checkedValue="Y" uncheckedValue="N"/>
                    <a:field name="tax_type_id"/>
                    <a:field name="tax_type_desc" lovHeight="480" lovService="public.fnd_tax_type_code_lov?business_group=${/session/@business_group}" lovWidth="500" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_TAX_CODE}" title="PUR_REQ_LINES.TAX_TYPE_RATE">
                        <a:mapping>
                            <a:map from="tax_type_id" to="tax_type_id"/>
                            <a:map from="tax_type_code" to="tax_type_code"/>
                            <a:map from="description" to="tax_type_desc"/>
                            <a:map from="tax_type_rate" to="tax_type_rate"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="tax_type_rate" readOnly="true"/>
                    <a:field name="place_of_delivery"/>
                    <a:field name="round" readOnly="true"/>
                    <a:field name="status_desc" readOnly="true"/>
                    <a:field name="feedback_range"/>
                    <a:field name="created_by"/>
                    <a:field name="created_by_desc" readOnly="true"/>
                    <a:field name="creation_date_desc" readOnly="true"/>
                    <a:field name="issued_date_desc" readOnly="true"/>
                    <a:field name="feedback_end_time" required="true" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_QUOTE_CLOSING_TIME}"/>
                    <a:field name="comments"/>
                    <a:field name="unique_template_flag"/>
                    <a:field name="sealed_bid_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="sealing_cutoff_date" readOnly="true" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_SEALED_DEADLINE}" validator="pur51302_release_dateValidator"/>
                    <a:field name="source_type_desc" defaultValue="${l:PUR5130.CONVENTIONAL}" displayField="code_value_name" options="pur51302_source_type_ds" required="true" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_SOURCE_TYPE}" returnField="source_type" valueField="code_value"/>
                    <a:field name="price_category_desc" defaultValue="${l:PUR5130.STANDARD}" displayField="code_value_name" options="pur51302_price_category_ds" required="true" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_PRICE_CATEGORY}" returnField="price_category" valueField="code_value"/>
                    <a:field name="score_mode_desc" displayField="code_value_name" options="bid5040_edit_score_modes_ds" returnField="score_mode" valueField="code_value"/>
                    <a:field name="team_1" readOnly="true"/>
                    <a:field name="team_1_desc" readOnly="true"/>
                    <a:field name="sequence_num_1"/>
                    <a:field name="team_2" readOnly="true"/>
                    <a:field name="sequence_num_2"/>
                    <a:field name="team_2_desc" readOnly="true"/>
                    <a:field name="is_quot_quantity_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                </a:fields>
                <a:events>
                    <a:event name="update" handler="pur51302_rfx_headers_ds_update"/>
                    <a:event name="load" handler="pur51302_rfx_headers_ds_load"/>
                </a:events>
            </a:dataSet>
            <!-- 物品行 -->
            <a:dataSet id="pur51302_rfx_ln_items_ds" autoCount="true" autoPageSize="true" model="pur.PUR5120.pur_rfx_ln_items" queryUrl="${/request/@context_path}/autocrud/pur.PUR5120.pur_rfx_ln_items/query?rfx_header_id=${/parameter/@rfx_header_id}" selectable="true">
                <a:fields>
                    <a:field name="line_num" required="true"/>
                    <a:field name="rfx_line_item_id"/>
                    <a:field name="source_from" defaultValue="MANUAL"/>
                    <a:field name="round_flag" defaultValue="Y"/>
                    <a:field name="auto_create_distribute" defaultValue="Y"/>
                    <a:field name="line_number"/>
                    <a:field name="company_id"/>
                    <a:field name="inv_organization_id"/>
                    <a:field name="inv_organization_desc" autoComplete="true" autoCompleteField="code_name" lovHeight="505" lovService="public.inv_organizations_lov" lovWidth="750" required="true" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_INV_ORG}" title="PUR_RFX_LN_ITEMS.INV_ORGANIZATION_ID">
                        <a:mapping>
                            <a:map from="inv_organization_id" to="inv_organization_id"/>
                            <a:map from="inv_organization_name" to="inv_organization_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="ladder_inquiry_desc" displayField="code_value_name" options="rfx_ladder_inquiry_type_ds" returnField="ladder_inquiry_code" valueField="code_value"/>
                    <a:field name="item_category_id"/>
                    <a:field name="item_category_desc" autoComplete="true" autoCompleteField="category_code_name" lovHeight="480" lovService="pur.PUR5130.mtl_categories_user_defined_vl" lovWidth="510" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_MATL_CATEGORY}" title="PUR_REQUISITION_LNS.ITEM_CATEGORY_ID">
                        <a:mapping>
                            <a:map from="category_name" to="item_category_desc"/>
                            <a:map from="category_udf_id" to="item_category_id"/>
                            <a:map from="category_code" to="item_category_code"/>
                            <a:map from="quote_tmpl_flag" to="quote_tmpl_flag"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="item_id"/>
                    <a:field name="item_code" autoComplete="true" autoCompleteField="item_code" lovHeight="480" lovService="public.mtl_system_item_relations_lov" lovWidth="550" title="MTL_SYSTEM_ITEMS.ITEM_CODE">
                        <a:mapping>
                            <a:map from="item_id" to="item_id"/>
                            <a:map from="item_code" to="item_code"/>
                            <a:map from="item_name" to="item_desc"/>
                            <a:map from="item_note" to="item_note"/>
                            <a:map from="primary_uom_code" to="uom_code"/>
                            <a:map from="primary_uom_desc" to="uom_desc"/>
                            <a:map from="item_category_id" to="item_category_id"/>
                            <a:map from="item_category_name" to="item_category_desc"/>
                            <a:map from="item_category_code" to="item_category_code"/>
                            <a:map from="quote_tmpl_flag" to="quote_tmpl_flag"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="item_desc"/>
                    <a:field name="item_note"/>
                    <a:field name="item_parameter_config"/>
                    <a:field name="quantity" requiredMessage="${l:PUR5130.PLEASE_FILL_DEMAND_QUANTITY}"/>
                    <a:field name="uom_code"/>
                    <a:field name="uom_desc" autoComplete="true" autoCompleteField="code_name" lovGridHeight="350" lovHeight="500" lovService="public.fnd_uom_codes_lov" lovWidth="500" title="FND_UOM_CODES.UOM">
                        <a:mapping>
                            <a:map from="uom_code" to="uom_code"/>
                            <a:map from="uom_desc" to="uom_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="need_by_date" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_DEMAND_DATE}"/>
                    <!-- <a:field name="pur_ln_type"/>
                    <a:field name="pur_ln_type_desc" displayField="line_type" options="pur51302_pur_ln_type_ds" required="true" returnField="pur_ln_type" valueField="line_type_id"/> -->
                    <a:field name="samples_requested" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="tax_included_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="tax_type_rate" lovHeight="480" lovService="public.fnd_tax_type_code_lov?business_group=${/session/@business_group}" lovWidth="500" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_TAX_CODE}" title="PUR_REQ_LINES.TAX_TYPE_RATE">
                        <a:mapping>
                            <a:map from="tax_type_id" to="tax_type_id"/>
                            <a:map from="tax_type_code" to="tax_type_code"/>
                            <a:map from="description" to="tax_type_desc"/>
                            <a:map from="tax_type_rate" to="tax_type_rate"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="ladder_inquiry_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                </a:fields>
                <a:events>
                    <a:event name="update" handler="pur51302_rfx_ln_items_ds_update"/>
                    <a:event name="load" handler="pur51302_rfx_ln_items_ds_load"/>
                    <a:event name="add" handler="pur51302_rfx_ln_items_ds_add"/>
                </a:events>
            </a:dataSet>
            <!-- Quote Ds -->
            <a:dataSet id="pur51202_rfx_quote_create_ds" bindName="quote_lines" bindTarget="pur51302_rfx_ln_items_ds" fetchAll="true" model="pur.PUR5130.pur_rfx_quotes">
                <a:events>
                    <a:event name="load" handler="pur51202_rfx_quote_create_loadFun"/>
                    <a:event name="update" handler="pur51202_rfx_quote_create_updateFun"/>
                    <a:event name="query" handler="pur51202_rfx_quote_create_queryFun"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="pur51302_rfx_quote_query_ds" autoQuery="true" fetchAll="true" model="pur.PUR5130.pur_rfx_quote_tmpl_line_create_query">
                <a:events>
                    <a:event name="load" handler="pur51302_rfx_quote_query_ds_loadFun"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="pur51202_rfx_quote_edit_ds"/>
            <a:dataSet id="pur51302_rfx_ln_vendors_ds" autoQuery="true" model="pur.PUR5120.pur_rfx_ln_vendors" queryUrl="${/request/@context_path}/autocrud/pur.PUR5120.pur_rfx_ln_vendors/query?rfx_header_id=${/parameter/@rfx_header_id}" selectable="true">
                <a:fields>
                    <a:field name="vendor_company_id"/>
                    <a:field name="vendor_code" autoComplete="true" autoCompleteField="vendor_code" lovGridHeight="320" lovHeight="480" lovService="pur.PUR5120.pur_vendors_by_user_authority_lov?rfx_header_id=${/parameter/@rfx_header_id}" lovWidth="500" required="true" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_VENDOR}" title="PUR_VENDORS.VENDOR">
                        <a:mapping>
                            <a:map from="coop_company_id" to="coop_company_id"/>
                            <a:map from="vendor_code" to="vendor_code"/>
                            <a:map from="vendor_desc" to="vendor_desc"/>
                            <a:map from="coop_business_group" to="coop_business_group"/>
                            <a:map from="contact_id" to="vendor_contact_id"/>
                            <a:map from="contact_person" to="contact_person"/>
                            <a:map from="contact_mobile" to="contact_mobile"/>
                            <a:map from="contact_mail" to="e_mail"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="vendor_desc"/>
                    <a:field name="vendor_contact_id"/>
                    <a:field name="contact_person" autoComplete="true" autoCompleteField="contact_name" lovGridHeight="320" lovHeight="450" lovService="public.fnd_com_sup_contacts_lov" lovWidth="800" readOnly="true" title="PUR_RFX_LN_VENDORS.CONTACT_PERSON">
                        <a:mapping>
                            <a:map from="contact_id" to="vendor_contact_id"/>
                            <a:map from="contact_name" to="contact_person"/>
                            <a:map from="mobile_phone" to="contact_mobile"/>
                            <a:map from="email" to="e_mail"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="contact_mobile"/>
                    <a:field name="e_mail"/>
                    <a:field name="sms_schicken_flag" checkedValue="Y" defaultValue="Y" uncheckedValue="N"/>
                </a:fields>
                <a:events>
                    <a:event name="update" handler="pur51302_rfx_ln_vendors_ds_update"/>
                    <a:event name="load" handler="pur51302_rfx_ln_vendors_ds_load"/>
                    <a:event name="beforecreate" handler="pur51302_rfx_ln_vendors_ds_beforecreate"/>
                    <a:event name="add" handler="pur51302_rfx_ln_vendors_ds_add"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="pur51302_rfx_ln_attachments" autoQuery="true" bindTarget="pur51302_rfx_headers_ds" model="public.fnd_atm_lines" queryUrl="${/request/@context_path}/autocrud/public.fnd_atm_lines/query?source_table_name=PUR_RFX_HEADERS&amp;source_pk_value=${/parameter/@rfx_header_id}" selectable="true">
                <a:fields>
                    <a:field name="atm_line_id"/>
                    <a:field name="line_number"/>
                    <a:field name="atm_desc"/>
                    <a:field name="source_table_name" defaultValue="PUR_RFX_HEADERS"/>
                    <a:field name="source_pk_value" defaultValue="${/parameter/@rfx_header_id}"/>
                </a:fields>
            </a:dataSet>
            <!-- 资格预审 -->
            <a:dataSet id="bid5040_edit_prequal_review_methods_ds" lookupCode="BID_PREQUAL_REVIEW_METHODS"/>
            <a:dataSet id="bid5040_edit_entrustment_prequal" autoCreate="true" autoQuery="true" model="pur.PUR5130.pur_rfx_prequal" queryUrl="${/request/@context_path}/autocrud/pur.PUR5130.pur_rfx_prequal/query?rfx_header_id=${/parameter/@rfx_header_id}">
                <a:fields>
                    <a:field name="rfx_header_id" defaultValue="${/parameter/@rfx_header_id}"/>
                    <a:field name="closing_date" required="true"/>
                    <a:field name="review_method_desc" displayField="code_value_name" options="bid5040_edit_prequal_review_methods_ds" returnField="review_method" valueField="code_value"/>
                    <a:field name="qualified_limit" readOnly="true"/>
                    <a:field name="file_free_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="proqual_file_expense" readOnly="false" required="true"/>
                </a:fields>
                <a:events>
                    <a:event name="load" handler="bid5040_onEditEntrustmentPrequal_loadFun"/>
                    <a:event name="update" handler="bid5040_onEditEntrustmentPrequal_updateFun"/>
                </a:events>
            </a:dataSet>
            <!-- 专家评分 -->
            <!-- 1 EXPERT -->
            <a:dataSet id="bid5040_ln_expert_1_ds" autoCount="true" autoPageSize="true" model="pur.PUR5130.pur_rfx_ln_experts" queryUrl="${/request/@context_path}/autocrud/pur.PUR5130.pur_rfx_ln_experts/query?rfx_header_id=${/parameter/@rfx_header_id}" selectable="true">
                <a:fields>
                    <a:field name="rfx_header_id" defaultValue="${/parameter/@rfx_header_id}"/>
                    <a:field name="team"/>
                    <a:field name="sequence_num"/>
                    <a:field name="line_expert_id"/>
                    <a:field name="expert_user_name" lovGridHeight="320" lovHeight="450" lovService="bid.BID5150.bid_expert_employee_lov" lovWidth="500" required="true" title="专家">
                        <a:mapping>
                            <a:map from="expert_id" to="expert_id"/>
                            <a:map from="user_name" to="expert_user_name"/>
                            <a:map from="full_name" to="expert_user_desc"/>
                            <a:map from="source_type" to="source_type"/>
                            <a:map from="source_type_desc" to="source_type_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="name"/>
                    <a:field name="expert_id"/>
                    <a:field name="source_type"/>
                    <a:field name="source_type_desc"/>
                    <a:field name="leader_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                </a:fields>
                <a:events>
                    <a:event name="add" handler="bid5040_edit_onLnExpertScore_expert1_addFun"/>
                    <a:event name="update" handler="bid5040_onLnExpert1_updateFun"/>
                </a:events>
            </a:dataSet>
            <!-- 2 EXPERT -->
            <a:dataSet id="bid5040_ln_expert_2_ds" autoCount="true" autoPageSize="true" model="pur.PUR5130.pur_rfx_ln_experts" queryUrl="${/request/@context_path}/autocrud/pur.PUR5130.pur_rfx_ln_experts/query?rfx_header_id=${/parameter/@rfx_header_id}" selectable="true">
                <a:fields>
                    <a:field name="rfx_header_id" defaultValue="${/parameter/@rfx_header_id}"/>
                    <a:field name="team"/>
                    <a:field name="sequence_num"/>
                    <a:field name="line_expert_id"/>
                    <a:field name="expert_user_name" lovGridHeight="320" lovHeight="450" lovService="bid.BID5150.bid_expert_employee_lov" lovWidth="500" required="true" title="专家">
                        <a:mapping>
                            <a:map from="expert_id" to="expert_id"/>
                            <a:map from="user_name" to="expert_user_name"/>
                            <a:map from="full_name" to="expert_user_desc"/>
                            <a:map from="source_type" to="source_type"/>
                            <a:map from="source_type_desc" to="source_type_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="name"/>
                    <a:field name="expert_id"/>
                    <a:field name="source_type"/>
                    <a:field name="source_type_desc"/>
                    <a:field name="leader_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                </a:fields>
                <a:events>
                    <a:event name="add" handler="bid5040_edit_onLnExpertScore_expert2_addFun"/>
                    <a:event name="update" handler="bid5040_onLnExpert2_updateFun"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="bid5040_ln_expert_ds" autoCount="true" autoPageSize="true" model="pur.PUR5130.pur_rfx_ln_experts" queryUrl="${/request/@context_path}/autocrud/pur.PUR5130.pur_rfx_ln_experts/query?rfx_header_id=${/parameter/@rfx_header_id}" selectable="true">
                <a:fields>
                    <a:field name="rfx_header_id" defaultValue="${/parameter/@rfx_header_id}"/>
                    <a:field name="team"/>
                    <a:field name="sequence_num"/>
                    <a:field name="line_expert_id"/>
                    <a:field name="expert_user_name" lovGridHeight="320" lovHeight="450" lovService="bid.BID5150.bid_expert_employee_lov" lovWidth="500" required="true" title="专家">
                        <a:mapping>
                            <a:map from="expert_id" to="expert_id"/>
                            <a:map from="user_name" to="expert_user_name"/>
                            <a:map from="full_name" to="expert_user_desc"/>
                            <a:map from="source_type" to="source_type"/>
                            <a:map from="source_type_desc" to="source_type_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="name"/>
                    <a:field name="expert_id"/>
                    <a:field name="source_type"/>
                    <a:field name="source_type_desc"/>
                    <a:field name="leader_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                </a:fields>
                <a:events>
                    <a:event name="add" handler="bid5040_edit_onLnExpertScore_expert_addFun"/>
                    <a:event name="update" handler="bid5040_onLnExpert_updateFun"/>
                </a:events>
            </a:dataSet>
            <!-- 1 ELEMENTS -->
            <a:dataSet id="bid5040_scoring_elements_1_assign_ds" autoCount="true" autoPageSize="true" model="pur.PUR5130.pur_rfx_ln_scoring_elements_assign" queryUrl="${/request/@context_path}/autocrud/pur.PUR5130.pur_rfx_ln_scoring_elements_assign/query?rfx_header_id=${/parameter/@rfx_header_id}" selectable="true">
                <a:fields>
                    <a:field name="rfx_header_id" defaultValue="${/parameter/@rfx_header_id}"/>
                    <a:field name="team"/>
                    <a:field name="sequence_num"/>
                    <a:field name="scoring_elements_code" autoComplete="true" autoCompleteField="code_name" lovHeight="480" lovService="public.bid_scoring_elements_lov" lovWidth="500" required="true" title="BID_SCORING_ELEMENTS.SCORING_ELEMENTS">
                        <a:mapping>
                            <a:map from="scoring_detail" to="scoring_rules"/>
                            <a:map from="scoring_elements_id" to="scoring_elements_id"/>
                            <a:map from="scoring_elements_code" to="scoring_elements_code"/>
                            <a:map from="scoring_elements_desc" to="scoring_elements_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="highest_scores" required="true"/>
                </a:fields>
                <a:events>
                    <a:event name="add" handler="bid5040_edit_onLnExpertScore_element1_addFun"/>
                </a:events>
            </a:dataSet>
            <!-- 2 ELEMENTS -->
            <a:dataSet id="bid5040_scoring_elements_2_assign_ds" autoCount="true" autoPageSize="true" model="pur.PUR5130.pur_rfx_ln_scoring_elements_assign" queryUrl="${/request/@context_path}/autocrud/pur.PUR5130.pur_rfx_ln_scoring_elements_assign/query?rfx_header_id=${/parameter/@rfx_header_id}" selectable="true">
                <a:fields>
                    <a:field name="rfx_header_id" defaultValue="${/parameter/@rfx_header_id}"/>
                    <a:field name="team"/>
                    <a:field name="sequence_num"/>
                    <a:field name="scoring_elements_code" autoComplete="true" autoCompleteField="code_name" lovHeight="480" lovService="public.bid_scoring_elements_lov" lovWidth="500" required="true" title="BID_SCORING_ELEMENTS.SCORING_ELEMENTS">
                        <a:mapping>
                            <a:map from="scoring_detail" to="scoring_rules"/>
                            <a:map from="scoring_elements_id" to="scoring_elements_id"/>
                            <a:map from="scoring_elements_code" to="scoring_elements_code"/>
                            <a:map from="scoring_elements_desc" to="scoring_elements_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="highest_scores" required="true"/>
                </a:fields>
                <a:events>
                    <a:event name="add" handler="bid5040_edit_onLnExpertScore_element2_addFun"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="bid5040_scoring_elements_assign_ds" autoCount="true" autoPageSize="true" model="pur.PUR5130.pur_rfx_ln_scoring_elements_assign" queryUrl="${/request/@context_path}/autocrud/pur.PUR5130.pur_rfx_ln_scoring_elements_assign/query?rfx_header_id=${/parameter/@rfx_header_id}" selectable="true">
                <a:fields>
                    <a:field name="rfx_header_id" defaultValue="${/parameter/@rfx_header_id}"/>
                    <a:field name="team"/>
                    <a:field name="sequence_num"/>
                    <a:field name="scoring_elements_code" autoComplete="true" autoCompleteField="code_name" lovGridHeight="350" lovHeight="510" lovService="public.bid_scoring_elements_lov" lovWidth="500" required="true" title="BID_SCORING_ELEMENTS.SCORING_ELEMENTS">
                        <a:mapping>
                            <a:map from="scoring_detail" to="scoring_rules"/>
                            <a:map from="scoring_elements_id" to="scoring_elements_id"/>
                            <a:map from="scoring_elements_code" to="scoring_elements_code"/>
                            <a:map from="scoring_elements_desc" to="scoring_elements_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="highest_scores" required="true"/>
                </a:fields>
                <a:events>
                    <a:event name="add" handler="bid5040_edit_onLnExpertScore_element_addFun"/>
                </a:events>
            </a:dataSet>
        </a:dataSets>
        <a:screenBody>
            <a:screenTopToolbar>
                <a:toolbarButton click="pur51302_rfx_first_trial_maintain_save" style="margin-left:20px;" text="HAP_SAVE" width="100"/>
                <a:toolbarButton click="pur51302_rfx_first_trail_maintain_issue" text="PUR5140.RELEASE" width="100"/>
                <a:toolbarButton click="pur51302_rfx_operation_records_window" text="PUR7110.OPERATION_RECORD" width="100"/>
                <a:toolbarButton id="pur51302_reback_button" click="pur51302_rfxFirstTrialMaintainBack" text="HAP_BACK" width="100"/>
                <a:switch test="/parameter/@atm_counts">
                    <a:case value="1">
                        <div style="float:right;margin-top:10px;margin-left:auto;margin-right:20px;vertical-align:middle;">
                            <img src="${/request/@context_path}/images/paperclip.png"/>
                        </div>
                    </a:case>
                </a:switch>
            </a:screenTopToolbar>
            <a:vBox labelWidth="120" padding="0">
                <a:hBox labelWidth="120">
                    <a:textField name="rfx_number" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.RFX_NUMBER" readOnly="true"/>
                    <a:lov name="pur_organization_name" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_ORGANIZATIONS.PUR_ORG_NAME"/>
                    <a:lov name="business_unit_name" bindTarget="pur51302_rfx_headers_ds" prompt="FND_BUSINESS_UNITS.BUSINESS_UNIT"/>
                </a:hBox>
                <a:hBox labelWidth="120">
                    <a:textField name="title" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.TITLE"/>
                    <a:comboBox name="rfx_type_desc" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.RFX_TYPE_ID"/>
                    <a:comboBox name="auction_direction_desc" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.AUCTION_DIRECTION"/>
                    <!--  <a:comboBox name="rfx_category_desc" bindTarget="pur51302_rfx_headers_ds" prompt="询价单类别"/> -->
                </a:hBox>
                <a:hBox labelWidth="120">
                    <a:comboBox name="rfx_method_desc" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.RFX_METHOD"/>
                    <a:comboBox name="payment_method_desc" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.PAYMENT_METHOD_ID"/>
                    <a:comboBox name="currency_desc" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.CURRENCY_CODE"/>
                </a:hBox>
                <a:hBox labelWidth="120">
                    <a:numberField name="exchange_rate" allowDecimals="true" allowFormat="true" allowNegative="false" bindTarget="pur51302_rfx_headers_ds" decimalPrecision="8" prompt="PUR_RFX_HEADERS.EXCHANGE_RATE"/>
                    <a:textField name="status_desc" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.STATUS"/>
                    <a:dateTimePicker name="feedback_end_time" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.FEEDBACK_END_TIME"/>
                </a:hBox>
                <a:hBox labelWidth="120">
                    <div id="quotation_title_id">
                        <a:hBox labelWidth="118">
                            <a:lov name="quotation_title" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_QUOTATION_TITLE"/>
                        </a:hBox>
                    </div>
                    <div id="logistics_quotation_desc_id">
                        <a:hBox labelWidth="112">
                            <a:comboBox name="logistics_quotation_desc" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_QUOTATION_TITLE"/>
                        </a:hBox>
                    </div>
                </a:hBox>
                <a:hBox labelWidth="120">
                    <!-- <a:textField name="comments" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.COMMENTS" width="707"/> -->
                    <!-- 修改备注字段显示框 by zoulonghui 2018/01/22 -->
                    <a:textArea name="comments" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.COMMENTS" width="707"/>
                </a:hBox>
                <a:hBox>
                    <a:accordionPanel id="pur5120_accordion_dim" height="220" showIcon="true" singleMode="false" width="900">
                        <a:accordions>
                            <a:accordion prompt="PUR_RFX_HEADERS.OTHER_INFO" selected="true">
                                <a:vBox>
                                    <a:hBox labelWidth="120">
                                        <a:checkBox name="tax_included_flag" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.TAX_INCLUDED_FLAG" width="152"/>
                                        <a:lov name="tax_type_desc" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.TAX_CODE"/>
                                        <a:textField name="tax_type_rate" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.TAX_RATE"/>
                                    </a:hBox>
                                    <a:hBox labelWidth="120">
                                        <a:checkBox name="sealed_bid_flag" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.SEALED_BID_FLAG" width="47"/>
                                        <div id="pur_rfx_password_div" class="desc-a-part">
                                            <a id="pur_rfx_password_href" href="javascript:void(0)" onclick="PUR5130_rfxPassword()"><![CDATA[${l:PUR5130.DEFINE_BID_OPENING_PASSWORD}]]></a>
                                        </div>
                                        <a:comboBox name="open_rule_desc" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.OPEN_RULE"/>
                                        <a:comboBox name="auction_ranking_desc" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.AUCTION_RANKING"/>
                                    </a:hBox>
                                    <a:hBox labelWidth="120">
                                        <a:dateTimePicker name="creation_date_desc" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.CREATION_DATE"/>
                                        <a:textField name="place_of_delivery" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.PLACE_OF_DELIVERY"/>
                                        <a:textField name="round" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.ROUND"/>
                                    </a:hBox>
                                    <a:hBox labelWidth="120">
                                        <a:comboBox name="source_type_desc" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.SOURCE_TYPE"/>
                                        <a:comboBox name="price_category_desc" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.PRICE_CATEGORY"/>
                                        <a:checkBox name="department_approve_flag" bindTarget="pur51302_rfx_headers_ds" prompt="PUR_RFX_HEADERS.DEPARTMENT_APPROVE_FLAG" width="152"/>
                                    </a:hBox>
                                    <a:hBox labelWidth="120">
                                        <a:checkBox name="is_quot_quantity_flag" bindTarget="pur51302_rfx_headers_ds" prompt="SACPUR5210.IS_QUOT_QUANTITY_FLAG" width="152"/>
                                    </a:hBox>
                                </a:vBox>
                            </a:accordion>
                        </a:accordions>
                    </a:accordionPanel>
                </a:hBox>
            </a:vBox>
            <a:vBox>
                <a id="bid5040_prequal" href="javascript:void(0)" onclick="bid5040_prequalFun()" style="margin-top: 38px;line-height: 20px;"><![CDATA[${l:BID_ENTRUSTMENT_HEADERS.ADD_PREQUAL}]]></a>
                <div id="bid5040_prequal_div" style="display:none">
                    <a:accordionPanel id="bid5040_prequal_div_dim" height="170" showIcon="true" singleMode="false" width="900">
                        <a:accordions>
                            <a:accordion prompt="BID_ENTRUSTMENT_HEADERS.PREQUAL_FLAG" selected="true">
                                <a:hBox>
                                    <a:toolbarButton click="bid5040_UploadPrequalAttachmentFun" text="BID_ENTRUSTMENT_HEADERS.PREQUAL_FILE_UPLOAD" width="100"/>
                                </a:hBox>
                                <a:hBox labelWidth="100">
                                    <a:dateTimePicker name="closing_date" bindTarget="bid5040_edit_entrustment_prequal" prompt="BID_PREQUAL_HEADERS.CLOSING_DATE"/>
                                    <a:comboBox name="review_method_desc" bindTarget="bid5040_edit_entrustment_prequal" prompt="BID_PREQUAL_HEADERS.REVIEW_METHOD"/>
                                    <a:numberField name="qualified_limit" allowDecimals="false" allowNegative="false" bindTarget="bid5040_edit_entrustment_prequal" prompt="BID_PREQUAL_HEADERS.QUALIFIED_LIMIT"/>
                                </a:hBox>
                                <a:hBox labelWidth="100">
                                    <a:textField name="prequal_location" bindTarget="bid5040_edit_entrustment_prequal" prompt="BID_PREQUAL_HEADERS.PREQUAL_LOCATION"/>
                                    <a:checkBox name="file_free_flag" bindTarget="bid5040_edit_entrustment_prequal" prompt="BID_PREQUAL_HEADERS.FILE_FREE_FLAG" width="152"/>
                                    <a:numberField name="proqual_file_expense" allowDecimals="false" allowNegative="false" bindTarget="bid5040_edit_entrustment_prequal" prompt="BID_PREQUAL_HEADERS.PROQUAL_FILE_EXPENSE"/>
                                </a:hBox>
                                <a:hBox labelWidth="100">
                                    <a:textField name="comments" bindTarget="bid5040_edit_entrustment_prequal" prompt="BID_PREQUAL_HEADERS.COMMENTS" width="750"/>
                                </a:hBox>
                            </a:accordion>
                        </a:accordions>
                    </a:accordionPanel>
                </div>
            </a:vBox>
            <a:vBox>
                <a id="bid5040_expertScore" href="javascript:void(0)" onclick="bid5040_expertScoreFun()" style="margin-top: 38px;line-height: 20px;"><![CDATA[${l:BID_ENTRUSTMENT_HEADERS.EXPERT_SCORE}]]></a>
                <div id="bid5040_expertScore_div" style="display:none">
                    <a:accordionPanel id="bid5040_expertScore_div_dim" height="600" showIcon="true" singleMode="false" width="900">
                        <a:accordions>
                            <a:accordion prompt="BID_ENTRUSTMENT_HEADERS.EXPERT_SCORE" selected="true">
                                <a:hBox>
                                    <a:comboBox name="score_mode_desc" bindTarget="pur51302_rfx_headers_ds" prompt="BID_ENTRUSTMENT_HEADERS.SCORE_MODE"/>
                                    <a:checkBox name="closed_bidding_flag" bindTarget="pur51302_rfx_headers_ds" prompt="BID_ENTRUSTMENT_HEADERS.CLOSED_BIDDING_FLAG"/>
                                </a:hBox>
                                <a:tabPanel id="bid5040_edit_experScore_tab" width="896">
                                    <a:tabs>
                                        <a:tab prompt="BID_ENTRUSTMENT_LN_EXPERTS.EXPERT" width="100">
                                            <a:textField name="team_1_desc" bindTarget="pur51302_rfx_headers_ds" prompt="BID_ENTRUSTMENT_TEAM_NAME" style="margin-top:10px;"/>
                                            <a:grid id="bid5040_ln_expert_1_grid" bindTarget="bid5040_ln_expert_1_ds" height="200" navBar="true" width="890">
                                                <a:toolBar>
                                                    <a:button type="add"/>
                                                    <a:button type="delete"/>
                                                    <a:button click="bid5040_ln_expert_1_RandomChoose" text="BID_ENTRUSTMENT_RANDOM_CHOOSE"/>
                                                </a:toolBar>
                                                <a:columns>
                                                    <a:column name="expert_user_name" align="left" editorFunction="bid5040_ln_expert_1_grid_Editor" prompt="BID_ENTRUSTMENT_LN_EXPERTS.EXPERT_EMP_NUMBER" width="120"/>
                                                    <a:column name="expert_user_desc" align="left" prompt="BID_ENTRUSTMENT_LN_EXPERTS.EXPERT_EMP_NAME" width="120"/>
                                                    <a:column name="source_type_desc" align="center" prompt="BID_ENTRUSTMENT_LN_EXPERTS.SOURCE_TYPE" width="100"/>
                                                    <a:column name="leader_flag" align="center" editor="bid5040_ln_expert_1_grid_cb" prompt="BID_ENTRUSTMENT_LN_EXPERTS.LEADER_FLAG" width="60"/>
                                                </a:columns>
                                                <a:editors>
                                                    <a:lov id="bid5040_ln_expert_1_grid_lov"/>
                                                    <a:checkBox id="bid5040_ln_expert_1_grid_cb"/>
                                                </a:editors>
                                            </a:grid>
                                            <a:textField name="team_2_desc" bindTarget="pur51302_rfx_headers_ds" prompt="BID_ENTRUSTMENT_TEAM_NAME" style="margin-top:10px;"/>
                                            <a:grid id="bid5040_ln_expert_2_grid" bindTarget="bid5040_ln_expert_2_ds" height="200" navBar="true" width="890">
                                                <a:toolBar>
                                                    <a:button type="add"/>
                                                    <a:button type="delete"/>
                                                    <a:button click="bid5040_ln_expert_2_RandomChoose" text="BID_ENTRUSTMENT_RANDOM_CHOOSE"/>
                                                </a:toolBar>
                                                <a:columns>
                                                    <a:column name="expert_user_name" align="left" editorFunction="bid5040_ln_expert_2_grid_Editor" prompt="BID_ENTRUSTMENT_LN_EXPERTS.EXPERT_EMP_NUMBER" width="120"/>
                                                    <a:column name="expert_user_desc" align="left" prompt="BID_ENTRUSTMENT_LN_EXPERTS.EXPERT_EMP_NAME" width="120"/>
                                                    <a:column name="source_type_desc" align="center" prompt="BID_ENTRUSTMENT_LN_EXPERTS.SOURCE_TYPE" width="100"/>
                                                    <a:column name="leader_flag" align="center" editor="bid5040_ln_expert_2_grid_cb" prompt="BID_ENTRUSTMENT_LN_EXPERTS.LEADER_FLAG" width="60"/>
                                                </a:columns>
                                                <a:editors>
                                                    <a:lov id="bid5040_ln_expert_2_grid_lov"/>
                                                    <a:checkBox id="bid5040_ln_expert_2_grid_cb"/>
                                                </a:editors>
                                            </a:grid>
                                        </a:tab>
                                        <a:tab prompt="BID_SCORING_ELEMENTS.SCORING_ELEMENTS" width="100">
                                            <a:textField name="team_1_desc" bindTarget="pur51302_rfx_headers_ds" prompt="BID_ENTRUSTMENT_TEAM_NAME" style="margin-top:10px;"/>
                                            <a:grid id="bid5040_scoring_elements_1_assign_grid" bindTarget="bid5040_scoring_elements_1_assign_ds" height="200" navBar="true" width="890">
                                                <a:toolBar>
                                                    <a:button type="add"/>
                                                    <a:button type="delete"/>
                                                </a:toolBar>
                                                <a:columns>
                                                    <a:column name="scoring_elements_code" align="left" editor="bid5040_scoring_elements_1_assign_lov" prompt="BID_SCORING_ELEMENTS.SCORING_ELEMENTS_CODE" width="100"/>
                                                    <a:column name="scoring_elements_desc" align="left" prompt="BID_SCORING_ELEMENTS.SCORING_ELEMENTS_NAME" width="100"/>
                                                    <a:column name="scoring_rules" align="left" editor="bid5040_scoring_elements_1_assign_tf" prompt="BID_SCORING_ELEMENTS_ASSIGN.SCORING_RULES" width="200"/>
                                                    <a:column name="highest_scores" align="left" editor="bid5040_scoring_elements_1_assign_nf" prompt="BID_SCORING_ELEMENTS_ASSIGN.HIGHEST_SCORES" width="80"/>
                                                    <a:column align="center" prompt="PUR_RFX_ELEMENT_EXPERT_ASSIGN" renderer="expert_assign_render" width="100"/>
                                                </a:columns>
                                                <a:editors>
                                                    <a:lov id="bid5040_scoring_elements_1_assign_lov"/>
                                                    <a:textField id="bid5040_scoring_elements_1_assign_tf" maxLength="300"/>
                                                    <a:numberField id="bid5040_scoring_elements_1_assign_nf"/>
                                                </a:editors>
                                            </a:grid>
                                            <a:textField name="team_2_desc" bindTarget="pur51302_rfx_headers_ds" prompt="BID_ENTRUSTMENT_TEAM_NAME" style="margin-top:10px;"/>
                                            <a:grid id="bid5040_scoring_elements_2_assign_grid" bindTarget="bid5040_scoring_elements_2_assign_ds" height="200" navBar="true" width="890">
                                                <a:toolBar>
                                                    <a:button type="add"/>
                                                    <a:button type="delete"/>
                                                </a:toolBar>
                                                <a:columns>
                                                    <a:column name="scoring_elements_code" align="left" editor="bid5040_scoring_elements_2_assign_lov" prompt="BID_SCORING_ELEMENTS.SCORING_ELEMENTS_CODE" width="100"/>
                                                    <a:column name="scoring_elements_desc" align="left" prompt="BID_SCORING_ELEMENTS.SCORING_ELEMENTS_NAME" width="100"/>
                                                    <a:column name="scoring_rules" align="left" editor="bid5040_scoring_elements_2_assign_tf" prompt="BID_SCORING_ELEMENTS_ASSIGN.SCORING_RULES" width="200"/>
                                                    <a:column name="highest_scores" align="left" editor="bid5040_scoring_elements_2_assign_nf" prompt="BID_SCORING_ELEMENTS_ASSIGN.HIGHEST_SCORES" width="80"/>
                                                    <a:column align="center" prompt="PUR_RFX_ELEMENT_EXPERT_ASSIGN" renderer="expert_assign_render" width="100"/>
                                                </a:columns>
                                                <a:editors>
                                                    <a:lov id="bid5040_scoring_elements_2_assign_lov"/>
                                                    <a:textField id="bid5040_scoring_elements_2_assign_tf" maxLength="300"/>
                                                    <a:numberField id="bid5040_scoring_elements_2_assign_nf"/>
                                                </a:editors>
                                            </a:grid>
                                        </a:tab>
                                    </a:tabs>
                                </a:tabPanel>
                            </a:accordion>
                        </a:accordions>
                    </a:accordionPanel>
                </div>
                <div id="bid5040_expertScore_no_div" style="display:none">
                    <a:accordionPanel id="bid5040_expertScore_no_div_dim" height="320" showIcon="true" singleMode="false" width="900">
                        <a:accordions>
                            <a:accordion prompt="BID_ENTRUSTMENT_HEADERS.EXPERT_SCORE" selected="true">
                                <a:hBox>
                                    <a:comboBox name="score_mode_desc" bindTarget="pur51302_rfx_headers_ds" prompt="BID_ENTRUSTMENT_HEADERS.SCORE_MODE"/>
                                    <a:checkBox name="closed_bidding_flag" bindTarget="pur51302_rfx_headers_ds" prompt="BID_ENTRUSTMENT_HEADERS.CLOSED_BIDDING_FLAG"/>
                                </a:hBox>
                                <a:tabPanel id="bid5040_edit_experScore_no_tab" width="896">
                                    <a:tabs>
                                        <a:tab prompt="BID_ENTRUSTMENT_LN_EXPERTS.EXPERT" width="100">
                                            <a:grid id="bid5040_ln_expert_grid" bindTarget="bid5040_ln_expert_ds" height="200" navBar="true" width="890">
                                                <a:toolBar>
                                                    <a:button type="add"/>
                                                    <a:button type="delete"/>
                                                    <a:button click="bid5040_ln_expert_RandomChoose" text="BID_ENTRUSTMENT_RANDOM_CHOOSE"/>
                                                </a:toolBar>
                                                <a:columns>
                                                    <a:column name="expert_user_name" align="left" editorFunction="bid5040_ln_expert_grid_Editor" prompt="BID_ENTRUSTMENT_LN_EXPERTS.EXPERT_EMP_NUMBER" width="120"/>
                                                    <a:column name="expert_user_desc" align="left" prompt="BID_ENTRUSTMENT_LN_EXPERTS.EXPERT_EMP_NAME" width="120"/>
                                                    <a:column name="source_type_desc" align="center" prompt="BID_ENTRUSTMENT_LN_EXPERTS.SOURCE_TYPE" width="100"/>
                                                    <a:column name="leader_flag" align="center" editor="bid5040_ln_expert_grid_cb" prompt="BID_ENTRUSTMENT_LN_EXPERTS.LEADER_FLAG" width="60"/>
                                                </a:columns>
                                                <a:editors>
                                                    <a:lov id="bid5040_ln_expert_grid_lov"/>
                                                    <a:checkBox id="bid5040_ln_expert_grid_cb"/>
                                                </a:editors>
                                            </a:grid>
                                        </a:tab>
                                        <a:tab prompt="BID_SCORING_ELEMENTS.SCORING_ELEMENTS" width="100">
                                            <a:grid id="bid5040_scoring_elements_assign_grid" bindTarget="bid5040_scoring_elements_assign_ds" height="200" navBar="true" width="890">
                                                <a:toolBar>
                                                    <a:button type="add"/>
                                                    <a:button type="delete"/>
                                                </a:toolBar>
                                                <a:columns>
                                                    <a:column name="scoring_elements_code" align="left" editor="bid5040_scoring_elements_assign_lov" prompt="BID_SCORING_ELEMENTS.SCORING_ELEMENTS_CODE" width="100"/>
                                                    <a:column name="scoring_elements_desc" align="left" prompt="BID_SCORING_ELEMENTS.SCORING_ELEMENTS_NAME" width="100"/>
                                                    <a:column name="scoring_rules" align="left" editor="bid5040_scoring_elements_assign_tf" prompt="BID_SCORING_ELEMENTS_ASSIGN.SCORING_RULES" width="200"/>
                                                    <a:column name="highest_scores" align="left" editor="bid5040_scoring_elements_assign_nf" prompt="BID_SCORING_ELEMENTS_ASSIGN.HIGHEST_SCORES" width="80"/>
                                                    <a:column align="center" prompt="PUR_RFX_ELEMENT_EXPERT_ASSIGN" renderer="expert_assign_render" width="100"/>
                                                </a:columns>
                                                <a:editors>
                                                    <a:lov id="bid5040_scoring_elements_assign_lov"/>
                                                    <a:textField id="bid5040_scoring_elements_assign_tf" maxLength="300"/>
                                                    <a:numberField id="bid5040_scoring_elements_assign_nf"/>
                                                </a:editors>
                                            </a:grid>
                                        </a:tab>
                                    </a:tabs>
                                </a:tabPanel>
                            </a:accordion>
                        </a:accordions>
                    </a:accordionPanel>
                </div>
            </a:vBox>
            <a:tabPanel height="400" marginWidth="130">
                <a:tabs>
                    <a:tab prompt="PUR5120.ITEM_DETIAL" width="120">
                        <a:grid id="pur51302_rfx_ln_items_grid" autoAppend="false" bindTarget="pur51302_rfx_ln_items_ds" height="350" marginWidth="140" navBar="true">
                            <a:toolBar>
                                <a:button type="add"/>
                                <a:button type="delete"/>
                            </a:toolBar>
                            <a:columns>
                                <a:column name="line_num" align="right" editor="pur51302_item_line_num_nf" prompt="PUR_RFX_LN_ITEMS.LINE_NUM" width="30"/>
                                <a:column name="logistics_quotation" align="center" prompt="物流报价模型" renderer="pur51302_quotationRendererFunction" width="80"/>
                                <!-- <a:column name="pur_ln_type_desc" align="left" editor="pur51302_pur_ln_type_desc_cb" lock="true" prompt="PUR_RFX_LN_ITEMS.PUR_LN_TYPE" width="50"/> -->
                                <a:column name="inv_organization_desc" align="left" editor="pur51302_inv_organization_desc_lov" prompt="PUR_RFX_LN_ITEMS.INV_ORGANIZATION_ID" width="100"/>
                                <a:column name="item_code" align="left" editor="pur51302_item_code_lov" prompt="PUR_RFX_LN_ITEMS.ITEM_CODE" width="80"/>
                                <a:column name="item_desc" align="left" editor="pur51302_item_desc_tf" prompt="PUR_RFX_LN_ITEMS.ITEM_DESC" width="100"/>
                                <a:column name="item_category_desc" align="left" editorFunction="pur51302_rfx_ln_items_ef" prompt="PUR_RFX_LN_ITEMS.ITEM_CATEGORY_ID" width="100"/>
                                <a:column name="quote_name" align="center" prompt="PUR_RFX_QUOTE_TITLE" renderer="pur51302_quoteRendererFun" width="60"/>
                                <a:column name="kw_customer" align="center" editor="pur51302_item_note_tf" prompt="PUR_RFX_KW_CUSTOMER" width="50"/>
                                <a:column name="ladder_inquiry_desc" align="center" editorFunction="pur51302_rfx_ln_items_ef" prompt="PUR_RFX_LADDER_INQUIRY_TYPE" width="50"/>
                                <a:column name="ladder_inquiry_flag" align="center" editor="pur51302_samples_requested_ckb" prompt="PUR5130.START_LADDER_LEVEL" width="50"/>
                                <a:column name="ladder_inquiry" align="center" prompt="PUR5130.LADDER_LEVEL" renderer="pur51302_ladderInquiryRendererFunction" width="50"/>
                                <a:column name="item_note" align="left" editor="pur51302_item_note_tf" prompt="PUR_RFX_LN_ITEMS.ITEM_NOTE" width="100"/>
                                <a:column name="item_parameter_config" align="left" editor="pur51302_item_parameter_config_tf" prompt="PUR_RFX_LN_ITEMS.ITEM_PARAMETER_CONFIG" width="60"/>
                                <a:column name="quantity" align="left" editor="pur51302_item_quantity_nf" prompt="PUR_RFX_LN_ITEMS.QUANTITY" width="40"/>
                                <a:column name="uom_desc" align="left" editor="pur51302_uom_desc_lov" prompt="PUR_RFX_LN_ITEMS.UOM_CODE" width="40"/>
                                <a:column name="samples_requested" editor="pur51302_samples_requested_ckb" prompt="PUR_RFX_LN_ITEMS.SAMPLES_REQUESTED" width="40"/>
                                <a:column name="need_by_date" align="left" editor="pur51302_item_need_by_date_dp" prompt="PUR_RFX_LN_ITEMS.NEED_BY_DATE" renderer="Aurora.formatDate" width="60"/>
                                <a:column name="tax_included_flag" editor="pur51302_tax_included_flag_ckb" prompt="PUR_RFX_LN_ITEMS.TAX_INCLUDED_FLAG" width="40"/>
                                <a:column name="tax_type_rate" editor="pur51302_tax_type_rate_lov" prompt="PUR_RFX_LN_ITEMS.TAX_TYPE_RATE" width="40"/>
                                <a:column name="feedback_range" align="left" editor="pur51302_feedback_range_nf" prompt="PUR_RFX_LN_ITEMS.FEEDBACK_RANGE" width="40"/>
                                <a:column name="limit_price" editor="pur51302_limit_price_nf" prompt="PUR_RFX_LN_ITEMS.LIMIT_PRICE" width="40"/>
                                <a:column name="cost_price" editor="pur51302_limit_price_nf" prompt="PUR_RFX_LN_ITEMS.COST_PRICE" width="40"/>
                                <a:column name="req_number" prompt="PUR_RFX_LN_ITEMS.REQ_NUMBER" width="70"/>
                                <a:column name="req_line_num" prompt="PUR_RFX_LN_ITEMS.REQ_LINE_NUMBER" width="70"/>
                                <!-- <a:column name="work_num" prompt="PUR_RFX_LN_ITEMS.WORK_NUMBER" width="70"/>
                                <a:column name="bom_num" prompt="PUR_RFX_LN_ITEMS.BOM_NUMBER" width="70"/> -->
                                <a:column name="atm_flag" align="center" renderer="pur51302_upload_attachment" width="20"/>
                                <a:column name="item_attachment" align="center" prompt="PUR_RFX_LN_ITEMS.REQ_ATTACHMENT" renderer="pur51302_upload_attachment" width="60"/>
                            </a:columns>
                            <a:editors>
                                <a:numberField id="pur51302_item_line_num_nf" allowDecimals="false" allowNegative="false"/>
                                <a:textField id="pur51302_item_note_tf"/>
                                <a:comboBox id="pur51302_pur_ln_type_desc_cb"/>
                                <a:lov id="pur51302_inv_organization_desc_lov"/>
                                <a:lov id="pur51302_item_category_desc_lov"/>
                                <a:lov id="pur51302_item_code_lov"/>
                                <a:lov id="pur51302_uom_desc_lov"/>
                                <a:textField id="pur51302_item_parameter_config_tf"/>
                                <a:textField id="pur51302_item_desc_tf"/>
                                <a:numberField id="pur51302_item_quantity_nf" allowNegative="false"/>
                                <a:datePicker id="pur51302_item_need_by_date_dp"/>
                                <a:numberField id="pur51302_feedback_range_nf"/>
                                <a:numberField id="pur51302_limit_price_nf"/>
                                <a:checkBox id="pur51302_samples_requested_ckb"/>
                                <a:checkBox id="pur51302_tax_included_flag_ckb"/>
                                <a:lov id="pur51302_tax_type_rate_lov"/>
                                <a:comboBox id="pur51302_ladder_inquiry_code_cb"/>
                            </a:editors>
                            <a:events>
                                <a:event name="cellclick" handler="pur51302_rfx_ln_items_grid_cellclick"/>
                            </a:events>
                        </a:grid>
                    </a:tab>
                    <a:tab prompt="PUR5120.VENDOR_LIST" width="120">
                        <a:grid id="pur51302_vendors_grid" autoAppend="false" bindTarget="pur51302_rfx_ln_vendors_ds" height="350" marginWidth="140" navBar="true">
                            <a:toolBar>
                                <a:button type="add"/>
                                <a:button type="delete"/>
                            </a:toolBar>
                            <a:columns>
                                <a:column name="vendor_code" align="left" editor="pur51302_vendor_code_lov" prompt="PUR_RFX_LN_VENDORS.VENDOR_CODE" width="100"/>
                                <a:column name="vendor_desc" align="left" prompt="PUR_RFX_LN_VENDORS.VENDOR_DESC" width="150"/>
                                <a:column name="contact_person" align="left" editor="pur51302_contact_person_lov" prompt="PUR_RFX_LN_VENDORS.CONTACT_PERSON" width="100"/>
                                <a:column name="contact_mobile" align="left" prompt="PUR_RFX_LN_VENDORS.CONTACT_MOBILE" width="100"/>
                                <a:column name="e_mail" align="left" prompt="PUR_RFX_LN_VENDORS.E_MAIL" width="100"/>
                                <a:column name="payment_terms" prompt="PUR5730.PAYMENT_TERMS" readOnly="true"/>
                                <!-- <a:column name="sms_schicken_flag" align="center" editor="pur51302_sms_schicken_flag_ck" prompt="PUR_RFX_LN_VENDORS.SMS_SCHICKEN_FLAG" width="100"/> -->
                            </a:columns>
                            <a:editors>
                                <a:lov id="pur51302_vendor_code_lov"/>
                                <a:lov id="pur51302_contact_person_lov"/>
                                <a:checkBox id="pur51302_sms_schicken_flag_ck" checkedValue="Y" uncheckedValue="N"/>
                            </a:editors>
                            <a:events>
                                <a:event name="cellclick" handler="pur51302_vendors_grid_cellclick"/>
                            </a:events>
                        </a:grid>
                    </a:tab>
                    <a:tab prompt="PUR5120.ATM_FILE_LIST" width="120">
                        <a:grid id="pur51302_atch_grid" autoAppend="false" bindTarget="pur51302_rfx_ln_attachments" height="350" marginWidth="140" navBar="true">
                            <a:toolBar>
                                <a:button type="add"/>
                                <a:button type="delete"/>
                            </a:toolBar>
                            <a:columns>
                                <a:column name="atm_desc" align="left" editor="pur51302_atch_desc_tf" prompt="FND_ATM_LINES.ATM_DESC" width="150"/>
                                <a:column name="upload_user_desc" align="center" prompt="FND_ATM_LINES.UPLOAD_USER_NAME" width="100"/>
                                <a:column name="upload_date" align="center" prompt="FND_ATM_LINES.UPLOAD_DATE" width="100"/>
                                <a:column name="atm_flag" align="center" renderer="pur51302_upload_render" width="20"/>
                                <a:column name="attachment" align="center" prompt="PROMPT.UPLOAD_DOWNLOAD" renderer="pur51302_upload_render" width="100"/>
                            </a:columns>
                            <a:editors>
                                <a:textField id="pur51302_atch_desc_tf" maxLength="500"/>
                            </a:editors>
                        </a:grid>
                    </a:tab>
                    <a:tab id="test_structure_tab_id" prompt="测试架" width="120">
                        <!-- <a:grid id="struc_grid" bindTarget="pur_rfx_ln_item_atrib_ds" height="350" marginWidth="140"> -->
                        <a:grid id="struc_grid" bindTarget="pur51302_rfx_ln_items_ds" height="350" marginWidth="140">
                            <a:columns>
                                <a:column name="line_num" align="right" prompt="行号" width="30"/>
                                <a:column name="item_category_desc" align="left" prompt="物品分类" width="100"/>
                                <a:column name="item_code" align="left" prompt="物料编码" width="70"/>
                                <a:column name="item_desc" align="left" prompt="物料描述" width="90"/>
                                <a:column name="test_type" align="left" prompt="测试架类型" width="40"/>
                                <a:column name="test_point_two_five" align="left" editor="structure_range_nf" prompt="探针0.25mm" width="50"/>
                                <a:column name="test_point_two" align="left" editor="structure_range_nf" prompt="探针0.2mm" width="50"/>
                                <a:column name="test_point_fifteen" align="left" editor="structure_range_nf" prompt="探针0.15mm" width="50"/>
                                <a:column name="test_point_one" align="left" editor="structure_range_nf" prompt="探针0.1mm" width="50"/>
                                <a:column name="test_point_zero_nine" align="left" editor="structure_range_nf" prompt="探针0.09mm" width="50"/>
                                <a:column name="test_needle_double_zero" align="left" editor="structure_range_nf" prompt="00针" width="50"/>
                                <a:column name="test_needle_zero_pound" align="left" editor="structure_range_nf" prompt="0#针" width="50"/>
                                <a:column name="test_needle_one_pound" align="left" editor="structure_range_nf" prompt="1#针" width="50"/>
                                <a:column name="test_needle_two_pound" align="left" editor="structure_range_nf" prompt="2#针" width="50"/>
                                <a:column name="test_float" align="left" editor="structure_range_nf" prompt="点数" width="50"/>
                                <a:column name="test_pcs" align="left" editor="structure_range_nf" prompt="pcs数" width="50"/>
                            </a:columns>
                            <a:editors>
                                <a:numberField id="structure_item_line_num_nf" allowDecimals="false" allowNegative="false"/>
                                <a:textField id="structure_note_tf"/>
                                <a:numberField id="structure_range_nf"/>
                            </a:editors>
                        </a:grid>
                    </a:tab>
                </a:tabs>
            </a:tabPanel>
        </a:screenBody>
        <script><![CDATA[
              function init() {
                  var type_po_item  = '${/parameter/@type_po_item}' ;
                  console.log('type_po_item == ' +type_po_item);
                 if (type_po_item == 'undefined'|| type_po_item == '' || type_po_item == 'NO_SELECT'){
                  diaplayTab("test_structure_tab_id");
                 } }

              init();
          ]]></script>
    </a:view>
</a:screen>

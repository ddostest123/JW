<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: IsaacF  
    $Date: 2013-7-3 下午2:29:43  
    $Revision: 1.0  
    $Purpose: 
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application" xmlns:s="aurora.plugin.script" trace="true">
    <a:init-procedure>
        <a:model-query defaultWhereClause="flex_value_set_code = &apos;APPROVAL_STATUS&apos;" fetchAll="true" model="public.fnd_flex_value_v_lov" rootPath="inv8010_noti_mode"/>
        <a:model-query defaultWhereClause="flex_value_set_code = &apos;EEPI_ATT_TYPE&apos;" fetchAll="true" model="public.fnd_flex_value_v_lov" rootPath="eepi10101_noti_mode"/>
        <a:model-query model="pur.EEPI1020.eepi1020_type_edit" rootPath="type_data"/>
    </a:init-procedure>
    <a:view>
        <meta name="viewport" content="width=device-width,user-scalable=no,height=device-height,maximum-scale=1.0,initial-scale=1.0"/>
        <!--    <script src="${/request/@context_path}/javascripts/bootstrap/jquery-1.8.3.min.js"/> -->
        <script language="JavaScript" src="${/request/@context_path}/component/handMove.js"/>
        <!-- <link href="${/request/@context_path}/css/bootstrap/bootstrap.min.css" rel="stylesheet" type="text/css"/> -->
        <!--  <script language="JavaScript" src="${/request/@context_path}/index/js/jquery-1.8.3.min.js"/> -->
        <a:link id="eepi10101_attachment_file_upload_link" url="${/request/@context_path}/attachment_file_upload.screen"/>
        <a:link id="eepi10101_info_delete_link" model="pur.EEPI1010.eepi1010_info_query" modelaction="batch_update"/>
        <a:link id="eepi10101_info_save_link" url="${/request/@context_path}/modules/pur/EEPI1010/eepi1010_header_submit.svc"/>
        <a:link id="eepi10101_info_submit_link" model="pur.EEPI1010.eepi1010_info_query" modelaction="batch_update"/>
        <a:link id="eepi10101_att_update_link" model="pur.EEPI1010.eepi1010_att_update" modelaction="execute"/>
        <a:link id="eepi10101_lines_info_delete_link" model="pur.EEPI1010.eepi1010_info_lines_query" modelaction="batch_update"/>
        <a:link id="eepi10101_operationRecord_link" url="${/request/@context_path}/modules/pur/EEPI1010/eepi_approve_record.screen"/>
        <a:link id="eepi10101_lines_info_save_link" model="pur.EEPI1010.eepi1010_info_lines_query" modelaction="batch_update"/>
        <a:link id="eepi10101_infoExport_link" url="${/request/@context_path}/modules/pur/EEPI1010/eepi1010_select_export.screen"/>
        <a:link id="eepi10101_submit_link" url="${/request/@context_path}/modules/pur/EEPI1010/eepi1010_header_submit.svc"/>
        <style><![CDATA[
            
            
        ]]></style>
        <script><![CDATA[


            function eepi10101_info_update(ds, record, name, value, oldvalue) {
                debugger;
                var localdate=new Date(new Date());
               if(name=='report_valid_date_to'){
                    if(Aurora.isEmpty(value)){
                        record.set('expire_flag','生效');
                    }else{
                     var  renderDate=renderTime(value);
                     var formatDate=formatDateF(renderDate);
	                 var Difference_In_Days = (formatDate-localdate) / (1000 * 3600 * 24);
	            
                    if(Difference_In_Days<0){
                       record.set('expire_flag','失效');
                    }else if(Difference_In_Days>30){
                        record.set('expire_flag','生效');
                    }else{
                         
                         record.set('expire_flag','即将失效'); 
                     }
                    } 
                    if(!record.isNew){
                    if(value!=oldvalue){
                           record.set('flag','Y');
                    } 
                    }
               }
                  if(!record.isNew){
                  if(name=='report_test_date'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                    } 
                  }
                  }
                  
                  if(!record.isNew){
                  if(name=='device_name'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                     } 
                  }
                  }
                  
                  if(!record.isNew){
                   if(name=='supplier_mode'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                     } 
                  }
                  }
               
               
               if(name=='attachment_type'){
                   var records=$('eepi10101_type_ds').getAll();
                   for(var i=0;i<records.length;i++){
                       if(records[i].get('data_type_code')==value){
                           if(records[i].get('report_test_date_flag')=='Y'){
                               record.getField('report_test_date').setRequired(true);
                           }else{
                               record.getField('report_test_date').setRequired(false);
                           }
                           if(records[i].get('report_valid_date_flag')=='Y'){
                               record.getField('report_valid_date_to').setRequired(true);
                           }else{
                               record.getField('report_valid_date_to').setRequired(false);
                           }
                           
                           
                           
                        if(record.get('homogenous_item_upload')=='N' || record.get('approval_status_desc')=='审批中'){
                              var btn1 = document.getElementById("eepi_line_vendor_addBtn");
							btn1.style.display = "none";
							 var btn2 = document.getElementById("eepi_line_vendor_saveBtn");
							btn2.style.display = "none";
							 var btn3 = document.getElementById("eepi_line_vendor_deleteBtn");
							btn3.style.display = "none";
                        }else{
                            var btn1 = document.getElementById("eepi_line_vendor_addBtn");
							btn1.style.display = "block";
							 var btn2 = document.getElementById("eepi_line_vendor_saveBtn");
							btn2.style.display = "block";
							 var btn3 = document.getElementById("eepi_line_vendor_deleteBtn");
							btn3.style.display = "block";
                        }
                       }
                   }
               }
               
            }
            
            
             function eepi10101_lines_info_update(ds, record, name, value, oldvalue) {
                debugger;
                var localdate=new Date(new Date());
                 
               if(name=='report_valid_date_to'){
                    if(Aurora.isEmpty(value)){
                        record.set('expire_flag','生效');
                    }else{
                     var  renderDate=renderTime(value);
                     var formatDate=formatDateF(renderDate);
	                 var Difference_In_Days = (formatDate-localdate) / (1000 * 3600 * 24);
	            
                    if(Difference_In_Days<0){
                       record.set('expire_flag','失效');
                    }else if(Difference_In_Days>30){
                        record.set('expire_flag','生效');
                    }else{
                         
                        record.set('expire_flag','即将失效'); 
                     }
                    }
                    
               if(value!=oldvalue){
                           record.set('flag','Y');
                    } 
               }
               
                  if(name=='report_test_date'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                    } 
                  }
                  
                  
                  if(name=='device_name'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                     } 
                  }
                  
                  
                   if(name=='supplier_mode'){
                       if(value!=oldvalue){
                           record.set('flag','Y');
                     } 
                  }
               
               if(name=='attachment_type'){
                   var records=$('eepi10101_type_ds').getAll();
                   for(var i=0;i<records.length;i++){
                       if(records[i].get('data_type_code')==value){
                           if(records[i].get('report_test_date_flag')=='Y'){
                               record.getField('report_test_date').setRequired(true);
                           }else{
                               record.getField('report_test_date').setRequired(false);
                           }
                           if(records[i].get('report_valid_date_flag')=='Y'){
                               record.getField('report_valid_date_to').setRequired(true);
                           }else{
                               record.getField('report_valid_date_to').setRequired(false);
                           }
                       }
                   }
               }
               
               
            }
            
            
              function setinitdata(ds,record,index){
                  var records=$('eepi10101_info_ds').getCurrentRecord();
                  record.getField('part_name').setRequired(true);
                 if(records.get('homogenous_item_upload')=="N"){
                      Aurora.showMessage('${l:PROMPT}','此附件类型,无法创建子行！');
                      $('eepi10101_lines_info_grid').remove(record);
                      return ;
                 }
                /*   if(record.get('approval_status_desc')=='审批中'){
                      Aurora.showMessage('${l:PROMPT}','审批中状态,无法创建子行！');
                      $('eepi101011_lines_info_grid').clear(record);
                      return ;
                 } */
                  record.set('attachment_type',records.get('attachment_type'));
                  record.set('item_no',records.get('item_no'));
                  record.set('approval_status_desc','新建');
                  record.set('device_name',records.get('device_name'));
                  record.set('vendor_code',records.get('vendor_code'));
                  record.set('vendor_name',records.get('vendor_name'));
             }
             
             
             
          function   setinitdata_header(ds,record,index){
                  record.set('approval_status_desc','新建');
                  record.set('expire_flag','待生效');
                /*    record.set('attachment_type','ROHS2.0'); */
              var btn1 = document.getElementById("eepi_line_vendor_addBtn");
			btn1.style.display = "none";
			 var btn2 = document.getElementById("eepi_line_vendor_saveBtn");
			btn2.style.display = "none";
			 var btn3 = document.getElementById("eepi_line_vendor_deleteBtn");
			btn3.style.display = "none";
                      
                  
                
             }
            
            function formatDateF(date){
                  var oldTime = (new Date(date)).getTime();
                  return new Date(oldTime);
            }
           function renderTime(date) {
				      var dateee = new Date(date).toJSON();
				      return new Date(+new Date(dateee) + 8 * 3600 * 1000)
				        .toISOString()
				        .replace(/T/g, " ")
				        .replace(/\.[\d]{3}Z/, "");
				    }
            
            
         
            function eepi10101_info_ds_load(ds) {
               var records=ds.getAll();
               
              
               if(Aurora.isEmpty(records)){
                    $('eepi10101_lines_info_ds').setQueryParameter('ep_info_id', -1);
                    $('eepi10101_lines_info_ds').query();
                   return;
               }else{
                    var records_c=ds.getCurrentRecord();
                 if (records_c.get('ep_info_id')) {
                    $('eepi10101_lines_info_ds').setQueryParameter('ep_info_id', records_c.get('ep_info_id'));
                    $('eepi10101_lines_info_ds').query();
                    
                } else {
                    $('eepi10101_lines_info_ds').setQueryParameter('ep_info_id', -1);
                    $('eepi10101_lines_info_ds').query();
                }
               }
                  for( var n=0;n<records.length;n++){
                        if(records[n].get('approval_status_desc')=='审批中'){
                            records[n].getField('item_no').setReadOnly(true);
                            records[n].getField('device_name').setReadOnly(true);
                            records[n].getField('attachment_type').setReadOnly(true);
                            records[n].getField('vendor_code').setReadOnly(true);
                            records[n].getField('supplier_mode').setReadOnly(true);
                            records[n].getField('part_name').setReadOnly(true);
                            records[n].getField('report_test_date').setReadOnly(true);
                            records[n].getField('report_valid_date_to').setReadOnly(true);
                            records[n].getField('suppliers_comments').setReadOnly(true);
                     }else{
                            records[n].getField('item_no').setReadOnly(false);
                            records[n].getField('device_name').setReadOnly(false);
                            records[n].getField('attachment_type').setReadOnly(false);
                            records[n].getField('vendor_code').setReadOnly(false);
                            records[n].getField('supplier_mode').setReadOnly(false);
                            records[n].getField('part_name').setReadOnly(false);
                            records[n].getField('report_test_date').setReadOnly(false);
                            records[n].getField('report_valid_date_to').setReadOnly(false);
                            records[n].getField('suppliers_comments').setReadOnly(false);
                     }
                      
                    
                      if(!records[n].isNew){
                            records[n].getField('attachment_type').setReadOnly(true);
                            records[n].getField('item_no').setReadOnly(true);
                            records[n].getField('device_name').setReadOnly(true);
                            records[n].getField('vendor_code').setReadOnly(true);
                      }
                      
                     
                     
                }
                
             
            }
            
            function eepi10101_lines_info_ds_load(ds) {
                  var records=$('eepi10101_info_ds').getCurrentRecord();
                  if(!Aurora.isEmpty(records)){
                     if(records.isNew){
                     var btn1 = document.getElementById("eepi_line_vendor_addBtn");
		             console.log(btn1);
					 btn1.style.display = "none";
					 var btn2 = document.getElementById("eepi_line_vendor_saveBtn");
					 btn2.style.display = "none";
					 var btn3 = document.getElementById("eepi_line_vendor_deleteBtn");
					 btn3.style.display = "none"; 
                   }  
                  }
                  
               var records=ds.getAll();
                  for( var n=0;n<records.length;n++){
                        
                   
                      
                     if(records[n].get('homogenous_item_upload')=='N'){
                           records[n].getField('part_name').setRequired(false);
                     }else{
                           records[n].getField('part_name').setRequired(true);
                     }
                     
                     if(records[n].get('line_valid_date_flag')=='N'){
                           records[n].getField('report_valid_date_to').setRequired(false);
                     }else{
                           records[n].getField('report_valid_date_to').setRequired(true);
                     }
                     
                     if(records[n].get('line_test_date_flag')=='N'){
                           records[n].getField('report_test_date').setRequired(false);
                     }else{
                           records[n].getField('report_test_date').setRequired(true);
                     }
                     
                    /*  if(Aurora.isEmpty(records[n].get('report_valid_date_to'))){
                         records[n].set('expire_flag','生效');
                     }
                      */
                     
                      if(records[n].get('approval_status_desc')=='审批中'){
                            records[n].getField('vendor_code').setReadOnly(true);
                            records[n].getField('supplier_mode').setReadOnly(true);
                            records[n].getField('part_name').setReadOnly(true);
                            records[n].getField('report_test_date').setReadOnly(true);
                            records[n].getField('report_valid_date_to').setReadOnly(true);
                            records[n].getField('suppliers_comments').setReadOnly(true);
                     }else{
                            records[n].getField('vendor_code').setReadOnly(false);
                            records[n].getField('supplier_mode').setReadOnly(false);
                            records[n].getField('part_name').setReadOnly(false);
                            records[n].getField('report_test_date').setReadOnly(false);
                            records[n].getField('report_valid_date_to').setReadOnly(false);
                            records[n].getField('suppliers_comments').setReadOnly(false);
                            
                             if(records[n].get('report_test_date_flag')=='N'){
                           records[n].getField('report_test_date').setRequired(false);
                     }else{
                           records[n].getField('report_test_date').setRequired(true);
                     }
                     if(records[n].get('report_valid_date_flag')=='N'){
                           records[n].getField('report_valid_date_to').setRequired(false);
                     }else{
                           records[n].getField('report_valid_date_to').setRequired(true);
                     }
                     
                     if(Aurora.isEmpty(records[n].get('report_valid_date_to'))){
                         var records_l=$('eepi10101_lines_info_ds').getAll();
                         console.log(records_l);
                         if(!Aurora.isEmpty(records_l)){
                              for( var i=0;i<records_l.length;i++){
                                  if(records_l[i].get('expire_flag')=='失效'){
                                     records[n].set('expire_flag',"失效"); 
                                     break ; 
                                  }
                                 if(records_l[i].get('expire_flag')=='即将失效'){
                                     records[n].set('expire_flag',"即将失效"); 
                                  } 
                              }
                              
                         }else{
                         records[n].set('expire_flag','生效');
                         
                         }
                     }
                     
                     
                     if(!records[n].isNew){
                            records[n].getField('attachment_type').setReadOnly(true);
                            records[n].getField('item_no').setReadOnly(true);
                            records[n].getField('device_name').setReadOnly(true);
                      }
                     }
                     
                    
                }
               
                
        
                
                
            }
            
             function eepi10101_expireFlagRenderer(value, record, name) {
                 debugger;
                if (name == 'expire_flag') {
                    if(!record.isNew){
                       if (value=='失效') {
                            return '<div style="color:red;margin:0px;">' + '失效' + '</div>';
                        } else if (value=='生效') {
                            return '<div style="color:green;margin:0px;">' + '生效' + '</div>';
                        } else if(value=='即将失效') {
                            return '<div style="color:#CFB53B;margin:0px;">' + '即将失效' + '</div>';
                        }else if(value=='待生效'){
                             return '<div>' + '待生效' + '</div>';
                        }
                      }else{
                           return '<div>' + '待生效' + '</div>';
                      }   
                    }
                       
                }
                  function eepi_req_render(value, record, name) {
                      if(name=='part_name'){
                          if(Aurora.isEmpty(value)){
                               //var id=document.getElementById('part_name_id');
                               //console.log(id);
                               //id.style.border = "1px solid red";
                                return   '<div">' +''+'</div>';
                          }else{
                               return   '<div>' + value + '</div>';
                          }
                      }
                
                  }
            
            
            /* 
             function eepi10101_hgUploadRenderer(value, record, name) {
                debugger;
                if (name == 'attachment_type') {
                      if(record.get('homogenous_item_upload')=='Y' &&record.get('attachment_type')=='均质物质上传'){
                      		 return '<div style="color:red;font-weight:bold;">' + '均质物质上传' + '</div>';
                      }else{
                          return '<div>' + record.get('attachment_type') + '</div>';
                      }
                       
                }
                
             } */
            function eepi10101_lines_expireFlagRenderer(value, record, name) {
                debugger;
                if (name == 'expire_flag') {
                        if (value=='失效') {
                            return '<div style="background-color:red">' + '失效' + '</div>';
                        } else if (value== '生效') {
                            return '<div style="background-color:green">' + '生效' + '</div>';
                        } else if(value== '即将失效') {
                            return '<div style="background-color:yellow">' + '即将失效' + '</div>';
                        }
                    } 
                }
          
           function eepi10101_info_submit(){
                  debugger;
                  var records=$('eepi10101_info_ds').getSelected();
                  //var records_l=$('eepi10101_lines_info_ds').getSelected();
                 // var records_a=$('eepi10101_lines_info_ds').getAll();
                /*   if(records_l.length!=records_a.length){
                    Aurora.showMessage('${l:PROMPT}', '提交请勾选全部子行！');
                    return ;
                  } */
                if(records.length==0 || Aurora.isEmpty(records)){
                    Aurora.showMessage('${l:PROMPT}', '请勾选一行进行操作！');
                    return ;
                }  
                
                
                   var h_records = $('eepi10101_info_ds');
	               var l_records = $('eepi10101_lines_info_ds');
                  
                   var m_records=$('eepi10101_type_ds');
                 
                 var paras = [];
                 for( var n=0;n<records.length;n++){
                     if(records[n].get('approval_status_desc')=='审批中'){
                            Aurora.showMessage('${l:PROMPT}', '审批中状态不允许重复提交！');
                            return ;
                     }
                     if(records[n].isNew){
                            Aurora.showMessage('${l:PROMPT}', '数据未保存，请先保存再提交！');
                            return ;
                     }else{
                           if(records[n].get('report_test_date_flag')=='Y'&&Aurora.isEmpty(records[n].get('report_test_date'))){
                               Aurora.showMessage('${l:PROMPT}','报告测试期为必输字段，请维护数据！');
                               return ;
                           }
                           if(records[n].get('report_valid_date_flag')=='Y'&&Aurora.isEmpty(records[n].get('report_valid_date_to'))){
                               Aurora.showMessage('${l:PROMPT}','报告有效期为必输字段，请维护数据！');
                               return ;
                           }
                           
                           
                     }
                     if(records[n].get('approval_status_desc')=='新建'||records[n].get('approval_status_desc')=='驳回'){
	                               records[n].set('_status','execute');
                     }else{
                         continue;
                     }
                      
	        	     paras.push(records[n].data); 
	        	        
	        	      //console.log(paras);  
                }
                
                var paras_l=[]; 
             /*  if(records_l.length>0){
                for( var i=0;i<records_l.length;i++){
                     if(records_l[i].isNew){
                            Aurora.showMessage('${l:PROMPT}', '数据未保存，请先保存再提交！');
                            return ;
                     }else{
                           if(records_l[i].get('line_test_date_flag')=='Y'&&Aurora.isEmpty(records_l[i].get('report_test_date'))){
                               Aurora.showMessage('${l:PROMPT}','报告测试期为必输字段，请维护数据！');
                               return ;
                           }
                           if(records_l[i].get('line_valid_date_flag')=='Y'&&Aurora.isEmpty(records_l[i].get('report_valid_date_to'))){
                               Aurora.showMessage('${l:PROMPT}','报告有效期为必输字段，请维护数据！');
                               return ;
                           }
                           
                           
                     }
                     if(records_l[i].get('approval_status_desc')=='新建'||records_l[i].get('approval_status_desc')=='驳回'){
	                               records_l[i].set('_status','execute');
                     }else{
                         continue;
                     }
                      
	        	     paras_l.push(records_l[i].data); 
	        	        
	        	      //console.log(paras);  
                }
                
              }  */
                
                console.log(paras_l);
                console.log(paras);
                var data=m_records.getCurrentRecord().data;
                        data['eepi_line'] = paras_l;
	                    data['eepi_header'] = paras;
	                    console.log(data);
                Aurora.showConfirm('${l:PROMPT}', '是否确认提交，若点击是则对选中行提交进行审批（已审批的行会重新审批）', function() {
	        	        Aurora.request({
		        	        url:$('eepi10101_info_submit_link').getUrl(),
		        	        para:paras,
		        	        success:function(){
	        	                Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.OPERATION_SUCCESS}', function(){
		        	                $('eepi10101_info_ds').query();
		        	                Aurora.Masker.unmask(Ext.getBody()); 	
	        	                });
		        	        },
		        	        failure:function(){
		        	        	Aurora.Masker.unmask(Ext.getBody()); 	    
		        	        },
		        	        error:function(){
		        	        	Aurora.Masker.unmask(Ext.getBody()); 	    
		        	        },
		        	        scope:this
		        	    });
                 });
                                 
              }
              
              
               function eepi10101_info_save(){
                
                var records=$('eepi10101_info_ds').getAll();     
                var records_l=$('eepi10101_lines_info_ds').getAll();     
                if(records.length==0 || Aurora.isEmpty(records)){
                    Aurora.showMessage('${l:PROMPT}', '请勾选一行操作');
                    return ;
                }
                 
                  /* if (!$('eepi10101_info_ds').validate()) {
                    return;
                  } */
                 
               var h_records=$('eepi10101_info_ds').getCurrentRecord();
               var m_records=$('eepi10101_type_ds');
                    
                 var paras = [];
                 var flag=false;
                 for(var n=0;n<records.length;n++){
                     
                      if(Aurora.isEmpty(records[n].get('attachment_type'))){
                           Aurora.showMessage('${l:PROMPT}', '附件类型为必输字段');
                           return ;
                     }
                     if(Aurora.isEmpty(records[n].get('item_no'))){
                           Aurora.showMessage('${l:PROMPT}', '景旺料号为必输字段');
                           return ;
                     }
                      if(Aurora.isEmpty(records[n].get('vendor_code'))){
                           Aurora.showMessage('${l:PROMPT}', '供应商编码为必输字段');
                           return ;
                     }
                     if(records[n].isNew){
                          records[n].set('_status', 'insert');
                     }else{
                           records[n].set('_status', 'update');
                     }
                  
                          if(records[n].get('expire_flag')=='生效'||records[n].get('expire_flag')=='即将失效'){
                              console.log(records[n].get('flag'));
                              if(records[n].get('flag')=='Y'){
                                flag=true;
                              }
                          }
                         
                      
	        	        paras.push(records[n].data);
	        	        
	        	  
                }
                
           
                  
                 var paras_l = [];
                 if(records_l.length>0){
                     for( var n=0;n<records_l.length;n++){
                          if(Aurora.isEmpty(records_l[n].get('attachment_type'))){
                           Aurora.showMessage('${l:PROMPT}', '附件类型为必输字段');
                           return ;
                       }
                        if(Aurora.isEmpty(records_l[n].get('item_no'))){
                           Aurora.showMessage('${l:PROMPT}', '景旺料号为必输字段');
	                           return ;
	                     }
	                      if(Aurora.isEmpty(records_l[n].get('vendor_code'))){
	                           Aurora.showMessage('${l:PROMPT}', '供应商编码为必输字段');
	                           return ;
	                     }
                 	   if(records_l[n].isNew){
                          records_l[n].set('_status', 'insert');
                          records_l[n].set('ep_info_id', h_records.get('ep_info_id'));
                      }else{
                           records_l[n].set('_status', 'update');
                      }
                     
	        	        paras_l.push(records_l[n].data);
      
                   } 
                 }
           
 
             
                var data=m_records.getCurrentRecord().data;
                        data['eepi_line'] = paras_l;
	                    data['eepi_header'] = paras;
                
                 if(flag){
                        Aurora.showConfirm('${l:PROMPT}', '保存的数据中存在已生效的变更，是否确认保存，保存后对应资料将变为待生效状态，需重新提交审批', function() { 
                            Aurora.request({
		        	        url:$('eepi10101_info_save_link').getUrl(),
		        	        para:data,
		        	        success:function(){
	        	                Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.OPERATION_SUCCESS}', function(){
	        	                       /* var ds= $('eepi10101_info_ds');
	        	                       var record=$('eepi10101_info_ds').getCurrentRecord();
	        	                       var currentPage =ds.currentPage;
               						   var pagesize = ds.pagesize;
                                      //ds 指针定位到勾选的行
                                
		        	                $('eepi10101_info_ds').query();
		        	                 ds.locate(ds.indexOf(record) + 1 + (currentPage - 1) * pagesize); */
		        	                 
		        	                  $('eepi10101_info_ds').query();
		        	                Aurora.Masker.unmask(Ext.getBody()); 	
	        	                });
		        	        },
		        	        failure:function(){
		        	        	Aurora.Masker.unmask(Ext.getBody()); 	    
		        	        },
		        	        error:function(){
		        	        	Aurora.Masker.unmask(Ext.getBody()); 	    
		        	        },
		        	        scope:this
		        	    }); 
                        });  
                 }else{
                      Aurora.request({
		        	        url:$('eepi10101_info_save_link').getUrl(),
		        	        para:data,
		        	        success:function(){
	        	                Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.OPERATION_SUCCESS}', function(){
		        	                  /*  var ds= $('eepi10101_info_ds');
	        	                       var record=$('eepi10101_info_ds').getCurrentRecord();
	        	                       var currentPage =ds.currentPage;
               						   var pagesize = ds.pagesize;
                                      //ds 指针定位到勾选的行
                                
		        	                $('eepi10101_info_ds').query();
		        	                 ds.locate(ds.indexOf(record) + 1 + (currentPage - 1) * pagesize); */
		        	                 
		        	                  $('eepi10101_info_ds').query();
		        	                Aurora.Masker.unmask(Ext.getBody()); 	
	        	                });
		        	        },
		        	        failure:function(){
		        	        	Aurora.Masker.unmask(Ext.getBody()); 	    
		        	        },
		        	        error:function(){
		        	        	Aurora.Masker.unmask(Ext.getBody()); 	    
		        	        },
		        	        scope:this
		        	    }); 
                 }
	        	       
              
                                 
              }
              
               function eepi10101_line_attachmentRender(value, record, name) {
                   debugger;
                    var ep_line_id = record.get('ep_line_id');
                    var  attachment_type=record.get('attachment_type');
                    console.log(record.get('approval_status_desc'));
                    console.log(record.get('expire_flag'));
                    if(record.get('approval_status_desc')=="审批中"){
                              if (!record.isNew && ep_line_id) {
                                   if(record.get('att_count')>0){
	                                       if(attachment_type=='MSDS'){
				                             return '<a href="javascript:eepi10101_line_attachmentRenderView1(' + ep_line_id+')">已上传</a>';
						                }else if(attachment_type=='无卤报告'){
						                     return '<a href="javascript:eepi10101_line_attachmentRenderView2(' + ep_line_id+')">已上传</a>';
						                }else if(attachment_type=='REACH报告'){
						                     return '<a href="javascript:eepi10101_line_attachmentRenderView3(' + ep_line_id+')">已上传</a>';
						                }else if(attachment_type=='ROHS2.0'){
						                     return '<a href="javascript:eepi10101_line_attachmentRenderView4(' + ep_line_id+')">已上传</a>';
						                }else if(attachment_type=='保证函'){
						                     return '<a href="javascript:eepi10101_line_attachmentRenderView5(' + ep_line_id+')">已上传</a>';
						                }else if(attachment_type=='规格书'){
						                     return '<a href="javascript:eepi10101_line_attachmentRenderView6(' + ep_line_id+')">已上传</a>';
						                }else if(attachment_type=='均质物质上传'){
						                     return '<a href="javascript:eepi10101_line_attachmentRenderView7(' + ep_line_id+')">已上传</a>';
						                } 
                                   }else{
                                       if(attachment_type=='MSDS'){
				                             return '<a href="javascript:eepi10101_line_attachmentRenderView1(' + ep_line_id+')">未上传</a>';
						                }else if(attachment_type=='无卤报告'){
						                     return '<a href="javascript:eepi10101_line_attachmentRenderView2(' + ep_line_id+')">未上传</a>';
						                }else if(attachment_type=='REACH报告'){
						                     return '<a href="javascript:eepi10101_line_attachmentRenderView3(' + ep_line_id+')">未上传</a>';
						                }else if(attachment_type=='ROHS2.0'){
						                     return '<a href="javascript:eepi10101_line_attachmentRenderView4(' + ep_line_id+')">未上传</a>';
						                }else if(attachment_type=='保证函'){
						                     return '<a href="javascript:eepi10101_line_attachmentRenderView5(' + ep_line_id+')">未上传</a>';
						                }else if(attachment_type=='规格书'){
						                     return '<a href="javascript:eepi10101_line_attachmentRenderView6(' + ep_line_id+')">未上传</a>';
						                }else if(attachment_type=='均质物质上传'){
						                     return '<a href="javascript:eepi10101_line_attachmentRenderView7(' + ep_line_id+')">未上传</a>';
						                } 
                                   }
			                       
			                   } 
                     } 
                   
                    if (!record.isNew && ep_line_id) {
                          if(record.get('att_count')>0){
                        if(attachment_type=='MSDS'){
	                             return '<a href="javascript:eepi10101_line_attachmentRenderUpload1(' + ep_line_id+')">已上传</a>';
			                }else if(attachment_type=='无卤报告'){
			                     return '<a href="javascript:eepi10101_line_attachmentRenderUpload2(' + ep_line_id+')">已上传</a>';
			                }else if(attachment_type=='REACH报告'){
			                     return '<a href="javascript:eepi10101_line_attachmentRenderUpload3(' + ep_line_id+')">已上传</a>';
			                }else if(attachment_type=='ROHS2.0'){
			                     return '<a href="javascript:eepi10101_line_attachmentRenderUpload4(' + ep_line_id+')">已上传</a>';
			                }else if(attachment_type=='保证函'){
			                     return '<a href="javascript:eepi10101_line_attachmentRenderUpload5(' + ep_line_id+')">已上传</a>';
			                }else if(attachment_type=='规格书'){
			                     return '<a href="javascript:eepi10101_line_attachmentRenderUpload6(' + ep_line_id+')">已上传</a>';
			                }else if(attachment_type=='均质物质上传'){
			                     return '<a href="javascript:eepi10101_line_attachmentRenderUpload7(' + ep_line_id+')">已上传</a>';
		                    }
                          }else{
                               if(attachment_type=='MSDS'){
                                  return '<a href="javascript:eepi10101_line_attachmentRenderUpload1(' + ep_line_id+')">未上传</a>';
			                }else if(attachment_type=='无卤报告'){
			                     return '<a href="javascript:eepi10101_line_attachmentRenderUpload2(' + ep_line_id+')">未上传</a>';
			                }else if(attachment_type=='REACH报告'){
			                     return '<a href="javascript:eepi10101_line_attachmentRenderUpload3(' + ep_line_id+')">未上传</a>';
			                }else if(attachment_type=='ROHS2.0'){
			                     return '<a href="javascript:eepi10101_line_attachmentRenderUpload4(' + ep_line_id+')">未上传</a>';
			                }else if(attachment_type=='保证函'){
			                     return '<a href="javascript:eepi10101_line_attachmentRenderUpload5(' + ep_line_id+')">未上传</a>';
			                }else if(attachment_type=='规格书'){
			                     return '<a href="javascript:eepi10101_line_attachmentRenderUpload6(' + ep_line_id+')">未上传</a>';
			                }else if(attachment_type=='均质物质上传'){
			                     return '<a href="javascript:eepi10101_line_attachmentRenderUpload7(' + ep_line_id+')">未上传</a>';  
                          }
                   } 
            }
            
          }
         
            
            function eepi10101_line_attachmentRenderUpload6(id) {
                var url="${/request/@context_path}/modules/pur/EEPI1010/uploadFile.screen?table_name=EPDATA_INFO_LINES.F&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                }).on('beforeclose', function() {
                       eepi_att_line_rercod(id);
                    });
            }
            
             function eepi10101_line_attachmentRenderUpload7(id) {
                var url="${/request/@context_path}/modules/pur/EEPI1010/uploadFile.screen?table_name=EPDATA_INFO_LINES.G&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                }).on('beforeclose', function() {
                       eepi_att_line_rercod(id);
                    });
            }
            
          
            
             function eepi10101_line_attachmentRenderUpload1(id) {
                var url="${/request/@context_path}/modules/pur/EEPI1010/uploadFile.screen?table_name=EPDATA_INFO_LINES.A&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                }).on('beforeclose', function() {
                       eepi_att_line_rercod(id);
                    });
            }
          
            function eepi10101_line_attachmentRenderUpload2(id) {
                var url="${/request/@context_path}/modules/pur/EEPI1010/uploadFile.screen?table_name=EPDATA_INFO_LINES.C&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                }).on('beforeclose', function() {
                       eepi_att_line_rercod(id);
                    });
            }
            function eepi10101_line_attachmentRenderUpload3(id) {
                var url="${/request/@context_path}/modules/pur/EEPI1010/uploadFile.screen?table_name=EPDATA_INFO_LINES.D&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                }).on('beforeclose', function() {
                       eepi_att_line_rercod(id);
                    });
            }
            function eepi10101_line_attachmentRenderUpload4(id) {
                var url="${/request/@context_path}/modules/pur/EEPI1010/uploadFile.screen?table_name=EPDATA_INFO_LINES.E&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                }).on('beforeclose', function() {
                       eepi_att_line_rercod(id);
                    });
            }
            function eepi10101_line_attachmentRenderUpload5(id) {
                var url="${/request/@context_path}/modules/pur/EEPI1010/uploadFile.screen?table_name=EPDATA_INFO_LINES.F&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                }).on('beforeclose', function() {
                       eepi_att_line_rercod(id);
                    });
            }
              
              
               function eepi10101_attachmentRender(value, record, name) {
                   debugger;
                    var ep_info_id = record.get('ep_info_id');
                    var  attachment_type=record.get('attachment_type');
                    console.log(record.get('approval_status_desc'));
                    console.log(record.get('expire_flag'));
                     if(record.get('approval_status_desc')=="审批中"){
                              if (!record.isNew && ep_info_id) {
                                  if(record.get('att_count')>0){
	                                   if(attachment_type=='MSDS'){
				                             return '<a href="javascript:eepi10101_attachmentRenderView1(' + ep_info_id+')">已上传</a>';
						                }else if(attachment_type=='无卤报告'){
						                     return '<a href="javascript:eepi10101_attachmentRenderView2(' + ep_info_id+')">已上传</a>';
						                }else if(attachment_type=='REACH报告'){
						                     return '<a href="javascript:eepi10101_attachmentRenderView3(' + ep_info_id+')">已上传</a>';
						                }else if(attachment_type=='ROHS2.0'){
						                     return '<a href="javascript:eepi10101_attachmentRenderView4(' + ep_info_id+')">已上传</a>';
						                }else if(attachment_type=='保证函'){
						                     return '<a href="javascript:eepi10101_attachmentRenderView5(' + ep_info_id+')">已上传</a>';
						                }else if(attachment_type=='规格书'){
						                     return '<a href="javascript:eepi10101_attachmentRenderView6(' + ep_info_id+')">已上传</a>';
						                }else if(attachment_type=='均质物质上传'){
						                     return '<a href="javascript:eepi10101_attachmentRenderView7(' + ep_info_id+')">已上传</a>';
						                }
                                  }   
					                else{ 
					                     if(attachment_type=='MSDS'){
				                             return '<a href="javascript:eepi10101_attachmentRenderView1(' + ep_info_id+')">未上传</a>';
						                }else if(attachment_type=='无卤报告'){
						                     return '<a href="javascript:eepi10101_attachmentRenderView2(' + ep_info_id+')">未上传</a>';
						                }else if(attachment_type=='REACH报告'){
						                     return '<a href="javascript:eepi10101_attachmentRenderView3(' + ep_info_id+')">未上传</a>';
						                }else if(attachment_type=='ROHS2.0'){
						                     return '<a href="javascript:eepi10101_attachmentRenderView4(' + ep_info_id+')">未上传</a>';
						                }else if(attachment_type=='保证函'){
						                     return '<a href="javascript:eepi10101_attachmentRenderView5(' + ep_info_id+')">未上传</a>';
						                }else if(attachment_type=='规格书'){
						                     return '<a href="javascript:eepi10101_attachmentRenderView6(' + ep_info_id+')">未上传</a>';
						                }else if(attachment_type=='均质物质上传'){
						                     return '<a href="javascript:eepi10101_attachmentRenderView7(' + ep_info_id+')">未上传</a>';
						                } 
                                  }
			                      
					                    
					                
			                   } 
                     } 
                   
                    if (!record.isNew && ep_info_id) {
                         if(record.get('att_count')>0){
	                        if(attachment_type=='MSDS'){
	                             return '<a href="javascript:eepi10101_attachmentRenderUpload1(' + ep_info_id+')">已上传</a>';
			                }else if(attachment_type=='无卤报告'){
			                     return '<a href="javascript:eepi10101_attachmentRenderUpload2(' + ep_info_id+')">已上传</a>';
			                }else if(attachment_type=='REACH报告'){
			                     return '<a href="javascript:eepi10101_attachmentRenderUpload3(' + ep_info_id+')">已上传</a>';
			                }else if(attachment_type=='ROHS2.0'){
			                     return '<a href="javascript:eepi10101_attachmentRenderUpload4(' + ep_info_id+')">已上传</a>';
			                }else if(attachment_type=='保证函'){
			                     return '<a href="javascript:eepi10101_attachmentRenderUpload5(' + ep_info_id+')">已上传</a>';
			                }else if(attachment_type=='规格书'){
			                     return '<a href="javascript:eepi10101_attachmentRenderUpload6(' + ep_info_id+')">已上传</a>';
			                }else if(attachment_type=='均质物质上传'){
			                     return '<a href="javascript:eepi10101_attachmentRenderUpload7(' + ep_info_id+')">已上传</a>';
			                }
                         }
                         else{
                              if(attachment_type=='MSDS'){
	                             return '<a href="javascript:eepi10101_attachmentRenderUpload1(' + ep_info_id+')">未上传</a>';
			                }else if(attachment_type=='无卤报告'){
			                     return '<a href="javascript:eepi10101_attachmentRenderUpload2(' + ep_info_id+')">未上传</a>';
			                }else if(attachment_type=='REACH报告'){
			                     return '<a href="javascript:eepi10101_attachmentRenderUpload3(' + ep_info_id+')">未上传</a>';
			                }else if(attachment_type=='ROHS2.0'){
			                     return '<a href="javascript:eepi10101_attachmentRenderUpload4(' + ep_info_id+')">未上传</a>';
			                }else if(attachment_type=='保证函'){
			                     return '<a href="javascript:eepi10101_attachmentRenderUpload5(' + ep_info_id+')">未上传</a>';
			                }else if(attachment_type=='规格书'){
			                     return '<a href="javascript:eepi10101_attachmentRenderUpload6(' + ep_info_id+')">未上传</a>';
			                }else if(attachment_type=='均质物质上传'){
			                     return '<a href="javascript:eepi10101_attachmentRenderUpload7(' + ep_info_id+')">未上传</a>';
			                }
                         }
		               
                   } 
            }
            
            
             function eepi_att_rercod(id){
                var data=[]; 
                Aurora.request({
		        	        url:$('eepi10101_att_update_link').getUrl()+'?ep_info_id=' + id,
		        	        para:data,
		        	        success:function(){
		        	                $('eepi10101_info_ds').query();
		        	                Aurora.Masker.unmask(Ext.getBody()); 	
		        	        },
		        	        failure:function(){
		        	        	Aurora.Masker.unmask(Ext.getBody()); 	    
		        	        },
		        	        error:function(){
		        	        	Aurora.Masker.unmask(Ext.getBody()); 	    
		        	        },
		        	        scope:this
		        	    }); 
            }
            
             function eepi_att_line_rercod(id){
                var data=[]; 
                Aurora.request({
		        	        url:$('eepi10101_att_update_link').getUrl()+'?ep_line_id=' + id,
		        	        para:data,
		        	        success:function(){
		        	                $('eepi10101_lines_info_ds').query();
		        	                Aurora.Masker.unmask(Ext.getBody()); 	
		        	        },
		        	        failure:function(){
		        	        	Aurora.Masker.unmask(Ext.getBody()); 	    
		        	        },
		        	        error:function(){
		        	        	Aurora.Masker.unmask(Ext.getBody()); 	    
		        	        },
		        	        scope:this
		        	    }); 
            }
            
            function eepi10101_attachmentRenderUpload6(id) {
                var url="${/request/@context_path}/modules/pur/EEPI1010/uploadFile.screen?table_name=EPDATA_INFO_HEADERS.F&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                }).on('beforeclose', function() {
                       eepi_att_rercod(id);
                    });
            }
            
             function eepi10101_attachmentRenderUpload7(id) {
                var url="${/request/@context_path}/modules/pur/EEPI1010/uploadFile.screen?table_name=EPDATA_INFO_HEADERS.G&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                }).on('beforeclose', function() {
                       eepi_att_rercod(id);
                    });
            }
            
          
            
             function eepi10101_attachmentRenderUpload1(id) {
                var url="${/request/@context_path}/modules/pur/EEPI1010/uploadFile.screen?table_name=EPDATA_INFO_HEADERS.A&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                }).on('beforeclose', function() {
                       eepi_att_rercod(id);
                    });
            }
          
            function eepi10101_attachmentRenderUpload2(id) {
                var url="${/request/@context_path}/modules/pur/EEPI1010/uploadFile.screen?table_name=EPDATA_INFO_HEADERS.C&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                }).on('beforeclose', function() {
                       eepi_att_rercod(id);
                    });
            }
            function eepi10101_attachmentRenderUpload3(id) {
                var url="${/request/@context_path}/modules/pur/EEPI1010/uploadFile.screen?table_name=EPDATA_INFO_HEADERS.D&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                }).on('beforeclose', function() {
                       eepi_att_rercod(id);
                    });
            }
            
            function eepi10101_attachmentRenderUpload4(id) {
                var url="${/request/@context_path}/modules/pur/EEPI1010/uploadFile.screen?table_name=EPDATA_INFO_HEADERS.E&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                }).on('beforeclose', function() {
                       eepi_att_rercod(id);
                    });
            }
            
            function eepi10101_attachmentRenderUpload5(id) {
                var url="${/request/@context_path}/modules/pur/EEPI1010/uploadFile.screen?table_name=EPDATA_INFO_HEADERS.F&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                }).on('beforeclose', function() {
                       eepi_att_rercod(id);
                    });
            }
          
             
            
             function eepi10101_attachmentRenderView6(id) {
                var url="${/request/@context_path}/uploadFileView.screen?table_name=EPDATA_INFO_HEADERS.F&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                }).on('beforeclose', function() {
                       eepi_att_rercod(id);
                    });
            }
            
            function eepi10101_attachmentRenderView7(id) {
                var url="${/request/@context_path}/uploadFileView.screen?table_name=EPDATA_INFO_HEADERS.G&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                }).on('beforeclose', function() {
                       eepi_att_rercod(id);
                    });
            }
            
            
             function eepi10101_attachmentRenderView1(id) {
                var url="${/request/@context_path}/uploadFileView.screen?table_name=EPDATA_INFO_HEADERS.A&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                });
            }
          
            function eepi10101_attachmentRenderView2(id) {
                var url="${/request/@context_path}/uploadFileView.screen?table_name=EPDATA_INFO_HEADERS.C&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                });
            }
            function eepi10101_attachmentRenderView3(id) {
                var url="${/request/@context_path}/uploadFileView.screen?table_name=EPDATA_INFO_HEADERS.D&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                });
            }
            function eepi10101_attachmentRenderView4(id) {
                var url="${/request/@context_path}/uploadFileView.screen?table_name=EPDATA_INFO_HEADERS.E&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                });
            }
            function eepi10101_attachmentRenderView5(id) {
                var url="${/request/@context_path}/uploadFileView.screen?table_name=EPDATA_INFO_HEADERS.F&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                });
            }
            
            
             function eepi10101_line_attachmentRenderView6(id) {
                var url="${/request/@context_path}/uploadFileView.screen?table_name=EPDATA_INFO_LINES.F&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                });
            }
            
            function eepi10101_line_attachmentRenderView7(id) {
                var url="${/request/@context_path}/uploadFileView.screen?table_name=EPDATA_INFO_LINES.G&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                });
            }
            
            
             function eepi10101_line_attachmentRenderView1(id) {
                var url="${/request/@context_path}/uploadFileView.screen?table_name=EPDATA_INFO_LINES.A&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                });
            }
          
            function eepi10101_line_attachmentRenderView2(id) {
                var url="${/request/@context_path}/uploadFileView.screen?table_name=EPDATA_INFO_LINES.C&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                });
            }
            function eepi10101_line_attachmentRenderView3(id) {
                var url="${/request/@context_path}/uploadFileView.screen?table_name=EPDATA_INFO_LINES.D&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                });
            }
            function eepi10101_line_attachmentRenderView4(id) {
                var url="${/request/@context_path}/uploadFileView.screen?table_name=EPDATA_INFO_LINES.E&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                });
            }
            function eepi10101_line_attachmentRenderView5(id) {
                var url="${/request/@context_path}/uploadFileView.screen?table_name=EPDATA_INFO_LINES.F&header_id=" + id;
                new Aurora.Window({
                    id: 'eepi10101_attachment_file_upload_link_window',
                    title: '附件上传',
                    url: url,
                    width: 500,
                    height: 500
                });
            }
          
            
           function eepi10101_info_delete(){
               var records=$('eepi10101_info_ds').getSelected();
               
               if(records.length==0 || Aurora.isEmpty(records)){
                    Aurora.showMessage('${l:PROMPT}', '请勾选一行进行操作！');
                    return ;
                }
                 
                 var para = [];
                 for( var n=0;n<records.length;n++){
                       if(records[n].get('approval_status_desc')=="已审批"){
                            Aurora.showMessage('${l:PROMPT}', '审批状态已审批，不允许删除！');
                            return ;
                       }
                       if(records[n].get('approval_status_desc')=="审批中"){
                            Aurora.showMessage('${l:PROMPT}', '审批状态为审批中，不允许删除！');
                            return ;
                       }
                        if(records[n].get('expire_flag')=="生效"){
                            Aurora.showMessage('${l:PROMPT}', '状态为生效，不允许删除！');
                            return ;
                       }
                       if(records[n].get('expire_flag')=="即将失效"){
                            Aurora.showMessage('${l:PROMPT}', '状态为即将失效，不允许删除！');
                            return ;
                       }
                        records[n].set('_status', 'delete');
	        	        para.push(records[n].data);
                }
                
                Aurora.showConfirm('${l:PROMPT}', '删除物料的环保认证资料后，需要重新上传走审批，请谨慎操作！', function() {
	        	        Aurora.request({
		        	        url:$('eepi10101_info_delete_link').getUrl(),
		        	        para:para,
		        	        success:function(){
	        	                Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.OPERATION_SUCCESS}', function(){
		        	                $('eepi10101_info_ds').query();
		        	                Aurora.Masker.unmask(Ext.getBody()); 	
	        	                });
		        	        },
		        	        failure:function(){
		        	        	Aurora.Masker.unmask(Ext.getBody()); 	    
		        	        },
		        	        error:function(){
		        	        	Aurora.Masker.unmask(Ext.getBody()); 	    
		        	        },
		        	        scope:this
		        	    });
                 });
           }
            
         
            
             function eepi10101_lines_info_delete(){
                debugger;
                var ds=$('eepi10101_lines_info_ds');
                var records=$('eepi10101_lines_info_ds').getSelected();
                var records_h=$('eepi10101_info_ds').getCurrentRecord();
                if(records.length==0 || Aurora.isEmpty(records)){
                    Aurora.showMessage('${l:PROMPT}', '请勾选一行进行操作！');
                    return ;
                }
                var para = [];
                for( var i=0;i<records.length;i++){
                       if(records[i].get('approval_status_desc')=="审批完成"||records[i].get('approval_status_desc')=="审批中"){
                              Aurora.showMessage('${l:PROMPT}', '该子行已审批完成，不允许删除！');
                              return ;
                       }
                        records[i].set('_status', 'delete');
	        	        para.push(records[i].data);
	        	       
                }
                
              
                Aurora.showConfirm('${l:PROMPT}', '是否确认删除！', function() {
                  Aurora.request({
                        url: $('eepi10101_lines_info_delete_link').getUrl(),
                        para: para,
                        success: function() {
                           //$('eepi10101_info_ds').query();
                            //$('eepi10101_lines_info_ds').query();
                            
                            for( var i=0;i<records.length;i++){
                              ds.remove(i);
                         }
                       
	        	       
                
                        },
                        failure: function() {
                            return;
                        },
                        error: function() {
                            return;
                        }
                    });
                  });  
                
                
                
                 
             }
        
           
             function eepi10101_infoEditExportSelectFunction() {
                var records = $('eepi10101_info_ds').getSelected();
                if (records.length == 0) {
                    Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.SELECT_ONE_RECORD_AT_LEAST}');
                    return;
                } else {
                    new Aurora.Window({
                        id: 'eepi10101_infoExport_window',
                        url: $('eepi10101_infoExport_link').getUrl(),
                        title: '${l:HAP_EXPORT}',
                        width: 1300,
                        height: 500
                    });
                }
            }
	          
            function eepi10101_lines_query_click(grid, row, name, record){
                  var records=$('eepi10101_info_ds').getCurrentRecord();
                  record.set('attachment_type',records.get('attachment_type'));
                  record.set('item_no',records.get('item_no'));
                  record.set('device_name',records.get('device_name'));
                  record.set('vendor_code',records.get('vendor_code'));
                  record.set('vendor_name',records.get('vendor_name'));
           }
           
             function rowclickAction(grid, index, record) {
                if (record.get('ep_info_id')) {
                    $('eepi10101_lines_info_ds').setQueryParameter('ep_info_id', record.get('ep_info_id'));
                    $('eepi10101_lines_info_ds').query();
                    
                } else {
                    $('eepi10101_lines_info_ds').setQueryParameter('ep_info_id', -1);
                    $('eepi10101_lines_info_ds').query();
                }
                     
                        if(record.get('homogenous_item_upload')=='N' || record.get('approval_status_desc')=='审批中'){
                              var btn1 = document.getElementById("eepi_line_vendor_addBtn");
							btn1.style.display = "none";
							 var btn2 = document.getElementById("eepi_line_vendor_saveBtn");
							btn2.style.display = "none";
							 var btn3 = document.getElementById("eepi_line_vendor_deleteBtn");
							btn3.style.display = "none";
                        }else{
                            var btn1 = document.getElementById("eepi_line_vendor_addBtn");
							btn1.style.display = "block";
							 var btn2 = document.getElementById("eepi_line_vendor_saveBtn");
							btn2.style.display = "block";
							 var btn3 = document.getElementById("eepi_line_vendor_deleteBtn");
							btn3.style.display = "block";
                        }
                        
                       
               }
            
            
            function eepi10101_lines_info_save(){
             
                  var records_con=$('eepi10101_info_ds').getCurrentRecord();
                  var records = $('eepi10101_lines_info_ds').getAll(); 
                  if (!$('eepi10101_lines_info_ds').validate()) {
                    return;
                 }
                   var ep_info_id=records_con.get('ep_info_id');
                   var datas=[];
                   var flag=false;
                
                    for( var i=0;i<records.length;i++){
                             console.log(records.length);
				                       if(records[i].isNew){
				                          records[i].set('_status','insert');
				                          records[i].set('ep_info_id',ep_info_id);
				                          datas.push(records[i].data);
				                        }else{
				                           records[i].set('_status','update');
				                           records[i].set('ep_info_id',ep_info_id);
				                          datas.push(records[i].data);
				                        }
				                       if(records[i].get('expire_flag')=='生效'||records[i].get('expire_flag')=='即将失效'){
				                              if(records[i].get('flag')=='Y'){
				                                 flag=true; 
				                              }
				                       }
                         
				                }
				                
				               
				                    if(flag){
                            Aurora.showConfirm('${l:PROMPT}', '保存的数据中存在已生效的变更，是否确认保存，保存后对应资料将变为待生效状态，需重新提交审批', function() { 
                                          Aurora.request({
					                        url: $('eepi10101_lines_info_save_link').getUrl(),
					                        para: datas, 
					                        success: function() {
/* 					                           var ds= $('eepi10101_lines_info_ds');
			        	                       var record=$('eepi10101_lines_info_ds').getCurrentRecord();
			        	                       var currentPage =ds.currentPage;
		               						   var pagesize = ds.pagesize;
					                           $('eepi10101_lines_info_ds').query();
					                            ds.locate(ds.indexOf(record) + 1 + (currentPage - 1) * pagesize); */
					                          
					                           
					                           Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.OPERATION_SUCCESS}', function(){
						        	                $('eepi10101_info_ds').query();
						        	                Aurora.Masker.unmask(Ext.getBody()); 	
					        	                });
					                        },
					                        failure: function() {
					                            return;
					                        },
					                        error: function() {
					                            return;
					                        }
					                    });
                        });
				                    }else{
				                         Aurora.request({
					                        url: $('eepi10101_lines_info_save_link').getUrl(),
					                        para: datas, 
					                        success: function() {
					                          /*  var ds= $('eepi10101_lines_info_ds');
			        	                       var record=$('eepi10101_lines_info_ds').getCurrentRecord();
			        	                       var currentPage =ds.currentPage;
		               						   var pagesize = ds.pagesize;
					                           $('eepi10101_lines_info_ds').query();
					                            ds.locate(ds.indexOf(record) + 1 + (currentPage - 1) * pagesize); */
					                           //$('eepi10101_info_ds').query();
					                           
					                           Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.OPERATION_SUCCESS}', function(){
						        	                  /*  var ds= $('eepi10101_info_ds');
					        	                       var record=$('eepi10101_info_ds').getCurrentRecord();
					        	                       var currentPage =ds.currentPage;
				               						   var pagesize = ds.pagesize;
				                                      //ds 指针定位到勾选的行
				                                
						        	                $('eepi10101_info_ds').query();
						        	                 ds.locate(ds.indexOf(record) + 1 + (currentPage - 1) * pagesize); */
						        	                 
						        	                $('eepi10101_info_ds').query();
						        	                Aurora.Masker.unmask(Ext.getBody()); 	
					        	                });
					                        },
					                        failure: function() {
					                            return;
					                        },
					                        error: function() {
					                            return;
					                        }
					                    });
				                    }
             } 
             
             
                 function news_blt_load(ds) {
                var records = ds.getAll();
                var data = records[0].data;
                var content = document.getElementById('login_news_minPara');
                content.innerHTML = '<div class="para">' + data.bulletin_context + '</div>';
            }
             
           function eepi10101_info_select(ds, record) {
               debugger;
                /* if (record.get('ep_info_id')) {
                    $('eepi10101_lines_info_ds').setQueryParameter('ep_info_id', record.get('ep_info_id'));
                    $('eepi10101_lines_info_ds').query();
                    
                } else {
                    $('eepi10101_lines_info_ds').setQueryParameter('ep_info_id', -1);
                    $('eepi10101_lines_info_ds').query();
                }  */
                 
                var list_ds=$('eepi10101_lines_info_ds');
                list_ds.selectAll();
                var records=list_ds.getAll();
                for(var i=0;i<records.length;i++){
                    if(records[i].get('ep_info_id')!=record.get('ep_info_id')){
                         list_ds.unSelectAll();
                         break;
                    }
                }
               /*  var ep_info_id=record.get('ep_info_id');
                var result_record = list_ds.find('ep_info_id', ep_info_id);
                 result_record.select();  */
           }
            
             function eepi10101_info_unselect(ds, record) {
                  var list_ds=$('eepi10101_lines_info_ds');
                  list_ds.unSelectAll();
            }
            
            
            
             function eepi10101_approveDocumentGridRenderer(value, record, name) {
                 if(!record.isNew){
                      var list_id = record.get('ep_info_id');
                if (name == 'operation_record') {
                    return '<a href="javascript:eepi10101_operationRecord(' + list_id + ')">${l:WFL_FUNCTION_APPROVE.OPERATION_RECORD}</a>';
                  } 
                 }else{
                      return '${l:WFL_FUNCTION_APPROVE.OPERATION_RECORD}';
                 }
              
            }
            
            function eepi10101_operationRecord(list_id) {
                new Aurora.Window({
                    id: 'eepi10101_operationRecord_window',
                    url: $('eepi10101_operationRecord_link').getUrl() + '?list_id=' + list_id,
                    title: '${l:WFL_FUNCTION_APPROVE.OPERATION_RECORD}',
                    height: 420,
                    width: 630
                });
            }
            
            
        ]]></script>
        <a:dataSets>
            <a:dataSet id="eepi10101_approval_status_ds">
                <a:datas dataSource="inv8010_noti_mode"/>
            </a:dataSet>
            <a:dataSet id="eepi10101_attachment_type_ds">
                <a:datas dataSource="eepi10101_noti_mode"/>
            </a:dataSet>
            <a:dataSet id="eepi10101_expirt_flag_ds" lookupCode="EEPI_EXPIRT_FLAG"/>
            <a:dataSet id="eepi10101_info_query_ds">
                <a:fields>
                    <a:field name="item_no"/>
                    <a:field name="supplier_model"/>
                    <a:field name="device_name"/>
                    <a:field name="report_valid_date_to_to"/>
                    <a:field name="report_valid_date_to_from"/>
                    <a:field name="vendor_code" lovHeight="480" lovService="public.pur_vendors_by_user_authority_lov" lovWidth="500" title="PROMPT.VENDOR">
                        <a:mapping>
                            <a:map from="vendor_id" to="vendor_id"/>
                            <a:map from="vendor_code" to="vendor_code"/>
                            <a:map from="vendor_name" to="vendor_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="vendor_name"/>
                    <a:field name="report_valid_date_to"/>
                    <a:field name="expire_flag" lovHeight="260" lovUrl="${/request/@context_path}/modules/pur/eepi10101/eepi10101_upload_status_multilov.screen" lovWidth="250" title="状态选择"/>
                    <a:field name="approval_status_desc" displayField="flex_desc" options="eepi10101_approval_status_ds" returnField="approval_status" valueField="flex_value"/>
                </a:fields>
            </a:dataSet>
            <a:dataSet id="eepi10101_info_ds" autoCount="true" autoQuery="true" model="pur.EEPI1010.eepi1010_info_vendor_query" pageSize="50" queryDataSet="eepi10101_info_query_ds" selectable="true">
                <a:fields>
                    <a:field name="approval_status_desc" displayField="flex_desc" options="eepi10101_approval_status_ds" returnField="approval_status" valueField="flex_value"/>
                    <a:field name="attachment_type" defaultValue="" displayField="flex_desc" options="eepi10101_attachment_type_ds" required="true" returnField="attachment_type" valueField="flex_value"/>
                    <a:field name="item_no" lovHeight="500" lovService="pur.EEPI1010.mtl_system_items_vendor_lov" lovWidth="750" required="true" requiredMessage="景旺料号不能为空" title="景旺料号">
                        <a:mapping>
                            <a:map from="display_item_code" to="item_no"/>
                            <a:map from="item_name" to="device_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="device_name"/>
                    <!--  <a:field name="item_no"/> -->
                    <!--  <a:field name="expire_flag" displayField="code_value_name" options="eepi10101_expirt_flag_ds" returnField="expire_flag" valueField="code_value"/> -->
                    <a:field name="supplier_mode"/>
                    <a:field name="vendor_code" autoComplete="true" autoCompleteField="vendor_code" lovHeight="480" lovService="pur.EEPI1010.pur_vendors_lov" lovWidth="500" required="true" requiredMessage="供应商编码不能为空" title="PROMPT.VENDOR">
                        <a:mapping>
                            <a:map from="vendor_id" to="vendor_id"/>
                            <a:map from="vendor_code" to="vendor_code"/>
                            <a:map from="vendor_name" to="vendor_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="expire_flag"/>
                    <a:field name="vendor_name"/>
                    <a:field name="v_count"/>
                    <a:field name="vendor_id"/>
                    <a:field name="att_count"/>
                    <a:field name="ep_info_id"/>
                    <a:field name="line_test_date_flag"/>
                    <a:field name="line_valid_date_flag"/>
                    <a:field name="homogenous_item_upload"/>
                    <a:field name="report_test_date_flag"/>
                    <a:field name="report_valid_date_flag"/>
                    <a:field name="part_name"/>
                    <a:field name="report_test_date"/>
                    <a:field name="report_valid_date_to"/>
                    <a:field name="attachment"/>
                    <a:field name="submit_date"/>
                    <a:field name="submit_by_desc"/>
                    <a:field name="flag"/>
                    <a:field name="approve_by"/>
                    <a:field name="approve_by_desc"/>
                    <a:field name="approve_date"/>
                    <a:field name="suppliers_comments"/>
                    <a:field name="approval_opinions"/>
                </a:fields>
                <a:events>
                    <a:event name="load" handler="eepi10101_info_ds_load"/>
                    <a:event name="update" handler="eepi10101_info_update"/>
                    <a:event name="add" handler="setinitdata_header"/>
                    <a:event name="select" handler="eepi10101_info_select"/>
                    <a:event name="unselect" handler="eepi10101_info_unselect"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="eepi10101_lines_info_ds" autoCount="true" model="pur.EEPI1010.eepi1010_info_lines_vendor_query" pageSize="50" selectable="true">
                <a:fields>
                    <a:field name="approval_status_desc" displayField="flex_desc" options="eepi10101_approval_status_ds" returnField="approval_status" valueField="flex_value"/>
                    <a:field name="attachment_type" defaultValue="" displayField="flex_desc" options="eepi10101_attachment_type_ds" required="true" returnField="attachment_type" valueField="flex_value"/>
                    <a:field name="item_no" lovHeight="500" lovService="pur.EEPI1010.mtl_system_items_vendor_lov" lovWidth="750" required="true" requiredMessage="景旺料号不能为空" title="景旺料号">
                        <a:mapping>
                            <a:map from="display_item_code" to="item_no"/>
                            <a:map from="item_name" to="device_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="device_name"/>
                    <!--  <a:field name="item_no"/> -->
                    <!--  <a:field name="expire_flag" displayField="code_value_name" options="eepi10101_expirt_flag_ds" returnField="expire_flag" valueField="code_value"/> -->
                    <a:field name="supplier_mode"/>
                    <a:field name="vendor_code" fetchRemote="true" lovHeight="480" lovService="pur.EEPI1010.pur_vendors_lov" lovWidth="500" required="true" requiredMessage="供应商编码不能为空" title="PROMPT.VENDOR">
                        <a:mapping>
                            <a:map from="vendor_id" to="vendor_id"/>
                            <a:map from="vendor_code" to="vendor_code"/>
                            <a:map from="vendor_name" to="vendor_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="expire_flag"/>
                    <a:field name="att_count"/>
                    <a:field name="ep_info_id"/>
                    <a:field name="ep_line_id"/>
                    <a:field name="vendor_name"/>
                    <a:field name="vendor_id"/>
                    <a:field name="line_test_date_flag"/>
                    <a:field name="line_valid_date_flag"/>
                    <a:field name="report_test_date_flag"/>
                    <a:field name="report_valid_date_flag"/>
                    <a:field name="part_name" required="true" requiredMessage="均质物质不能为空"/>
                    <a:field name="report_test_date"/>
                    <a:field name="report_valid_date_to"/>
                    <a:field name="attachment"/>
                    <a:field name="submit_date"/>
                    <a:field name="submit_by"/>
                    <a:field name="submit_by_desc"/>
                    <a:field name="flag"/>
                    <a:field name="approve_by"/>
                    <a:field name="approve_by_desc"/>
                    <a:field name="approve_date"/>
                    <a:field name="suppliers_comments"/>
                    <a:field name="approval_opinions"/>
                </a:fields>
                <a:events>
                    <a:event name="load" handler="eepi10101_lines_info_ds_load"/>
                    <a:event name="update" handler="eepi10101_lines_info_update"/>
                    <a:event name="add" handler="setinitdata"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="eepi10101_type_ds" autoCount="true" autoQuery="true" model="pur.EEPI1020.eepi1020_type_edit">
                <a:fields>
                    <a:field name="data_type_code" displayField="flex_desc" options="eepi1020_attachment_type_ds" required="true" returnField="data_type_code" valueField="flex_value"/>
                    <a:field name="report_test_date_flag"/>
                    <a:field name="report_valid_date_flag"/>
                    <a:field name="describes"/>
                </a:fields>
            </a:dataSet>
            <a:dataSet id="news_blt_query_ds" autoQuery="true" fetchAll="true" model="pur.EEPI1010.blt_login_vendor_query_file">
                <a:events>
                    <a:event name="load" handler="news_blt_load"/>
                </a:events>
            </a:dataSet>
        </a:dataSets>
        <a:screenBody>
            <a:screenTopToolbar>
                <a:gridButton bind="eepi10101_info_grid" type="add" width="100"/>
                <a:toolbarButton click="eepi10101_info_save" text="保存" width="100"/>
                <a:toolbarButton click="eepi10101_info_delete" text="删除" width="100"/>
                <a:toolbarButton click="eepi10101_info_submit" text="提交" width="100"/>
                <!--   <a:toolbarButton click="eepi10101_infoEditExportSelectFunction" text="勾选数据导出" width="100"/> -->
                <a:gridButton bind="eepi10101_info_grid" type="excel" width="100"/>
                <div style="margin-left:80px;float:rigth;width:35%;">
                    <div id="login_news_minPara"/>
                </div>
            </a:screenTopToolbar>
            <a:queryForm bindTarget="eepi10101_info_query_ds" resultTarget="eepi10101_info_ds" style="width:100%;border:none">
                <a:formToolBar>
                    <a:hBox>
                        <a:textField name="item_no" prompt="景旺料号" width="100"/>
                        <a:textField name="supplier_mode" prompt="供应商型号" width="100"/>
                        <a:textField name="device_name" prompt="器件名称" width="100"/>
                        <a:datePicker name="report_valid_date_to_to" prompt="报告失效日期从" width="100"/>
                        <a:datePicker name="report_valid_date_to_from" prompt="报告失效日期至" width="100"/>
                        <a:lov name="expire_flag" prompt="状态" width="100"/>
                    </a:hBox>
                </a:formToolBar>
                <a:formBody>
                    <a:hBox>
                        <a:comboBox name="approval_status_desc" prompt="审批状态" width="80"/>
                    </a:hBox>
                </a:formBody>
            </a:queryForm>
            <div style="font-weight:bold;padding-top:5px;padding-left:5px">
                <span><![CDATA[环保资料]]></span>
            </div>
            <a:grid id="eepi10101_info_grid" bindTarget="eepi10101_info_ds" marginHeight="350" marginWidth="30" navBar="true" width="900">
                <a:columns>
                    <a:column name="expire_flag" align="center" autoAdjust="false" prompt="状态" renderer="eepi10101_expireFlagRenderer" resizable="false" width="70"/>
                    <a:column name="approval_status_desc" align="center" prompt="审批状态" resizable="false" width="40"/>
                    <a:column name="attachment_type" align="left" editor="eepi10101_upload_cml" prompt="附件类型" resizable="false" width="60"/>
                    <a:column name="item_no" align="center" editor="eepi10101_upload_lov" prompt="景旺料号" resizable="false" width="80"/>
                    <a:column name="device_name" align="center" prompt="器件名称" width="130"/>
                    <a:column name="vendor_code" align="center" editor="eepi10101_upload_lov" prompt="供应商编码" resizable="false" width="60"/>
                    <a:column name="vendor_name" align="center" prompt="供应商名称" width="80"/>
                    <a:column name="supplier_mode" align="center" editor="eepi10101_upload_tf" prompt="供应商型号"  width="60"/>
                    <!-- <a:column name="part_name" align="center" autoAdjust="true" editor="eepi10101_upload_tf" prompt="部件名称(均质物质)"/> -->
                    <a:column name="report_test_date" align="center" editor="eepi10101_upload_dp" prompt="报告测试日期" renderer="Aurora.formatDate" resizable="false" width="70"/>
                    <a:column name="report_valid_date_to" align="center" editor="eepi10101_upload_dp" prompt="报告失效日期" renderer="Aurora.formatDate" resizable="false" width="70"/>
                    <a:column name="attachment" align="center" prompt="附件" renderer="eepi10101_attachmentRender" resizable="false" width="80"/>
                   <a:column name="suppliers_comments" align="center" editor="eepi10101_upload_tf" prompt="供方备注" width="70"/>
                    <a:column name="approval_opinions" align="center" prompt="审批意见" width="100"/>
                    <a:column name="submit_by_desc" align="center" prompt="提交人" resizable="false" width="70"/>
                    <a:column name="submit_date" align="center" prompt="提交日期" renderer="Aurora.formatDate" resizable="false" width="70"/>
                    <a:column name="approve_by_desc" align="center" prompt="审核人" resizable="false" width="100"/>
                    <a:column name="approve_date" align="center" prompt="审核时间" renderer="Aurora.formatDate" resizable="false" width="100"/>
                    <a:column name="operation_record" align="center" prompt="WFL_FUNCTION_APPROVE.OPERATION_RECORD" renderer="eepi10101_approveDocumentGridRenderer" resizable="false" width="50"/>
                </a:columns>
                <a:editors>
                    <a:comboBox id="eepi10101_upload_cml"/>
                    <a:numberField id="eepi10101_upload_nb"/>
                    <a:dateTimePicker id="eepi10101_upload_dp"/>
                    <a:textField id="eepi10101_upload_tf"/>
                    <a:lov id="eepi10101_upload_lov"/>
                </a:editors>
                <a:events>
                    <a:event name="rowclick" handler="rowclickAction"/>
                </a:events>
            </a:grid>
            <a:grid id="eepi10101_lines_info_grid" bindTarget="eepi10101_lines_info_ds" marginHeight="480" marginWidth="30" width="900">
                <a:toolBar>
                    <a:button id="eepi_line_vendor_addBtn" type="add"/>
                    <a:button id="eepi_line_vendor_saveBtn" click="eepi10101_lines_info_save" text="保存"/>
                    <a:button id="eepi_line_vendor_deleteBtn" click="eepi10101_lines_info_delete" text="删除"/>
                </a:toolBar>
                <a:columns>
                    <a:column name="expire_flag" align="center" autoAdjust="false" prompt="状态" renderer="eepi10101_expireFlagRenderer" resizable="false" width="70"/>
                    <a:column name="approval_status_desc" align="center" prompt="审批状态" resizable="false" width="40"/>
                    <a:column name="attachment_type" align="left" prompt="附件类型" resizable="false" width="60"/>
                    <a:column name="item_no" align="center" autoAdjust="true" prompt="景旺料号" width="120"/>
                    <a:column name="device_name" align="left" prompt="器件名称" width="130"/>
                    <a:column name="vendor_code" align="center" prompt="供应商编码" resizable="false" width="60"/>
                    <a:column name="vendor_name" align="center" prompt="供应商名称" width="80"/>
                    <a:column name="supplier_mode" align="center" editor="eepi10101_lines_upload_tf" prompt="供应商型号"  width="60"/>
                    <a:column name="part_name" id="part_name_id" align="center" editor="eepi10101_lines_upload_tf" prompt="部件名称(均质物质)" renderer="eepi_req_render"/>
                    <a:column name="report_test_date" align="center" editor="eepi10101_lines_upload_dp" prompt="报告测试日期" renderer="Aurora.formatDate" resizable="false" width="70"/>
                    <a:column name="report_valid_date_to" align="right" editor="eepi10101_lines_upload_dp" prompt="报告失效日期" renderer="Aurora.formatDate" resizable="false" width="70"/>
                    <a:column name="attachment" align="center" prompt="附件" renderer="eepi10101_line_attachmentRender" resizable="false" width="80"/>
                       <a:column name="suppliers_comments" align="center" editor="eepi10101_upload_tf" prompt="供方备注" width="70"/>
                    <a:column name="approval_opinions" align="center" prompt="审批意见" width="100"/>
                    <a:column name="submit_date" align="center" prompt="提交日期" renderer="Aurora.formatDate" resizable="false" width="70"/>
                    <a:column name="submit_by_desc" align="center" prompt="提交人" resizable="false" width="70"/>
                    <a:column name="approval_by_desc" align="center" prompt="审核人" resizable="false" width="100"/>
                    <a:column name="approval_date" align="center" prompt="审核时间" renderer="Aurora.formatDate" resizable="false" width="100"/>
                </a:columns>
                <a:editors>
                    <a:comboBox id="eepi10101_lines_upload_cml"/>
                    <a:numberField id="eepi10101_lines_upload_nb"/>
                    <a:dateTimePicker id="eepi10101_lines_upload_dp"/>
                    <a:textField id="eepi10101_lines_upload_tf"/>
                    <a:lov id="eepi10101_lines_upload_lov"/>
                </a:editors>
                <!-- <a:events>
                    <a:event name="cellClick" handler="eepi10101_lines_query_click"/>
                </a:events> -->
            </a:grid>
        </a:screenBody>
    </a:view>
</a:screen>

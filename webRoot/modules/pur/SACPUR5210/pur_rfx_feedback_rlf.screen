<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: WangQiaosen  
    $Date: 2013-6-29 下午3:55:28  
    $Revision: 1.0  
    $Purpose: 
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application" xmlns:s="aurora.plugin.script" trace="true">
    <a:init-procedure>
        <!-- <s:server-script import="fnd_flex_dynamic_tools.js"/>
        <s:server-script import="fnd_flex_dynamic_page_main.js"/>
        <s:server-script import="fnd_flex_dynamic_grid_expanded.js"/> -->
        <a:model-query defaultWhereClause="feedback_header_id = ${/parameter/@feedback_header_id}" fetchAll="true" model="pur.SACPUR5210.pur_rfx_feedback_rfq_header" rootPath="header_record_rp"/>
        <a:model-query fetchAll="true" model="public.currency_list" rootPath="pur5130_currency_source"/>
        <!-- <a:model-query defaultWhereClause="v.config_classify_code = &apos;RFX&apos; AND v.config_item_code = &apos;RFX_14&apos;" fetchAll="true" model="public.get_fnd_config_center_coop_bg_item_value" rootPath="bg_item_rfx_14"/> -->
        <a:model-query defaultWhereClause="rfx_header_id = ${/parameter/@rfx_header_id}" fetchAll="true" model="public.get_fnd_config_center_owner_bg_item_value" rootPath="bg_item_rfx_14"/>
        <a:model-query fetchAll="true" model="cux.KINWONG.public.get_0407_category_id" rootPath="get_0407_category_id"/>
    </a:init-procedure>
    <a:view>
        <div/>
        <a:link id="sacpur52101_rfx_feedback_save_link" url="${/request/@context_path}/modules/pur/SACPUR5210/pur_rfx_feedback_save.svc"/>
        <a:link id="sacpur52101_rfx_feedback_submit_link" url="${/request/@context_path}/modules/pur/SACPUR5210/pur_rfx_feedback_submit.svc"/>
        <a:link id="sacpur52101_rfx_feedback_ln_submit_link" url="${/request/@context_path}/modules/pur/SACPUR5210/pur_rfx_feedback_ln_submit.svc"/>
        <a:link id="sacpur52101_rfx_feedback_takeback_link" model="pur.SACPUR5210.pur_rfx_feedback_rfq_line" modelaction="execute"/>
        <a:link id="sacpur52101_rfx_feedback_vendor_quote_edit_link" url="${/request/@context_path}/modules/pur/SACPUR5210/pur_rfx_feedback_vendor_quote_edit.screen"/>
        <a:link id="sacpur52101_rfx_feedback_vendor_quote_view_link" url="${/request/@context_path}/modules/pur/SACPUR5210/pur_rfx_feedback_vendor_quote_view.screen"/>
        <a:link id="pur5220_rfxLadderQuotation_link" url="${/request/@context_path}/modules/pur/SACPUR5210/pur_rfx_ladder_quotation.screen"/>
        <a:link id="pur5220_rfxLadderQuotationView_link" url="${/request/@context_path}/modules/pur/SACPUR5210/pur_rfx_ladder_quotation_view.screen"/>
        <a:link id="sacpur5210_rfxLadderQuotationDefaultPrice_link" model="pur.SACPUR5210.pur_rfx_ladder_quotation" modelaction="execute"/>
        <a:link id="sacpur52105_rfx_quote_import_link" url="${/request/@context_path}/modules/pur/SACPUR5210/pur_rfx_quote_rfq_import.screen"/>
        <a:link id="sacpur52101_rfx_item_note_view_rfq_link" url="${/request/@context_path}/modules/pur/SACPUR5210/pur_rfx_item_note_view_rfq.screen"/>
        <a:link id="template_link" url="${/request/@context_path}/modules/cux/KINWONG/rfx/rfx5020/rfx5020_template_print.screen"/>
        <script src="${/request/@context_path}/javascripts/countdown/jquery-1.8.3.min.js" type="text/javascript"/>
        <script src="${/request/@context_path}/javascripts/countdown/jquery.classycountdown.js" type="text/javascript"/>
        <script src="${/request/@context_path}/javascripts/countdown/jquery.knob.js" type="text/javascript"/>
        <script src="${/request/@context_path}/javascripts/countdown/jquery.throttle.js" type="text/javascript"/>
        <link href="${/request/@context_path}/css/pur/jquery.classycountdown.css" rel="stylesheet" type="text/css"/>
        <a:link id="sacpur52101_expressFrame_maintain_link" url="${/request/@context_path}/modules/pur/SACPUR5210/pur_rfx_feedback_express_frame.screen"/>
        <a:link id="sacpur52101_logisticsFrame_maintain_link" url="${/request/@context_path}/modules/pur/SACPUR5210/pur_rfx_feedback_domestic_logistics_frame.screen"/>
        <a:link id="sacpur52101_vehicleFrame_maintain_link" url="${/request/@context_path}/modules/pur/SACPUR5210/pur_rfx_feedback_vehicle_logistics_frame.screen"/>
        <style><![CDATA[
  .circle {
 margin-left:20px;
 margin-top:5px;
 width:365px;
 height:170px;
/*  background:#E2F0D9; */
 
 font-size:18px;
 font-family: "Helvetica Neue", Helvetica, Microsoft Yahei, Hiragino Sans GB, WenQuanYi Micro Hei, sans-serif;
}
#countdown4{
   /*  background:#E2F0D9; */
}
 .ClassyCountdownDemo {
     margin:0 auto; 
     max-width:330px; 
     width:calc(100%); 
     padding:15px;
     display:block 
}     
       
        ]]></style>
        <script><![CDATA[
            var left_time;
            var jq = jQuery.noConflict();
            
            function check_value_from_ladder(rec, name, val) {
                var ladder_inquiry_flag = rec.get('ladder_inquiry_flag');
                if (ladder_inquiry_flag == 'Y') {
                    return true;
                }
                if (rec.get('ladder_quotation') == 'Y') {
                    return true;
                } else {
                    return '请填写阶梯报价！';
                }
            }
            
            function sacpur52101RfxFeedbackRfqSave() {
                var item_ds = $('sacpur52101_rfx_feedback_rfq_line_ds');
                var header_rec = $('sacpur52101_rfx_feedback_rfq_header_ds').getCurrentRecord();
                if (!item_ds.validate()) {
                    return;
                }
            
                var data = {};
                data['items'] = item_ds.getJsonData();
                data['feedback_expiry_date_from'] = header_rec.get('feedback_expiry_date_from');
                data['feedback_expiry_date_to'] = header_rec.get('feedback_expiry_date_to');
                data['place_of_delivery'] = header_rec.get('place_of_delivery');
                Aurora.Masker.mask($('sacpur52101_rfx_feedback_rlf_window').wrap, '${l:LOADING}');
                Aurora.request({
                    url: $('sacpur52101_rfx_feedback_save_link').getUrl(),
                    para: data,
                    success: function(result) {
                        //sacpur52101RfxFeedbackRfqCountsAndToalPrice();
                        $('sacpur52101_rfx_feedback_rfq_line_ds').query();
                        Aurora.Masker.unmask($('sacpur52101_rfx_feedback_rlf_window').wrap);
                    },
                    failure: function() {
                        Aurora.Masker.unmask($('sacpur52101_rfx_feedback_rlf_window').wrap);
                        return;
                    },
                    error: function() {
                        Aurora.Masker.unmask($('sacpur52101_rfx_feedback_rlf_window').wrap);
                        return;
                    }
                });
            
            }
            
            function pur52101_rfx_feedback_submit(header_record, item_ds) {
                var feedback_header_id = header_record.get('feedback_header_id');
                var status = header_record.get('status');
                var data = {};
                data.feedback_header_id = feedback_header_id;
                data.status = status;
                var item_rec = item_ds.getAll();
                for (i = 0;i < item_rec.length;i++) {
                    item_rec[i].dirty = true;
                }
                data['feedback_expiry_date_from'] = header_record.get('feedback_expiry_date_from');
                data['feedback_expiry_date_to'] = header_record.get('feedback_expiry_date_to');
                data['place_of_delivery'] = header_record.get('place_of_delivery');
                data['items'] = item_ds.getJsonData();
                Aurora.Masker.mask($('sacpur52101_rfx_feedback_rlf_window').wrap, '${l:LOADING}');
                Aurora.request({
                    url: $('sacpur52101_rfx_feedback_submit_link').getUrl(),
                    para: data,
                    success: function(result) {
                        Aurora.Masker.unmask($('sacpur52101_rfx_feedback_rlf_window').wrap);
                        sacpur52101RfxFeedbackRfqReturn();
                    },
                    failure: function() {
                        Aurora.Masker.unmask($('sacpur52101_rfx_feedback_rlf_window').wrap);
                        return;
                    },
                    error: function() {
                        Aurora.Masker.unmask($('sacpur52101_rfx_feedback_rlf_window').wrap);
                        return;
                    }
                });
            }
            
            function pur52101_rfx_feedback_ln_submit(header_record, item_ds) {
                var records = item_ds.getSelected();
                if (Aurora.isEmpty(records) || records.length == 0) {
                    Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.PLEASE_SELECT}');
                    return;
                }
                var data = {};
                var items = [];
                for (var i = 0;i < records.length;i++) {
                    if (records[i].get('status') == "SUBMITTED" && records[i].get('abandoned_flag') != 'Y') {
                        Aurora.showMessage('${l:PROMPT}', '${l:SACPUR5210.ITEM_TIP_HEAD}' + records[i].get('item_desc') + '${l:SACPUR5210.SUBMIT_AGAIN_REFUSE}');
                        return;
                    }
                    var item = records[i].data;
                    //物流询价时忽略该校验
                    var rfx_category = $('sacpur52101_rfx_feedback_rfq_header_ds').getAt(0).get('rfx_category');
                    if (rfx_category != 'RLF') {
                        if ((Aurora.isEmpty(records[i].get('current_fb_retail_price')) || Number(records[i].get('current_fb_retail_price')) == 0) && records[i].get('abandoned_flag') != 'Y') {
                            Aurora.showMessage('${l:PROMPT}', '${l:SACPUR5210.ITEM_TIP_HEAD}' + records[i].get('item_desc') + '${l:SACPUR5210.NULL_QUOTATION_NO_SUBMIT}');
                            return;
                        }
                    } else {
                        item.current_fb_retail_price = 0;
                    }
                    item.feedback_rfq_records = '';
                    items.push(item);
                }
                data['feedback_expiry_date_from'] = header_record.get('feedback_expiry_date_from');
                data['feedback_expiry_date_to'] = header_record.get('feedback_expiry_date_to');
                data['place_of_delivery'] = header_record.get('place_of_delivery');
                data['items'] = items;
                Aurora.Masker.mask($('sacpur52101_rfx_feedback_rlf_window').wrap, '${l:LOADING}');
            
                Aurora.request({
                    url: $('sacpur52101_rfx_feedback_ln_submit_link').getUrl(),
                    para: data,
                    success: function(result) {
                        Aurora.Masker.unmask($('sacpur52101_rfx_feedback_rlf_window').wrap);
                        sacpur52101RfxFeedbackRfqReturn();
                    },
                    failure: function() {
                        Aurora.Masker.unmask($('sacpur52101_rfx_feedback_rlf_window').wrap);
                        return;
                    },
                    error: function() {
                        Aurora.Masker.unmask($('sacpur52101_rfx_feedback_rlf_window').wrap);
                        return;
                    }
                });
            }
            
            function sacpur52101RfxFeedbackRfqSubmit() {
                var header_ds = $('sacpur52101_rfx_feedback_rfq_header_ds');
                var item_ds = $('sacpur52101_rfx_feedback_rfq_line_ds');
                if (!header_ds.validate()) {
                    return;
                }
                if (!item_ds.validate()) {
                    return;
                }
                var header_record = header_ds.getCurrentRecord();
                var status = header_record.get('status');
                //第一次提交整单提交
                if (status == 'NEW') {
                    pur52101_rfx_feedback_submit(header_record, item_ds);
                    //第一次提交以后则单行提交
                } else if (status == 'FEEDBACKING') {
                    pur52101_rfx_feedback_ln_submit(header_record, item_ds);
                }
            }
            
            function sacpur52101RfxFeedbackRfqReturn() {
                $('sacpur52101_rfx_feedback_rlf_window').close();
            }
            
            function sacpur52101_rfx_feedback_rfq_line_ds_update(ds, record, name, value, oldvalue) {
                if (name == 'current_fb_retail_price') {
                    var records = ds.getAll();
                    var head_ds = $('sacpur52101_rfx_feedback_rfq_header_ds');
                    var head_rec = head_ds.getCurrentRecord();
                    var total_amount = 0;
                    for (var i = 0;i < records.length;i++) {
                        var record1 = records[i];
                        var quantity = record1.get('quantity');
                        if (quantity == null) {
                            quantity = 0;
                        }
                        var current_fb_retail_price = record1.get('current_fb_retail_price');
                        if (current_fb_retail_price == null) {
                            current_fb_retail_price = 0;
                        }
                        total_amount = total_amount + quantity * current_fb_retail_price;
                    }
                    head_rec.set('total_amount', total_amount);
                }
                if (name == "abandoned_flag") {
                    var unit_price_configure = record.get('unit_price_configure');
                    var trans_cost_flag = record.get('trans_cost_flag');
                    if (value == 'Y' && oldvalue == 'N') {
                        record.set('current_fb_retail_price', '');
                        record.set('current_fb_wholesale_price', '');
                        record.set('current_fb_reason', '');
                        record.set('promised_date', '');
                        record.set('current_delivery_cycle', '');
                        // record.set('feedback_expiry_date_from', '');
                        // record.set('feedback_expiry_date_to', '');
                        record.set('trans_cost', '');
                        record.getMeta().getField('promised_date').setRequired(false);
                        // record.getMeta().getField('feedback_expiry_date_from').setRequired(false);
                        // record.getMeta().getField('feedback_expiry_date_to').setRequired(false);
                        record.getMeta().getField('current_fb_retail_price').setRequired(false);
                        record.getMeta().getField('trans_cost').setRequired(false);
                    } else {
                        record.getMeta().getField('promised_date').setRequired(false);
                        // record.getMeta().getField('feedback_expiry_date_from').setRequired(true);
                        // record.getMeta().getField('feedback_expiry_date_to').setRequired(true);
                        record.getMeta().getField('promised_date').setReadOnly(false);
                        // record.getMeta().getField('feedback_expiry_date_from').setReadOnly(false);
                        // record.getMeta().getField('feedback_expiry_date_to').setReadOnly(false);
                        if (unit_price_configure == 'Y') {
                            record.getMeta().getField('current_fb_retail_price').setRequired(true);
                            record.getMeta().getField('current_fb_retail_price').setReadOnly(false);
                        }
                        if (trans_cost_flag == 'Y') {
                            record.getMeta().getField('trans_cost').setRequired(true);
                            record.getMeta().getField('trans_cost').setReadOnly(false);
                        }
                    }
            
                }
                if (name == "tax_included_flag") {
                    if (value == 'N' && oldvalue == 'Y') {
                        record.set('tax_type_id', '');
                        record.set('tax_type_code', '');
                        record.set('tax_type_desc', '');
                        record.set('tax_type_rate', '');
                    }
            
                }
                if (name == 'current_fb_retail_price') {
                    if (!Aurora.isEmpty('tax_type_rate')) {
                        record.set('untax_price', ((value / (100 + parseInt(record.get('tax_type_rate')))) * 100).toFixed(4));
                    }
                }
            
                if (name == 'tax_type_rate') {
                    if (!Aurora.isEmpty('current_fb_retail_price')) {
                        record.set('untax_price', (record.get('current_fb_retail_price') / (100 + parseInt(value))) * 100);
                    }
                }
            }
            
            
            function sacpur52101_line_status_check(record) {
                var status = record.get('status');
                if (status == 'SUBMITTED') {
                    return false;
                }
                return true;
            }
            
            function sacpur52101_abandoned_flag_ef(record, name) {
                if (!sacpur52101_line_status_check(record)) {
                    return '';
                    //record.getMeta().getField('abandoned_flag').setReadOnly(true);
                } else {
                    return "sacpur52101_abandoned_flag_chb";
                }
            }
            
            function bargain_wholesale_price_check(record) {
                var bargain_wholesale_price = record.get("valid_bargain_wholesale_price");
                var valid_feedback_wholesale_price = record.get("valid_feedback_wholesale_price");
                if (Aurora.isEmpty(bargain_wholesale_price) && !Aurora.isEmpty(valid_feedback_wholesale_price)) {
                    return false;
                }
                return true;
            
            }
            
            
            function sacpur52101_date_dp_ef(record, name) {
                var abandoned_flag = record.get('abandoned_flag');
                if (abandoned_flag == 'Y' || !sacpur52101_line_status_check(record) || !bargain_wholesale_price_check(record)) {
                    return '';
                }
                return 'sacpur52101_date_dp';
            }
            
            function sacpur52101_current_fb_wholesale_price_ef(record, name) {
                var abandoned_flag = record.get('abandoned_flag');
                if (name == 'min_purchase' || name == 'min_package') {
                    if (abandoned_flag == 'Y' || !sacpur52101_line_status_check(record) || !bargain_wholesale_price_check(record)) {
                        record.getMeta().getField('min_purchase').setRequired(false);
                        record.getMeta().getField('min_package').setRequired(false);
                        return '';
                    }
                    return 'sacpur52101_min_purchase_package';
                }
                if (name == 'current_delivery_cycle') {
                    if (abandoned_flag == 'Y' || !sacpur52101_line_status_check(record) || !bargain_wholesale_price_check(record)) {
                        record.getMeta().getField('current_delivery_cycle').setRequired(false);
                        return '';
                    }
                    return 'sacpur52105_delivery_cycle_nb';
                }
                if (abandoned_flag == 'Y' || !sacpur52101_line_status_check(record) || !bargain_wholesale_price_check(record)) {
                    record.getMeta().getField('current_delivery_cycle').setRequired(false);
                    record.getMeta().getField('min_purchase').setRequired(false);
                    record.getMeta().getField('min_package').setRequired(false);
                    return '';
                }
            
                return 'sacpur52101_current_fb_wholesale_price_nf';
            }
            
            function sacpur52101_trans_cost_tf(record, name) {
            
                var abandoned_flag = record.get('abandoned_flag');
                var trans_cost_flag = record.get('trans_cost_flag');
                if (abandoned_flag == 'Y' || !sacpur52101_line_status_check(record) || !bargain_wholesale_price_check(record) || trans_cost_flag != 'Y') {
                    return '';
                }
                return 'sacpur52101_current_fb_reason_tf';
            
            }
            
            function sacpur52101_current_fb_reason_ef(record, name) {
                var abandoned_flag = record.get('abandoned_flag');
                if (abandoned_flag == 'Y' || !sacpur52101_line_status_check(record) || !bargain_wholesale_price_check(record)) {
                    return '';
                }
                return 'sacpur52101_current_fb_reason_tf';
            }
            
            function formatNumber2(value, decimalprecision) {
                if (Ext.isEmpty(value)) {
                    return '';
                }
            
                value = String(value).replace(/,/g, '');
                if (isNaN(value)) return '';
                if (decimalprecision || decimalprecision === 0)
            
            
                var point_value = value.split('.');
                var in_length = (point_value.length == 2) ? '.' + point_value[1] : '';
            
            
                if (in_length.length - 1 < decimalprecision) {
            
                    decimalprecision = in_length.length - 1
                };
                if (in_length.length == 0) {
                    decimalprecision = 0;
                }
            
                value = Number(value).toFixed(decimalprecision);
            
                var ps = value.split('.');
                var sub = (ps.length == 2) ? '.' + ps[1] : '';
            
            
                var whole = ps[0];
                var r = /(\d+)(\d{3})/;
                while (r.test(whole)) {
                    whole = whole.replace(r, '$1' + ',' + '$2');
                }
            
                Math.round()
                v = whole + sub;
                return v;
            }
            
            function pur52101_formatNumber_render(value, record, name) {
                return formatNumber2(value, 8);
            }
            
            
            //收回
            
            
            function sacpur5210_takeback_fun(value, record, name) {
                var header_record = $('sacpur52101_rfx_feedback_rfq_header_ds').getAt(0);
                //密封报价
                var sealed_bid_flag = header_record.get('sealed_bid_flag');
                var feedback_line_id = record.get('feedback_line_id');
                var header_status = record.get('header_status');
                var status = record.get('status');
                if (sealed_bid_flag == 'Y' && feedback_line_id && status == 'SUBMITTED') {
                    return '<a href="javascript:sacpur5210_takeback_executeFun(' + feedback_line_id + ',\'' + header_status + '\')">${l:PROMPT.TAKEBACK}</a>';
                }
            }
            
            function sacpur5210_takeback_executeFun(feedback_line_id, header_status) {
                Aurora.showConfirm('${l:WFL_MY_INSTANCE.TAKEBACK}', '${l:SACPUR5210.SURE_OR_WILL_BE_INVALID}', function() {
                    Aurora.Masker.mask($('sacpur52101_rfx_feedback_rlf_window').wrap, '${l:LOADING}');
            
                    Aurora.request({
                        url: $('sacpur52101_rfx_feedback_takeback_link').getUrl(),
                        para: {
                            'feedback_line_id': feedback_line_id,
                            'header_status': header_status
                        },
                        success: function(result) {
                            Aurora.Masker.unmask($('sacpur52101_rfx_feedback_rlf_window').wrap);
                            $('sacpur52101_rfx_feedback_rfq_line_ds').query();
                        },
                        failure: function() {
                            Aurora.Masker.unmask($('sacpur52101_rfx_feedback_rlf_window').wrap);
                            return;
                        },
                        error: function() {
                            Aurora.Masker.unmask($('sacpur52101_rfx_feedback_rlf_window').wrap);
                            return;
                        }
                    });
                }, null, 300, 100);
            }
            
            
            //比较两个日期的大小
            
            function sacpur5210_compareDate(start, end) {
            
                if (typeof(start) == 'string') {
                    start = new Date(start.replace(/-/g, "/"));
                }
            
                if (typeof(end) == 'string') {
                    end = new Date(end.replace(/-/g, "/"));
                }
                if (start > end) {
                    return false;
                }
                return true;
            }
            
            
            function sacpur5210_dateValidator(record, name, value) {
            
            
            
                if (name == 'feedback_expiry_date_from' || name == 'feedback_expiry_date_to') {
                    var feedback_expiry_date_from = record.get('feedback_expiry_date_from');
                    var feedback_expiry_date_to = record.get('feedback_expiry_date_to');
                    if ( !! feedback_expiry_date_to) {
                        if (!sacpur5210_compareDate(feedback_expiry_date_from, feedback_expiry_date_to)) {
                            return '${l:SACPUR5210.CANNOT_BE_LATER_THE_END_TIME}';
                        }
                    }
                    return true;
                }
            
                if (name == 'promised_date') {
                    var promised_date = record.get('promised_date');
                    var sysdate = new Date();
            
                    if ( !! promised_date) {
                        if (!sacpur5210_compareDate(sysdate, promised_date)) {
                            return '${l:SACPUR5210.CANNOT_BE_EARLIER_THE_CURRENT_TIME}';
                        }
                    }
                    return true;
                }
            }
            
            function sacpur52101_rfxFeedbackVendorQuote_renderFun(value, record, name) {
                var quote_header_id = record.get('quote_header_id');
                var abandoned_flag = record.get('abandoned_flag');
                if (abandoned_flag == 'N' && !Ext.isEmpty(quote_header_id)) {
                    if (sacpur52101_line_status_check(record)) {
                        return '<a href="javascript:sacpur52101_rfxFeedbackVendorQuote_openEditFun(' + record.get('feedback_line_id') + ',' + quote_header_id + ')">${l:PUR_RFX_QUOTE_TITLE}</a>';
                    } else {
                        return '<a href="javascript:sacpur52101_rfxFeedbackVendorQuote_openViewFun(' + record.get('feedback_line_id') + ',' + quote_header_id + ')">${l:PUR_RFX_QUOTE_TITLE}</a>';
                    }
                }
                return ''
            }
            
            
            function sacpur52101_rfxFeedbackVendorQuote_openEditFun(feedback_line_id, quote_header_id) {
                new Aurora.Window({
                    url: $('sacpur52101_rfx_feedback_vendor_quote_edit_link').getUrl() + '?feedback_line_id=' + feedback_line_id + '&quote_header_id=' + quote_header_id,
                    title: '${l:PUR_RFX_QUOTE_TITLE}',
                    id: 'sacpur5210_rfx_feedback_vendor_quote_edit_window',
                    width: 900,
                    height: 430
                });
            }
            
            function sacpur52101_rfxFeedbackVendorQuote_openViewFun(feedback_line_id, quote_header_id) {
                new Aurora.Window({
                    url: $('sacpur52101_rfx_feedback_vendor_quote_view_link').getUrl() + '?feedback_line_id=' + feedback_line_id + '&quote_header_id=' + quote_header_id,
                    title: '${l:PUR_RFX_QUOTE_TITLE}',
                    id: 'sacpur5210_rfx_feedback_vendor_quote_view_window',
                    width: 900,
                    height: 430
                });
            }
            
            //-----------------------------------------------------------------------------------------------------------
            //阶梯报价
            
            function pur5220_rfxLadderQuotationFunction(feedback_line_id, ladder_edit_flag) {
                new Aurora.Window({
                    url: $('pur5220_rfxLadderQuotation_link').getUrl() + '?feedback_line_id=' + feedback_line_id + '&ladder_edit_flag=' + ladder_edit_flag,
                    title: '${l:SACPUR5210.LADDER_QUOTES}',
                    id: 'pur5220_rfxLadderQuotation_window',
                    width: 500,
                    height: 300
                }).on('beforeclose', function() {
                    sacpur5210_rfxLadderQuotationDefaultPriceFunction();
                });
            }
            
            function pur5220_rfxLadderQuotationViewFunction(feedback_line_id) {
                new Aurora.Window({
                    url: $('pur5220_rfxLadderQuotationView_link').getUrl() + '?feedback_line_id=' + feedback_line_id,
                    title: '${l:SACPUR5210.LADDER_QUOTES}',
                    id: 'pur5220_rfxLadderQuotationView_window',
                    width: 500,
                    height: 300
                });
            }
            
            function sacpur52101_rfxLadderQuotationRenderFun(value, record, name) {
                if (name == 'ladder_quotation') {
                    var abandoned_flag = record.get('abandoned_flag');
                    var ladder_edit_flag = record.get('ladder_edit_flag');
                    var ladder_inquiry_flag = record.get('ladder_inquiry_flag');
                    if (ladder_inquiry_flag == 'N') {
                        return '-';
                    }
                    if (abandoned_flag == 'Y' || !sacpur52101_line_status_check(record) || !bargain_wholesale_price_check(record)) {
                        return '<a href="javascript:pur5220_rfxLadderQuotationViewFunction(' + record.get('feedback_line_id') + ')">${l:SACPUR5210.LADDER_QUOTES}</a>';
                    }
                    return '<a href="javascript:pur5220_rfxLadderQuotationFunction(' + record.get('feedback_line_id') + ',\'' + ladder_edit_flag + '\')">${l:SACPUR5210.LADDER_QUOTES}</a>';
                }
            }
            
            function sacpur5210_rfxLadderQuotationDefaultPriceFunction() {
                Aurora.request({
                    url: $('sacpur5210_rfxLadderQuotationDefaultPrice_link').getUrl(),
                    para: {
                        'feedback_line_id': $('sacpur52101_rfx_feedback_rfq_line_ds').getCurrentRecord().get('feedback_line_id')
                    },
                    success: function(res) {
                        var feedback_price = res.result.feedback_price;
                        if (feedback_price != 'NONE') {
                            $('sacpur52101_rfx_feedback_rfq_line_ds').getCurrentRecord().set('current_fb_retail_price', feedback_price);
                        }
                        return;
                    },
                    failure: function() {
                        return;
                    },
                    error: function() {
                        return;
                    }
                });
            }
            
            function sacpur52101_quotationRendererFunction(value, record, name) {
                var rfx_line_item_id = record.get('rfx_line_item_id');
                if (!rfx_line_item_id) {
                    return '-';
                } else {
                    return '<a href="javascript:sacpur52101_quotationEditFunction(' + rfx_line_item_id + ')">报价模型</a>';
                }
            }
            
            function sacpur52101_quotationEditFunction(rfx_line_item_id) {
                debugger;
                var record = $('sacpur52101_rfx_feedback_rfq_header_ds').getCurrentRecord();
                var logistics_quotation_code = record.get('logistics_quotation_code');
                var url;
                var id;
                var title;
                if (logistics_quotation_code == 'EXPRESS_FRAME') {
                    url = $('sacpur52101_expressFrame_maintain_link').getUrl();
                    id = 'sacpur52101_expressFrameEdit_window';
                    title = '快递框架模型';
                } else if (logistics_quotation_code == 'DOMESTIC_LOGISTICS_FRAME') {
                    url = $('sacpur52101_logisticsFrame_maintain_link').getUrl();
                    id = 'sacpur52101_logisticsFrameEdit_window';
                    title = '国内物流框架模型';
                } else if (logistics_quotation_code == 'VEHICLE_LOGISTICS_FRAME') {
                    url = $('sacpur52101_vehicleFrame_maintain_link').getUrl();
                    id = 'sacpur52101_vehicleFrameEdit_window';
                    title = '整车物流框架模型';
                }
            
                new Aurora.Window({
                    url: url + '?rfx_line_item_id=' + rfx_line_item_id + '&vendor_id=' + record.get('coop_company_id'),
                    title: title,
                    id: id,
                    fullScreen: true
                });
            }
            
            function sacpur5210_rfx_quote_header_go_import() {
                var quote_header_id = '${/parameter/@feedback_header_id}';
                new Aurora.Window({
                    url: $('sacpur52105_rfx_quote_import_link').getUrl() + '?quote_header_id=' + quote_header_id,
                    title: '${l:SACPUR5210.QUOTATION_IMPORT}',
                    id: 'sacpur5210_rfx_quote_header_go_import_window',
                    fullScreen: true
                }).on('close', function() {
                    $('sacpur52101_rfx_feedback_rfq_line_ds').query();
                });
            }
            //---------------------------------------------------------------------------------------
            
            //附件上传/下载
            
            function sacpur52101_RfxRender(value, record, name) {
                var rfx_line_item_id = record.get('rfx_line_item_id');
                var feedback_line_id = record.get('feedback_line_id');
                var item_atm_counts = record.get('item_atm_counts');
                var feedback_atm_counts = record.get('feedback_atm_counts');
            
                if (name == "item_attachment") {
                    if (!record.isNew && rfx_line_item_id) {
                        if (item_atm_counts == 0) {
                            return '<a href="javascript:sacpur52101_download_file(' + rfx_line_item_id + ')">${l:FND_ATM_LINES.ATM_DOWNLOAD}</a>';
                        } else {
                            return '<a href="javascript:sacpur52101_download_file(' + rfx_line_item_id + ')">${l:FND_ATM_LINES.ATM_DOWNLOAD}</a>' + '<img src="${/request/@context_path}/images/paperclip.png"/>';
                        }
            
                    }
                }
            
                if (name == "attachment") {
                    if (!record.isNew && feedback_line_id) {
                        if (feedback_atm_counts == 0) {
                            return '<a href="javascript:sacpur52101_upload_file(' + feedback_line_id + ')">${l:PROMPT.UPLOAD_DOWNLOAD}</a>';
                        } else {
                            return '<a href="javascript:sacpur52101_upload_file(' + feedback_line_id + ')">${l:PROMPT.UPLOAD_DOWNLOAD}</a>' + '<img src="${/request/@context_path}/images/paperclip.png"/>';
                        }
            
                    }
                }
            
                /*  if (name == "atm_flag") {
                 if (item_atm_counts > 0 || feedback_atm_counts > 0) {
                 return '<div style="margin-top:3px;margin-left:auto;margin-right:auto;vertical-align:middle;height:20px;line-height:20px;"><img src="${/request/@context_path}/images/paperclip.png"/></div>';
                 }
                 } */
            }
            
            function sacpur52101_download_file(rfx_line_item_id) {
                var url = "${/request/@context_path}/check_uploadFile.screen?table_name=PUR_RFX_LN_ITEMS&header_id=" + rfx_line_item_id;
                new Aurora.Window({
                    url: url,
                    title: '${l:HAP_DOWNLOAD}',
                    id: 'sacpur52101_download_window',
                    width: 500,
                    height: 500
                });
            }
            
            function sacpur52101_upload_file(id) {
                var url = "${/request/@context_path}/attachment_file_upload.screen?table_name=PUR_RFX_FEEDBACK_LINES&pkvalue=" + id;
                new Aurora.Window({
                    url: url,
                    title: '${l:HAP_UPLOAD_TITLE}',
                    id: 'sacpur52101_upload_window',
                    width: 500,
                    height: 500
                });
            }
            
            //Add by Hunter.Wang at 2016-04-14
            //新增报价行数、报价总价字段的计算逻辑
            //报价行数，供应商未放弃报价（已经填写单价）的物品行的数量
            //报价总价，报价行总单价*需求数量，汇总出来的值
            
            function sacpur52101RfxFeedbackRfqCountsAndToalPrice() {
                var ds = $('sacpur52101_rfx_feedback_rfq_header_ds');
                var record = ds.getCurrentRecord();
                var feedback_counts = 0;
                var feedback_total_price = 0;
                var item_ds = $('sacpur52101_rfx_feedback_rfq_line_ds');
                var item_records = item_ds.getAll();
                for (var i = 0;i < item_records.length;i++) {
                    if (!Aurora.isEmpty(item_records[i].get('current_fb_retail_price'))) {
                        feedback_counts++;
                        var current_fb_retail_price = item_records[i].get('current_fb_retail_price') * 1;
                        var quantity = item_records[i].get('quantity') * 1;
                        feedback_total_price = feedback_total_price + (current_fb_retail_price * quantity);
                    }
                }
                record.set('feedback_counts', feedback_counts);
                record.set('feedback_total_price', feedback_total_price);
            }
            
            //Add by Hunter.Wang at 2016-05-03
            //新增报价明细页面，附件上传按钮
            
            function sacpur5210RfxFeedbackRfqHeaderAtmUpload() {
                var url;
                var flag = $('sacpur52101_rfx_feedback_rfq_header_ds').getAt(0).get('closed_bidding_flag');
                if (flag == 'N') {
                    url = "${/request/@context_path}/attachment_file_upload.screen?table_name=PUR_RFX_FEEDBACK_HEADER&pkvalue=${/parameter/@feedback_header_id}";
                } else {
                    url = "${/request/@context_path}/modules/pur/SACPUR5210/pur_rfx_attachment_upload.screen?header_id=${/parameter/@feedback_header_id}";
                }
            
                new Aurora.Window({
                    url: url,
                    title: '${l:HAP_UPLOAD_TITLE}',
                    id: 'sacpur52101_upload_window',
                    width: 650,
                    height: 500
                });
            }
            
            function pur52101_rfxLnItemsGridRenderer(value, record, name) {
                if (name == "item_note") {
                    if (!Aurora.isEmpty(value) && value.length > 20) {
                        return '<a href="javascript:pur52101_rfxLnItemsView()">' + value + '</a>';
                    } else if (!Aurora.isEmpty(value) && value.length <= 20) {
                        return '<div>' + value + '</div>';
                    } else {
                        return '';
                    }
                }
            }
            
            function pur52101_rfxLnItemsView() {
                new Aurora.Window({
                    url: $('sacpur52101_rfx_item_note_view_rfq_link').getUrl(),
                    title: '${l:SACPUR5210.VIEW_MATERIAL_DESCRIPTION}',
                    id: 'sacpur52101_rfx_item_note_view_rfq_link_window',
                    width: 500,
                    height: 400
                });
            }
            
            
            // function getMyTime() {
            // var startDate = new Date();
            // var endDate = new Date(feedback_end_time);
            // var countDown = (endDate.getTime() - startDate.getTime()) / 1000;
            // // alert(startDate+'__'+endDate+'__'+countDown);
            // var day = parseInt(countDown / (24 * 60 * 60));
            // var h = parseInt(countDown / (60 * 60) % 24);
            // var m = parseInt(countDown / 60 % 60);
            // var s = parseInt(countDown % 60);
            // var obj = document.getElementById("remain_time");
            // if (obj) {
            // if (countDown <= 0) {
            // obj.innerHTML = "";
            // } else {
            // obj.innerHTML = day + "天" + h + "时" + m + '分' + s + '秒';
            // }
            // }
            
            
            // setTimeout('getMyTime()', 500);
            
            // }
            var first_load = 'Y';
            
            function pur5210DocmHeader_loadFun(ds) {
                var rfx_category = ds.getAt(0).get('rfx_category');
                if (rfx_category == 'RLF') {
                    document.getElementById('logistics_quotation_desc_id').style.display = 'block';
                    document.getElementById('quotation_title_id').style.display = 'none';
                } else {
                    document.getElementById('logistics_quotation_desc_id').style.display = 'none';
                    document.getElementById('quotation_title_id').style.display = 'block';
                }
                var rec = ds.getAt(0);
                left_time = rec.get('left_time');
                if (first_load == 'Y') {
                    jq('#countdown18').ClassyCountdown({
                        theme: "flat-colors-black",
                        end: jq.now() + left_time,
                    });
                }
                first_load = 'N';
            }
            
            
            function sacpur52101_rfx_feedback_rfq_line_ds_load(ds) {
                var records = ds.getAll();
                var head_ds = $('sacpur52101_rfx_feedback_rfq_header_ds');
                var head_rec = head_ds.getCurrentRecord();
                var total_amount = 0;
                var feedback_counts = 0;
                var feedback_total_price = 0;
                for (var i = 0;i < records.length;i++) {
                    var record = records[i];
                    if (!Aurora.isEmpty(record.get('current_fb_retail_price')) && !Aurora.isEmpty(record.get('tax_type_rate'))) {
                        record.set('untax_price', ((record.get('current_fb_retail_price') / (100 + parseInt(record.get('tax_type_rate')))) * 100).toFixed(4));
                    }
                    if (!Aurora.isEmpty(record.get('current_fb_retail_price'))) {
                        feedback_counts++; //报价行数
                    }
                    var quantity = record.get('quantity') ? record.get('quantity') : 0;
                    var current_fb_retail_price = record.get('current_fb_retail_price') ? record.get('current_fb_retail_price') : 0;
                    feedback_total_price = feedback_total_price + (current_fb_retail_price * quantity); //报价总价
                    total_amount = total_amount + quantity * current_fb_retail_price;
                    var abandoned_flag = record.get('abandoned_flag');
                    if (abandoned_flag == 'Y') {
                        record.getMeta().getField('current_fb_retail_price').setRequired(false);
            
                        record.getMeta().getField('promised_date').setRequired(false);
            
                        record.getMeta().getField('feedback_expiry_date_from').setRequired(false);
            
                        record.getMeta().getField('feedback_expiry_date_to').setRequired(false);
                        record.getMeta().getField('trans_cost').setRequired(false);
            
                    }
                    var trans_cost_flag = record.get('trans_cost_flag');
                    if (trans_cost_flag == 'Y' && abandoned_flag != 'Y') {
                        record.getMeta().getField('trans_cost').setRequired(true);
            
                    }
                    var tax_type_rate = record.getField('tax_type_rate');
                    var owner_business_group = record.get('owner_business_group');
                    tax_type_rate.setLovPara('business_group', owner_business_group);
            
                    //配置报价有效期
                    // var feedback_expiry_date_configure = record.get('feedback_expiry_date_configure');
                    // if (feedback_expiry_date_configure == 'required' && abandoned_flag != 'Y') {
                    // record.getMeta().getField('feedback_expiry_date_from').setRequired(true);
                    // record.getMeta().getField('feedback_expiry_date_to').setRequired(true);
                    // } else if (feedback_expiry_date_configure == 'not_required') {
                    // record.getMeta().getField('feedback_expiry_date_from').setRequired(false);
                    // record.getMeta().getField('feedback_expiry_date_to').setRequired(false);
                    // } else if (feedback_expiry_date_configure == 'not_maintain') {
                    // record.getMeta().getField('feedback_expiry_date_from').setRequired(false);
                    // record.getMeta().getField('feedback_expiry_date_to').setRequired(false);
                    // record.getMeta().getField('feedback_expiry_date_from').setReadOnly(true);
                    // record.getMeta().getField('feedback_expiry_date_to').setReadOnly(true);
                    // }
            
                    //配置报价单价
                    var unit_price_configure = record.get('unit_price_configure');
                    if (unit_price_configure == 'N') {
                        record.getMeta().getField('current_fb_retail_price').setRequired(false);
                    } else if (unit_price_configure == 'Y' && abandoned_flag != 'Y') {
                        record.getMeta().getField('current_fb_retail_price').setRequired(true);
                    }
                    //开启配置项则显示税前净价、税前金额、税额、总额字段
                    var item_value = '${/model/bg_item_rfx_14/record/@bg_config_item_value}';
                    if (!Aurora.isEmpty(item_value) && item_value == "N") {
                        $('sacpur52101_rfx_feedback_rfq_line_grid').hideColumn('net_price');
                        $('sacpur52101_rfx_feedback_rfq_line_grid').hideColumn('net_amount');
                        $('sacpur52101_rfx_feedback_rfq_line_grid').hideColumn('tax_amount');
                        $('sacpur52101_rfx_feedback_rfq_line_grid').hideColumn('total_amounts');
                    } else if (Aurora.isEmpty(item_value)) {
                        $('sacpur52101_rfx_feedback_rfq_line_grid').hideColumn('net_price');
                        $('sacpur52101_rfx_feedback_rfq_line_grid').hideColumn('net_amount');
                        $('sacpur52101_rfx_feedback_rfq_line_grid').hideColumn('tax_amount');
                        $('sacpur52101_rfx_feedback_rfq_line_grid').hideColumn('total_amounts');
                    }
                    //addby liumeiqi
                    //当采购方勾了报价数量标志，则隐藏需求数量
                    var is_quot_quantity_flag = head_ds.getAt(0).get('is_quot_quantity_flag');
                    if (is_quot_quantity_flag == 'Y') {
                        $('sacpur52101_rfx_feedback_rfq_line_grid').hideColumn('quantity');
                    }
                    //added_by 7211@20180115
                    //purpose 增加采购周期、最小采购量、最小包装量的配置
                    var delivery_cycle_configure = record.get('delivery_cycle_configure');
                    if (delivery_cycle_configure == 'N') {
                        record.getMeta().getField('current_delivery_cycle').setRequired(false);
                    } else if (delivery_cycle_configure == 'Y') {
                        record.getMeta().getField('current_delivery_cycle').setRequired(true);
                    }
                    //
                    var min_purchase_configure = record.get('min_purchase_configure');
                    if (min_purchase_configure == 'N') {
                        record.getMeta().getField('min_purchase').setRequired(false);
                    } else if (min_purchase_configure == 'Y') {
                        record.getMeta().getField('min_purchase').setRequired(true);
                    }
                    //
                    var min_package_configure = record.get('min_package_configure');
                    if (min_package_configure == 'N') {
                        record.getMeta().getField('min_package').setRequired(false);
                    } else if (min_package_configure == 'Y') {
                        record.getMeta().getField('min_package').setRequired(true);
                    }
            
                    if (Aurora.isEmpty(record.get('currency_desc'))) {
                        record.set('currency_desc', '人民币');
                        record.set('currency_code', 'CNY');
                    }
            
                    if (Aurora.isEmpty(record.get('quotation_id'))) {
                        if ('${/model/get_0407_category_id/record/@category_udf_id}' == record.get('p_category_udf_id') || '${/model/get_0407_category_id/record/@category_udf_id}' == record.get('pp_category_udf_id')) {
                            record.getMeta().getField('brand').setRequired(true);
                            record.getMeta().getField('place_of_product').setRequired(true);
                            record.getMeta().getField('spec').setRequired(true);
                            record.getMeta().getField('pur_cycle').setRequired(true);
                            record.getMeta().getField('warranty_period').setRequired(true);
                        }
                    } else {
                        record.getMeta().getField('current_fb_retail_price').setRequired(false);
                    }
                    if (record.get('ladder_inquiry_flag') == 'Y') {
                        record.getMeta().getField('current_fb_retail_price').setRequired(false);
                    }
                }
                head_rec.set('total_amount', total_amount ? total_amount : 0);
                head_rec.set('feedback_counts', feedback_counts ? feedback_counts : 0);
                head_rec.set('feedback_total_price', feedback_total_price ? feedback_total_price : 0);
            }
            
            function tax_edit_fn(record, name) {
                var tax_modify_flag = record.get('tax_modify_flag');
                if (tax_modify_flag == 'Y') {
                    return 'sacpur52101_tax_included_flag_cb';
                } else {
                    return '';
                }
            }
            
            function tax_edit_fn2(record, name) {
            
                var abandoned_flag = record.get('abandoned_flag');
                if (abandoned_flag == 'Y' || !sacpur52101_line_status_check(record) || !bargain_wholesale_price_check(record)) {
                    return '';
                }
                var tax_modify_flag = record.get('tax_modify_flag');
                if (tax_modify_flag == 'Y') {
                    if (record.get('tax_included_flag') == 'Y') {
                        record.getMeta().getField('tax_type_rate').setRequired(true);
                        return 'sacpur52101_tax_type_rate_lov';
                    } else {
                        record.getMeta().getField('tax_type_rate').setRequired(false);
                        return '';
                    }
                } else {
                    return '';
                }
            }
            //附件下载
            
            function pur52102_upload_renderer(value, record, name) {
                var atm_line_id = record.get('atm_line_id');
                var atm_counts = record.get('atm_counts');
            
                if (name == "attachment") {
                    if (!record.isNew && atm_line_id) {
                        return '<a href="javascript:pur52102_upload_file(' + atm_line_id + ')">${l:FND_ATM_LINES.ATM_DOWNLOAD}</a>';
                    }
                }
            
                if (name == "atm_flag") {
                    if (atm_counts > 0) {
                        return '<div style="margin-top:3px;margin-left:auto;margin-right:auto;vertical-align:middle;height:20px;line-height:20px;"><img src="${/request/@context_path}/images/paperclip.png"/></div>';
                    }
                }
            }
            
            function pur52102_upload_file(id) {
                var url = "${/request/@context_path}/check_uploadFile.screen?table_name=PUR_RFX_HEADERS&header_id=" + id;
                new Aurora.Window({
                    url: url,
                    title: '${l:FND_ATM_LINES.ATM_DOWNLOAD}',
                    id: 'pur52102_upload_window',
                    width: 850,
                    height: 500
                })
                /* .on('beforeclose', function() {
                 $('pur52102_rfx_ln_attachments').query();
                 });  */
            }
            
            
            //add by Hunter 2658 at 2018-04-23 in T2320
            //询报价相关模块，加上显示字段
            
            function sacpur52101_rfxFeedbackRfqLineGridRendererNetPrice(value, record, name) {
                //获取“显示净价”配置项的值
                var item_value = '${/model/bg_item_rfx_14/record/@bg_config_item_value}';
            
                if (name == "net_price") {
                    //开启配置项则显示此字段
                    if (!Aurora.isEmpty(item_value) && item_value == "Y") {
                        var current_fb_retail_price = record.get("current_fb_retail_price");
                        var tax_type_rate = record.get("tax_type_rate");
                        if (Aurora.isEmpty(current_fb_retail_price)) {
                            current_fb_retail_price = 0;
                        }
                        if (Aurora.isEmpty(tax_type_rate)) {
                            tax_type_rate = 0;
                        }
            
                        //净价=单价/（1+税率%）
                        var net_price = current_fb_retail_price / (1 + (tax_type_rate / 100));
                        net_price = net_price.toFixed(2);
                        return '<div>' + net_price + '</div>';
                    } else {
                        return '';
                    }
                }
                if (name == "net_amount") {
                    //开启配置项则显示此字段
                    if (!Aurora.isEmpty(item_value) && item_value == "Y") {
                        var current_fb_retail_price = record.get("current_fb_retail_price");
                        var tax_type_rate = record.get("tax_type_rate");
                        var quantity = record.get("quantity");
                        if (Aurora.isEmpty(current_fb_retail_price)) {
                            current_fb_retail_price = 0;
                        }
                        if (Aurora.isEmpty(tax_type_rate)) {
                            tax_type_rate = 0;
                        }
            
                        //净价=单价/（1+税率%）
                        var net_price = current_fb_retail_price / (1 + (tax_type_rate / 100));
                        net_price = net_price.toFixed(2);
                        //税前金额=税前净价x数量
                        var net_amount = net_price * quantity;
                        net_amount = net_amount.toFixed(2);
                        return '<div>' + net_amount + '</div>';
                    } else {
                        return '';
                    }
                }
                if (name == "tax_amount") {
                    //开启配置项则显示此字段
                    if (!Aurora.isEmpty(item_value) && item_value == "Y") {
                        var current_fb_retail_price = record.get("current_fb_retail_price");
                        var tax_type_rate = record.get("tax_type_rate");
                        var quantity = record.get("quantity");
                        if (Aurora.isEmpty(current_fb_retail_price)) {
                            current_fb_retail_price = 0;
                        }
                        if (Aurora.isEmpty(tax_type_rate)) {
                            tax_type_rate = 0;
                        }
            
                        //净价=单价/（1+税率%）
                        var net_price = current_fb_retail_price / (1 + (tax_type_rate / 100));
                        net_price = net_price.toFixed(2);
                        //税前金额=税前净价x数量
                        var net_amount = net_price * quantity;
                        net_amount = net_amount.toFixed(2);
                        //税额=（单价-税前净价）x数量
                        var tax_amount = (current_fb_retail_price - net_price) * quantity;
                        tax_amount = tax_amount.toFixed(2);
                        return '<div>' + tax_amount + '</div>';
                    } else {
                        return '';
                    }
                }
                if (name == "total_amounts") {
                    //开启配置项则显示此字段
                    if (!Aurora.isEmpty(item_value) && item_value == "Y") {
                        var current_fb_retail_price = record.get("current_fb_retail_price");
                        var tax_type_rate = record.get("tax_type_rate");
                        var quantity = record.get("quantity");
                        if (Aurora.isEmpty(current_fb_retail_price)) {
                            current_fb_retail_price = 0;
                        }
                        if (Aurora.isEmpty(tax_type_rate)) {
                            tax_type_rate = 0;
                        }
            
                        //净价=单价/（1+税率%）
                        var net_price = current_fb_retail_price / (1 + (tax_type_rate / 100));
                        net_price = net_price.toFixed(2);
                        //税前金额=税前净价x数量
                        var net_amount = net_price * quantity;
                        //税额=（单价-税前净价）x数量
                        var tax_amount = (current_fb_retail_price - net_price) * quantity;
                        //总额=税前金额+税额
                        var total_amounts = net_amount + tax_amount;
                        total_amounts = total_amounts.toFixed(2);
                        return '<div>' + total_amounts + '</div>';
                    } else {
                        return '';
                    }
                }
            }
            
            function quote_quantity_editorFun(record, name) {
                if (name == 'quote_quantity') {
                    var is_quot_quantity_flag = $('sacpur52101_rfx_feedback_rfq_header_ds').getAt(0).get('is_quot_quantity_flag');
                    if (is_quot_quantity_flag == 'Y') {
                        record.getField('quote_quantity').setRequired(true);
                        return 'sacpur52105_quote_quantity_nf';
                    } else {
                        record.getField('quote_quantity').setRequired(false);
                        return '';
                    }
                }
            }
            
            function pur52101_rfxQuotationDetail(value, record, name) {
                var header_rec = $('sacpur52101_rfx_feedback_rfq_header_ds').getCurrentRecord();
                if (!Aurora.isEmpty(header_rec.get('quotation_id'))) {
                    return '<a href="javascript:pur_quotation_detail(' + record.get('es_inv_org_id') + ')">报价</a>';
                } else {
                    return '';
                }
            }
            
            function pur_quotation_detail(inv_org_id) {
                var header_rec = $('sacpur52101_rfx_feedback_rfq_header_ds').getCurrentRecord();
                var url = $('template_link').getUrl() + '?quotation_id=' + header_rec.get('quotation_id') + '&vendor_id=' + header_rec.get('coop_company_id') + '&currency_code=' + header_rec.get('currency_code') + '&business_unit_id=' + inv_org_id;
                new Aurora.Window({
                    id: 'rfx5010_template_win',
                    title: '模板',
                    url: url,
                    fullScreen: true
                });
            }
        ]]></script>
        <a:dataSets>
            <a:dataSet id="sacpur52101_rfx_feedback_rfq_header_ds" model="pur.SACPUR5210.pur_rfx_feedback_rfq_header" queryUrl="${/request/@context_path}/autocrud/pur.SACPUR5210.pur_rfx_feedback_rfq_header/query?feedback_header_id=${/parameter/@feedback_header_id}">
                <a:datas dataSource="/model/header_record_rp"/>
                <a:fields>
                    <!-- <a:field name="feedback_expiry_date_from" required="true"/>
                    <a:field name="feedback_expiry_date_to" required="true"/>
                    <a:field name="place_of_delivery" required="true"/> -->
                    <a:field name="tax_included_flag" readOnly="true"/>
                    <a:field name="sealed_bid_flag" readOnly="true"/>
                    <a:field name="department_approve_flag" readOnly="true"/>
                </a:fields>
                <a:events>
                    <a:event name="load" handler="pur5210DocmHeader_loadFun"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="pur51303_currency_ds" autoCreate="true" fetchAll="true" loadData="true">
                <a:datas dataSource="/model/pur5130_currency_source"/>
            </a:dataSet>
            <a:dataSet id="sacpur52101_rfx_feedback_rfq_line_ds" autoCreate="true" autoQuery="true" fetchAll="true" model="pur.SACPUR5210.pur_rfx_feedback_rfq_line" queryUrl="${/request/@context_path}/autocrud/pur.SACPUR5210.pur_rfx_feedback_rfq_line/query?feedback_header_id=${/parameter/@feedback_header_id}" selectable="true">
                <a:fields>
                    <!-- <a:field name="ladder_quotation" readOnly="true" validator="check_value_from_ladder"/> -->
                    <a:field name="currency_desc" defaultValue="人民币" displayField="currency_name" options="pur51303_currency_ds" returnField="currency_code" valueField="currency_code">
                        <a:mapping>
                            <a:map from="currency_name" to="currency_desc"/>
                            <a:map from="currency_code" to="currency_code"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="exchange_rate" defaultValue="1"/>
                    <a:field name="currency_code" defaultValue="CNY"/>
                    <a:field name="abandoned_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="promised_date" required="false"/>
                    <a:field name="current_fb_retail_price"/>
                    <!-- <a:field name="feedback_expiry_date_from" required="true" requiredMessage="${l:PUR5210.FEEDBACK_EXPIRY_DATE}" validator="sacpur5210_dateValidator"/>
                    <a:field name="feedback_expiry_date_to" required="true" requiredMessage="${l:PUR5210.FEEDBACK_EXPIRY_DATE}" validator="sacpur5210_dateValidator"/> -->
                    <a:field name="promised_date" validator="sacpur5210_dateValidator"/>
                    <a:field name="tax_included_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="samples_requested" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="trans_cost_flag" checkedValue="Y" readOnly="true" uncheckedValue="N"/>
                    <a:field name="tax_type_rate" lovHeight="480" lovService="public.fnd_tax_type_code_lov" lovWidth="500" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_TAX_CODE}" title="PUR_REQ_LINES.TAX_TYPE_RATE">
                        <a:mapping>
                            <a:map from="tax_type_id" to="tax_type_id"/>
                            <a:map from="tax_type_code" to="tax_type_code"/>
                            <a:map from="description" to="tax_type_desc"/>
                            <a:map from="tax_type_rate" to="tax_type_rate"/>
                        </a:mapping>
                    </a:field>
                </a:fields>
                <a:events>
                    <a:event name="update" handler="sacpur52101_rfx_feedback_rfq_line_ds_update"/>
                    <a:event name="load" handler="sacpur52101_rfx_feedback_rfq_line_ds_load"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="sacpur52101_rfx_feedback_rfq_record_ds" bindName="feedback_rfq_records" bindTarget="sacpur52101_rfx_feedback_rfq_line_ds" fetchAll="true" model="pur.SACPUR5210.pur_rfx_feedback_rfq_record"/>
            <a:dataSet id="pur52102_rfx_ln_attachments_1" autoQuery="true" fetchAll="true" model="public.fnd_atm_lines" queryUrl="${/request/@context_path}/autocrud/public.fnd_atm_lines/query?source_table_name=PUR_RFX_HEADERS&amp;source_pk_value=${/parameter/@rfx_header_id}">
                <a:fields>
                    <a:field name="atm_line_id"/>
                </a:fields>
            </a:dataSet>
        </a:dataSets>
        <a:screenBody>
            <a:screenTopToolbar>
                <a:toolbarButton click="sacpur52101RfxFeedbackRfqSave" text="HAP_SAVE" width="100"/>
                <a:toolbarButton click="sacpur52101RfxFeedbackRfqSubmit" text="HAP_SUBMIT" width="100"/>
                <a:gridButton bind="sacpur52101_rfx_feedback_rfq_line_grid" className="item-rbtn-blue button-excel" type="excel" width="100"/>
                <a:toolbarButton className="item-rbtn-blue button-excel" click="sacpur5210_rfx_quote_header_go_import" text="PROMPT.IMPORT" width="100"/>
                <a:toolbarButton click="sacpur5210RfxFeedbackRfqHeaderAtmUpload" text="ATM.UPLOAD_ATTACHMENT" width="100"/>
                <a:toolbarButton click="sacpur52101RfxFeedbackRfqReturn" text="HAP_BACK" width="100"/>
                <a:switch test="/parameter/@atm_counts">
                    <a:case value="1">
                        <div style="float:right;margin-top:10px;margin-left:auto;margin-right:20px;vertical-align:middle;">
                            <img src="${/request/@context_path}/images/paperclip.png"/>
                        </div>
                    </a:case>
                </a:switch>
            </a:screenTopToolbar>
            <a:hBox>
                <a:vBox labelWidth="120" padding="0">
                    <a:hBox labelWidth="120">
                        <a:textField name="rfx_number" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_HEADERS.RFX_NUMBER" readOnly="true"/>
                        <a:textField name="company_desc" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="FND_COMPANIES.CLIENT" readOnly="true"/>
                        <a:textField name="title" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_HEADERS.TITLE" readOnly="true"/>
                    </a:hBox>
                    <a:hBox labelWidth="120">
                        <a:comboBox name="rfx_category_desc" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_HEADERS.RFX_CATEGORY" readOnly="true"/>
                        <a:comboBox name="rfx_method_desc" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_HEADERS.RFX_METHOD" readOnly="true"/>
                        <a:lov name="business_unit_name" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="FND_BUSINESS_UNITS.BUSINESS_UNIT" readOnly="true"/>
                        <!-- <a:comboBox name="payment_method_desc" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_HEADERS.PAYMENT_METHOD_ID" readOnly="true"/> -->
                    </a:hBox>
                    <a:hBox labelWidth="120">
                        <!-- <a:comboBox name="currency_desc" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_HEADERS.CURRENCY_CODE" readOnly="true"/> -->
                        <!-- <a:numberField name="exchange_rate" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" decimalPrecision="8" prompt="PUR_RFX_HEADERS.EXCHANGE_RATE" readOnly="true" renderer="Aurora.formatNumber"/> -->
                        <a:textField name="status_desc" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_HEADERS.STATUS" readOnly="true"/>
                        <a:dateTimePicker name="feedback_end_time" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_HEADERS.FEEDBACK_END_TIME" readOnly="true"/>
                        <a:comboBox name="auction_direction_desc" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_HEADERS.AUCTION_DIRECTION" readOnly="true"/>
                    </a:hBox>
                    <a:hBox labelWidth="120">
                        <a:textField name="feedback_counts" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_FEEDBACK_HEADERS.FEEDBACK_COUNTS" readOnly="true"/>
                        <a:textField name="feedback_total_price" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_FEEDBACK_HEADERS.TOTAL_AMOUNT" readOnly="true"/>
                        <!-- <a:textField name="place_of_delivery" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_HEADERS.PLACE_OF_DELIVERY"/> -->
                    </a:hBox>
                    <!-- <a:hBox labelWidth="120">
                        <a:datePicker name="feedback_expiry_date_from" align="center" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_FEEDBACK_LINES.FEEDBACK_EXPIRY_DATE_FROM" renderer="Aurora.formatDate"/>
                        <a:datePicker name="feedback_expiry_date_to" align="center" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_FEEDBACK_LINES.FEEDBACK_EXPIRY_DATE_TO" renderer="Aurora.formatDate"/>
                    </a:hBox> -->
                    <a:hBox labelWidth="120">
                        <!-- <a:textField name="comments" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_HEADERS.COMMENTS" readOnly="true" width="707"/> -->
                        <!-- 修改备注字段显示框 by zoulonghui 2018/01/22 -->
                        <a:textArea name="comments" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_HEADERS.COMMENTS" readOnly="true" width="707"/>
                    </a:hBox>
                    <a:hBox>
                        <a:accordionPanel id="pur5120_accordion_dim" height="180" showIcon="true" singleMode="false" width="900">
                            <a:accordions>
                                <a:accordion prompt="PUR_RFX_HEADERS.OTHER_INFO" selected="false">
                                    <a:vBox>
                                        <a:hBox labelWidth="120">
                                            <a:checkBox name="sealed_bid_flag" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_HEADERS.SEALED_BID_FLAG" readOnly="true" width="152"/>
                                            <a:comboBox name="open_rule_desc" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_HEADERS.OPEN_RULE" readOnly="true"/>
                                            <a:comboBox name="auction_ranking_desc" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_HEADERS.AUCTION_RANKING" readOnly="true"/>
                                        </a:hBox>
                                        <a:hBox labelWidth="120">
                                            <a:dateTimePicker name="creation_date_desc" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_HEADERS.CREATION_DATE" readOnly="true"/>
                                            <!-- <a:textField name="place_of_delivery" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_HEADERS.PLACE_OF_DELIVERY" readOnly="true"/> -->
                                            <a:textField name="round" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_HEADERS.ROUND" readOnly="true"/>
                                            <div id="quotation_title_id">
                                                <a:hBox labelWidth="118">
                                                    <a:lov name="quotation_title" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_QUOTATION_TITLE" readOnly="true"/>
                                                </a:hBox>
                                            </div>
                                            <div id="logistics_quotation_desc_id">
                                                <a:hBox labelWidth="112">
                                                    <a:comboBox name="logistics_quotation_desc" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_QUOTATION_TITLE" readOnly="true"/>
                                                </a:hBox>
                                            </div>
                                        </a:hBox>
                                        <a:hBox labelWidth="120">
                                            <a:comboBox name="source_type_desc" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_HEADERS.SOURCE_TYPE" readOnly="true"/>
                                            <a:comboBox name="price_category_desc" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_HEADERS.PRICE_CATEGORY" readOnly="true"/>
                                            <!-- <a:checkBox name="department_approve_flag" bindTarget="sacpur52101_rfx_feedback_rfq_header_ds" prompt="PUR_RFX_HEADERS.DEPARTMENT_APPROVE_FLAG" readOnly="true" width="152"/> -->
                                        </a:hBox>
                                    </a:vBox>
                                </a:accordion>
                            </a:accordions>
                        </a:accordionPanel>
                    </a:hBox>
                </a:vBox>
                <div class="circle">
                    <span style="display:block;margin-left:10px; margin-top:20px;"><![CDATA[${l:SACPUR5210.HOW_LONG_IS_QUOTATION_DEADLINE}
                    ]]></span>
                    <div id="countdown18" class="ClassyCountdownDemo"/>
                </div>
            </a:hBox>
            <a:tabPanel height="630" marginWidth="40">
                <a:tabs>
                    <a:tab prompt="PROMPT.BASIC_INFOMATION" width="120">
                        <a:grid id="sacpur52101_rfx_feedback_rfq_line_grid" autoAppend="false" bindTarget="sacpur52101_rfx_feedback_rfq_line_ds" height="280" marginWidth="50">
                            <a:columns>
                                <a:column name="line_num" align="right" prompt="PUR_RFX_LN_ITEMS.LINE_NUM" width="30"/>
                                <a:column name="logistics_quotation" align="center" prompt="报价模型" renderer="sacpur52101_quotationRendererFunction" width="80"/>
                            </a:columns>
                            <a:editors>
                                <a:numberField id="sacpur52101_current_fb_wholesale_price_nf" allowNegative="false" decimalPrecision="8"/>
                                <a:numberField id="sacpur52101_min_purchase_package" allowNegative="false" decimalPrecision="2"/>
                                <a:numberField id="sacpur52105_delivery_cycle_nb" allowDecimals="false" allowNegative="false"/>
                                <a:numberField id="sacpur52105_quote_quantity_nf" allowDecimals="false" allowNegative="false"/>
                                <a:numberField id="sacpur52105_exchange_rate_nf" allowNegative="false" decimalPrecision="4"/>
                                <a:datePicker id="sacpur52101_date_dp"/>
                                <a:textField id="sacpur52101_current_fb_reason_tf"/>
                                <a:checkBox id="sacpur52101_tax_included_flag_cb"/>
                                <a:lov id="sacpur52101_tax_type_rate_lov"/>
                                <a:comboBox id="sacpur5210_currency_cmb"/>
                                <a:checkBox id="sacpur52101_abandoned_flag_chb" checkedValue="Y" uncheckedValue="N"/>
                            </a:editors>
                        </a:grid>
                        <a:grid id="sacpur52101_rfx_feedback_rfq_record_grid" bindTarget="sacpur52101_rfx_feedback_rfq_record_ds" height="280" marginWidth="50">
                            <a:columns>
                                <a:column name="feedback_count" align="left" prompt="PUR_RFX_FEEDBACK_RECORDS.FEEDBACK_COUNT" width="40"/>
                                <a:column name="feedback_time" align="left" prompt="PUR_RFX_FEEDBACK_RECORDS.FEEDBACK_TIME" width="80"/>
                                <a:column name="feedback_by_desc" align="left" prompt="PUR_RFX_FEEDBACK_RECORDS.FEEDBACK_BY" width="80"/>
                                <a:column name="feedback_retail_price" align="right" prompt="PUR_RFX_FEEDBACK_RECORDS.FEEDBACK_RETAIL_PRICE" renderer="pur52101_formatNumber_render" width="50"/>
                                <a:column name="feedback_total_price" align="right" prompt="PUR_RFX_FEEDBACK_LINES.VALID_FB_TOTAL_PRICE" renderer="pur52101_formatNumber_render" width="50"/>
                                <a:column name="feedback_wholesale_price" align="right" prompt="PUR_RFX_FEEDBACK_RECORDS.FEEDBACK_WHOLESALE_PRICE" renderer="pur52101_formatNumber_render" width="80"/>
                                <a:column name="feedback_reason" align="left" prompt="PUR_RFX_FEEDBACK_RECORDS.FEEDBACK_REASON" width="100"/>
                                <a:column name="bargained_time" align="left" prompt="PUR_RFX_FEEDBACK_RECORDS.BARGAINED_TIME" width="80"/>
                                <a:column name="bargain_by_desc" align="left" prompt="PUR_RFX_FEEDBACK_RECORDS.BARGAIN_BY" width="80"/>
                                <a:column name="bargain_retail_price" align="right" prompt="PUR_RFX_FEEDBACK_RECORDS.BARGAIN_RETAIL_PRICE" renderer="pur52101_formatNumber_render" width="50"/>
                                <a:column name="bargain_reason" align="left" prompt="PUR_RFX_FEEDBACK_RECORDS.BARGAIN_REASON" width="100"/>
                            </a:columns>
                        </a:grid>
                    </a:tab>
                    <a:tab prompt="PROMPT.OTHER_INFO" width="120">
                        <a:grid id="sacpur52101_rfx_feedback_rfq_line_other_grid" autoAppend="false" bindTarget="sacpur52101_rfx_feedback_rfq_line_ds" height="280" marginWidth="50">
                            <a:columns>
                                <a:column name="line_num" align="right" prompt="PUR_RFX_LN_ITEMS.LINE_NUM" width="30"/>
                                <a:column align="center" prompt="PROMPT.TAKEBACK" renderer="sacpur5210_takeback_fun" width="80"/>
                                <!-- <a:column name="valid_fb_wholesale_price" align="right" prompt="PUR_RFX_FEEDBACK_LINES.VALID_FB_WHOLESALE_PRICE" renderer="pur52101_formatNumber_render" width="50"/> -->
                                <a:column name="valid_bargain_retail_price" align="right" prompt="PUR_RFX_FEEDBACK_LINES.VALID_BARGAIN_RETAIL_PRICE" renderer="pur52101_formatNumber_render" width="50"/>
                                <!-- <a:column name="valid_bargain_wholesale_price" align="right" prompt="PUR_RFX_FEEDBACK_LINES.VALID_BARGAIN_WHOLESALE_PRICE" renderer="pur52101_formatNumber_render" width="50"/> -->
                                <a:column name="valid_bargain_by_desc" align="right" prompt="PUR_RFX_FEEDBACK_LINES.VALID_BARGAIN_BY" width="60"/>
                                <a:column name="valid_bargain_reason" align="left" prompt="PUR_RFX_FEEDBACK_LINES.VALID_BARGAIN_REASON" width="100"/>
                                <a:column name="item_category_desc" align="left" prompt="PUR_RFX_LN_ITEMS.ITEM_CATEGORY_ID" width="100"/>
                                <a:column name="feedback_range" align="left" prompt="PUR_RFX_LN_ITEMS.FEEDBACK_RANGE" width="40"/>
                                <!-- <a:column name="item_note" align="left" prompt="PUR_RFX_LN_ITEMS.ITEM_NOTE" renderer="pur52101_rfxLnItemsGridRenderer" width="100"/> -->
                                <!-- <a:column name="item_parameter_config" align="left" prompt="PUR_RFX_LN_ITEMS.ITEM_PARAMETER_CONFIG" width="60"/> -->
                                <!--  <a:column name="work_num" prompt="PUR_RFX_LN_ITEMS.WORK_NUMBER" width="70"/>
                                <a:column name="bom_num" prompt="PUR_RFX_LN_ITEMS.BOM_NUMBER" width="70"/> -->
                                <!-- <a:column name="atm_flag" align="center" renderer="sacpur52101_RfxRender" width="20"/> -->
                                <a:column name="item_attachment" align="left" prompt="PUR_RFX_LN_ITEMS.REQ_ATTACHMENT" renderer="sacpur52101_RfxRender" width="50"/>
                                <a:column name="attachment" align="left" prompt="PUR_RFX_LINE_VENDOR.ATTACHMENT" renderer="sacpur52101_RfxRender" width="50"/>
                            </a:columns>
                        </a:grid>
                    </a:tab>
                    <a:tab prompt="SACPUR5210.ATM_FILE_LIST" width="120">
                        <a:grid id="pur52102_atm_grid_1" bindTarget="pur52102_rfx_ln_attachments_1" height="320" marginWidth="140" navBar="true">
                            <a:columns>
                                <!-- <a:column name="line_number" align="center" prompt="FND_ATM_LINES.LINE_NUMBER" width="50"/> -->
                                <!-- <a:column name="atm_file" align="left" prompt="FND_ATM_LINES.ATM_FILE" width="250"/> -->
                                <a:column name="atm_desc" align="center" prompt="FND_ATM_LINES.ATM_DESC" width="100"/>
                                <a:column name="upload_user_name" align="center" prompt="FND_ATM_LINES.UPLOAD_USER_NAME" width="100"/>
                                <!-- <a:column name="download_count" align="center" prompt="FND_ATM_LINES.DOWNLOAD_COUNT" width="100"/> -->
                                <a:column name="atm_flag" align="center" renderer="pur52102_upload_renderer" width="20"/>
                                <a:column name="attachment" align="center" prompt="FND_ATM_LINES.ATM_DOWNLOAD" renderer="pur52102_upload_renderer" width="100"/>
                            </a:columns>
                        </a:grid>
                    </a:tab>
                </a:tabs>
            </a:tabPanel>
            <flex-segment dataset="sacpur52101_rfx_feedback_rfq_line_ds" grid="sacpur52101_rfx_feedback_rfq_line_grid" headerIdPath="/parameter/@feedback_header_id" headerTableName="PUR_RFX_FEEDBACK_HEADERS" pageType="edit" templateFieldName="template_id" type="grid_expanded"/>
        </a:screenBody>
    </a:view>
</a:screen>

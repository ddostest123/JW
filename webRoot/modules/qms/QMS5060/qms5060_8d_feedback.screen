<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: 7211
    $Date: 2015-1-6 上午09:46:29  
    $Revision: 1.0  
    $Purpose: 8D反馈
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application">
    <a:init-procedure>
        <a:model-query model="qms.QMS5050.get_current_employee_name" rootPath="qms5060_current_user"/>
        <a:model-query defaultWhereClause="flex_value_set_code = &apos;QMS_8D_MEMEBER_ROLE_TYPE&apos;" fetchAll="true" model="qms.QMS5050.fnd_flex_value_sets_query" rootPath="qms5060_8d_member_role_type_data"/>
    </a:init-procedure>
    <a:view>
        <a:link id="qms7100_inspection_maintain_link" url="${/request/@context_path}/modules/qms/QMS7100/qms7100_inspection_maintain.screen"/>
        <a:link id="qms5060_8d_update_link" url="${/request/@context_path}/modules/qms/QMS5060/qms5060_8d_vendor_modify_save.svc"/>
        <a:link id="qms5060_8d_submit_link" model="qms.QMS5060.qms_8d_query" modelaction="execute"/>
        <a:link id="qms5060_8d_approve_opinion_link" url="${/request/@context_path}/modules/qms/QMS5060/qms_8d_operation_records_query.screen"/>
        <a:link id="qms5060_quality_notice_maintain_link" url="${/request/@context_path}/modules/qms/QMS7120/qms7120_quality_notice_maintain.screen"/>
        <a:link id="qms5060_8d_histories_link" url="${/request/@context_path}/modules/qms/QMS5060/qms_8d_histories_query.screen"/>
        <script><![CDATA[
            var qms5060_data_source = 'MANUAL';
            
            function qms5060_8d_maintain_return() {
                $('qms5060_8d_feedback_win').close();
            }
            
            function qms5060_8d_maintain_upload() {
                new Aurora.Window({
                    id: 'qms5060_8d_upload_win',
                    title: '${l:QMS_8D.UPLOAD_ATTACHMENT}',
                    url: $('qms5060_8d_upload_link').getUrl() + '?pkvalue=${/parameter/@qms_8d_id}&qms_8d_file=QMS_8D_FILE&qms_8d_measure_file=QMS_8D_MEASURE',
                    width: 900,
                    height: 500
                });
            }
            
            function qms5060_8d_save() {
                var ds = $('qms5060_8d_maintain_ds');
                var member_ds = $('qms5060_8d_members_ds');
                if (ds.validate() && member_ds.validate()) {
                    var record = ds.getCurrentRecord();
                    var para = record.data;
                    para['8d_members'] = $('qms5060_8d_members_ds').getJsonData(false);
                    Aurora.Masker.mask($('qms5060_8d_feedback_win').wrap, '${l:QMS5050.BEING_SUBMITTED}');
                    Aurora.request({
                        url: $('qms5060_8d_update_link').getUrl(),
                        para: para,
                        success: function() {
                            Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.SAVE_SUCCESS}', function() {
                                ds.setQueryParameter('qms_8d_id', '${/parameter/@qms_8d_id}');
                                ds.query();
                                member_ds.setQueryParameter('qms_8d_id', '${/parameter/@qms_8d_id}');
                                member_ds.query();
                                Aurora.Masker.unmask($('qms5060_8d_feedback_win').wrap);
                            });
                        },
                        error: function() {
                            Aurora.Masker.unmask($('qms5060_8d_feedback_win').wrap);
                        },
                        failure: function() {
                            Aurora.Masker.unmask($('qms5060_8d_feedback_win').wrap);
                        },
                        scope: this
                    });
                }
            }
            
            //8D反馈提交
            
            function qms5060_8d_release() {
                var member_ds = $('qms5060_8d_members_ds');
                //如果8d成员为空，则不可发布
                if (member_ds.getAll().length === 0) {
                    Aurora.showMessage('${l:PROMPT}', '${l:QMS_8D.PLEASE_MAINTAIN_TEAM_MEMBER}', function() {});
                } else {
                    var ds = $('qms5060_8d_maintain_ds');
                    var record = ds.getCurrentRecord();
                    if (ds.validate()) {
                        if (!record.dirty) {
                            Aurora.showConfirm('${l:PROMPT}', '${l:QMS_8D.COMFIRM_INFO_AND_SUBMIT}', function() {
                                Aurora.Masker.mask($('qms5060_8d_feedback_win').wrap, '${l:QMS5050.BEING_SUBMITTED}');
                                Aurora.request({
                                    url: $('qms5060_8d_submit_link').getUrl(),
                                    para: record.data,
                                    success: function() {
                                        Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.OPERATION_SUCCESS}', function() {
                                            Aurora.Masker.unmask($('qms5060_8d_feedback_win').wrap);
                                            qms5060_8d_maintain_return();
                                        });
                                    },
                                    error: function() {
                                        Aurora.Masker.unmask($('qms5060_8d_feedback_win').wrap);
                                    },
                                    failure: function() {
                                        Aurora.Masker.unmask($('qms5060_8d_feedback_win').wrap);
                                    },
                                    scope: this
                                });
                            }, function() {}, 300, 100);
                        } else {
                            Aurora.showMessage('${l:PROMPT}', '${l:QMS5050.DATA_IS_NOT_SAVED}');
                            return;
                        }
                    }
                }
            }
            
            function qms5060_member_email_validate(record, name, value) {
                if (value) {
                    var myReg = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,4})+$/;
                    if (myReg.test(value)) {
                        return true;
                    }
                    return '${l:PROMPT.INCORRECT_EMAIL_FORMAT}';
                }
                return true;
            }
            
            function qms5060_d47_date_validate(record, name, value) {
                // if (value) {
                // var myReg = /^\w+([\.-]?\w+)*@\w+([\.-]?\w+)*(\.\w{2,4})+$/;
                // if (myReg.test(value)) {
                // return true;
                // }
                // return '${l:PROMPT.INCORRECT_EMAIL_FORMAT}';
                // }
                // return true;
                if (!Aurora.isEmpty(value)) {
                    if (name == 'attribute_2') {
            
            
                        if (Aurora.isEmpty(record.get('attribute_1'))) {
                            return 'D4完成日期不能为空';
            
                        }
            
            
                        if (value < record.get('attribute_1')) {
                            return 'D5完成日期不能小于D4';
            
                        }
            
                        return true;
            
                    }
                    if (name == 'attribute_3') {
            
                        if (Aurora.isEmpty(record.get('attribute_2'))) {
                            return 'D5完成日期不能为空';
            
                        }
            
                        if (value < record.get('attribute_2') && !Aurora.isEmpty(value)) {
                            return 'D6完成日期不能小于D5';
            
                        }
                        return true;
                    }
                    if (name == 'attribute_4') {
            
                        if (Aurora.isEmpty(record.get('attribute_3'))) {
                            return 'D6完成日期不能为空';
            
                        }
            
                        if (value < record.get('attribute_3') && !Aurora.isEmpty(value)) {
                            return 'D7完成日期不能小于D6';
            
                        }
                        return true;
                    }
            
                } else {
                    return true;
                }
            
            }
            
            function qms5060_8d_feedback_load_handler(ds) {
                var record = ds.getCurrentRecord();
            
                //手工创建
                //永久措施反馈中、永久措施审核拒绝状态的8D，“永久纠正措施”除GRID里的内容必填
                //if(record.get('data_source') == 'MANUAL'){
                if (record.get('status') == 'PER_MEASURE_WAITING' || record.get('status') == 'PER_MEASURE_REJECTED') {
                    record.getField('prevent_occur_measure').setRequired(true);
                    record.getField('prevent_check_measure').setRequired(true);
                    record.getField('permanent_measure_effect').setRequired(true);
                } else {
                    record.getField('prevent_occur_measure').setRequired(false);
                    record.getField('prevent_check_measure').setRequired(false);
                    record.getField('permanent_measure_effect').setRequired(false);
                }
                // }
            
                //手工创建
                //已发布、措施审核拒绝状态的8D，“临时围堵措施——针对后续生产”必填
                //措施详述
                // if(record.get('data_source') == 'MANUAL'){
                if (record.get('status') == 'RELEASED' || record.get('status') == 'MEASURE_REJECTED') {
                    record.getField('measure_desc').setRequired(true);
                    //record.getField('measure_check').setRequired(true);
                } else {
                    record.getField('measure_desc').setRequired(false);
                    //record.getField('measure_check').setRequired(false);
                }
                //  }
            
                //永久措施反馈中、永久措施审核拒绝状态且问题类型为“实物问题”的8D，“根本原因分析”必填
                if (record.get('status') == 'PER_MEASURE_WAITING' || record.get('status') == 'PER_MEASURE_REJECTED') {
                    if (record.get('issue_type') == '10') {
                        record.getField('reason_type_display').setRequired(true);
                        record.getField('reason_desc').setRequired(true);
                        record.getField('unhappen_desc').setRequired(true);
                    } else {
                        record.getField('reason_type_display').setRequired(false);
                        record.getField('reason_desc').setRequired(false);
                        record.getField('unhappen_desc').setRequired(false);
                    }
                } else {
                    record.getField('reason_type_display').setRequired(false);
                    record.getField('reason_desc').setRequired(false);
                    record.getField('unhappen_desc').setRequired(false);
                }
            
            
                //如果问题类型是实物问题、项目问题，则当前者值为“是”时，此字段为必填。
                if (record.get('issue_type') == '10') {
                    if (record.get('inventory_affect_flag') == 'Y') {
                        record.getField('inventory_affect_measure_display').setRequired(true);
                    } else {
                        record.getField('inventory_affect_measure_display').setRequired(false);
                    }
                    if (record.get('process_affect_flag') == 'Y') {
                        record.getField('process_affect_measure_display').setRequired(true);
                    } else {
                        record.getField('process_affect_measure_display').setRequired(false);
                    }
                    if (record.get('transporting_affect_flag') == 'Y') {
                        record.getField('transporting_affect_measure_display').setRequired(true);
                    } else {
                        record.getField('transporting_affect_measure_display').setRequired(false);
                    }
                    if (record.get('custom_stock_affect_flag') == 'Y') {
                        record.getField('custom_stock_affect_measure_display').setRequired(true);
                    } else {
                        record.getField('custom_stock_affect_measure_display').setRequired(false);
                    }
                }
            }
            
            function qms5060_8d_feedback_update_handler(ds, record, name, value, oldvalue) {
                if (name == 'inventory_affect_flag') {
                    if (value) {
                        if (value == 'Y') {
                            if (record.get('issue_type') == '10' || record.get('issue_type') == '50') {
                                record.getField('inventory_affect_measure_display').setRequired(true);
                            } else {
                                record.getField('inventory_affect_measure_display').setRequired(false);
                            }
                        } else {
                            record.getField('inventory_affect_measure_display').setRequired(false);
                        }
                    } else {
                        record.getField('inventory_affect_measure_display').setRequired(false);
                    }
                }
                if (name == 'process_affect_flag') {
                    if (value) {
                        if (value == 'Y') {
                            if (record.get('issue_type') == '10' || record.get('issue_type') == '50') {
                                record.getField('process_affect_measure_display').setRequired(true);
                            } else {
                                record.getField('process_affect_measure_display').setRequired(false);
                            }
                        } else {
                            record.getField('process_affect_measure_display').setRequired(false);
                        }
                    } else {
                        record.getField('process_affect_measure_display').setRequired(false);
                    }
                }
                if (name == 'transporting_affect_flag') {
                    if (value) {
                        if (value == 'Y') {
                            if (record.get('issue_type') == '10' || record.get('issue_type') == '50') {
                                record.getField('transporting_affect_measure_display').setRequired(true);
                            } else {
                                record.getField('transporting_affect_measure_display').setRequired(false);
                            }
                        } else {
                            record.getField('transporting_affect_measure_display').setRequired(false);
                        }
                    } else {
                        record.getField('transporting_affect_measure_display').setRequired(false);
                    }
                }
                if (name == 'custom_stock_affect_flag') {
                    if (value) {
                        if (value == 'Y') {
                            if (record.get('issue_type') == '10' || record.get('issue_type') == '50') {
                                record.getField('custom_stock_affect_measure_display').setRequired(true);
                            } else {
                                record.getField('custom_stock_affect_measure_display').setRequired(false);
                            }
                        } else {
                            record.getField('custom_stock_affect_measure_display').setRequired(false);
                        }
                    } else {
                        record.getField('custom_stock_affect_measure_display').setRequired(false);
                    }
                }
            }
            
            function qms5060_8d_approve_opinion_view() {
                new Aurora.Window({
                    id: 'qms5070_8d_operation_record_win',
                    title: '${l:PROMPT.OPERATION_RECORD}',
                    url: $('qms5060_8d_approve_opinion_link').getUrl() + '?qms_8d_id=${/parameter/@qms_8d_id}',
                    width: 600,
                    height: 550
                });
            }
            
            function qms5060_quality_detial_query() {
                var record = $('qms5060_8d_maintain_ds').getCurrentRecord();
                if (record.get('data_source_id')) {
                    new Aurora.Window({
                        id: 'qms7120_notice_quality_maintain_win',
                        title: '${l:QMS5050.QUALITY_NOTICE_DETAIL}',
                        url: $('qms5060_quality_notice_maintain_link').getUrl() + '?notice_header_id=' + record.get('data_source_id'),
                        fullScreen: true
                    });
                } else {
                    Aurora.showMessage('${l:PROMPT}', '${l:QMS5050.NO_QUALITY_NOTICE_INFO}');
                    return;
                }
            }
            
            
            //查看8D历史版本
            
            function qms5060_8d_histories() {
                var qms_8d_id = $('qms5060_8d_maintain_ds').getCurrentRecord().get('qms_8d_id');
                new Aurora.Window({
                    id: 'qms5060_8d_histories_win',
                    title: '${l:QMS_8D.8D_HISTORY_VERSION}',
                    url: $('qms5060_8d_histories_link').getUrl() + '?qms_8d_id=' + qms_8d_id,
                    width: 600,
                    height: 550
                });
            }
            
            function qms5050_query_deliver_inspection() {
                var record = $('qms5060_8d_maintain_ds').getCurrentRecord();
                var inspection_id = record.get('data_source_id');
                if (inspection_id) {
                    new Aurora.Window({
                        id: 'qms7100_inspection_maintain_win',
                        title: '${l:QMS7100.MY_DELIVERY_INSPECTION}',
                        url: $('qms7100_inspection_maintain_link').getUrl() + '?inspection_id=' + inspection_id,
                        fullScreen: true
                    });
                } else {
                    Aurora.showMessage('${l:PROMPT}', '没有绑定送货单信息！');
                    return;
                }
            }
        ]]></script>
        <a:dataSets>
            <a:dataSet id="qms5060_8d_member_role_type_ds">
                <a:datas dataSource="qms5060_8d_member_role_type_data"/>
            </a:dataSet>
            <a:dataSet id="qms5060_8d_maintain_ds" autoCreate="true" autoQuery="true" model="qms.QMS5060.qms_8d_query" queryUrl="${/request/@context_path}/autocrud/qms.QMS5060.qms_8d_query/query?qms_8d_id=${/parameter/@qms_8d_id}">
                <a:fields>
                    <a:field name="status"/>
                    <a:field name="inv_organization_code"/>
                    <a:field name="ica_require_date"/>
                    <a:field name="pca_require_date"/>
                    <a:field name="issue_desc"/>
                    <a:field name="created_date"/>
                    <a:field name="issue_type_display" displayField="flex_desc" options="qms5060_8d_issue_type_ds" returnField="issue_type" valueField="flex_value"/>
                    <a:field name="status_display" displayField="flex_desc" options="qms5060_8d_status_ds" returnField="status" valueField="flex_value"/>
                    <a:field name="data_source_desc_display" displayField="flex_desc" options="qms5060_8d_data_source_desc_ds" returnField="data_source_desc" valueField="flex_value"/>
                    <a:field name="data_source_display" displayField="flex_desc" options="qms5060_8d_data_source_ds" returnField="data_source" valueField="flex_value"/>
                    <a:field name="measure_desc"/>
                    <a:field name="inventory_affect_flag_display" displayField="code_value_name" options="qms5060_yes_no_ds" required="true" returnField="inventory_affect_flag" valueField="code_value"/>
                    <a:field name="process_affect_flag_display" displayField="code_value_name" options="qms5060_yes_no_ds" required="true" returnField="process_affect_flag" valueField="code_value"/>
                    <a:field name="transporting_affect_flag_display" displayField="code_value_name" options="qms5060_yes_no_ds" required="true" returnField="transporting_affect_flag" valueField="code_value"/>
                    <a:field name="custom_stock_affect_flag_display" displayField="code_value_name" options="qms5060_yes_no_ds" required="true" returnField="custom_stock_affect_flag" valueField="code_value"/>
                    <a:field name="other_process_flag_display" displayField="code_value_name" options="qms5060_yes_no_ds" returnField="other_process_flag" valueField="code_value"/>
                    <a:field name="other_item_flag_display" displayField="code_value_name" options="qms5060_yes_no_ds" returnField="other_item_flag" valueField="code_value"/>
                    <a:field name="other_place_flag_display" displayField="code_value_name" options="qms5060_yes_no_ds" returnField="other_place_flag" valueField="code_value"/>
                    <a:field name="fmea_flag_display" displayField="code_value_name" options="qms5060_yes_no_ds" returnField="fmea_flag" valueField="code_value"/>
                    <a:field name="control_flag_display" displayField="code_value_name" options="qms5060_yes_no_ds" returnField="control_flag" valueField="code_value"/>
                    <a:field name="flowchart_flag_display" displayField="code_value_name" options="qms5060_yes_no_ds" returnField="flowchart_flag" valueField="code_value"/>
                    <a:field name="project_deal_flag_display" displayField="code_value_name" options="qms5060_yes_no_ds" returnField="project_deal_flag" valueField="code_value"/>
                    <a:field name="inventory_affect_measure_display" displayField="flex_desc" options="qms5060_8d_temp_measure_content_ds" required="true" returnField="inventory_affect_measure" valueField="flex_value"/>
                    <a:field name="process_affect_measure_display" displayField="flex_desc" options="qms5060_8d_temp_measure_content_ds" required="true" returnField="process_affect_measure" valueField="flex_value"/>
                    <a:field name="transporting_affect_measure_display" displayField="flex_desc" options="qms5060_8d_temp_measure_content_ds" required="true" returnField="transporting_affect_measure" valueField="flex_value"/>
                    <a:field name="custom_stock_affect_measure_display" displayField="flex_desc" options="qms5060_8d_temp_measure_content_ds" required="true" returnField="custom_stock_affect_measure" valueField="flex_value"/>
                    <a:field name="reason_type_display" displayField="flex_desc" options="qms5060_8d_reason_type_ds" returnField="reason_type" valueField="flex_value"/>
                    <a:field name="takeback_flag_display" displayField="flex_desc" options="qms5060_8d_oa_takeback_flag_ds" returnField="takeback_flag" valueField="flex_value"/>
                    <a:field name="srga_flag_display" displayField="code_value_name" options="qms5060_yes_no_ds" returnField="srga_flag" valueField="code_value"/>
                    <a:field name="approve_action_display" displayField="flex_desc" options="qms5060_8d_approve_action_ds" returnField="approve_action" valueField="flex_value"/>
                    <a:field name="importance_degree_display" displayField="flex_desc" options="qms5060_8d_importance_degree_ds" returnField="importance_degree" valueField="flex_value"/>
                    <a:field name="urgency_degree_display" displayField="flex_desc" options="qms5060_8d_urgency_degree_ds" returnField="urgency_degree" valueField="flex_value"/>
                    <a:field name="version" readOnly="true"/>
                    <a:field name="display_po_number" readOnly="true"/>
                    <a:field name="asn_number" readOnly="true"/>
                    <a:field name="lots_num" readOnly="true"/>
                    <a:field name="item_code" autoComplete="true" autoCompleteField="item_code" lovAutoQuery="false" lovHeight="530" lovService="qms.QMS5050.inv_system_items_vl_lov?enabled_flag=Y" lovWidth="530" title="QMS_8D.ITEM_QUERY">
                        <a:mapping>
                            <a:map from="item_id" to="item_id"/>
                            <a:map from="item_code" to="item_code"/>
                            <a:map from="item_desc" to="item_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="sampling_quantity"/>
                    <a:field name="unit" readOnly="true"/>
                    <a:field name="repeat_happen_flag" readOnly="true"/>
                    <a:field name="abnormal_source" readOnly="true"/>
                    <a:field name="inventory_affect_desc" required="true"/>
                    <a:field name="process_affect_desc" required="true"/>
                    <a:field name="transporting_affect_desc" required="true"/>
                    <a:field name="custom_stock_affect_desc" required="true"/>
                    <a:field name="item_reivew_count" required="true"/>
                    <a:field name="item_trouble_count" required="true"/>
                    <a:field name="finish_date_new" required="true"/>
                    <a:field name="measure_check" required="true"/>
                    <a:field name="sop_flag_display" displayField="code_value_name" options="qms5060_yes_no_ds" returnField="sop_flag" valueField="code_value"/>
                    <a:field name="audit_form_flag_display" displayField="code_value_name" options="qms5060_yes_no_ds" returnField="audit_form_flag" valueField="code_value"/>
                    <a:field name="others_flag_display" displayField="code_value_name" options="qms5060_yes_no_ds" returnField="others_flag" valueField="code_value"/>
                    <a:field name="attribute_1"/>
                    <a:field name="attribute_2" validator="qms5060_d47_date_validate"/>
                    <a:field name="attribute_3" validator="qms5060_d47_date_validate"/>
                    <a:field name="attribute_4" validator="qms5060_d47_date_validate"/>
                    <a:field name="attribute_5"/>
                    <a:field name="attribute_6"/>
                    <a:field name="attribute_7"/>
                </a:fields>
                <a:events>
                    <!-- <a:event name="update" handler="qms5060_8d_feedback_update_handler"/> -->
                    <a:event name="load" handler="qms5060_8d_feedback_load_handler"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="qms5060_stage_leader_ds" lookupCode="QMS_STAGE_LEADER"/>
            <a:dataSet id="qms5060_8d_members_ds" autoQuery="true" fetchAll="true" model="qms.qms_8d_members" queryUrl="${/request/@context_path}/autocrud/qms.qms_8d_members/query?qms_8d_id=${/parameter/@qms_8d_id}" selectable="true">
                <a:fields>
                    <a:field name="qms_8d_id" defaultValue="${/parameter/@qms_8d_id}"/>
                    <a:field name="stage_leader" displayField="code_value_name" options="qms5060_stage_leader_ds" required="true" returnField="stage_leader_code" valueField="code_value"/>
                    <a:field name="stage_leader_code"/>
                    <a:field name="name" required="true"/>
                    <a:field name="role_display" displayField="flex_desc" options="qms5060_8d_member_role_type_ds" returnField="role" valueField="flex_value"/>
                    <a:field name="phone_number" required="true"/>
                    <a:field name="email" validator="qms5060_member_email_validate"/>
                </a:fields>
            </a:dataSet>
        </a:dataSets>
        <a:screenBody>
            <a:screenTopToolbar>
                <a:toolbarButton click="qms5060_8d_save" text="PROMPT.SAVE" width="100"/>
                <a:toolbarButton click="qms5060_8d_release" text="PROMPT.SUBMIT" width="100"/>
                <a:toolbarButton click="qms5050_query_deliver_inspection" text="查询进料异常单" width="120"/>
                <!-- <a:toolbarButton id="qms5060_quality_detial_btn" click="qms5060_quality_detial_query" text="QMS_8D.VIEW_QUALITY_NOTICE" width="100"/> -->
                <a:toolbarButton click="qms5060_8d_approve_opinion_view" text="QMS_8D.WFL_WORKFLOW_CHECK_SUG" width="100"/>
                <a:toolbarButton click="qms5060_8d_histories" text="QMS_8D.HISTORY_VERSION" width="100"/>
                <a:toolbarButton click="qms5060_8d_maintain_upload" text="QMS_8D.UPLOAD_ATTACHMENT" width="100"/>
                <a:toolbarButton click="qms5060_8d_maintain_return" text="HAP_BACK" width="100"/>
            </a:screenTopToolbar>
            <a:fieldSet title="QMS_8D.STAGE_AUDIT_TITLE" width="1100">
                <!--                 <a:hBox labelWidth="110">
                    <a:textField name="approve_action_display" bindTarget="qms5060_8d_maintain_ds" prompt="QMS_8D.APPROVE_ACTION" readOnly="true" width="150"/>
                </a:hBox> -->
                <a:hBox labelWidth="110">
                    <a:textArea name="approve_opinion" bindTarget="qms5060_8d_maintain_ds" height="70" prompt="QMS_8D.APPROVE_OPINION" readOnly="true" width="950"/>
                </a:hBox>
            </a:fieldSet>
            <a:fieldSet column="1" title="PROMPT.BASIC_INFOMATION" width="1100">
                <a:hBox labelWidth="110">
                    <a:textField name="qms_8d_title" bindTarget="qms5060_8d_maintain_ds" prompt="QMS_8D.QMS_8D_TITLE" readOnly="true" width="687"/>
                    <a:numberField name="version" allowDecimals="true" bindTarget="qms5060_8d_maintain_ds" decimalPrecision="1" width="150"/>
                </a:hBox>
                <a:hBox labelWidth="110">
                    <a:textField name="qms_8d_code" bindTarget="qms5060_8d_maintain_ds" prompt="8D编号" readOnly="true" width="150"/>
                    <a:datePicker name="send_date" bindTarget="qms5060_8d_maintain_ds" prompt="发出日期" readOnly="true" width="150"/>
                    <!-- <a:textField name="version" bindTarget="qms5050_8d_maintain_ds" prompt="版本" width="150" /> -->
                    <a:lov name="coop_company_desc" bindTarget="qms5060_8d_maintain_ds" prompt="PUR_VENDORS.VENDOR_NAME" readOnly="true" width="150"/>
                    <a:comboBox name="abnormal_source" bindTarget="qms5060_8d_maintain_ds" prompt="异常来源" width="150"/>
                    <!-- <a:textField name="status_display" bindTarget="qms5050_8d_maintain_ds" prompt="QMS_8D.STATUS_DISPLAY" readOnly="true" width="150"/> -->
                    <!-- <a:textField name="created_by_name" bindTarget="qms5050_8d_maintain_ds" readOnly="true" width="150"/> -->
                    <!-- <a:textField name="created_date" bindTarget="qms5050_8d_maintain_ds" readOnly="true" width="150"/> -->
                </a:hBox>
                <!--                 <a:hBox labelWidth="100">
                    <a:lov name="company_desc" bindTarget="qms5050_8d_maintain_ds" prompt="FND_COMPANIES.COMPANY" width="150"/>
                    <a:lov name="inv_organization_code" bindTarget="qms5050_8d_maintain_ds" readOnly="true" width="150"/>
                    <a:textField name="inv_organization_desc" bindTarget="qms5050_8d_maintain_ds" readOnly="true" width="150"/>
                    <a:textField name="project_code" bindTarget="qms5050_8d_maintain_ds" width="150"/>
                </a:hBox> -->
                <a:hBox labelWidth="110">
                    <a:lov name="company_desc" bindTarget="qms5060_8d_maintain_ds" prompt="FND_COMPANIES.COMPANY" readOnly="true" width="150"/>
                    <a:lov name="inv_organization_code" bindTarget="qms5060_8d_maintain_ds" prompt="库存组织代码" readOnly="true" width="150"/>
                    <a:textField name="inv_organization_desc" bindTarget="qms5060_8d_maintain_ds" prompt="库存组织描述" readOnly="true" width="150"/>
                    <a:textField name="data_source_display" bindTarget="qms5060_8d_maintain_ds" prompt="PROMPT.DATA_SOURCE" readOnly="true" width="150"/>
                    <!--                     <a:lov name="coop_company_code" bindTarget="qms5050_8d_maintain_ds" prompt="PUR_VENDORS.VENDOR_CODE" width="150"/>
                    <a:textField name="coop_company_desc" bindTarget="qms5050_8d_maintain_ds" prompt="PUR_VENDORS.VENDOR_NAME" readOnly="true" width="150"/>
                    <a:lov name="item_code" bindTarget="qms5050_8d_maintain_ds" width="150"/>
                    <a:textField name="item_name" bindTarget="qms5050_8d_maintain_ds" readOnly="true" width="150"/> -->
                </a:hBox>
                <a:hBox labelWidth="110">
                    <a:dateTimePicker name="ica_require_date" bindTarget="qms5060_8d_maintain_ds" prompt="3D要求时间" readOnly="true" renderer="Aurora.formatDateTime" width="150"/>
                    <a:datePicker name="pca_require_date" bindTarget="qms5060_8d_maintain_ds" prompt="8D要求日期" readOnly="true" width="150"/>
                    <a:textField name="discovery" bindTarget="qms5060_8d_maintain_ds" prompt="发现人" readOnly="true" width="150"/>
                    <a:datePicker name="discovery_date" bindTarget="qms5060_8d_maintain_ds" prompt="发现日期" readOnly="true" renderer="Aurora.formatDateTime" width="150"/>
                </a:hBox>
                <!-- <a:hBox labelWidth="100"> -->
                <!-- <a:textField name="data_source_desc_display" bindTarget="qms5050_8d_maintain_ds" prompt="QMS_8D.DATA_SOURCE_DESC" readOnly="true" width="150"/> -->
                <!-- <a:textField name="data_source_code" bindTarget="qms5050_8d_maintain_ds" readOnly="true" width="150"/> -->
                <!-- <a:textField name="relation_num" bindTarget="qms5050_8d_maintain_ds" prompt="QMS5050.RELATION_NUMBER" width="150"/> -->
                <!-- </a:hBox> -->
                <!--                 <a:hBox labelWidth="100">
                    <a:dateTimePicker name="ica_require_date" bindTarget="qms5050_8d_maintain_ds" dayRenderer="qms5050_rendererDay" renderer="Aurora.formatDateTime" width="150"/>
                    <a:datePicker name="pca_require_date" bindTarget="qms5050_8d_maintain_ds" dayRenderer="qms5050_rendererDay" width="150"/>
                </a:hBox>
                <a:hBox labelWidth="100"> 
                    <a:textField name="display_po_number" bindTarget="qms5050_8d_maintain_ds" prompt="采购订单" width="150"/>
                    <a:textField name="asn_number" bindTarget="qms5050_8d_maintain_ds" prompt="送货单" width="150"/>
                    <a:textField name="lots_num" bindTarget="qms5050_8d_maintain_ds" prompt="批次号" width="150"/>
                </a:hBox> -->
                <!-- <a:hBox labelWidth="100"> -->
                <!-- <a:lov name="display_po_number" bindTarget="qms5050_8d_maintain_ds" prompt="采购订单" width="150"/> -->
                <!-- <a:textField name="display_po_number" bindTarget="qms5050_8d_maintain_ds" prompt="采购订单" width="150"/>
                    <a:textField name="asn_number" bindTarget="qms5050_8d_maintain_ds" prompt="送货单" width="150"/>
                    <a:textField name="lots_num" bindTarget="qms5050_8d_maintain_ds" prompt="批次号" width="150"/>
                </a:hBox> -->
                <!--                 <a:hBox labelWidth="100">
                    <a:textField name="comments" bindTarget="qms5050_8d_maintain_ds" width="924"/>
                </a:hBox> -->
            </a:fieldSet>
            <a:fieldSet title="QMS_8D.ISSUE_DESC_TITLE">
                <!--                 <a:hBox labelWidth="110">
                    <a:textField name="customer_name" bindTarget="qms5060_8d_maintain_ds" prompt="客户名称" readOnly="true" width="150"/>
                    <a:textField name="complaints" bindTarget="qms5060_8d_maintain_ds" prompt="投诉事件" readOnly="true" width="150"/>
                    <a:textField name="complaint_location" bindTarget="qms5060_8d_maintain_ds" prompt="投诉位置" readOnly="true" width="150"/>
                    <a:textField name="order_num" bindTarget="qms5060_8d_maintain_ds" prompt="订单号" readOnly="true" width="150"/>
                </a:hBox> -->
                <a:hBox labelWidth="110">
                    <!-- <a:textField name="shipments" bindTarget="qms5060_8d_maintain_ds" prompt="出货事件" readOnly="true" width="150"/> -->
                    <!-- <a:textField name="shipping_qty" bindTarget="qms5060_8d_maintain_ds" prompt="出货数量" readOnly="true" width="150"/> -->
                    <a:lov name="item_code" bindTarget="qms5060_8d_maintain_ds" prompt="物料编码" readOnly="true" width="150"/>
                    <a:textField name="item_name" bindTarget="qms5060_8d_maintain_ds" prompt="物料描述" readOnly="true" width="150"/>
                    <a:textField name="unit" bindTarget="qms5060_8d_maintain_ds" prompt="单位" width="150"/>
                    <a:numberField name="sampling_quantity" allowDecimals="false" bindTarget="qms5060_8d_maintain_ds" prompt="抽样数量" readOnly="true" width="150"/>
                </a:hBox>
                <a:hBox labelWidth="110">
                    <a:numberField name="bad_quantity" allowDecimals="false" bindTarget="qms5060_8d_maintain_ds" prompt="不良数量" readOnly="true" width="150"/>
                    <a:numberField name="adverse_rate" allowDecimals="true" bindTarget="qms5060_8d_maintain_ds" decimalPrecision="2" prompt="不良率" readOnly="true" width="150"/>
                    <a:textField name="issue_type_display" bindTarget="qms5060_8d_maintain_ds" prompt="QMS_8D.ISSUE_TYPE_DISPLAY" readOnly="true" width="150"/>
                    <a:textField name="importance_degree_display" bindTarget="qms5060_8d_maintain_ds" prompt="QMS_8D.IMPORTANCE_DEGREE" readOnly="true" width="150"/>
                </a:hBox>
                <a:hBox labelWidth="110">
                    <a:textField name="urgency_degree_display" bindTarget="qms5060_8d_maintain_ds" prompt="QMS_8D.URGENCY_DEGREE" readOnly="true" width="150"/>
                    <a:checkBox name="repeat_happen_flag" bindTarget="qms5060_8d_maintain_ds" prompt="是否重复发生"/>
                </a:hBox>
                <a:hBox labelWidth="110">
                    <a:textArea name="issue_desc" bindTarget="qms5060_8d_maintain_ds" height="70" readOnly="true" width="950"/>
                </a:hBox>
            </a:fieldSet>
            <a:fieldSet title="QMS_8D.GROUP_MEMBER_TITLE" width="1100">
                <a:grid bindTarget="qms5060_8d_members_ds" height="150" style="margin-left:113px;" width="954">
                    <a:toolBar>
                        <a:button type="add"/>
                        <a:button type="delete"/>
                    </a:toolBar>
                    <a:columns>
                        <a:column name="stage_leader" align="center" editor="qms5060_8d_memebers_grid_cb" prompt="阶段负责人" width="100"/>
                        <a:column name="name" align="center" editor="qms5060_8d_members_grid_tf" width="100"/>
                        <a:column name="responsibility_scope" editor="qms5060_8d_members_grid_tf" width="160"/>
                        <a:column name="role_display" editor="qms5060_8d_memebers_grid_cb" prompt="QMS_8D.ROLE_DISPLAY" width="80"/>
                        <a:column name="phone_number" align="center" editor="qms5060_8d_members_grid_tf" width="100"/>
                        <a:column name="email" align="center" editor="qms5060_8d_members_grid_tf" width="180"/>
                        <a:column name="comments" editor="qms5060_8d_members_grid_tf" width="200"/>
                    </a:columns>
                    <a:editors>
                        <a:textField id="qms5060_8d_members_grid_tf"/>
                        <a:comboBox id="qms5060_8d_memebers_grid_cb"/>
                    </a:editors>
                </a:grid>
            </a:fieldSet>
            <a:fieldSet title="QMS_8D.CONTAINMENT_ACTION-CONTINUE_SUPPLY" width="1100">
                <a:hBox labelWidth="180">
                    <a:comboBox name="inventory_affect_flag_display" bindTarget="qms5060_8d_maintain_ds" prompt="QMS_8D.INVENTORY_AFFECT_FLAG" width="100"/>
                    <a:comboBox name="inventory_affect_measure_display" bindTarget="qms5060_8d_maintain_ds" prompt="QMS_8D.INVENTORY_AFFECT_MEASURE" width="150"/>
                    <a:textField name="inventory_affect_desc" bindTarget="qms5060_8d_maintain_ds" width="230"/>
                </a:hBox>
                <a:hBox labelWidth="180">
                    <a:comboBox name="process_affect_flag_display" bindTarget="qms5060_8d_maintain_ds" prompt="QMS_8D.PROCESS_AFFECT_FLAG" width="100"/>
                    <a:comboBox name="process_affect_measure_display" bindTarget="qms5060_8d_maintain_ds" prompt="QMS_8D.PROCESS_AFFECT_MEASURE" width="150"/>
                    <a:textField name="process_affect_desc" bindTarget="qms5060_8d_maintain_ds" width="230"/>
                </a:hBox>
                <a:hBox labelWidth="180">
                    <a:comboBox name="transporting_affect_flag_display" bindTarget="qms5060_8d_maintain_ds" prompt="QMS_8D.TRANSPORTING_AFFECT_FLAG" width="100"/>
                    <a:comboBox name="transporting_affect_measure_display" bindTarget="qms5060_8d_maintain_ds" prompt="QMS_8D.TRANSPORTING_AFFECT_MEASURE" width="150"/>
                    <a:textField name="transporting_affect_desc" bindTarget="qms5060_8d_maintain_ds" width="230"/>
                </a:hBox>
                <a:hBox labelWidth="180">
                    <a:comboBox name="custom_stock_affect_flag_display" bindTarget="qms5060_8d_maintain_ds" prompt="QMS_8D.CUSTOM_STOCK_AFFECT_FLAG" width="100"/>
                    <a:comboBox name="custom_stock_affect_measure_display" bindTarget="qms5060_8d_maintain_ds" prompt="QMS_8D.CUSTOM_STOCK_AFFECT_MEASURE" width="150"/>
                    <a:textField name="custom_stock_affect_desc" bindTarget="qms5060_8d_maintain_ds" width="230"/>
                </a:hBox>
                <a:hBox labelWidth="180">
                    <a:numberField name="item_reivew_count" allowDecimals="false" allowFormat="false" allowNegative="false" bindTarget="qms5060_8d_maintain_ds" prompt="QMS_8D.ITEM_REIVEW_COUNT" width="100"/>
                    <a:numberField name="item_trouble_count" allowDecimals="false" allowFormat="false" allowNegative="false" bindTarget="qms5060_8d_maintain_ds" prompt="QMS_8D.ITEM_TROUBLE_COUNT" width="150"/>
                    <a:datePicker name="finish_date_new" bindTarget="qms5060_8d_maintain_ds" prompt="QMS7030.FINISH_TIME" renderer="Aurora.formatDateTime" width="150"/>
                </a:hBox>
                <!--             </a:fieldSet>
            <a:fieldSet title="QMS_8D.CONTAINMENT_ACTION-CONTINUE_PRODUCT" width="1100"> -->
                <a:hBox labelWidth="180">
                    <a:textArea name="measure_desc" bindTarget="qms5060_8d_maintain_ds" width="840"/>
                </a:hBox>
                <a:hBox labelWidth="180">
                    <a:textArea name="measure_check" bindTarget="qms5060_8d_maintain_ds" width="840"/>
                </a:hBox>
            </a:fieldSet>
            <a:fieldSet title="QMS_8D.ROOT_CAUSE" width="1100">
                <a:vBox labelWidth="220">
                    <a:comboBox name="reason_type_display" bindTarget="qms5060_8d_maintain_ds" prompt="QMS_8D.REASON_TYPE" width="150"/>
                    <a:textArea name="reason_desc" bindTarget="qms5060_8d_maintain_ds" width="840"/>
                    <a:textArea name="system_reason" bindTarget="qms5060_8d_maintain_ds" prompt="缺陷产生的系统原因" width="840"/>
                    <a:textArea name="unhappen_desc" bindTarget="qms5060_8d_maintain_ds" prompt="该问题为什么会流出？" width="840"/>
                    <a:datePicker name="attribute_1" bindTarget="qms5060_8d_maintain_ds" prompt="完成日期" renderer="Aurora.formatDateTime" width="150"/>
                </a:vBox>
            </a:fieldSet>
            <a:fieldSet title="QMS_8D.PERMANENT_CORRECTIVE_ACTION" width="1100">
                <a:vBox labelWidth="220">
                    <a:textArea name="prevent_occur_measure" bindTarget="qms5060_8d_maintain_ds" width="840"/>
                    <a:textArea name="system_reason_measure" bindTarget="qms5060_8d_maintain_ds" prompt="系统的改善原因" width="840"/>
                    <a:textArea name="prevent_check_measure" bindTarget="qms5060_8d_maintain_ds" prompt="如何预防该问题再次流出？" width="840"/>
                    <a:grid bindTarget="qms5060_8d_maintain_ds" height="85" width="844">
                        <a:columns>
                            <a:column prompt="QMS_8D.MATCH_FOLLOWING_PROJECTS_OR_NOT">
                                <a:column name="other_item_flag_display" align="center" editor="qms5060_8d_maintain_grid_cmb" prompt="QMS_8D.OTHER_ITEM_FLAG" resizable="false" width="130"/>
                                <a:column name="other_process_flag_display" align="center" editor="qms5060_8d_maintain_grid_cmb" prompt="QMS_8D.OTHER_PROCESS_FLAG" resizable="false" width="130"/>
                                <a:column name="other_place_flag_display" align="center" editor="qms5060_8d_maintain_grid_cmb" prompt="QMS_8D.OTHER_PLACE_FLAG" resizable="false" width="130"/>
                            </a:column>
                            <a:column name="project_deal_flag_display" align="center" editor="qms5060_8d_maintain_grid_cmb" prompt="QMS_8D.PROJECT_DEAL_FLAG" resizable="false" width="452"/>
                        </a:columns>
                        <a:editors>
                            <a:comboBox id="qms5060_8d_maintain_grid_cmb"/>
                        </a:editors>
                    </a:grid>
                    <a:datePicker name="attribute_2" bindTarget="qms5060_8d_maintain_ds" prompt="完成日期" renderer="Aurora.formatDateTime" width="150"/>
                </a:vBox>
            </a:fieldSet>
            <a:fieldSet title="D6  验证纠正措施 Verification of Corrective Actions" width="1100">
                <a:vBox labelWidth="220">
                    <a:textArea name="permanent_measure_effect" bindTarget="qms5060_8d_maintain_ds" width="840"/>
                    <a:datePicker name="attribute_3" bindTarget="qms5060_8d_maintain_ds" prompt="完成日期" renderer="Aurora.formatDateTime" width="150"/>
                </a:vBox>
            </a:fieldSet>
            <a:fieldSet title="QMS_8D.PREVENTIVE_ACTION" width="1100">
                <a:vBox labelWidth="220">
                    <a:textArea name="prevent_desc" bindTarget="qms5060_8d_maintain_ds" width="840"/>
                    <a:grid bindTarget="qms5060_8d_maintain_ds" height="85" style="overflow:none;" width="844">
                        <a:columns>
                            <a:column prompt="QMS_8D.RELEVANT_DOC_HAVE_BEEN_MODIFIED_OR_NOT">
                                <a:column name="control_flag_display" align="center" editor="qms5060_8d_approve_grid_cmb" prompt="QMS_8D.CONTROL_FLAG" resizable="false" width="140"/>
                                <a:column name="fmea_flag_display" align="center" editor="qms5060_8d_approve_grid_cmb" prompt="FMEA" resizable="false" width="140"/>
                                <a:column name="flowchart_flag_display" align="center" editor="qms5060_8d_approve_grid_cmb" prompt="QMS_8D.FLOWCHART_FLAG" resizable="false" width="140"/>
                                <a:column name="sop_flag_display" align="center" editor="qms5060_8d_approve_grid_cmb" prompt="SOP/WI" resizable="false" width="140"/>
                                <a:column name="audit_form_flag_display" align="center" editor="qms5060_8d_approve_grid_cmb" prompt="稽核表" resizable="false" width="140"/>
                                <a:column name="others_flag_display" align="center" editor="qms5060_8d_approve_grid_cmb" prompt="其他" resizable="false" width="140"/>
                            </a:column>
                        </a:columns>
                        <a:editors>
                            <a:comboBox id="qms5060_8d_approve_grid_cmb"/>
                        </a:editors>
                    </a:grid>
                    <a:textArea name="sharing_solutions" bindTarget="qms5060_8d_maintain_ds" prompt="分享此问题的解决方案到其他工序，产品，产地等" width="840"/>
                    <a:datePicker name="attribute_4" bindTarget="qms5060_8d_maintain_ds" prompt="完成日期" renderer="Aurora.formatDateTime" width="150"/>
                </a:vBox>
                <a:hBox labelWidth="100">
                    <a:textField hidden="true" prompt="制作" width="10"/>
                    <a:textField name="attribute_5" bindTarget="qms5060_8d_maintain_ds" prompt="制作" width="150"/>
                    <a:textField name="attribute_6" bindTarget="qms5060_8d_maintain_ds" prompt="审核" width="150"/>
                    <a:textField name="attribute_7" bindTarget="qms5060_8d_maintain_ds" prompt="核准" width="150"/>
                </a:hBox>
            </a:fieldSet>
            <a:fieldSet style="margin-bottom:40px;" title="QMS_8D.RELEVANT_DOC_HAVE_BEEN_MODIFIED_OR_NOT" width="1100">
                <a:hBox labelWidth="220">
                    <a:textArea name="cooperation_effect" bindTarget="qms5060_8d_maintain_ds" width="840"/>
                </a:hBox>
            </a:fieldSet>
        </a:screenBody>
    </a:view>
</a:screen>

<?xml version="1.0" encoding="UTF-8"?>
<a:screen xmlns:a="http://www.aurora-framework.org/application">
    <a:view>
        <a:link id="se_ap7020_confirm_save_link" url="${/request/@context_path}/modules/cux/SOLAREAST/ap/SE_AP7020/se_ap7020_confirm_save.svc"/>
        <a:link id="se_ap7020_confirm_header_print_save_link" url="${/request/@context_path}/modules/cux/SOLAREAST/ap/se_ap_confirm_print_save.svc"/>
        <a:link id="se_ap7020_confirm_header_attachments_link" url="${/request/@context_path}/attachment_file_download.screen"/>
        <a:link id="se_ap7020_confirm_header_release_link" model="cux.SOLAREAST.ap.SE_AP7020.se_ap_confirm_headers" modelaction="execute"/>
        <a:link id="se_ap7020_confirm_header_print_link" url="${/request/@context_path}/modules/cux/SOLAREAST/ap/se_ap_confirm_print.screen"/>
        <script><![CDATA[
        	function init(){
        	    var confirm_header_id = '${/parameter/@confirm_header_id}';
        	    if(confirm_header_id){
        	        $('se_ap7020_confirm_header_maintain_ds').setQueryParameter('confirm_header_id', confirm_header_id);
        	        $('se_ap7020_confirm_header_maintain_ds').query();
        	        $('se_ap7020_confirm_line_maintain_ds').setQueryParameter('confirm_header_id', confirm_header_id);
        	        $('se_ap7020_confirm_line_maintain_ds').query();
        	    }
        	}
        	
        	//打印
        	function se_ap7020_confirm_header_print(){
        	 	        	 	//已退回和已删除的不需要打印
			    var header_record = $('se_ap7020_confirm_header_maintain_ds').getCurrentRecord(),
			    	confirm_status = header_record.get('confirm_status');
			    if(confirm_status == '40_RETURNED' || confirm_status == '50_DELETED'){
			    	Aurora.showMessage('${l:PROMPT}', '${l:SE_AP_CONFIRM_HEADER.PRINT_STATUS_ERROR}');
			    	return ; 	   
			    }
			    
                var data = header_record.data;
                Aurora.Masker.mask(Ext.getBody());
                Aurora.request({
                    url: $('se_ap7020_confirm_header_print_save_link').getUrl(),
                    para: data,
                    success: function(res) {
                        Aurora.Masker.unmask(Ext.getBody());
                        window.open($('se_ap7020_confirm_header_print_link').getUrl(), '_blank');
                    },
                    failure: function(res) {
                        Aurora.Masker.unmask(Ext.getBody());
                    },
                    error: function(res) {
                        Aurora.Masker.unmask(Ext.getBody());
                    },
                    scope: this
                });
        	}
        
			
			function se_ap7020_confirm_header_attachments(){
				 new Aurora.Window({
                    id: 'se_ap7020_confirm_header_attachments_win',
                    title: '${l:QMS_8D.VIEW_ATTACHMENT}',
                    url: $('se_ap7020_confirm_header_attachments_link').getUrl()+'?pkvalue=${/parameter/@confirm_header_id}&table_name=SE_AP_CONFIRM_HEADERS',
                    width: 900,
                    height: 500
                });
			}
			
			
			function se_ap7020_confirm_header_return(){
				$('se_ap7020_confirm_maintain_win').close();
			}
			
			//操作记录
			function se_ap7020_confirm_header_oper_record(){
			    var confirm_header_id = $('se_ap7020_confirm_header_maintain_ds').getCurrentRecord().get('confirm_header_id');
			    if(confirm_header_id){
					new Aurora.Window({
	        	        id:'se_ap7020_confirm_oper_record_win',
	        	        title:'${l:PROMPT.OPERATION_RECORD}',
	        	        url:$('se_ap7020_confirm_oper_record_link').getUrl()+'?confirm_header_id=' + confirm_header_id,
	        	        width:600,
	        	        height:550
	        	    });
			    } else {
			        Aurora.showMessage('${l:PROMPT}', '${l:SE_AP_CONFIRM_HEADER.DATA_IS_NOT_SAVED}');
        	        return false;
			    }		   
			}
		]]></script>
        <a:dataSets>
            <a:dataSet id="se_ap7020_confirm_header_maintain_ds" model="cux.SOLAREAST.ap.SE_AP7020.se_ap_confirm_headers"/>
            <a:dataSet id="se_ap7020_confirm_line_maintain_ds" autoCount="true" autoPageSize="true" model="cux.SOLAREAST.ap.SE_AP5010.se_ap_confirm_lines" selectable="true"/>
        </a:dataSets>
        <a:screenBody>
            <a:screenTopToolbar>
                <a:toolbarButton click="se_ap7020_confirm_header_print" text="PROMPT.PRINT" width="100"/>
                <a:toolbarButton click="se_ap7020_confirm_header_attachments" text="PROMPT.VIEW_ATTACHMENT" width="100"/>
                <a:toolbarButton click="se_ap7020_confirm_header_oper_record" text="PORMPT.OPERATION_RECORD" width="100"/>
                <a:toolbarButton click="se_ap7020_confirm_header_return" text="HAP_BACK" width="100"/>
            </a:screenTopToolbar>
            <a:fieldSet column="1" title="PROMPT.BASIC_INFOMATION">
                <a:hBox labelWidth="100">
                    <a:textField name="confirm_title" bindTarget="se_ap7020_confirm_header_maintain_ds" prompt="SE_AP_CONFIRM_HEADER.CONFIRM_TITLE" readOnly="true" width="667"/>
                </a:hBox>
                <a:hBox labelWidth="100">
                    <a:textField name="confirm_code" bindTarget="se_ap7020_confirm_header_maintain_ds" prompt="SE_AP_CONFIRM_HEADER.CONFIRM_CODE" readOnly="true" width="150"/>
                    <a:textField name="business_unit_name" bindTarget="se_ap7020_confirm_header_maintain_ds" prompt="SE_AP_CONFIRM_HEADER.BUSINESS_UNIT" readOnly="true" width="150"/>
                    <a:textField name="released_by_display" bindTarget="se_ap7020_confirm_header_maintain_ds" prompt="SE_AP_CONFIRM_HEADER.RELEASED_BY" readOnly="true" width="150"/>
                    <a:textField name="released_date_ft" bindTarget="se_ap7020_confirm_header_maintain_ds" prompt="SE_AP_CONFIRM_HEADER.RELEASED_DATE" readOnly="true" width="150"/>
                </a:hBox>
                <a:hBox labelWidth="100">
                    <a:textField name="vendor_code" bindTarget="se_ap7020_confirm_header_maintain_ds" prompt="SE_AP_CONFIRM_HEADER.VENDOR_CODE" readOnly="true" width="150"/>
                    <a:textField name="vendor_name" bindTarget="se_ap7020_confirm_header_maintain_ds" prompt="SE_AP_CONFIRM_HEADER.VENDOR_NAME" readOnly="true" width="150"/>
                    <a:datePicker name="journal_date_from" bindTarget="se_ap7020_confirm_header_maintain_ds" prompt="SE_AP_CONFIRM_HEADER.JOURNAL_DATE_FROM" readOnly="true" width="150"/>
                    <a:datePicker name="journal_date_to" bindTarget="se_ap7020_confirm_header_maintain_ds" prompt="SE_AP_CONFIRM_HEADER.JOURNAL_DATE_TO" readOnly="true" width="150"/>
                </a:hBox>
                <a:hBox labelWidth="100">
                    <a:textField name="confirm_year" bindTarget="se_ap7020_confirm_header_maintain_ds" prompt="SE_AP_CONFIRM_HEADER.CONFIRM_YEAR" readOnly="true" width="150"/>
                    <a:textField name="confirm_month" bindTarget="se_ap7020_confirm_header_maintain_ds" prompt="SE_AP_CONFIRM_HEADER.CONFIRM_MONTH" readOnly="true" width="150"/>
                    <a:datePicker name="confirm_date" bindTarget="se_ap7020_confirm_header_maintain_ds" prompt="SE_AP_CONFIRM_HEADER.CONFIRM_DATE" readOnly="true" width="150"/>
                    <a:textField name="total_line_amount" bindTarget="se_ap7020_confirm_header_maintain_ds" prompt="SE_AP_CONFIRM_HEADER.TOTAL_LINE_AMOUNT" readOnly="true" renderer="Aurora.formatNumber" width="150"/>
                </a:hBox>
                <a:hBox labelWidth="100">
                    <a:textField name="confirm_balance" bindTarget="se_ap7020_confirm_header_maintain_ds" prompt="SE_AP_CONFIRM_HEADER.CONFIRM_BALANCE" readOnly="true" renderer="Aurora.formatNumber" width="150"/>
                    <a:textField name="debit_credit_display" bindTarget="se_ap7020_confirm_header_maintain_ds" prompt="SE_AP_CONFIRM_HEADER.DEBIT_CREDIT" readOnly="true" width="150"/>
                    <a:textField name="currency_code" bindTarget="se_ap7020_confirm_header_maintain_ds" prompt="SE_AP_CONFIRM_LINE.CURRENCY_CODE" readOnly="true" width="150"/>
                </a:hBox>
                <a:hBox labelWidth="100">
                    <a:textArea name="comments" bindTarget="se_ap7020_confirm_header_maintain_ds" height="60" prompt="SE_AP_CONFIRM_HEADER.COMMENTS" readOnly="true" width="924"/>
                </a:hBox>
            </a:fieldSet>
            <a:grid id="se_ap7020_confirm_line_maintain_grid" bindTarget="se_ap7020_confirm_line_maintain_ds" marginHeight="246" marginWidth="184" navBar="true" width="1000">
                <a:columns>
                    <a:column name="certificate_code" align="center" prompt="SE_AP_CONFIRM_LINE.CERTIFICATE_CODE" sortable="true" width="90"/>
                    <a:column name="certificate_date" align="center" prompt="SE_AP_CONFIRM_LINE.CERTIFICATE_DATE" sortable="true" width="90"/>
                    <a:column name="gl_date" align="center" prompt="SE_AP_CONFIRM_LINE.GL_DATE" sortable="true" width="90"/>
                    <a:column name="certificate_type_display" align="center" prompt="SE_AP_CONFIRM_LINE.CERTIFICATE_TYPE" width="90"/>
                    <a:column name="reference" prompt="SE_AP_CONFIRM_LINE.REFERENCE" width="100"/>
                    <a:column name="certificate_amount" align="right" prompt="SE_AP_CONFIRM_LINE.CERTIFICATE_AMOUNT" renderer="Aurora.formatNumber" sortable="true" width="90"/>
                    <a:column name="currency_code" align="center" prompt="SE_AP_CONFIRM_LINE.CURRENCY_CODE" width="70"/>
                    <a:column name="confirm_line_desc" prompt="SE_AP_CONFIRM_LINE.CONFIRM_LINE_DESC" width="160"/>
                </a:columns>
            </a:grid>
        </a:screenBody>
        <script><![CDATA[
        	init();
        ]]></script>
    </a:view>
</a:screen>

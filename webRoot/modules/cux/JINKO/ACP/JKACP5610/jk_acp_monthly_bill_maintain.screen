<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: Afghan
    $Date: 2017年11月4 日23:04:26
    $Revision: 1.0  
    $Purpose:月账单创建、查看编辑页面
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application" trace="true">
    <a:view>
        <a:link id="jk_acp5610_debt_delete_link" url="${/request/@context_path}/modules/cux/JINKO/ACP/JKACP5610/jk_acp_monthly_debt_delete.svc"/>
        <a:link id="jk_acp5610_quapro_delete_link" url="${/request/@context_path}/modules/cux/JINKO/ACP/JKACP5610/jk_acp_monthly_quapro_delete.svc"/>
        <a:link id="jk_acp5610_vminmiro_delete_link" url="${/request/@context_path}/modules/cux/JINKO/ACP/JKACP5610/jk_acp_monthly_vminmiro_delete.svc"/>
        <a:link id="jk_acp5610_bill_detail_Release_link" url="${/request/@context_path}/modules/cux/JINKO/ACP/JKACP5610/jk_acp_monthly_bill_detail_release.svc"/>
        <a:link id="jk_acp5610_bill_detail_cancel_link" url="${/request/@context_path}/modules/cux/JINKO/ACP/JKACP5610/jk_acp_monthly_bill_detail_cancel.svc"/>
        <!-- <a:link id="con5010_attachment_file_upload_link" url="${/request/@context_path}/uploadFile.screen"/>
        <a:link id="con5010_attachment_file_show_upload_link" url="${/request/@context_path}/check_uploadFile.screen"/>
        <a:link id="con5010_attachment_file_download_link" url="${/request/@context_path}/atm_download.svc"/>
        <a:link id="con5010_check_attachment_upload_link" model="cont.CON5010.con_contract_check_atm_upload" modelaction="query"/>
        <a:link id="con5010_update_file_path_link" model="cont.CON5010.con_contract_atm_file_path" modelaction="execute"/>
        <a:link id="con5010_update_file_id_link" model="cont.CON5010.con_contract_atm_file_id" modelaction="execute"/>
        <a:link id="con5010_delete_atm_link" url="${/request/@context_path}/modules/cont/CON5010/con_contract_atm_delete.svc"/>
        <a:link id="con5010_delete_partner_link" url="${/request/@context_path}/modules/cont/CON5010/con_contract_partner_delete.svc"/>
        <a:link id="con5010_delete_stage_link" url="${/request/@context_path}/modules/cont/CON5010/con_contract_stage_delete.svc"/>
        <a:link id="con5010_delete_link" url="${/request/@context_path}/modules/cont/CON5010/con_contract_delete.svc"/>
        <a:link id="con5010_publish_con_link" model="cont.CON5010.con_contract_headers_publish" modelaction="execute"/>
        <a:link id="con5010_contract_generate_maintain_link" url="${/request/@context_path}/modules/cont/CON5010/con_contract_generate_maintain.screen"/>
        <a:link id="con5010_generate_maintain_load_data_link" model="cont.CON5010.con_generate_load_data" modelaction="execute"/>
        <a:link id="con5010_contract_detail_terminal_link" url="${/request/@context_path}/modules/cont/CON5010/con_contract_detail_terminal.screen"/>
        <a:link id="con5010_contract_histories_link" url="${/request/@context_path}/modules/cont/public/con_contract_histories_query.screen"/>
 -->
        <script><![CDATA[
            var headFields_1 = ['bill_dead_date_desc', 'business_unit_name'];
            var headFields_2 = ['bill_dead_date_desc', 'business_unit_name', 'organization_name', 'arrears_amount', 'currency_name', 'comments'];
            var headFields_all = ['organization_name', 'arrears_amount', 'currency_name', 'comments', 'vendor_name', 'company_name', 'bill_dead_date_desc', 'business_unit_name', 'receive_date_from', 'receive_date_to'];
            var win_status = '';
            var amount_1 = 0;
            var nv_new_flag = '';
            var amount_2 = 0;
            var bill_header_id_bak = '${/parameter/@bill_header_id}';
            
            function jk_acp_5610_bill_back() {
                $('jk_acp_monthly_bill_result_ds').query();
                $('jk_acp5610_maintain_window').close();
            }
            // function not_invoiced_amout_sum_render(value, record, name){
            // var head_amount0 = window.amount_1 + window.amount_2;
            // var head_amount = parseFloat(head_amount0).toFixed(2);
            // alert(head_amount)
            // return head_amount;
            // }
            
            function jk_acp_5610_bill_detail_save_fun() {
                if (!$('jk_acp_5610_bill_header_ds').validate()) {
                    return;
                }
            
                $('jk_acp_5610_bill_header_ds').submit();
            }
            
            function jk_acp_5610_vminmiro_loadFun() {
                if (!bill_header_id_bak) {
                    var rs = $('jk_acp_monthly_bill_line_vminmiro_ds');
                    for (var i = 0;i < rs.data.length;i++) {
                        ds = rs.getAt(i);
                        ds.isNew = true;
                        ds.data.line_num = 10 * (i + 1);
                        ds._status = 'submit';
                    }
                }
            }
            
            function jk_acp_5610_vminuse_loadFun() {
                if (!bill_header_id_bak) {
                    var rs = $('jk_acp_monthly_bill_line_vminuse_ds');
                    for (var i = 0;i < rs.data.length;i++) {
                        ds = rs.getAt(i);
                        ds.isNew = true;
                        ds.data.line_num = 10 * (i + 1);
                        ds._status = 'submit';
                    }
                }
            }
            
            function jk_acp_5610_nvmipnmiro_loadFun() {
                if (!bill_header_id_bak) {
                    var rs = $('jk_acp_monthly_bill_line_nvmipnmiro_ds');
                    for (var i = 0;i < rs.data.length;i++) {
                        ds = rs.getAt(i);
                        ds.isNew = true;
                        ds.data.line_num = 10 * (i + 1);
                        ds._status = 'submit';
                    }
                }
            }
            
            function nvmipnmiro_new_flag_loadFun() {
                var nrecord = $('jk_acp_5610_nvmipnmiro_new_flag_ds').getAt(0);
                var head_record = $('jk_acp_5610_bill_header_ds').getAt(0);
                if (nrecord.data.nvmipnmiro_new_flag == 'Y') {
                    window.nv_new_flag = 'Y';
                    $('jk_acp_monthly_bill_nvmipnmiro_lines_grid').showColumn('rcv_trx_number');
                    $('jk_acp_monthly_bill_nvmipnmiro_lines_grid').showColumn('voucher_project');
                    $('jk_acp_monthly_bill_nvmipnmiro_lines_grid').showColumn('head_text_new');
                    $('receive_date_from_dp').show();
                    $('receive_date_to_dp').show();
                    if (head_record) {} else {
                        var nvmipnmiro_ds = $('jk_acp_monthly_bill_line_nvmipnmiro_ds');
                    }
                } else {
                    window.nv_new_flag = 'N';
                    $('receive_date_from_dp').hide();
                    $('receive_date_to_dp').hide();
                    $('jk_acp_monthly_bill_nvmipnmiro_lines_grid').hideColumn('rcv_trx_number');
                    $('jk_acp_monthly_bill_nvmipnmiro_lines_grid').hideColumn('voucher_project');
                    $('jk_acp_monthly_bill_nvmipnmiro_lines_grid').hideColumn('head_text_new');
                }
            
            
            }
            
            function jk_acp_monthly_bill_debt_editor_fun(record, name) {
                var head_record = $('jk_acp_5610_bill_header_ds').getAt(0);
                var status = head_record.get('status');
                if (status != 'RELEASED' && status != 'CONFIRMED') {
                    if (name == 'document_num' || name == 'comments' || name == 'item_name' || name == 'item_code') {
                        return 'jk_acp_monthly_bill_debt_lines_tf';
                    } else if (name == 'ship_date_desc') {
                        return 'jk_acp_monthly_bill_debt_lines_dp';
                    } else if (name == 'uom_name') {
                        return 'jk_acp_monthly_bill_debt_lines_lv';
                    } else if (name == 'quantity') {
                        return 'jk_acp_monthly_bill_debt_lines_nf';
                    } else if (name == 'price' || name == 'amount') {
                        return 'jk_acp_monthly_bill_debt_lines_cf';
                    }
                } else {
                    return null;
                }
            }
            
            function jk_acp_monthly_bill_quapro_editor_fun(record, name) {
                var head_record = $('jk_acp_5610_bill_header_ds').getAt(0);
                var status = head_record.get('status');
                if (status != 'RELEASED' && status != 'CONFIRMED') {
                    if (name == 'document_num' || name == 'comments' || name == 'item_name' || name == 'item_code') {
                        return 'jk_acp_monthly_bill_quapro_lines_tf';
                    } else if (name == 'ship_date_desc') {
                        return 'jk_acp_monthly_bill_quapro_lines_dp';
                    } else if (name == 'uom_name') {
                        return 'jk_acp_monthly_bill_quapro_lines_lv';
                    } else if (name == 'quantity') {
                        return 'jk_acp_monthly_bill_quapro_lines_nf';
                    } else if (name == 'price' || name == 'amount') {
                        return 'jk_acp_monthly_bill_quapro_lines_cf';
                    }
                } else {
                    return null;
                }
            }
            
            function jk_acp_monthly_bill_nvmipnmiro_editor_fun(record, name) {
                var head_record = $('jk_acp_5610_bill_header_ds').getAt(0);
                var status = head_record.get('status');
                if (status != 'RELEASED' && status != 'CONFIRMED') {
                    if (name == 'document_num' || name == 'comments') {
                        return 'jk_acp_monthly_bill_nvmipnmiro_lines_tf';
                    } else if (name == 'quantity') {
                        return 'jk_acp_monthly_bill_nvmipnmiro_lines_nf';
                    }
                } else {
                    return null;
                }
            }
            
            function jk_acp_monthly_bill_vminuse_editor_fun(record, name) {
                var head_record = $('jk_acp_5610_bill_header_ds').getAt(0);
                var status = head_record.get('status');
                if (status != 'RELEASED' && status != 'CONFIRMED') {
                    if (name == 'document_num' || name == 'comments' || name == 'item_name') {
                        return 'jk_acp_monthly_bill_vminuse_lines_tf';
                    } else if (name == 'quantity') {
                        return 'jk_acp_monthly_bill_vminuse_lines_nf';
                    } else if (name == 'price' || name == 'amount') {
                        return 'jk_acp_monthly_bill_vminuse_lines_cf';
                    }
                } else {
                    return null;
                }
            }
            
            function jk_acp_monthly_bill_vminmiro_editor_fun(record, name) {
                var head_record = $('jk_acp_5610_bill_header_ds').getAt(0);
                var status = head_record.get('status');
                if (status != 'RELEASED' && status != 'CONFIRMED') {
                    if (name == 'comments') {
                        return 'jk_acp_monthly_bill_vminmiro_lines_tf';
                    }
                } else {
                    return null;
                }
            }
            
            function jk_acp5610_deleteDebt() {
                var ds = $('jk_acp_monthly_bill_line_debt_ds');
                var rs = $('jk_acp_monthly_bill_line_debt_ds').getSelected();
                if (rs.length < 1) {
                    Aurora.showMessage('${l:PROMPT}', '${l:CHOOSE_ONE_RECORD}');
                }
                for (var i = 0;i < rs.length;i++) {
                    if (rs[i].isNew) {
                        ds.remove(rs);
                    }
                }
                var param = $('jk_acp_monthly_bill_line_debt_ds').getJsonData(true);
                Aurora.request({
                    url: $('jk_acp5610_debt_delete_link').getUrl(),
                    para: param,
                    success: function(args) {
                        $('jk_acp_monthly_bill_line_debt_ds').setQueryParameter('bill_header_id', bill_header_id_bak);
                        $('jk_acp_monthly_bill_line_debt_ds').query();
                    },
                    scope: this
                });
            }
            
            function jk_acp5610_detail_operation_record() {
                new Aurora.Window({
                    id: 'acp_operation_record_win',
                    url: $('jk_acp5610_header_operation_record_link').getUrl() + '?operation_table_id=' + ${/parameter/@bill_header_id} + '&operation_table=JK_ACP_MONTHLY_BILL_HEADERS',
                    title: '${l:ACP_BILL.OPERATION_RECORD}',
                    height: 450,
                    width: 600
                });
            
            }
            
            function jk_acp5610_deleteQuapro() {
                var ds = $('jk_acp_monthly_bill_line_quapro_ds');
                var rs = $('jk_acp_monthly_bill_line_quapro_ds').getSelected();
                if (rs.length < 1) {
                    Aurora.showMessage('${l:PROMPT}', '${l:CHOOSE_ONE_RECORD}');
                }
                for (var i = 0;i < rs.length;i++) {
                    if (rs[i].isNew) {
                        ds.remove(rs);
                    }
                }
                var param = $('jk_acp_monthly_bill_line_quapro_ds').getJsonData(true);
                Aurora.request({
                    url: $('jk_acp5610_quapro_delete_link').getUrl(),
                    para: param,
                    success: function(args) {
                        $('jk_acp_monthly_bill_line_quapro_ds').setQueryParameter('bill_header_id', bill_header_id_bak);
                        $('jk_acp_monthly_bill_line_quapro_ds').query();
                    },
                    scope: this
                });
            }
            // function jk_acp5610_deleteVminmiro() {
            // var ds = $('jk_acp_monthly_bill_line_vminmiro_ds');
            // var rs = $('jk_acp_monthly_bill_line_vminmiro_ds').getSelected();
            // if (rs.length < 1) {
            // Aurora.showMessage('${l:PROMPT}', '${l:CHOOSE_ONE_RECORD}');
            // }
            // for (var i = 0;i < rs.length;i++) {
            // if (rs[i].isNew) {
            // ds.remove(rs);
            // }
            // }
            // var param = $('jk_acp_monthly_bill_line_vminmiro_ds').getJsonData(true);
            // Aurora.request({
            // url: $('jk_acp5610_vminmiro_delete_link').getUrl(),
            // para: param,
            // success: function(args) {
            // $('jk_acp_monthly_bill_line_vminmiro_ds').setQueryParameter('bill_header_id', bill_header_id_bak);
            // $('jk_acp_monthly_bill_line_vminmiro_ds').query();
            // },
            // scope: this
            // });
            // }
            
            function jkacp5610_debtLineFootRender(data, name) {
                if (name == 'quantity') {
                    var records = $('jk_acp_monthly_bill_line_debt_ds').getAll();
                    var quantity_sum = 0;
                    for (var i = 0;i < records.length;i++) {
                        var quantity = parseFloat(records[i].get('quantity'));
                        if (Aurora.isEmpty(quantity)) {
                            quantity_sum += 0;
                        } else {
                            quantity_sum += quantity;
                        }
                    }
                    quantity_sum = parseFloat(quantity_sum).toFixed(2);
                    return quantity_sum;
                } else if (name == 'amount') {
                    var records = $('jk_acp_monthly_bill_line_debt_ds').getAll();
                    var amount_sum = 0;
                    for (var i = 0;i < records.length;i++) {
                        var amount = parseFloat(records[i].get('amount'));
                        if (Aurora.isEmpty(amount)) {
                            amount_sum += 0;
                        } else {
                            amount_sum += amount;
                        }
                    }
                    return parseFloat(amount_sum).toFixed(2);
                } else if (name == 'document_num') {
                    return '小计';
                } else {
                    return '/';
                }
            
            }
            
            function jkacp5610_vminmiroLineFootRender(data, name) {
                if (name == 'quantity') {
                    var records = $('jk_acp_monthly_bill_line_vminmiro_ds').getAll();
                    var quantity_sum = 0;
                    for (var i = 0;i < records.length;i++) {
                        var quantity = parseFloat(records[i].get('quantity'));
                        if (Aurora.isEmpty(quantity)) {
                            quantity_sum += 0;
                        } else {
                            quantity_sum += quantity;
                        }
                    }
                    quantity_sum = parseFloat(quantity_sum).toFixed(2);
                    return quantity_sum;
                } else if (name == 'amount') {
                    var records = $('jk_acp_monthly_bill_line_vminmiro_ds').getAll();
                    var amount_sum = 0;
                    for (var i = 0;i < records.length;i++) {
                        var amount = parseFloat(records[i].get('amount'));
                        if (Aurora.isEmpty(amount)) {
                            amount_sum += 0;
                        } else {
                            amount_sum += amount;
                        }
                    }
                    window.amount_1 = amount_sum;
                    var head_record = $('jk_acp_5610_bill_header_ds').getAt(0);
                    head_amount_sum = window.amount_1 + window.amount_2;
                    amount_sum = parseFloat(amount_sum).toFixed(2);
                    head_record.set('not_invoiced_amout', head_amount_sum);
                    return amount_sum;
                } else if (name == 'document_num') {
                    return '小计';
                } else {
                    return '/';
                }
            
            }
            
            function jkacp5610_vminuseLineFootRender(data, name) {
                if (name == 'quantity') {
                    var records = $('jk_acp_monthly_bill_line_vminuse_ds').getAll();
                    var quantity_sum = 0;
                    for (var i = 0;i < records.length;i++) {
                        var quantity = parseFloat(records[i].get('quantity'));
                        if (Aurora.isEmpty(quantity)) {
                            quantity_sum += 0;
                        } else {
                            quantity_sum += quantity;
                        }
                    }
                    quantity_sum = parseFloat(quantity_sum).toFixed(2);
                    return quantity_sum;
                } else if (name == 'amount') {
                    var records = $('jk_acp_monthly_bill_line_vminuse_ds').getAll();
                    var amount_sum = 0;
                    for (var i = 0;i < records.length;i++) {
                        var amount = parseFloat(records[i].get('amount'));
                        if (Aurora.isEmpty(amount)) {
                            amount_sum += 0;
                        } else {
                            amount_sum += amount;
                        }
                    }
                    return parseFloat(amount_sum).toFixed(2);
                } else if (name == 'document_num') {
                    return '小计';
                } else {
                    return '/';
                }
            
            }
            
            function jkacp5610_nvmipnmiroLineFootRender(data, name) {
                if (name == 'quantity') {
                    var records = $('jk_acp_monthly_bill_line_nvmipnmiro_ds').getAll();
                    var quantity_sum = 0;
                    for (var i = 0;i < records.length;i++) {
                        var quantity = parseFloat(records[i].get('quantity'));
                        if (Aurora.isEmpty(quantity)) {
                            quantity_sum += 0;
                        } else {
                            quantity_sum += quantity;
                        }
                    }
                    quantity_sum = parseFloat(quantity_sum).toFixed(2);
                    return quantity_sum;
                } else if (name == 'erp_quantity') {
                    var records = $('jk_acp_monthly_bill_line_nvmipnmiro_ds').getAll();
                    var quantity_sum = 0;
                    for (var i = 0;i < records.length;i++) {
                        var quantity = parseFloat(records[i].get('erp_quantity'));
                        if (Aurora.isEmpty(quantity)) {
                            quantity_sum += 0;
                        } else {
                            quantity_sum += quantity;
                        }
                    }
                    quantity_sum = parseFloat(quantity_sum).toFixed(2);
                    return quantity_sum;
                } else if (name == 'amount') {
                    var records = $('jk_acp_monthly_bill_line_nvmipnmiro_ds').getAll();
                    var amount_sum = 0;
                    for (var i = 0;i < records.length;i++) {
                        var amount = parseFloat(records[i].get('amount'));
                        if (Aurora.isEmpty(amount)) {
                            amount_sum += 0;
                        } else {
                            amount_sum += amount;
                        }
                    }
                    window.amount_2 = amount_sum;
                    var head_record = $('jk_acp_5610_bill_header_ds').getAt(0);
                    head_amount_sum = window.amount_1 + window.amount_2;
                    head_amount_sum = parseFloat(head_amount_sum).toFixed(2);
                    head_record.set('not_invoiced_amout', head_amount_sum);
                    amount_sum = parseFloat(amount_sum).toFixed(2);
            
                    return amount_sum;
                } else if (name == 'document_num') {
                    return '小计';
                } else {
                    return '/';
                }
            
            }
            
            function jkacp5610_quaproLineFootRender(data, name) {
                if (name == 'quantity') {
                    var records = $('jk_acp_monthly_bill_line_quapro_ds').getAll();
                    var quantity_sum = 0;
                    for (var i = 0;i < records.length;i++) {
                        var quantity = records[i].get('quantity');
                        if (Aurora.isEmpty(quantity)) {
                            quantity_sum += 0;
                        } else {
                            quantity_sum += quantity;
                        }
                    }
                    quantity_sum = parseFloat(quantity_sum).toFixed(2);
                    return quantity_sum;
                } else if (name == 'amount') {
                    var records = $('jk_acp_monthly_bill_line_quapro_ds').getAll();
                    var amount_sum = 0;
                    for (var i = 0;i < records.length;i++) {
                        var amount = records[i].get('amount');
                        if (Aurora.isEmpty(amount)) {
                            amount_sum += 0;
                        } else {
                            amount_sum += amount;
                        }
                    }
                    return parseFloat(amount_sum).toFixed(2);
                } else if (name == 'document_num') {
                    return '小计';
                } else {
                    return '/';
                }
            
            }
            
            function jk_acp_5610_bill_header_ds_query(ds) {
                var record = $('jk_acp_5610_bill_header_ds').getAt(0);
            
                if (record) {
                    var headMeta = record.getMeta();
                    var status = record.get('status');
                    var owner_business_group = record.get('owner_business_group');
                    $('jk_acp_monthly_bill_line_debt_ds').getField('uom_name').setLovPara('business_group', owner_business_group);
                    $('jk_acp_monthly_bill_line_quapro_ds').getField('uom_name').setLovPara('business_group', owner_business_group);
                    var owner_business_group = record.get('owner_business_group');
                    $('jk_acp_5610_currency_list_ds').setQueryUrl("${/request/@context_path}/autocrud/cux.JINKO.ACP.JKACP5610.currency_list/query?business_group=" + owner_business_group);
                    $('jk_acp_5610_currency_list_ds').query();
                    if (status == 'NEW' || status == 'RETURNED') {
                        headMeta.getField('receive_date_from').setReadOnly(true);
                        headMeta.getField('receive_date_to').setReadOnly(true);
                        headMeta.getField('bill_dead_date_desc').setReadOnly(true);
                        headMeta.getField('business_unit_name').setReadOnly(true);
                        headMeta.getField('company_name').setReadOnly(true);
                        headMeta.getField('vendor_name').setReadOnly(true);
                        headMeta.getField('arrears_amount').setReadOnly(false);
                        headMeta.getField('organization_name').setReadOnly(false);
                        headMeta.getField('comments').setReadOnly(false);
                        headMeta.getField('currency_name').setReadOnly(false);
                        // $('jkacp5610save_release_btn').setText('保存并发布');
                        diaplayBtn('jkacp5610create_btn');
                        diaplayBtn('jkacp5610create_release_btn');
                        // console.log($('jkacp5610save_release_btn'));
                    } else {
            
                        for (var i = 0;i < headFields_all.length;i++) {
                            headMeta.getField(headFields_all[i]).setReadOnly(true);
                        }
                        diaplayBtn('jkacp5610create_btn');
                        diaplayBtn('jkacp5610create_release_btn');
                        diaplayBtn('jkacp5610save_release_btn');
                        diaplayBtn('jkacp5610cancel_btn');
                        diaplayBtn('jkacp5610save_btn');
                        diaplayBtn('jk_acp_debt_grid_new');
                        diaplayBtn('jk_acp_debt_grid_delete');
                        diaplayBtn('jk_acp_quapro_grid_new');
                        diaplayBtn('jk_acp_quapro_grid_delete');
                        // diaplayBtn('jkacp5610back_btn');
                    }
                    if (status != 'CONFIRMED') {
                        diaplayBtn('jkacp5610_print_btn');
                    } else {
                        Ext.get('jkacp5610_print_btn').show();
                    }
                    var vminmiro_ds = $('jk_acp_monthly_bill_line_vminmiro_ds');
                    vminmiro_ds.setQueryUrl('${/request/@context_path}/autocrud/cux.JINKO.ACP.JKACP5610.jkacp_5610_bill_vminmiro_lines_edit/query?bill_header_id=${/parameter/@bill_header_id}');
                    vminmiro_ds.query();
                    var vminuse_ds = $('jk_acp_monthly_bill_line_vminuse_ds');
                    vminuse_ds.setQueryUrl('${/request/@context_path}/autocrud/cux.JINKO.ACP.JKACP5610.jkacp_5610_bill_vminuse_lines_edit/query?bill_header_id=${/parameter/@bill_header_id}');
                    vminuse_ds.query();
                    var nvmipnmiro_ds = $('jk_acp_monthly_bill_line_nvmipnmiro_ds');
                    nvmipnmiro_ds.setQueryUrl('${/request/@context_path}/autocrud/cux.JINKO.ACP.JKACP5610.jkacp_5610_bill_nvmipnmiro_lines_edit/query?bill_header_id=${/parameter/@bill_header_id}');
                    nvmipnmiro_ds.query();
                };
            }
            
            function jkacp5610_nvmipnmiroLineResultRender(value, record, name) {
                var erp_quantity = record.get('erp_quantity');
                var quantity = record.get('quantity');
                if (erp_quantity == quantity) {
                    return '<div style="background:#00FF00;">正常</div>';
                } else {
                    return '<div style="background:#FF0000;">差异</div>';
                }
            }
            
            function jkacp5610_nvmipnmiroLineAmountRender(value, record, name) {
                var price = record.get('price');
                var quantity = record.get('quantity');
                var nv_line_amount = price * quantity;
                nv_line_amount = parseFloat(nv_line_amount).toFixed(2);
            
            
                return nv_line_amount;
            }
            
            function receive_from_to_date_validator(record, name, value) {
                if (name == 'receive_date_from' || name == 'receive_date_to') {
                    var start = record.get('receive_date_from');
                    var end = record.get('receive_date_to');
            
                    if (start > end) {
                        return '过账日期起不能大于过账日期至';
                    }
                    return true;
                }
            }
            
            function jk_acp_5610_bill_header_ds_update(ds, record, name, value, oldvalue) {
                var headMeta = record.getMeta();
            
                if (name == "company_name") {
                    //公司修改后，readonly判断，以及业务实体
                    if (value == '') {
                        for (var i = 0;i < headFields_2.length;i++) {
                            headMeta.getField(headFields_2[i]).setReadOnly(true);
                        }
                        record.set('business_unit_name', '');
                    }
                } else if (name == "owner_business_group") {
                    //公司修改后，readonly判断，以及业务实体
                    $('jk_acp_5610_currency_list_ds').setQueryUrl("${/request/@context_path}/autocrud/cux.JINKO.ACP.JKACP5610.currency_list/query?business_group=" + value);
                    $('jk_acp_monthly_bill_line_debt_ds').getField('uom_name').setLovPara('business_group', value);
                    $('jk_acp_monthly_bill_line_quapro_ds').getField('uom_name').setLovPara('business_group', value);
                    $('jk_acp_5610_currency_list_ds').query();
                }
                var head_data = record.data;
                if (head_data.status == 'NEW0') {
                    if (head_data.vendor_name && head_data.company_name) {
                        for (var i = 0;i < headFields_1.length;i++) {
                            headMeta.getField(headFields_1[i]).setReadOnly(false);
                        }
                    } else {
                        headMeta.getField('bill_dead_date_desc').setReadOnly(true);
                        headMeta.getField('receive_date_from').setReadOnly(true);
                        headMeta.getField('receive_date_to').setReadOnly(true);
                        headMeta.getField('business_unit_name').setReadOnly(true);
                        headMeta.getField('arrears_amount').setReadOnly(true);
                        headMeta.getField('organization_name').setReadOnly(true);
                        headMeta.getField('comments').setReadOnly(true);
                        headMeta.getField('currency_name').setReadOnly(true);
                    }
                    // alert(head_data.status);
                    if (head_data.vendor_name && head_data.business_unit_id && head_data.bill_dead_date_desc) {
                        for (var i = 0;i < headFields_all.length;i++) {
                            headMeta.getField(headFields_all[i]).setReadOnly(false);
                        }
                    } else {
                        headMeta.getField('arrears_amount').setReadOnly(true);
                        headMeta.getField('organization_name').setReadOnly(true);
                        headMeta.getField('comments').setReadOnly(true);
                        headMeta.getField('currency_name').setReadOnly(true);
                    }
                }
                if (name == 'vendor_name' || name == 'business_unit_name' || name == 'bill_dead_date_desc') {
                    if (head_data.vendor_id && head_data.business_unit_name && head_data.bill_dead_date_desc) {
                        $('jk_acp_monthly_bill_line_vminmiro_ds').setQueryUrl('${/request/@context_path}/autocrud/cux.JINKO.ACP.JKACP5610.jkacp_5610_bill_vminmiro_new_query/query?');
                        $('jk_acp_monthly_bill_line_vminuse_ds').setQueryUrl('${/request/@context_path}/autocrud/cux.JINKO.ACP.JKACP5610.jkacp_5610_bill_vminuse_new_query/query?');
                        if (window.window.nv_new_flag == 'Y') {
                            $('jk_acp_monthly_bill_line_nvmipnmiro_ds').setQueryUrl('${/request/@context_path}/autocrud/cux.JINKO.ACP.JKACP5610.jkacp_5610_bill_nvmipnmiro_new_query_n/query?');
                        } else {
                            $('jk_acp_monthly_bill_line_nvmipnmiro_ds').setQueryUrl('${/request/@context_path}/autocrud/cux.JINKO.ACP.JKACP5610.jkacp_5610_bill_nvmipnmiro_new_query/query?');
                        }
                        $('jk_acp_monthly_bill_line_vminmiro_ds').setQueryParameter('vendor_id', head_data.vendor_id);
                        $('jk_acp_monthly_bill_line_vminmiro_ds').setQueryParameter('business_unit_id', head_data.business_unit_id);
                        $('jk_acp_monthly_bill_line_vminmiro_ds').setQueryParameter('bill_dead_date_desc', head_data.bill_dead_date_desc);
                        $('jk_acp_monthly_bill_line_vminmiro_ds').query();
                        $('jk_acp_monthly_bill_line_vminuse_ds').setQueryParameter('vendor_id', head_data.vendor_id);
                        $('jk_acp_monthly_bill_line_vminuse_ds').setQueryParameter('bill_dead_date_desc', head_data.bill_dead_date_desc);
                        $('jk_acp_monthly_bill_line_vminuse_ds').query();
                        $('jk_acp_monthly_bill_line_nvmipnmiro_ds').setQueryParameter('bill_dead_date_desc', head_data.bill_dead_date_desc);
                        $('jk_acp_monthly_bill_line_nvmipnmiro_ds').setQueryParameter('vendor_id', head_data.vendor_id);
                        $('jk_acp_monthly_bill_line_nvmipnmiro_ds').query();
            
                    }
                } else if (name == 'receive_date_from' || name == 'receive_date_to') {
                    $('jk_acp_monthly_bill_line_nvmipnmiro_ds').setQueryParameter(name, value);
                    $('jk_acp_monthly_bill_line_nvmipnmiro_ds').query();
                }
            
            }
            
            function jk_acp_5610_debtAddFun(dataSet, record, index) {
                record.data['line_num'] = 10 * (index + 1);
            }
            
            function jk_acp_5610_nvmipnmiro_updateFun(dataSet, record, name, value, oldvalue) {
                if (name == 'quantity') {
                    var price = record.get('price');
                    var head_record = $('jk_acp_5610_bill_header_ds').getAt(0);
                    window.amount_2 = window.amount_2 + (value * price - oldvalue * price);
                    head_amount_sum = window.amount_1 + window.amount_2;
                    head_amount_sum = parseFloat(head_amount_sum).toFixed(2);
                    head_record.set('not_invoiced_amout', head_amount_sum);
                    record.getMeta().getField('comments').setRequired(true);
            
                    record.set('amount', parseFloat(value * price).toFixed(2));
                }
            
            }
            
            function con5010BusinessAddFun(dataSet, record, index) {
                record.data['line_num'] = 10 * (index + 1);
            }
            
            function con5010StageAddFun(dataSet, record, index) {
                record.data['line_num'] = 10 * (index + 1);
                record.data['currency_name'] = $('con5010_contract_header_ds').getAt(0).get('currency_name');
                record.data['currency_code'] = $('con5010_contract_header_ds').getAt(0).get('currency_code');
            }
            
            
            
            function jk_acp_5610_bill_detail_cancel_fun() {
                Aurora.showConfirm('${l:PROMPT}', '确定取消？', function() {
                    Aurora.Masker.mask(Ext.getBody(), '${l:LOADING}');
                    Aurora.request({
                        url: $('jk_acp5610_bill_detail_cancel_link').getUrl(),
                        para: {
                            bill_header_id: window.bill_header_id_bak
                        },
                        success: function(res) {
                            window.win_status == 'canceled'
                            Aurora.Masker.unmask(Ext.getBody());
                            jk_acp_5610_bill_back();
                        },
                        failure: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        error: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        scope: this
                    });
                });
            }
            
            function jk_acp_5610_bill_header_ds_success(ds, res) {
                // Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.OPERATION_SUCCESS}');
                var rec = ds.getCurrentRecord();
            
                var head_id = bill_header_id_bak == '' ? res.result.record.bill_header_id : bill_header_id_bak;
                var bill_number = res.result.record.bill_number;
                Ext.get('jk_acp5610debt_export').show();
                Ext.get('jk_acp5610vminmiro_export').show();
                Ext.get('jk_acp5610vminuse_export').show();
                Ext.get('jkacp5610save_release_btn').show();
                Ext.get('jkacp5610save_btn').show();
                diaplayBtn('jkacp5610create_btn');
                diaplayBtn('jkacp5610create_release_btn');
                Ext.get('jk_acp5610_detail_operation_record').show();
                Ext.get('jk_acp5610nvmipnmiro_export').show();
                Ext.get('jk_acp5610quapro_export').show();
                bill_header_id_bak = head_id;
                //保存并发布
                if (window.win_status == 'release') {
                    Aurora.request({
                        url: $('jk_acp5610_bill_detail_Release_link').getUrl(),
                        para: {
                            bill_header_id: head_id
                        },
                        success: function(res) {
                            window.win_status == 'released'
                            Aurora.Masker.unmask(Ext.getBody());
                            if (rec.get('status') == 'NEW0') {
                                Aurora.showMessage('${l:PROMPT}', '月度对账单已创建并发布,单号:' + bill_number, function() {
                                    jk_acp_5610_bill_back();
                                }, 360, 120);
                            } else {
                                Aurora.showMessage('${l:PROMPT}', '操作成功', function() {
                                    jk_acp_5610_bill_back();
                                }, 360, 120);
                            }
                        },
                        failure: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        error: function(res) {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        scope: this
                    });
                }
                Ext.get('jkacp5610cancel_btn').show();
                if (rec.get('status') == 'NEW0') {
                    Aurora.showMessage('${l:PROMPT}', '月度对账单已创建,单号:' + bill_number, function() {
                        jk_acp_5610_bill_back();
                    }, 360, 120);
                } else {
                    Aurora.showMessage('${l:PROMPT}', '操作成功', function() {
                        jk_acp_5610_bill_back();
                    }, 360, 120);
                }
            }
            
            
            function jkacp5610_print() {
                window.open('${/request/@context_path}/modules/cux/JINKO/ACP/JKACP5610/jk_acp_monthly_bill_print.screen?bill_header_id=' + bill_header_id_bak);
            }
            //保存并发布
            
            function jk_acp_5610_bill_detail_save_release_fun() {
                if (!$('jk_acp_5610_bill_header_ds').validate()) {
                    return;
                }
            
                Aurora.showConfirm('${l:PROMPT}', '确定保存/创建并发布？', function() {
                    window.win_status = 'release';
                    var records = $('jk_acp_5610_bill_header_ds');
                    Aurora.Masker.mask(Ext.getBody(), '${l:LOADING}');
                    $('jk_acp_5610_bill_header_ds').submit();
                });
            
            }
        ]]></script>
        <a:dataSets>
            <a:dataSet id="jk_acp_5610_currency_list_ds" loadData="true" model="public.currency_list"/>
            <a:dataSet id="jk_acp_5610_business_unit_name_ds" loadData="true" model="cux.JINKO.ACP.JKACP5610.jkacp_5610_unit_com"/>
            <a:dataSet id="jk_acp_5610_bill_header_ds" autoCount="false" autoCreate="true" autoQuery="true" fetchAll="true" queryUrl="${/request/@context_path}/autocrud/cux.JINKO.ACP.JKACP5610.jkacp_5610_bill_maintainquery/query?bill_header_id=${/parameter/@bill_header_id}" selectable="true" submitUrl="${/request/@context_path}/modules/cux/JINKO/ACP/JKACP5610/jk_acp_monthly_bill_update.svc">
                <!-- <a:datas dataSource="/model/con5010_contract_header_init_source"/> -->
                <a:fields>
                    <a:field name="status" defaultValue="NEW0"/>
                    <a:field name="company_name" lovGridHeight="320" lovHeight="450" lovService="cux.JINKO.ACP.JKACP5610.jkacp_5610_company_lov" lovWidth="500" required="true" title="公司">
                        <a:mapping>
                            <a:map from="company_id" to="company_id"/>
                            <a:map from="company_code" to="company_code"/>
                            <a:map from="company_full_name" to="company_name"/>
                            <a:map from="business_group" to="owner_business_group"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="company_id"/>
                    <a:field name="organization_name" readOnly="true"/>
                    <a:field name="bill_header_id"/>
                    <a:field name="bill_number"/>
                    <a:field name="vendor_name" autoComplete="true" autoCompleteField="vendor_name" lovHeight="480" lovService="cux.JINKO.ACP.JKACP5610.jkacp_5610_vendor_lov" lovWidth="500" required="true" title="PROMPT.VENDOR">
                        <a:mapping>
                            <a:map from="vendor_id" to="vendor_id"/>
                            <a:map from="vendor_code" to="vendor_code"/>
                            <a:map from="full_name" to="vendor_name"/>
                            <a:map from="coop_business_group" to="coop_business_group"/>
                            <a:map from="coop_company_id" to="coop_company_id"/>
                            <a:map from="vendor_site_id" to="vendor_site_id"/>
                            <a:map from="address" to="address"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="not_invoiced_amout" readOnly="true"/>
                    <a:field name="creation_date" readOnly="true"/>
                    <a:field name="arrears_amount" prompt="欠款总额" readOnly="true"/>
                    <a:field name="currency_name" displayField="currency_name" options="jk_acp_5610_currency_list_ds" readOnly="true" required="true" returnField="currency_code" valueField="currency_code"/>
                    <a:field name="business_unit_name" displayField="business_unit_name" options="jk_acp_5610_business_unit_name_ds" readOnly="true" required="true" returnField="business_unit_id" valueField="business_unit_id"/>
                    <a:field name="business_unit_id"/>
                    <a:field name="bill_dead_date_desc" readOnly="true" required="true"/>
                    <a:field name="comments" readOnly="true"/>
                    <a:filed name="receive_date_from" validator="receive_from_to_date_validator"/>
                    <a:filed name="receive_date_to" validator="receive_from_to_date_validator"/>
                </a:fields>
                <a:events>
                    <a:event name="update" handler="jk_acp_5610_bill_header_ds_update"/>
                    <a:event name="load" handler="jk_acp_5610_bill_header_ds_query"/>
                    <a:event name="submitsuccess" handler="jk_acp_5610_bill_header_ds_success"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="jk_acp_monthly_bill_line_debt_ds" autoQuery="true" bindName="debt_lines" bindTarget="jk_acp_5610_bill_header_ds" fetchAll="true" queryUrl="${/request/@context_path}/autocrud/cux.JINKO.ACP.JKACP5610.jkacp_5610_bill_debt_lines_edit/query?bill_header_id=${/parameter/@bill_header_id}" selectable="true">
                <a:fields>
                    <a:field name="line_num"/>
                    <a:field name="uom_name" lovGridHeight="320" lovHeight="450" lovService="cux.JINKO.ACP.JKACP5610.fnd_uom_codes_lov" lovWidth="510" title="FND_UOM_CODES.UOM_CODE_QUERY">
                        <a:mapping>
                            <a:map from="uom_name" to="uom_name"/>
                            <a:map from="uom_id" to="uom_id"/>
                            <a:map from="uom_code" to="uom_code"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="price"/>
                    <a:field name="item_name"/>
                    <a:field name="quantity"/>
                    <a:field name="amount" required="true"/>
                    <a:field name="not_include_amount"/>
                </a:fields>
                <a:events>
                    <a:event name="add" handler="jk_acp_5610_debtAddFun"/>
                    <!-- <a:event name="update" handler="con5010ObjectUpdateFun"/> -->
                </a:events>
            </a:dataSet>
            <a:dataSet id="jk_acp_monthly_bill_line_quapro_ds" autoQuery="true" bindName="quapro_lines" bindTarget="jk_acp_5610_bill_header_ds" fetchAll="true" queryUrl="${/request/@context_path}/autocrud/cux.JINKO.ACP.JKACP5610.jkacp_5610_bill_quapro_lines_edit/query?bill_header_id=${/parameter/@bill_header_id}" selectable="true">
                <a:fields>
                    <a:field name="line_num"/>
                    <a:field name="uom_name" lovGridHeight="320" lovHeight="450" lovService="cux.JINKO.ACP.JKACP5610.fnd_uom_codes_lov" lovWidth="510" title="FND_UOM_CODES.UOM_CODE_QUERY">
                        <a:mapping>
                            <a:map from="uom_name" to="uom_name"/>
                            <a:map from="uom_id" to="uom_id"/>
                            <a:map from="uom_code" to="uom_code"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="price"/>
                    <a:field name="item_name"/>
                    <a:field name="quantity"/>
                    <a:field name="amount" required="true"/>
                    <a:field name="not_include_amount"/>
                </a:fields>
                <a:events>
                    <a:event name="add" handler="jk_acp_5610_debtAddFun"/>
                    <!-- <a:event name="update" handler="con5010ObjectUpdateFun"/> -->
                </a:events>
            </a:dataSet>
            <a:dataSet id="jk_acp_monthly_bill_line_vminmiro_ds" bindName="vminmiro_lines" bindTarget="jk_acp_5610_bill_header_ds" fetchAll="true" model="cux.JINKO.ACP.JKACP5610.jkacp_5610_bill_vminmiro_new_query">
                <a:fields>
                    <a:field name="line_num"/>
                    <a:field name="ship_date_desc"/>
                    <a:field name="uom_name" lovGridHeight="320" lovHeight="450" lovService="cux.JINKO.ACP.JKACP5610.fnd_uom_codes_lov" lovWidth="510" required="true" title="FND_UOM_CODES.UOM_CODE_QUERY">
                        <a:mapping>
                            <a:map from="uom_name" to="uom_name"/>
                            <a:map from="uom_id" to="uom_id"/>
                            <a:map from="uom_code" to="uom_code"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="price" required="true"/>
                    <a:field name="amount" required="true"/>
                    <a:field name="not_include_amount"/>
                </a:fields>
                <a:events>
                    <a:event name="load" handler="jk_acp_5610_vminmiro_loadFun"/>
                    <!-- <a:event name="update" handler="con5010ObjectUpdateFun"/> -->
                </a:events>
            </a:dataSet>
            <a:dataSet id="jk_acp_monthly_bill_line_vminuse_ds" bindName="vminuse_lines" bindTarget="jk_acp_5610_bill_header_ds" fetchAll="true" model="cux.JINKO.ACP.JKACP5610.jkacp_5610_bill_vminuse_new_query">
                <a:fields>
                    <a:field name="line_num"/>
                    <a:field name="ship_date_desc"/>
                    <a:field name="uom_name" lovGridHeight="320" lovHeight="450" lovService="cux.JINKO.ACP.JKACP5610.fnd_uom_codes_lov" lovWidth="510" required="true" title="FND_UOM_CODES.UOM_CODE_QUERY">
                        <a:mapping>
                            <a:map from="uom_name" to="uom_name"/>
                            <a:map from="uom_id" to="uom_id"/>
                            <a:map from="uom_code" to="uom_code"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="price"/>
                    <a:field name="amount"/>
                    <a:field name="not_include_amount"/>
                </a:fields>
                <a:events>
                    <a:event name="load" handler="jk_acp_5610_vminuse_loadFun"/>
                    <!-- <a:event name="update" handler="con5010ObjectUpdateFun"/> -->
                </a:events>
            </a:dataSet>
            <a:dataSet id="jk_acp_monthly_bill_line_nvmipnmiro_ds" bindName="nvmipnmiro_lines" bindTarget="jk_acp_5610_bill_header_ds" fetchAll="true" model="cux.JINKO.ACP.JKACP5610.jkacp_5610_bill_nvmipnmiro_new_query">
                <a:fields>
                    <a:field name="line_num"/>
                    <a:field name="ship_date_desc"/>
                    <a:field name="uom_name" lovGridHeight="320" lovHeight="450" lovService="cux.JINKO.ACP.JKACP5610.fnd_uom_codes_lov" lovWidth="510" required="true" title="FND_UOM_CODES.UOM_CODE_QUERY">
                        <a:mapping>
                            <a:map from="uom_name" to="uom_name"/>
                            <a:map from="uom_id" to="uom_id"/>
                            <a:map from="uom_code" to="uom_code"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="price"/>
                    <a:field name="amount"/>
                    <a:field name="not_include_amount"/>
                </a:fields>
                <a:events>
                    <a:event name="load" handler="jk_acp_5610_nvmipnmiro_loadFun"/>
                    <a:event name="update" handler="jk_acp_5610_nvmipnmiro_updateFun"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="jk_acp_5610_nvmipnmiro_new_flag_ds" autoquery="true" model="cux.JINKO.ACP.JKACP5610.jkacp_5610_new_flag">
                <a:events>
                    <a:event name="load" handler="nvmipnmiro_new_flag_loadFun"/>
                </a:events>
            </a:dataSet>
        </a:dataSets>
        <a:defaultScreen>
            <a:screenTopToolbar>
                <a:gridButton id="jkacp5610save_release_btn" click="jk_acp_5610_bill_detail_save_release_fun" text="保存并发布" width="100"/>
                <a:gridButton id="jkacp5610create_release_btn" click="jk_acp_5610_bill_detail_save_release_fun" text="创建并发布" width="100"/>
                <a:gridButton id="jkacp5610save_btn" click="jk_acp_5610_bill_detail_save_fun" text="保存" width="100"/>
                <a:gridButton id="jkacp5610create_btn" click="jk_acp_5610_bill_detail_save_fun" text="创建" width="100"/>
                <a:gridButton id="jkacp5610cancel_btn" click="jk_acp_5610_bill_detail_cancel_fun" text="取消" width="100"/>
                <a:gridButton id="jk_acp5610debt_export" bind="jk_acp_monthly_bill_debt_lines_grid" text="导出欠款明细" type="excel" width="100"/>
                <a:gridButton id="jk_acp5610vminmiro_export" bind="jk_acp_monthly_bill_vminmiro_lines_grid" text="导出VMI仓库使用未开票明细" type="excel" width="100"/>
                <a:gridButton id="jk_acp5610vminuse_export" bind="jk_acp_monthly_bill_vminuse_lines_grid" text="导出VMI仓库未使用结存明细" type="excel" width="100"/>
                <a:gridButton id="jk_acp5610nvmipnmiro_export" bind="jk_acp_monthly_bill_nvmipnmiro_lines_grid" text="导出非VMI仓库采购未开票明细" type="excel" width="100"/>
                <a:gridButton id="jk_acp5610quapro_export" bind="jk_acp_monthly_bill_quapro_lines_grid" text="导出存在质量问题批次明细" type="excel" width="100"/>
                <a:toolbarButton id="jk_acp5610_detail_operation_record" click="jk_acp5610_detail_operation_record" text="操作记录" width="100"/>
                <a:toolbarButton id="jkacp5610back_btn" click="jk_acp_5610_bill_back" text="HAP_BACK" width="100"/>
                <a:toolbarButton id="jkacp5610_print_btn" click="jkacp5610_print" text="打印" width="100"/>
            </a:screenTopToolbar>
            <a:fieldSet marginWidth="30" style="margin-top:5px;margin-left:2px;">
                <a:hBox labelWidth="120">
                    <!-- <a:textField name="subject_document_number" bindTarget="jk_acp_monthly_bill_query_ds" prompt="对账单号"/> -->
                    <a:lov name="company_name" bindTarget="jk_acp_5610_bill_header_ds" prompt="公司"/>
                    <a:comboBox name="business_unit_name" bindTarget="jk_acp_5610_bill_header_ds" prompt="业务实体"/>
                    <a:lov name="organization_name" bindTarget="jk_acp_5610_bill_header_ds" prompt="采购组织"/>
                    <a:lov name="vendor_name" bindTarget="jk_acp_5610_bill_header_ds" prompt="PROMPT.VENDOR"/>
                </a:hBox>
                <a:hBox labelWidth="120">
                    <a:comboBox name="currency_name" bindTarget="jk_acp_5610_bill_header_ds" prompt="币种"/>
                    <a:datePicker name="bill_dead_date_desc" bindTarget="jk_acp_5610_bill_header_ds" prompt="对账截止日期" renderer="Aurora.formatDate"/>
                    <a:datePicker name="creation_date" bindTarget="jk_acp_5610_bill_header_ds" prompt="创建日期" renderer="Aurora.formatDate"/>
                    <a:numberField name="arrears_amount" bindTarget="jk_acp_5610_bill_header_ds" prompt="欠款总额"/>
                </a:hBox>
                <a:hBox labelWidth="120">
                    <a:numberField name="not_invoiced_amout" bindTarget="jk_acp_5610_bill_header_ds" prompt="未开票总额" readOnly="true"/>
                    <a:textField name="bill_number" bindTarget="jk_acp_5610_bill_header_ds" prompt="月度对账单号" readOnly="true"/>
                    <a:datePicker name="receive_date_from" id="receive_date_from_dp" bindTarget="jk_acp_5610_bill_header_ds" hidden="true" prompt="过账日期起" renderer="Aurora.formatDate"/>
                    <a:datePicker name="receive_date_to" id="receive_date_to_dp" bindTarget="jk_acp_5610_bill_header_ds" hidden="true" prompt="过账日期至" renderer="Aurora.formatDate"/>
                </a:hBox>
                <a:hBox labelWidth="120">
                    <a:textArea name="comments" bindTarget="jk_acp_5610_bill_header_ds" marginWidth="400" prompt="备注"/>
                </a:hBox>
            </a:fieldSet>
            <a:tabPanel marginHeight="240" marginWidth="30">
                <a:tabs>
                    <a:tab prompt="欠款明细" width="100">
                        <a:grid id="jk_acp_monthly_bill_debt_lines_grid" bindTarget="jk_acp_monthly_bill_line_debt_ds" marginHeight="300" marginWidth="45" navBar="true" showRowNumber="true">
                            <a:toolBar>
                                <a:button id="jk_acp_debt_grid_new" text="HAP_NEW" type="add"/>
                                <a:button id="jk_acp_debt_grid_delete" click="jk_acp5610_deleteDebt" text="HAP_DELETE"/>
                            </a:toolBar>
                            <a:columns>
                                <!-- <a:column name="line_num" align="left" footerRenderer="jkacp5610_debtLineFootRender" prompt="序号" width="20"/> -->
                                <a:column name="document_num" align="left" editor="jk_acp_monthly_bill_debt_lines_tf" editorFunction="jk_acp_monthly_bill_debt_editor_fun" footerRenderer="jkacp5610_debtLineFootRender" prompt="采购订单号\合同号" width="70"/>
                                <a:column name="ship_date_desc" align="left" editor="jk_acp_monthly_bill_debt_lines_dp" editorFunction="jk_acp_monthly_bill_debt_editor_fun" prompt="制单日期" renderer="Aurora.formatDate" width="50"/>
                                <!-- <a:column name="item_id" align="left" editor="jk_acp_monthly_bill_debt_lines_tf" editorFunction="jk_acp_monthly_bill_debt_editor_fun" prompt="物料编码" width="60"/> -->
                                <a:column name="item_name" align="left" editorFunction="jk_acp_monthly_bill_debt_editor_fun" prompt="产品名称" width="80"/>
                                <a:column name="uom_name" align="left" editor="jk_acp_monthly_bill_debt_lines_lv" editorFunction="jk_acp_monthly_bill_debt_editor_fun" prompt="单位" width="50"/>
                                <a:column name="quantity" align="left" editorFunction="jk_acp_monthly_bill_debt_editor_fun" footerRenderer="jkacp5610_debtLineFootRender" prompt="数量" width="80"/>
                                <a:column name="price" align="left" editorFunction="jk_acp_monthly_bill_debt_editor_fun" footerRenderer="jkacp5610_debtLineFootRender" prompt="单价（含税）" width="80"/>
                                <a:column name="amount" align="left" editorFunction="jk_acp_monthly_bill_debt_editor_fun" footerRenderer="jkacp5610_debtLineFootRender" prompt=" 金额（含税）" width="80"/>
                                <a:column name="comments" align="left" editorFunction="jk_acp_monthly_bill_debt_editor_fun" footerRenderer="jkacp5610_debtLineFootRender" prompt="备注" width="120"/>
                            </a:columns>
                            <a:editors>
                                <a:textField id="jk_acp_monthly_bill_debt_lines_tf"/>
                                <a:lov id="jk_acp_monthly_bill_debt_lines_lv"/>
                                <!-- <a:comboBox id="jk_acp_monthly_bill_debt_lines_cb"/> -->
                                <a:numberField id="jk_acp_monthly_bill_debt_lines_nf"/>
                                <a:currencyField id="jk_acp_monthly_bill_debt_lines_cf"/>
                                <a:datePicker id="jk_acp_monthly_bill_debt_lines_dp"/>
                            </a:editors>
                        </a:grid>
                    </a:tab>
                    <!-- 第二-->
                    <a:tab prompt="VMI仓库使用未开票明细" width="200">
                        <a:grid id="jk_acp_monthly_bill_vminmiro_lines_grid" bindTarget="jk_acp_monthly_bill_line_vminmiro_ds" marginHeight="300" marginWidth="45" navBar="true" showRowNumber="true">
                            <a:columns>
                                <!-- <a:column name="line_num" align="left" footerRenderer="jkacp5610_vminmiroLineFootRender" prompt="序号" width="20"/> -->
                                <a:column name="document_num" align="left" footerRenderer="jkacp5610_vminmiroLineFootRender" prompt="采购订单号\合同号" width="70"/>
                                <a:column name="ship_date_desc" align="left" prompt="送货日期" renderer="Aurora.formatDate" width="50"/>
                                <a:column name="item_code" align="left" prompt="物料编码" width="60"/>
                                <a:column name="item_name" align="left" prompt="产品名称" width="80"/>
                                <a:column name="uom_name" align="left" prompt="单位" width="50"/>
                                <a:column name="quantity" align="left" footerRenderer="jkacp5610_vminmiroLineFootRender" prompt="数量" width="80"/>
                                <a:column name="price" align="left" footerRenderer="jkacp5610_vminmiroLineFootRender" prompt="单价（含税）" width="80"/>
                                <a:column name="amount" align="left" footerRenderer="jkacp5610_vminmiroLineFootRender" prompt=" 金额（含税）" width="80"/>
                                <a:column name="comments" align="left" editor="jk_acp_monthly_bill_vminmiro_lines_tf" editorFunction="jk_acp_monthly_bill_vminmiro_editor_fun" footerRenderer="jkacp5610_vminmiroLineFootRender" prompt="备注" width="120"/>
                            </a:columns>
                            <a:editors>
                                <a:textField id="jk_acp_monthly_bill_vminmiro_lines_tf"/>
                                <a:lov id="jk_acp_monthly_bill_vminmiro_lines_lv"/>
                                <!-- <a:comboBox id="jk_acp_monthly_bill_quapro_lines_cb"/> -->
                                <a:numberField id="jk_acp_monthly_bill_vminmiro_lines_nf"/>
                                <a:currencyField id="jk_acp_monthly_bill_vminmiro_lines_cf"/>
                                <a:datePicker id="jk_acp_monthly_bill_vminmiro_lines_dp"/>
                            </a:editors>
                        </a:grid>
                    </a:tab>
                    <a:tab prompt="VMI仓库未使用结存明细" width="200">
                        <a:grid id="jk_acp_monthly_bill_vminuse_lines_grid" bindTarget="jk_acp_monthly_bill_line_vminuse_ds" marginHeight="300" marginWidth="45" navBar="true" showRowNumber="true">
                            <a:columns>
                                <!-- <a:column name="line_num" align="left" footerRenderer="jkacp5610_vminuseLineFootRender" prompt="序号" width="20"/> -->
                                <a:column name="document_num" align="left" editor="jk_acp_monthly_bill_vminuse_lines_tf" editorFunction="jk_acp_monthly_bill_vminuse_editor_fun" footerRenderer="jkacp5610_vminuseLineFootRender" prompt="采购订单号\合同号" width="70"/>
                                <a:column name="ship_date_desc" align="left" prompt="送货日期" renderer="Aurora.formatDate" width="50"/>
                                <a:column name="item_code" align="left" prompt="物料编码" width="60"/>
                                <a:column name="item_name" align="left" prompt="产品名称" width="80"/>
                                <a:column name="uom_name" align="left" prompt="单位" width="50"/>
                                <a:column name="quantity" align="left" footerRenderer="jkacp5610_vminuseLineFootRender" prompt="数量" width="80"/>
                                <a:column name="price" align="left" editor="jk_acp_monthly_bill_vminuse_lines_cf" editorFunction="jk_acp_monthly_bill_vminuse_editor_fun" footerRenderer="jkacp5610_vminuseLineFootRender" prompt="单价（含税）" width="80"/>
                                <a:column name="amount" align="left" editor="jk_acp_monthly_bill_vminuse_lines_cf" editorFunction="jk_acp_monthly_bill_vminuse_editor_fun" footerRenderer="jkacp5610_vminuseLineFootRender" prompt=" 金额（含税）" width="80"/>
                                <a:column name="comments" align="left" editor="jk_acp_monthly_bill_vminuse_lines_tf" editorFunction="jk_acp_monthly_bill_vminuse_editor_fun" footerRenderer="jkacp5610_vminuseLineFootRender" prompt="备注" width="120"/>
                            </a:columns>
                            <a:editors>
                                <a:textField id="jk_acp_monthly_bill_vminuse_lines_tf"/>
                                <!-- <a:lov id="jk_acp_monthly_bill_vminmiro_lines_lv"/> -->
                                <!-- <a:comboBox id="jk_acp_monthly_bill_quapro_lines_cb"/> -->
                                <a:numberField id="jk_acp_monthly_bill_vminuse_lines_nf"/>
                                <a:currencyField id="jk_acp_monthly_bill_vminuse_lines_cf"/>
                                <!-- <a:datePicker id="jk_acp_monthly_bill_vminmiro_lines_dp"/> -->
                            </a:editors>
                        </a:grid>
                    </a:tab>
                    <a:tab prompt="非VMI仓库采购未开票明细" width="200">
                        <a:grid id="jk_acp_monthly_bill_nvmipnmiro_lines_grid" bindTarget="jk_acp_monthly_bill_line_nvmipnmiro_ds" marginHeight="300" marginWidth="45" navBar="true" showRowNumber="true">
                            <a:columns>
                                <a:column name="check_result" align="left" footerRenderer="jkacp5610_nvmipnmiroLineFootRender" prompt="对比结果" renderer="jkacp5610_nvmipnmiroLineResultRender" width="40"/>
                                <!-- <a:column name="line_num" align="left" footerRenderer="jkacp5610_nvmipnmiroLineFootRender" prompt="序号" width="20"/> -->
                                <a:column name="rcv_trx_number" prompt="物料凭证"/>
                                <a:column name="voucher_project" prompt="行号"/>
                                <a:column name="head_text_new" prompt="抬头文本"/>
                                <a:column name="document_num" align="left" editor="jk_acp_monthly_bill_nvmipnmiro_lines_tf" editorFunction="jk_acp_monthly_bill_nvmipnmiro_editor_fun" footerRenderer="jkacp5610_nvmipnmiroLineFootRender" prompt="采购订单号\合同号" width="70"/>
                                <a:column name="ship_date_desc" align="left" prompt="送货日期" renderer="Aurora.formatDate" width="50"/>
                                <a:column name="item_code" align="left" prompt="物料编码" width="60"/>
                                <a:column name="item_name" align="left" prompt="产品名称" width="80"/>
                                <a:column name="uom_name" align="left" prompt="单位" width="30"/>
                                <a:column name="erp_quantity" align="left" footerRenderer="jkacp5610_nvmipnmiroLineFootRender" prompt="ERP数量" width="80"/>
                                <a:column name="quantity" align="left" editor="jk_acp_monthly_bill_nvmipnmiro_lines_nf" editorFunction="jk_acp_monthly_bill_nvmipnmiro_editor_fun" footerRenderer="jkacp5610_nvmipnmiroLineFootRender" prompt="数量" width="80"/>
                                <a:column name="price" align="left" footerRenderer="jkacp5610_nvmipnmiroLineFootRender" prompt="单价（含税）" width="80"/>
                                <a:column name="amount" align="left" footerRenderer="jkacp5610_nvmipnmiroLineFootRender" prompt=" 金额（含税）" width="80"/>
                                <a:column name="comments" align="left" editor="jk_acp_monthly_bill_nvmipnmiro_lines_tf" editorFunction="jk_acp_monthly_bill_nvmipnmiro_editor_fun" footerRenderer="jkacp5610_nvmipnmiroLineFootRender" prompt="备注" width="120"/>
                            </a:columns>
                            <a:editors>
                                <a:textField id="jk_acp_monthly_bill_nvmipnmiro_lines_tf"/>
                                <!-- <a:lov id="jk_acp_monthly_bill_vminmiro_lines_lv"/> -->
                                <!-- <a:comboBox id="jk_acp_monthly_bill_quapro_lines_cb"/> -->
                                <a:numberField id="jk_acp_monthly_bill_nvmipnmiro_lines_nf"/>
                                <!-- <a:currencyField id="jk_acp_monthly_bill_vminuse_lines_cf"/> -->
                                <!-- <a:datePicker id="jk_acp_monthly_bill_vminmiro_lines_dp"/> -->
                            </a:editors>
                        </a:grid>
                    </a:tab>
                    <a:tab prompt="存在质量问题批次明细" width="180">
                        <a:grid id="jk_acp_monthly_bill_quapro_lines_grid" bindTarget="jk_acp_monthly_bill_line_quapro_ds" marginHeight="300" marginWidth="45" navBar="true" showRowNumber="true">
                            <a:toolBar>
                                <a:button id="jk_acp_quapro_grid_new" text="HAP_NEW" type="add"/>
                                <a:button id="jk_acp_quapro_grid_delete" click="jk_acp5610_deleteQuapro" text="HAP_DELETE"/>
                            </a:toolBar>
                            <a:columns>
                                <!-- <a:column name="line_num" align="left" footerRenderer="jkacp5610_quaproLineFootRender" prompt="序号" width="20"/> -->
                                <a:column name="document_num" align="left" editor="jk_acp_monthly_bill_quapro_lines_tf" editorFunction="jk_acp_monthly_bill_quapro_editor_fun" footerRenderer="jkacp5610_quaproLineFootRender" prompt="采购订单号\合同号" width="70"/>
                                <a:column name="ship_date_desc" align="left" editor="jk_acp_monthly_bill_quapro_lines_dp" editorFunction="jk_acp_monthly_bill_quapro_editor_fun" prompt="制单日期" renderer="Aurora.formatDate" width="50"/>
                                <!-- <a:column name="item_id" align="left" editor="jk_acp_monthly_bill_quapro_lines_tf" editorFunction="jk_acp_monthly_bill_quapro_editor_fun" prompt="物料编码" width="60"/> -->
                                <a:column name="item_name" align="left" editor="jk_acp_monthly_bill_quapro_lines_tf" editorFunction="jk_acp_monthly_bill_quapro_editor_fun" prompt="产品名称" width="80"/>
                                <a:column name="uom_name" align="left" editor="jk_acp_monthly_bill_quapro_lines_lv" editorFunction="jk_acp_monthly_bill_quapro_editor_fun" prompt="单位" width="50"/>
                                <a:column name="quantity" align="left" editor="jk_acp_monthly_bill_quapro_lines_nf" editorFunction="jk_acp_monthly_bill_quapro_editor_fun" footerRenderer="jkacp5610_quaproLineFootRender" prompt="数量" width="80"/>
                                <a:column name="price" align="left" editor="jk_acp_monthly_bill_quapro_lines_cf" editorFunction="jk_acp_monthly_bill_quapro_editor_fun" footerRenderer="jkacp5610_quaproLineFootRender" prompt="单价（含税）" width="80"/>
                                <a:column name="amount" align="left" editor="jk_acp_monthly_bill_quapro_lines_cf" editorFunction="jk_acp_monthly_bill_quapro_editor_fun" footerRenderer="jkacp5610_quaproLineFootRender" prompt=" 金额（含税）" width="80"/>
                                <a:column name="comments" align="left" editor="jk_acp_monthly_bill_quapro_lines_tf" editorFunction="jk_acp_monthly_bill_quapro_editor_fun" footerRenderer="jkacp5610_quaproLineFootRender" prompt="备注" width="120"/>
                            </a:columns>
                            <a:editors>
                                <a:textField id="jk_acp_monthly_bill_quapro_lines_tf"/>
                                <a:lov id="jk_acp_monthly_bill_quapro_lines_lv"/>
                                <!-- <a:comboBox id="jk_acp_monthly_bill_quapro_lines_cb"/> -->
                                <a:numberField id="jk_acp_monthly_bill_quapro_lines_nf"/>
                                <a:currencyField id="jk_acp_monthly_bill_quapro_lines_cf"/>
                                <a:datePicker id="jk_acp_monthly_bill_quapro_lines_dp"/>
                            </a:editors>
                        </a:grid>
                    </a:tab>
                </a:tabs>
            </a:tabPanel>
            <!--                   </a:accordion>
                </a:accordions>
            </a:accordionPanel>
 -->
        </a:defaultScreen>
        <script><![CDATA[
            function diaplayBtn(id) {
                var ui = document.getElementById(id);
                ui.style.display = "none";
            }
            
            function con5010Init() {
                if (bill_header_id_bak != '') {
                    //Ext.get('con5010_published').show();
                    //Ext.get('con5010_terminal').show();
                    //Ext.get('con5010_histories').show();
                    diaplayBtn('jkacp5610create_btn');
                    diaplayBtn('jkacp5610_print_btn');
                    diaplayBtn('jkacp5610create_release_btn');
            
                } else {
                    diaplayBtn('jk_acp5610debt_export');
                    diaplayBtn('jk_acp5610vminmiro_export');
                    diaplayBtn('jkacp5610save_btn');
                    diaplayBtn('jkacp5610save_release_btn');
                    diaplayBtn('jkacp5610cancel_btn');
                    diaplayBtn('jkacp5610_print_btn');
                    diaplayBtn('jk_acp5610vminuse_export');
                    diaplayBtn('jk_acp5610_detail_operation_record');
                    diaplayBtn('jk_acp5610nvmipnmiro_export');
                    diaplayBtn('jk_acp5610quapro_export');
                }
            }
            con5010Init();
        ]]></script>
    </a:view>
</a:screen>

<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Date: 2017年11月21日 14:04:03
    $Revision: 1.0 
    $Purpose: 晶科对账单
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application">
    <a:init-procedure/>
    <a:view>
        <style><![CDATA[ 
	        body{background-color: #ffffff;}
	        #bill_content *{margin:0;margin:0 auto;border-color:black;}
		    #bill_content div{text-align:left;word-break:break-all;}
		    #bill_content table {border-collapse:collapse;border-right:0;border-left:0;border-bottom:0}
 
		    #bill_signature_area{margin-top:10px;width:100%;}
		    #bill_signature_area table{width:100%;border-top:0;border-left:0;text-indent:10px;font-size:10pt;align:center;}

		    #bill_head_area span{
		        display:inline-block;
		    }
		    @page  {
		        margin-left: 1.5cm;
		        margin-right: 1.5cm;
		        margin-top: 1.91cm;
		        margin-bottom: 1.91cm;
		    }
	]]></style>
        <script><![CDATA[
            /// <summary>
            /// 数字转换成中文金额
            /// </summary>
            
            function ConvertSum(str) {
                str = str.toString();
                if (!IsPositveDecimal(str)) {
                    return "输入的不是正数字！";
                }
                if (parseFloat(str) > 999999999999.99) {
                    return "数字太大，无法换算，请输入一万亿元以下的金额";
                }
                var splitstr = new Array(); //定义按小数点分割后的字符串数组
                splitstr = str.split("."); //按小数点分割字符串
                if (splitstr[1] == '0000') { //只有整数部分
                    return ConvertData(splitstr[0]) + "圆整";
                } else { //有小数部分
                    var rstr;
                    rstr = ConvertData(splitstr[0]) + "圆"; //转换整数部分
                    rstr += ConvertXiaoShu(splitstr[1]); //转换小数部分
                    return rstr;
                }
            
            }
            ///
            /// 判断是否是正数字字符串
            ///
            /// 判断字符串
            /// 如果是数字，返回true，否则返回false
            
            function IsPositveDecimal(str) {
                if (!/^\d*(\.\d*)?$/.test(str)) {
                    return false;
                }
                return true;
            }
            ///
            /// 转换数字（整数）
            ///
            /// 需要转换的整数数字字符串
            /// 转换成中文大写后的字符串
            
            function ConvertData(str) {
                var tmpstr = "";
                var rstr = "";
                var strlen = str.length;
                if (strlen <= 4) {//数字长度小于四位
                
                    rstr = ConvertDigit(str);
            
                } else {
            
                    if (strlen <= 8) {//数字长度大于四位，小于八位
                    
                        tmpstr = str.substr(strlen - 4, 4); //先截取最后四位数字
                        rstr = ConvertDigit(tmpstr); //转换最后四位数字
                        tmpstr = str.substr(0, strlen - 4); //截取其余数字
                        //将两次转换的数字加上万后相连接
                        rstr = ConvertDigit(tmpstr) + "万" + rstr;
                        rstr = rstr.replace("零万", "万");
                        rstr = rstr.replace("零零", "零");
            
                    } else if (strlen <= 12) {//数字长度大于八位，小于十二位
                    
                        tmpstr = str.substr(strlen - 4, 4); //先截取最后四位数字
                        rstr = ConvertDigit(tmpstr); //转换最后四位数字
                        tmpstr = str.substr(strlen - 8, 4); //再截取四位数字
                        rstr = ConvertDigit(tmpstr) + "万" + rstr;
                        tmpstr = str.substr(0, strlen - 8);
                        rstr = ConvertDigit(tmpstr) + "亿" + rstr;
                        rstr = rstr.replace("零亿", "亿");
                        rstr = rstr.replace("零万", "零");
                        rstr = rstr.replace("零零", "零");
                        rstr = rstr.replace("零零", "零");
                    }
                }
                strlen = rstr.length;
                if (strlen >= 2) {
                    switch (rstr.substr(strlen - 2, 2)) {
                    case "佰零":
                        rstr = rstr.substr(0, strlen - 2) + "佰";
                        break;
                    case "仟零":
                        rstr = rstr.substr(0, strlen - 2) + "仟";
                        break;
                    case "万零":
                        rstr = rstr.substr(0, strlen - 2) + "万";
                        break;
                    case "亿零":
                        rstr = rstr.substr(0, strlen - 2) + "亿";
                        break;
                    }
                }
            
                return rstr;
            }
            ///
            /// 转换数字（小数部分）
            ///
            /// 需要转换的小数部分数字字符串
            /// 转换成中文大写后的字符串
            
            function ConvertXiaoShu(str) {
                var strlen = str.length;
                var rstr;
                if (strlen == 1) {
                    rstr = ConvertChinese(str) + "角";
                    return rstr;
                } else {
                    var tmpstr = str.substr(0, 1);
                    rstr = ConvertChinese(tmpstr) + "角";
                    tmpstr = str.substr(1, 1);
                    rstr += ConvertChinese(tmpstr) + "分";
                    rstr = rstr.replace("零分", "");
                    rstr = rstr.replace("零角", "");
                    return rstr;
                }
            }
            
            ///
            /// 转换数字
            ///
            /// 转换的字符串（四位以内）
            ///
            
            function ConvertDigit(str) {
                var strlen = str.length;
                var rstr = "";
                switch (strlen) {
                case 1:
                    rstr = ConvertChinese(str);
                    break;
                case 2:
                    rstr = Convert2Digit(str);
                    break;
                case 3:
                    rstr = Convert3Digit(str);
                    break;
                case 4:
                    rstr = Convert4Digit(str);
                    break;
                }
                rstr = rstr.replace("拾零", "拾");
                strlen = rstr.length;
                return rstr;
            }
            
            
            ///
            /// 转换四位数字
            ///
            
            function Convert4Digit(str) {
                var str1 = str.substr(0, 1);
                var str2 = str.substr(1, 1);
                var str3 = str.substr(2, 1);
                var str4 = str.substr(3, 1);
                var rstring = "";
                rstring += ConvertChinese(str1) + "仟";
                rstring += ConvertChinese(str2) + "佰";
                rstring += ConvertChinese(str3) + "拾";
                rstring += ConvertChinese(str4);
                rstring = rstring.replace("零仟", "零");
                rstring = rstring.replace("零佰", "零");
                rstring = rstring.replace("零拾", "零");
                rstring = rstring.replace("零零", "零");
                rstring = rstring.replace("零零", "零");
                rstring = rstring.replace("零零", "零");
                return rstring;
            }
            ///
            /// 转换三位数字
            ///
            
            function Convert3Digit(str) {
                var str1 = str.substr(0, 1);
                var str2 = str.substr(1, 1);
                var str3 = str.substr(2, 1);
                var rstring = "";
                rstring += ConvertChinese(str1) + "佰";
                rstring += ConvertChinese(str2) + "拾";
                rstring += ConvertChinese(str3);
                rstring = rstring.replace("零佰", "零");
                rstring = rstring.replace("零拾", "零");
                rstring = rstring.replace("零零", "零");
                rstring = rstring.replace("零零", "零");
                return rstring;
            }
            ///
            /// 转换二位数字
            ///
            
            function Convert2Digit(str) {
                var str1 = str.substr(0, 1);
                var str2 = str.substr(1, 1);
                var rstring = "";
                rstring += ConvertChinese(str1) + "拾";
                rstring += ConvertChinese(str2);
                rstring = rstring.replace("零拾", "零");
                rstring = rstring.replace("零零", "零");
                return rstring;
            }
            ///
            /// 将一位数字转换成中文大写数字
            ///
            
            function ConvertChinese(str) {
                //"零壹贰叁肆伍陆柒捌玖拾佰仟万亿圆整角分"
                var cstr = "";
                switch (str) {
                case "0":
                    cstr = "零";
                    break;
                case "1":
                    cstr = "壹";
                    break;
                case "2":
                    cstr = "贰";
                    break;
                case "3":
                    cstr = "叁";
                    break;
                case "4":
                    cstr = "肆";
                    break;
                case "5":
                    cstr = "伍";
                    break;
                case "6":
                    cstr = "陆";
                    break;
                case "7":
                    cstr = "柒";
                    break;
                case "8":
                    cstr = "捌";
                    break;
                case "9":
                    cstr = "玖";
                    break;
                }
                return cstr;
            }
            
            // function print_bill_txt() {
                // var record = $('huge_style_ds').getCurrentRecord();
                // if (record.data.huge_style_flag == 'Y') {
                    // window.open('${/request/@context_path}/modules/pur/bill_PRINT/bill_purchase_sale_print2.screen?contract_header_id=${/parameter/@contract_header_id}', '_blank');
                // } else {
                    // window.open('${/request/@context_path}/modules/pur/bill_PRINT/FDM/FDM_bill_purchase_sale_print.screen?contract_header_id=${/parameter/@contract_header_id}', '_blank');
                // }
            // }
        ]]></script>
        <a:dataSets>
            <a:dataSet id="jk_acp_5610_print_bill_header_ds" loadData="true" model="cux.JINKO.ACP.JKACP5610.jkacp_5610_bill_maintainquery"/>
            <!-- <a:dataSet id="jk_acp_5610_print_bill_header_ds" autoQuery="true" queryUrl="${/request/@context_path}/autocrud/cux.JINKO.ACP.JKACP5610.jkacp_5610_bill_maintainquery/query?bill_header_id=${/parameter/@bill_header_id}"/> -->
            <a:dataSet id="jk_acp_5610_bill_line_debt_ds" fetchAll="true" loadData="true" model="cux.JINKO.ACP.JKACP5610.jkacp_5610_bill_debt_lines_edit"/>
            <a:dataSet id="jk_acp_5610_bill_line_vminmiro_ds" fetchAll="true" loadData="true" model="cux.JINKO.ACP.JKACP5610.jkacp_5610_bill_vminmiro_lines_edit"/>
            <a:dataSet id="jk_acp_5610_bill_line_vminuse_ds" fetchAll="true" loadData="true" model="cux.JINKO.ACP.JKACP5610.jkacp_5610_bill_vminuse_lines_edit"/>
            <a:dataSet id="jk_acp_5610_bill_line_nvmipnmiro_ds" fetchAll="true" loadData="true" model="cux.JINKO.ACP.JKACP5610.jkacp_5610_bill_nvmipnmiro_lines_edit"/>
            <a:dataSet id="jk_acp_5610_bill_line_quapro_ds" fetchAll="true" loadData="true" model="cux.JINKO.ACP.JKACP5610.jkacp_5610_bill_quapro_lines_edit"/>
        </a:dataSets>
        <div id="bill_content" style="width:100%;height:100%;line-height:22pt;">
            <div style="font-size:15pt;font-weight:bold;text-align:center;margin-top:11px;margin-bottom:11px;font-family:&apos;宋体&apos;;"><![CDATA[采购对账单]]></div>
            <div id="bill_head_area" style="font-size:10pt;text-align:left;font-family:&apos;宋体&apos;;">
                <script><![CDATA[
                    var bill_head_company = $('jk_acp_5610_print_bill_header_ds').getAt(0);
                    console.log(bill_head_company);
                    var dom_business_unit_name = '<div style="width:100%;line-height:40pt;"><span style="float:left;font-size:10pt;font-weight:bold;">致：</span><span style="font-size:10pt;color:red;font-weight:bold;">' + bill_head_company.get('business_unit_name') + '</span></div>';
                    var dom_dead_date = '<div  style="width:100%;"><span>截止到：</span><span style="color:red; "><u style="color:red;">' + bill_head_company.get('bill_dead_date_print') + '</u></span>';
                    var dom_amount = '<span>：贵公司欠我公司贷款&nbsp;&nbsp;</span><span style="color:red;"><u>' + bill_head_company.get('arrears_amount') + '</u>' + bill_head_company.get('currency_name') + '</span>' + '；未开票金额：' + '<span style="color:red;"><u>' + bill_head_company.get('not_invoiced_amout') + '</u>' + bill_head_company.get('currency_name') + '</span>' + '；' + '</div></br>';
                    var dom_detail_text = '<p>交易明细如下：</p>';
                    var div = document.getElementById('bill_head_area');
                    div.innerHTML = dom_business_unit_name + dom_dead_date + dom_amount + dom_detail_text;
                ]]></script>
            </div>
            <table border="1" cellpadding="0" cellspacing="0" width="100%">
                <tr>
                    <td>
                        <div id="bill_debt_area" style="font-size:10pt;font-family:&apos;宋体&apos;;"/>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div id="bill_vminmiro_area" style="font-size:10pt;font-family:&apos;宋体&apos;;"/>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div id="bill_vminuse_area" style="font-size:10pt;font-family:&apos;宋体&apos;;"/>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div id="bill_nvmipnmiro_area" style="font-size:10pt;font-family:&apos;宋体&apos;;"/>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div id="bill_quapro_area" style="font-size:10pt;font-family:&apos;宋体&apos;;"/>
                    </td>
                </tr>
                <tr>
                    <td>
                        <div id="bill_foot_area" style="font-size:10pt;font-family:&apos;宋体&apos;;"/>
                    </td>
                </tr>
            </table>
            <div id="bill_signature_area" style="font-size:10pt;font-family:&apos;宋体&apos;;"/>
            <div id="page_break"/>
            <!-- <div style="page-break-before:always"/> -->
            <!--      <a:screenTopToolbar style="magin: auto 0">
                                <a:toolbarButton click="print_bill_txt" style="margin-bottom:60px;" text="打印合同文本" width="100"/>
                            </a:screenTopToolbar> -->
            <script><![CDATA[
                //加载表格
                
                function init_debt_table() {
                    var records = $('jk_acp_5610_bill_line_debt_ds').getAll();
                    var oDiv = document.getElementById('bill_debt_area');
                    var total_amount = 0;
                    var total_quantity = 0;
                    var v_dom_title = '<p>贵公司欠款明细：(包括VMI及非VMI)</p>';
                    var v_dom = '<table border="1" cellpadding="0" cellspacing="0" width="100%" style="font-size:10pt;text-align: center;"><tr>' + '<td style="border-left:0" width="20%">采购订单号/含合同号</td><td width="10%">送货日期</td><td width="10%">产品名称</td><td width="10%">单位</td><td width="10%">数量</td>' + '<td width="10%">单价(含税)</td><td width="10%">金额(含税)</td><td style="border-right: 0" width="10%">备注</td></tr>';
                    for (var u = 0;u < records.length;u++) {
                        if (records[u].data.document_num == null) {
                            v_dom = v_dom + '<tr><td style="border-left:0"> </td>';
                        } else {
                            v_dom = v_dom + '<tr><td style="border-left:0">' + records[u].data.document_num + '</td>'; //采购订单号/含合同号
                        }
                        if (records[u].data.ship_date_desc == null) {
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            v_dom = v_dom + '<td>' + records[u].data.ship_date_desc + '</td>'; //送货日期
                        }
                        if (records[u].data.item_name == null) {
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            v_dom = v_dom + '<td>' + records[u].data.item_name + '</td>'; //产品名称
                        }
                        if (records[u].data.uom_code == null) {
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            v_dom = v_dom + '<td>' + records[u].data.uom_code + '</td>'; //单位
                        }
                        if (records[u].data.quantity == null) {
                            total_quantity = total_quantity * 1;
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            total_quantity += records[u].data.quantity;
                            v_dom = v_dom + '<td>' + records[u].data.quantity + '</td>'; //数量
                        }
                        if (records[u].data.price == null) {
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            v_dom = v_dom + '<td>' + records[u].data.price + '</td>'; //单价(含税)
                        }
                        if (records[u].data.amount == null) {
                            total_amount = total_amount * 1;
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            total_amount += records[u].data.amount;
                            v_dom = v_dom + '<td>' + records[u].data.amount + '</td>'; //金额(含税)
                        }
                        if (records[u].data.comments == null) {
                            v_dom = v_dom + '<td style="border-right: 0"> </td>';
                        } else {
                            v_dom = v_dom + '<td style="border-right: 0">' + records[u].data.comments + '</td></tr>'; //备注
                        }
                    }
                    v_dom = v_dom + '<tr style="background-color: #96D2D2;border-bottom:0"><td style="border-bottom:0;border-left:0" colspan="3" rowspan="1">小计</td><td style="border-bottom:0"></td><td style="border-bottom:0" id="total_quantity_debt"></td><td style="border-bottom:0">/</td><td style="border-bottom:0" id="total_amount_debt"></td><td style="border-right: 0;border-bottom:0"></td></tr></table>';
                    oDiv.innerHTML = v_dom_title + v_dom;
                    document.getElementById('total_quantity_debt').innerHTML = total_quantity;
                    document.getElementById('total_amount_debt').innerHTML = total_amount;
                }
                init_debt_table();
                
                
                function init_vminmiro_table() {
                    var records = $('jk_acp_5610_bill_line_vminmiro_ds').getAll();
                    var oDiv = document.getElementById('bill_vminmiro_area');
                    var total_amount = 0;
                    var total_quantity = 0;
                    var v_dom_title = '<p>我公司VMI仓库使用未开票明细：<span style="color :red">(截止到'+bill_head_company.get('bill_dead_date_print')+')</span></p>';
                    var v_dom = '<table border="1" cellpadding="0" cellspacing="0" width="100%" style="font-size:10pt;text-align: center;"><tr>' + '<td style="border-left:0" width="20%">采购订单号/含合同号</td><td width="10%">送货日期</td><td width="10%">产品名称</td><td width="10%">单位</td><td width="10%">数量</td>' + '<td width="10%">单价(含税)</td><td width="10%">金额(含税)</td><td style="border-right: 0" width="10%">备注</td></tr>';
                    for (var u = 0;u < records.length;u++) {
                        if (records[u].data.document_num == null) {
                            v_dom = v_dom + '<tr><td style="border-left:0"> </td>';
                        } else {
                            v_dom = v_dom + '<tr><td style="border-left:0">' + records[u].data.document_num + '</td>'; //采购订单号/含合同号
                        }
                        if (records[u].data.ship_date_desc == null) {
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            v_dom = v_dom + '<td>' + records[u].data.ship_date_desc + '</td>'; //送货日期
                        }
                        if (records[u].data.item_name == null) {
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            v_dom = v_dom + '<td>' + records[u].data.item_name + '</td>'; //产品名称
                        }
                        if (records[u].data.uom_code == null) {
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            v_dom = v_dom + '<td>' + records[u].data.uom_code + '</td>'; //单位
                        }
                        if (records[u].data.quantity == null) {
                            total_quantity = total_quantity * 1;
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            total_quantity += records[u].data.quantity;
                            v_dom = v_dom + '<td>' + records[u].data.quantity + '</td>'; //数量
                        }
                        if (records[u].data.price == null) {
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            v_dom = v_dom + '<td>' + records[u].data.price + '</td>'; //单价(含税)
                        }
                        if (records[u].data.amount == null) {
                            total_amount = total_amount * 1;
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            total_amount += records[u].data.amount;
                            v_dom = v_dom + '<td>' + records[u].data.amount + '</td>'; //金额(含税)
                        }
                        if (records[u].data.comments == null) {
                            v_dom = v_dom + '<td style="border-right: 0"> </td>';
                        } else {
                            v_dom = v_dom + '<td style="border-right: 0">' + records[u].data.comments + '</td></tr>'; //备注
                        }
                    }
                    v_dom = v_dom + '<tr style="background-color: #96D2D2;border-bottom:0"><td style="border-bottom:0;border-left:0" colspan="3" rowspan="1">小计</td><td style="border-bottom:0"></td><td style="border-bottom:0" id="total_quantity_vminmiro"></td><td style="border-bottom:0">/</td><td style="border-bottom:0" id="total_amount_vminmiro"></td><td style="border-right: 0;border-bottom:0"></td></tr></table>';
                    oDiv.innerHTML = v_dom_title + v_dom;
                    document.getElementById('total_quantity_vminmiro').innerHTML = total_quantity;
                    document.getElementById('total_amount_vminmiro').innerHTML = total_amount;
                }
                init_vminmiro_table();
                
                
                function init_vminuse_table() {
                    var records = $('jk_acp_5610_bill_line_vminuse_ds').getAll();
                    var oDiv = document.getElementById('bill_vminuse_area');
                    var total_amount = 0;
                    var total_quantity = 0;
                    var v_dom_title = '<p>我公司VMI仓库未使用结存明细：<span style="color: red">(截止到'+bill_head_company.get('bill_dead_date_print')+')</span></p>';
                    var v_dom = '<table border="1" cellpadding="0" cellspacing="0" width="100%" style="font-size:10pt;text-align: center;"><tr>' + '<td style="border-left:0" width="20%">采购订单号/含合同号</td><td width="10%">送货日期</td><td width="10%">产品名称</td><td width="10%">单位</td><td width="10%">数量</td>' + '<td width="10%">单价(含税)</td><td width="10%">金额(含税)</td><td style="border-right: 0" width="10%">备注</td></tr>';
                    for (var u = 0;u < records.length;u++) {
                        if (records[u].data.document_num == null) {
                            v_dom = v_dom + '<tr><td style="border-left:0"> </td>';
                        } else {
                            v_dom = v_dom + '<tr><td style="border-left:0">' + records[u].data.document_num + '</td>'; //采购订单号/含合同号
                        }
                        if (records[u].data.ship_date_desc == null) {
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            v_dom = v_dom + '<td>' + records[u].data.ship_date_desc + '</td>'; //送货日期
                        }
                        if (records[u].data.item_name == null) {
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            v_dom = v_dom + '<td>' + records[u].data.item_name + '</td>'; //产品名称
                        }
                        if (records[u].data.uom_code == null) {
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            v_dom = v_dom + '<td>' + records[u].data.uom_code + '</td>'; //单位
                        }
                        if (records[u].data.quantity == null) {
                            total_quantity = total_quantity * 1;
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            total_quantity += records[u].data.quantity;
                            v_dom = v_dom + '<td>' + records[u].data.quantity + '</td>'; //数量
                        }
                        if (records[u].data.price == null) {
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            v_dom = v_dom + '<td>' + records[u].data.price + '</td>'; //单价(含税)
                        }
                        if (records[u].data.amount == null) {
                            total_amount = total_amount * 1;
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            total_amount += records[u].data.amount;
                            v_dom = v_dom + '<td>' + records[u].data.amount + '</td>'; //金额(含税)
                        }
                        if (records[u].data.comments == null) {
                            v_dom = v_dom + '<td style="border-right:0"> </td>';
                        } else {
                            v_dom = v_dom + '<td style="border-right:0">' + records[u].data.comments + '</td></tr>'; //备注
                        }
                    }
                    v_dom = v_dom + '<tr style="background-color: #96D2D2;border-bottom:0"><td style="border-bottom:0;border-left:0" colspan="3" rowspan="1">小计</td><td style="border-bottom:0"></td><td style="border-bottom:0" id="total_quantity_vminuse"></td><td style="border-bottom:0">/</td><td style="border-bottom:0" id="total_amount_vminuse"></td><td style="border-right: 0;border-bottom:0"></td></tr></table>';
                    oDiv.innerHTML = v_dom_title + v_dom;
                    document.getElementById('total_quantity_vminuse').innerHTML = total_quantity;
                    document.getElementById('total_amount_vminuse').innerHTML = total_amount;
                }
                init_vminuse_table();
                
                function init_nvmipnmiro_table() {
                    var records = $('jk_acp_5610_bill_line_nvmipnmiro_ds').getAll();
                    var oDiv = document.getElementById('bill_nvmipnmiro_area');
                    var total_amount = 0;
                    var total_quantity = 0;
                    var v_dom_title = '<p>我公司非VMI仓库采购未开票明细：<span style="color:red">(截止到'+bill_head_company.get('bill_dead_date_print')+')</span></p>';
                    var v_dom = '<table border="1" cellpadding="0" cellspacing="0" width="100%" style="font-size:10pt;text-align: center;"><tr>' + '<td style="border-left:0" width="20%">采购订单号/含合同号</td><td width="10%">送货日期</td><td width="10%">产品名称</td><td width="10%">单位</td><td width="10%">数量</td>' + '<td width="10%">单价(含税)</td><td width="10%">金额(含税)</td><td style="border-right: 0" width="10%">备注</td></tr>';
                    for (var u = 0;u < records.length;u++) {
                        if (records[u].data.document_num == null) {
                            v_dom = v_dom + '<tr><td style="border-left:0"> </td>';
                        } else {
                            v_dom = v_dom + '<tr><td style="border-left:0">' + records[u].data.document_num + '</td>'; //采购订单号/含合同号
                        }
                        if (records[u].data.ship_date_desc == null) {
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            v_dom = v_dom + '<td>' + records[u].data.ship_date_desc + '</td>'; //送货日期
                        }
                        if (records[u].data.item_name == null) {
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            v_dom = v_dom + '<td>' + records[u].data.item_name + '</td>'; //产品名称
                        }
                        if (records[u].data.uom_code == null) {
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            v_dom = v_dom + '<td>' + records[u].data.uom_code + '</td>'; //单位
                        }
                        if (records[u].data.quantity == null) {
                            total_quantity = total_quantity * 1;
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            total_quantity += records[u].data.quantity;
                            v_dom = v_dom + '<td>' + records[u].data.quantity + '</td>'; //数量
                        }
                        if (records[u].data.price == null) {
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            v_dom = v_dom + '<td>' + records[u].data.price + '</td>'; //单价(含税)
                        }
                        if (records[u].data.amount == null) {
                            total_amount = total_amount * 1;
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            total_amount += records[u].data.amount;
                            v_dom = v_dom + '<td>' + records[u].data.amount + '</td>'; //金额(含税)
                        }
                        if (records[u].data.comments == null) {
                            v_dom = v_dom + '<td style="border-right:0"> </td>';
                        } else {
                            v_dom = v_dom + '<td style="border-right:0">' + records[u].data.comments + '</td></tr>'; //备注
                        }
                    }
                    v_dom = v_dom + '<tr style="background-color: #96D2D2;border-bottom:0"><td style="border-bottom:0;border-left:0" colspan="3" rowspan="1">小计</td><td style="border-bottom:0"></td><td style="border-bottom:0" id="total_quantity_nvmipnmiro"></td><td style="border-bottom:0">/</td><td style="border-bottom:0" id="total_amount_nvmipnmiro"></td><td style="border-right: 0;border-bottom:0"></td></tr></table>';
                    oDiv.innerHTML = v_dom_title + v_dom;
                    document.getElementById('total_quantity_nvmipnmiro').innerHTML = total_quantity;
                    document.getElementById('total_amount_nvmipnmiro').innerHTML = total_amount;
                }
                init_nvmipnmiro_table();
                
                
                function init_quapro_table() {
                    var records = $('jk_acp_5610_bill_line_quapro_ds').getAll();
                    var oDiv = document.getElementById('bill_quapro_area');
                    var total_amount = 0;
                    var total_quantity = 0;
                    var v_dom_title = '<p>存在质量问题批次明细：</p>';
                    var v_dom = '<table border="1" cellpadding="0" cellspacing="0" width="100%" style="font-size:10pt;text-align: center;"><tr>' + '<td style="border-left:0" width="20%">采购订单号/含合同号</td><td width="10%">送货日期</td><td width="10%">产品名称</td><td width="10%">单位</td><td width="10%">数量</td>' + '<td width="10%">单价(含税)</td><td width="10%">金额(含税)</td><td style="border-right: 0" width="10%">备注</td></tr>';
                    for (var u = 0;u < records.length;u++) {
                        if (records[u].data.document_num == null) {
                            v_dom = v_dom + '<tr><td style="border-left:0"> </td>';
                        } else {
                            v_dom = v_dom + '<tr><td style="border-left:0">' + records[u].data.document_num + '</td>'; //采购订单号/含合同号
                        }
                        if (records[u].data.ship_date_desc == null) {
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            v_dom = v_dom + '<td>' + records[u].data.ship_date_desc + '</td>'; //送货日期
                        }
                        if (records[u].data.item_name == null) {
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            v_dom = v_dom + '<td>' + records[u].data.item_name + '</td>'; //产品名称
                        }
                        if (records[u].data.uom_code == null) {
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            v_dom = v_dom + '<td>' + records[u].data.uom_code + '</td>'; //单位
                        }
                        if (records[u].data.quantity == null) {
                            total_quantity = total_quantity * 1;
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            total_quantity += records[u].data.quantity;
                            v_dom = v_dom + '<td>' + records[u].data.quantity + '</td>'; //数量
                        }
                        if (records[u].data.price == null) {
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            v_dom = v_dom + '<td>' + records[u].data.price + '</td>'; //单价(含税)
                        }
                        if (records[u].data.amount == null) {
                            total_amount = total_amount * 1;
                            v_dom = v_dom + '<td> </td>';
                        } else {
                            total_amount += records[u].data.amount;
                            v_dom = v_dom + '<td>' + records[u].data.amount + '</td>'; //金额(含税)
                        }
                        if (records[u].data.comments == null) {
                            v_dom = v_dom + '<td style="border-right:0"> </td>';
                        } else {
                            v_dom = v_dom + '<td style="border-right:0">' + records[u].data.comments + '</td></tr>'; //备注
                        }
                    }
                    // v_dom = v_dom + '<tr style="background-color: #96D2D2;border-bottom:0"><td style="border-bottom:0;border-left:0" colspan="3" rowspan="1">小计</td><td style="border-bottom:0"></td><td style="border-bottom:0" id="total_quantity_quapro"></td><td style="border-bottom:0">/</td><td style="border-bottom:0" id="total_amount_quapro"></td><td style="border-right: 0;border-bottom:0"></td></tr></table>';
                    oDiv.innerHTML = v_dom_title + v_dom;
                    // document.getElementById('total_quantity_quapro').innerHTML = total_quantity;
                    // document.getElementById('total_amount_quapro').innerHTML = total_amount;
                }
                init_quapro_table();
                
                //加载脚
                
                
                function init_foot() {
                    var records = $('jk_acp_5610_bill_line_quapro_ds').getAll();
                    var oDiv = document.getElementById('bill_foot_area');
                    var total_amount = 0;
                    var v_dom = '<p style="border-bottom: 1px solid;" border="1">截止到'+bill_head_company.get('bill_dead_date_print')+'，我司应赔晶科质量赔款金额：</p>';
                    var v_dom_comment = '<span>备注：</span>';
                    var dom_1 = '<p style="background-color:yellow;border-bottom: 1px solid;border-top: 1px solid">我公司承诺：本对账单已囊括贵、我两司截止到<span style="color:red">'+bill_head_company.get('bill_dead_date_print')+'</span>之全部业务；若有遗漏，未经贵司特别同意，我公司自愿放弃追偿。</p>';
                    var dom_2 = '<p style="background-color:yellow;">此对账单的扫描件、传真件和复印件等非原件盖章形式对账单也具有法律效应，本公司一律承担法律后果。</p>';
                
                    // document.getElementById('total_quantity').innerHTML = total_quantity;
                    // document.getElementById('total_amount').innerHTML = total_amount;
                    oDiv.innerHTML = v_dom + v_dom_comment + dom_1 + dom_2;
                }
                init_foot();
                
                
                //合同签章
                
                function bill_signature() {
                var oSignature = document.getElementById('bill_signature_area');
                var v_dom = '<table border="0" style="font-size:10pt;"><tr><td width="50%">供货方（盖章）：'+bill_head_company.get('vendor_name')+'</td><td width="50%">采购方（盖章）：晶科能源有限公司</td></tr>';
                v_dom = v_dom+'<tr><td width="50%">核对人：</td><td width="50%">核对人：</td></tr>';
                v_dom = v_dom+'<tr><td width="50%">日期：</td><td width="50%">日期：</td></tr></table>';
                oSignature.innerHTML = v_dom;
                }
                bill_signature();
                
                //分页
                
                function break_page() {
                    //主div高度
                    var div_main_height = document.getElementById('main_content').offsetHeight;
                    //bill_signature_area的div高度
                    var div_sign_height = document.getElementById('bill_signature_area').offsetHeight;
                    //减去若干个A4页面高度
                    while ((div_main_height - 872) > 0) {
                        //A4当前格式所能容纳的内容高度 872px
                        div_main_height = div_main_height - 872;
                    }
                    //判断剩余空间能否容下bill_signature_area
                    if (div_main_height < div_sign_height) {
                        document.getElementById('page_break').style.pageBreakAfter = 'always';
                    }
                }
                // break_page();
            ]]></script>
        </div>
        <script><![CDATA[
            function NoToChinese(num) {
                if (!/^\d*(\.\d*)?$/.test(num)) {
                    alert("Number is wrong!");
                    return "Number is wrong!";
                }
                var AA = new Array("零", "壹", "贰", "叁", "肆", "伍", "陆", "柒", "捌", "玖");
                var BB = new Array("", "拾", "佰", "仟", "萬", "億", "点", "");
                var a = ("" + num).replace(/(^0*)/g, "").split("."),
                    k = 0,
                    re = "";
                for (var i = a[0].length - 1;i >= 0;i--) {
                    switch (k) {
                    case 0:
                        re = BB[7] + re;
                        break;
                    case 4:
                        if (!new RegExp("0{4}\\d{" + (a[0].length - i - 1) + "}$").test(a[0])) re = BB[4] + re;
                        break;
                    case 8:
                        re = BB[5] + re;
                        BB[7] = BB[5];
                        k = 0;
                        break;
                    }
                    if (k % 4 == 2 && a[0].charAt(i + 2) != 0 && a[0].charAt(i + 1) == 0) re = AA[0] + re;
                    if (a[0].charAt(i) != 0) re = AA[a[0].charAt(i)] + BB[k % 4] + re;
                    k++;
                }
            
                if (a.length > 1) { //加上小数部分(如果有小数部分)
            
                    re += BB[6];
                    for (var i = 0;i < a[1].length;i++) re += AA[a[1].charAt(i)];
                }
                return re;
            }
            
            function getByClass(obj, iClass) {
                var oSource = obj.getElementsByTagName('*');
                var oTarget = [];
                for (var u = 0;u < oSource.length;u++) {
                    if (oSource[u].className == iClass) {
                        oTarget.push(oSource[u]);
                    }
                }
                return oTarget;
            }
        ]]></script>
        <script><![CDATA[
            window.onload = function() {
                var timer_print = null;
                clearTimeout(timer_print);
                timer_print = setTimeout(function() {
                    window.print();
                }, 1000);
            };
        ]]></script>
    </a:view>
</a:screen>

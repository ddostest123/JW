<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: IsaacF  
    $Date: 2013-6-25 下午7:34:51  
    $Revision: 1.0  
    $Purpose: 
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application" xmlns:s="aurora.plugin.script" trace="true">
    <a:init-procedure>
        <!--  <a:model-query fetchAll="true" model="pur.PUR5120.pur_rfx_header_init" rootPath="jkpur5910_rfx_header_init_source"/> -->
        <a:model-query fetchAll="true" model="public.csh_payment_methods_list" rootPath="jkpur5910_payment_methods_source"/>
        <a:model-query fetchAll="true" model="public.currency_list" rootPath="jkpur5910_currency_source"/>
        <!--    <a:model-query fetchAll="true" model="pur.PUR5130.pur_rfx_get_default_type" rootPath="pur51302_default_rfx_type"/> -->
        <!--  <a:model-query fetchAll="true" model="pur.PUR5130.pur_bg_rfx_type" rootPath="pur51302_bg_rfx_type"/> -->
        <!-- <a:model-query fetchAll="true" model="public.fnd_tax_type_code_lov" rootPath="jkpur5910_tax_type_code_source"/> -->
    </a:init-procedure>
    <a:view>
        <a:link id="jkpur5910_rfx_manual_maintain_link" url="${/request/@context_path}/modules/cux/JINKO/PUR/JKPUR5910/jkpur_rfx_manual_maintain.screen"/>
        <a:link id="jkpur5910_rfx_create_link" url="${/request/@context_path}/modules/cux/JINKO/PUR/JKPUR5910/jkpur_rfx_create.svc"/>
        <a:link id="jkpur5910_rfx_quote_create_link" url="${/request/@context_path}/modules/pur/PUR5120/pur_rfx_quote_create.screen"/>
        <a:link id="jkpur5910_agreement_confirm_link" url="${/request/@context_path}/modules/cux/JINKO/PUR/JKPUR5910/jkpur_rfx_cnt_agreement_confirm.screen"/>
        <style><![CDATA[
  .desc-a-part{
    text-indent: 1em;
    font-size:14px;
    color:#444;
}
   .desc-a-part a{
	color:#19a2d5;
}     
        ]]></style>
        <script><![CDATA[
            function jkpur5910_rfx_headers_ds_update(ds, record, name, value, oldvalue) {
                if (name == 'rfx_category') {
                    jkpur5910_set_rfx_header_rules(record, value);
            
                } else if (name == 'currency_code' || name == 'functional_currency_code') {
                    var functional_currency_code = record.get('functional_currency_code');
                    var currency_code = record.get('currency_code');
                    if (functional_currency_code != currency_code) {
                        record.set('exchange_rate', '');
                       // record.getMeta().getField('exchange_rate').setRequired(true);
                        record.getMeta().getField('exchange_rate').setReadOnly(false);
                    } else {
                        record.set('exchange_rate', 1);
                        record.getMeta().getField('exchange_rate').setRequired(false);
                        record.getMeta().getField('exchange_rate').setReadOnly(true);
                    }
                } else if (name == 'tax_included_flag') {
                    record.set('tax_type_id', '');
                    record.set('tax_type_code', '');
                    record.set('tax_type_desc', '');
                    record.set('tax_type_rate', '');
                    if (value == 'Y') {
                        record.getMeta().getField('tax_type_desc').setRequired(true);
                        record.getMeta().getField('tax_type_desc').setReadOnly(false);
                    } else {
                        record.getMeta().getField('tax_type_desc').setRequired(false);
                        record.getMeta().getField('tax_type_desc').setReadOnly(true);
                    }
                } else if (name == 'pur_organization_require_flag') {
            
                    if (value == 'Y') {
                        record.getField('pur_organization_name').setRequired(true);
                    } else {
                        record.getField('pur_organization_name').setRequired(false);
                    }
                } else if(name == 'agent_require_flag'){
                    if (value == 'Y') {
                        record.getField('agent_name').setRequired(true);
                    } else {
                        record.getField('agent_name').setRequired(false);
                    }
                }
            
                if (record.getField('pur_organization_name').isRequired()) {
                    record.getField('pur_organization_name').setRequired(false);
                    record.getField('pur_organization_name').setRequired(true);
                } else {
                    record.getField('pur_organization_name').setRequired(true);
                    record.getField('pur_organization_name').setRequired(false);
                }
                record.getField('business_unit_name').setRequired(false);
                record.getField('business_unit_name').setRequired(true);
            }
            
            function jkpur5910_rfx_headers_ds_load(dataSet) {
                var record = dataSet.getCurrentRecord();
                // record.set('rfx_type_desc', '${/model/pur51302_default_rfx_type/record/@rfx_type_desc}');
                // record.set('rfx_type_id', '${/model/pur51302_default_rfx_type/record/@rfx_type_id}');
                // record.set('rfx_type_code', '${/model/pur51302_default_rfx_type/record/@rfx_type_code}');
                // record.set('rfx_category', '${/model/pur51302_default_rfx_type/record/@rfx_category}');
                // record.set('rfx_category_desc', '${/model/pur51302_default_rfx_type/record/@rfx_category_desc}');
                // record.set('rfx_method_desc', '${/model/pur51302_default_rfx_type/record/@default_rfx_method_desc}');
                // record.set('rfx_method', '${/model/pur51302_default_rfx_type/record/@default_rfx_method}');
                // record.set('auction_direction_desc', '${/model/pur51302_default_rfx_type/record/@default_auction_direction_desc}');
                // record.set('auction_direction', '${/model/pur51302_default_rfx_type/record/@default_auction_direction}');
                // record.set('open_rule_desc', '${/model/pur51302_default_rfx_type/record/@default_open_rule_desc}');
                // record.set('open_rule', '${/model/pur51302_default_rfx_type/record/@default_open_rule}');
                // record.set('auction_ranking_desc', '${/model/pur51302_default_rfx_type/record/@default_auction_ranking_desc}');
                // record.set('auction_ranking', '${/model/pur51302_default_rfx_type/record/@default_auction_ranking}');
                // record.set('tax_included_flag', '${/model/pur51302_default_rfx_type/record/@tax_flag}');
            
                // record.set('sealed_bid_flag', '${/model/pur51302_default_rfx_type/record/@default_seal_quote}');
                // record.set('tax_type_desc', '${/model/pur51302_default_rfx_type/record/@tax_type_desc}');
                // record.set('tax_type_rate', '${/model/pur51302_default_rfx_type/record/@tax}');
                // record.set('tax_type_code', '${/model/pur51302_default_rfx_type/record/@tax_code}');
                // record.set('tax_type_id', '${/model/pur51302_default_rfx_type/record/@tax_id}');
                // record.set('business_unit_id', '${/model/pur51302_default_rfx_type/record/@business_unit_id}');
                // record.set('pur_organization_id', '${/model/pur51302_default_rfx_type/record/@pur_organization_id}');
                // record.set('pur_organization_name', '${/model/pur51302_default_rfx_type/record/@pur_organization_name}');
                // record.set('business_unit_name', '${/model/pur51302_default_rfx_type/record/@business_unit_name}');
                // record.set('pur_organization_require_flag', '${/model/pur51302_default_rfx_type/record/@pur_organization_require_flag}');
                // record.set('company_id', '${/model/pur51302_default_rfx_type/record/@company_id}');
                // record.set('department_approve_flag', '${/model/pur51302_default_rfx_type/record/@department_approve_flag}');
                // record.set('price_category', '${/model/pur51302_default_rfx_type/record/@price_category}');
                // record.set('price_category_desc', '${/model/pur51302_default_rfx_type/record/@price_category_desc}');
                // record.set('agent_require_flag', '${/model/pur51302_default_rfx_type/record/@agent_require_flag}');
                var functional_currency_code = record.get('functional_currency_code');
                var currency_code = record.get('currency_code');
                if (functional_currency_code != currency_code) {
                    record.getMeta().getField('exchange_rate').setRequired(true);
                    record.getMeta().getField('exchange_rate').setReadOnly(false);
                } else {
                    record.set('exchange_rate', 1);
                    record.getMeta().getField('exchange_rate').setRequired(false);
                    record.getMeta().getField('exchange_rate').setReadOnly(true);
                }
            
                var tax_included_flag = record.get('tax_included_flag');
                if (tax_included_flag == 'Y') {
                    record.getMeta().getField('tax_type_desc').setRequired(true);
                    record.getMeta().getField('tax_type_desc').setReadOnly(false);
                } else {
                    record.getMeta().getField('tax_type_desc').setRequired(false);
                    record.getMeta().getField('tax_type_desc').setReadOnly(true);
                }
                if (Aurora.isEmpty(record.get("tax_included_flag"))) {
                    record.set("tax_included_flag", 'N');
                }
            
            }
            
            function jkpur5910_set_rfx_header_rules(record, rfx_category) {
                if (rfx_category == 'RFA') { //竞价单
            
                    record.getMeta().getField('open_rule_desc').setRequired(true);
                    record.getMeta().getField('open_rule_desc').setReadOnly(false);
            
            
                    record.getMeta().getField('auction_ranking_desc').setRequired(true);
                    record.getMeta().getField('auction_ranking_desc').setReadOnly(false);
            
                    // record.set('sealed_bid_flag', 'Y');
                    // record.getMeta().getField('sealed_bid_flag').setReadOnly(true);
            
                } else { //不为竞价单
            
                    record.set('open_rule', '');
                    record.set('open_rule_desc', '');
                    record.getMeta().getField('open_rule_desc').setRequired(false);
                    record.getMeta().getField('open_rule_desc').setReadOnly(true);
            
                    record.set('auction_ranking', '');
                    record.set('auction_ranking_desc', '');
                    record.getMeta().getField('auction_ranking_desc').setRequired(false);
                    record.getMeta().getField('auction_ranking_desc').setReadOnly(true);
            
                    // record.set('sealed_bid_flag', 'N');
                    // record.getMeta().getField('sealed_bid_flag').setReadOnly(false);
            
                }
            
            }
            
            
            function jkpur5910_rfx_create() {
                var header_ds = $('jkpur5910_rfx_headers_ds');
                var header_record = header_ds.getCurrentRecord();
                header_record.set('source_from', 'MANUAL');
                if (!header_ds.validate()) {
                    return;
                }
                var data = header_record.data;
                if (Aurora.isEmpty(header_record.get('rfx_header_id'))) {
                    data._status = 'insert';
                } else {
                    data._status = 'update';
                }
                jkpur5910_mask();
                Aurora.request({
                    url: $('jkpur5910_rfx_create_link').getUrl(),
                    para: data,
                    success: function(result) {
                        jkpur5910_unmask();
                        var rfx_header_id = result.result.rfx_header_id;
                        Aurora.showMessage('${l:PROMPT}', '${l:PUR5120.RFX_CREATION_SUCCESSFULLY}', function() {
                            new Aurora.Window({
                                id: 'jkpur5910_rfx_manual_maintain_window',
                                title: '招竞标维护',
                                url: $('jkpur5910_rfx_manual_maintain_link').getUrl() + '?rfx_header_id=' + rfx_header_id,
                                fullScreen: true
                            });
                            jkpur5910_reback();
                        });
            
                    },
                    failure: function() {
                        jkpur5910_unmask();
                        return;
                    },
                    error: function() {
                        jkpur5910_unmask();
                        return;
                    }
                });
            }
            
            //保存
            function jkpur5910_save() {
                var header_ds = $('jkpur5910_rfx_headers_ds');
                var header_record = header_ds.getCurrentRecord(); 
                header_record.getMeta().getField('pur_organization_name').setRequired(false);
                header_record.getMeta().getField('agent_name').setRequired(false);
                header_record.getMeta().getField('title').setRequired(false);
                header_record.getMeta().getField('rfx_method_desc').setRequired(false);
                header_record.getMeta().getField('source_type_desc').setRequired(false);
                header_record.getMeta().getField('currency_desc').setRequired(false);
                header_record.getMeta().getField('payment_method_desc').setRequired(false);
                header_record.getMeta().getField('start_date').setRequired(false);
                header_record.getMeta().getField('end_date').setRequired(false);
                header_record.getMeta().getField('open_rule_desc').setRequired(false); 
                header_record.getMeta().getField('ranking_rule_desc').setRequired(false); 
                header_record.getMeta().getField('place_of_delivery').setRequired(false); 
                header_record.getMeta().getField('rfx_mode').setRequired(false); 
                header_record.getMeta().getField('price_category_desc').setRequired(false); 
                header_record.getMeta().getField('extend_date').setRequired(false);  
                header_record.getMeta().getField('auction_direction_desc').setRequired(false);                                           
                header_record.set('source_from', 'MANUAL');
                if (!header_ds.validate()) {
                    return;
                }
                var data = header_record.data;
                if (Aurora.isEmpty(header_record.get('rfx_header_id'))) {
                    data._status = 'insert';
                } else {
                    data._status = 'update';
                }
                jkpur5910_mask();
                Aurora.request({
                    url: $('jkpur5910_rfx_create_link').getUrl(),
                    para: data,
                    success: function(result) {
                        jkpur5910_unmask();
                        var rfx_header_id = result.result.rfx_header_id;
                        Aurora.showMessage('${l:PROMPT}', '${l:PUR5120.RFX_CREATION_SUCCESSFULLY}', function() {
                            new Aurora.Window({
                                id: 'jkpur5910_rfx_manual_maintain_window',
                                title: '招竞标维护',
                                url: $('jkpur5910_rfx_manual_maintain_link').getUrl() + '?rfx_header_id=' + rfx_header_id,
                                fullScreen: true
                            });
                            jkpur5910_reback();
                        });
            
                    },
                    failure: function() {
                        jkpur5910_unmask();
                        return;
                    },
                    error: function() {
                        jkpur5910_unmask();
                        return;
                    }
                });
            }
            
            function jkpur5910_window_reload() {
                var url = $('jkpur5910_rfx_manual_maintain_link').getUrl();
            
                var header_record = $('jkpur5910_rfx_headers_ds').getCurrentRecord();
                var rfx_header_id = header_record.get('rfx_header_id');
                url += '?rfx_header_id=' + rfx_header_id;
                url += '&created_flag=' + '${/parameter/@created_flag}';
            
                //window.location.href=url;
                var items = $('mainTab').items;
                var index;
                for (var i = 0;i < items.length;i++) {
                    var item = items[i];
                    if (item.ref == document.getElementById('MAIN_screen_name').value) {
                        index = i;
                        break;
                    }
                }
                $('mainTab').reloadTab(index, url);
            }
            
            
            function jkpur5910_reback() {
                $('jkpur5910_rfx_manual_create_window').close();
            }
            
            function jkpur5910_rfx_ln_items_ds_load(ds) {
                var records = ds.getAll();
                for (var i = 0;i < records.length;i++) {
                    var business_unit_id = records[i].get('business_unit_id');
                    var inv_organization_id = records[i].get('inv_organization_id');
                    var item_category_id = records[i].get('item_category_id');
                    if (!Aurora.isEmpty(business_unit_id)) {
                        records[i].getField('inv_organization_desc').setLovPara('business_unit_id', business_unit_id);
                    }
                    if (!Aurora.isEmpty(inv_organization_id)) {
                        records[i].getField('item_code').setLovPara('inv_organization_id', inv_organization_id);
                    }
                    if (!Aurora.isEmpty(item_category_id)) {
                        records[i].getField('item_code').setLovPara('item_category_id', item_category_id);
                    }
                }
            }
            
            function jkpur5910_rfx_ln_items_grid_cellclick(grid, row, name, record) {
                var business_unit_id = record.get('business_unit_id');
                if (name == 'item_code') {
                    record.getField('item_code').setLovPara('business_unit_id', business_unit_id);
            
                    if (Aurora.isEmpty(record.get('inv_organization_id'))) {
                        record.getField('item_code').setLovPara('inv_organization_id', -1);
                    } else {
                        record.getField('item_code').setLovPara('inv_organization_id', record.get('inv_organization_id'));
                    }
            
                    var item_category_id = record.get('item_category_id');
                    if (Aurora.isEmpty(item_category_id)) {
                        record.getField('item_code').setLovPara('item_category_id', -1);
                    } else {
                        record.getField('item_code').setLovPara('item_category_id', item_category_id);
                    }
                } else if (name == 'quote_name') {
                    grid.focusRow(row);
                }
            }
            
            
            function jkpur5910_rfx_ln_items_ds_update(ds, record, name, value, oldvalue) {
                if (name == 'business_unit_id') {
                    record.set('inv_organization_id', '');
                    record.set('inv_organization_code', '');
                    record.set('inv_organization_desc', '');
                    record.getField('inv_organization_desc').setLovPara('business_unit_id', value);
                } else if (name == 'inv_organization_id') {
                    record.set('item_id', '');
                    record.set('item_code', '');
                    record.set('item_desc', '');
                    record.getField('item_code').setLovPara('inv_organization_id', value);
                } else if (name == 'item_category_desc') {
                    if (Aurora.isEmpty(value)) {
                        record.set('item_category_id', '');
                    }
                } else if (name == 'item_category_id') {
                    //自主品类变更,清除当前record下的对应的报价模板创建ds中数据
                    var quote_lines = record.get('quote_lines');
                    if (quote_lines) {
                        for (var i = quote_lines.data.length - 1;i >= 0;i--) {
                            var quote_line_rec = quote_lines.data[i];
                            $('jkpur5910_rfx_quote_create_ds').remove(quote_line_rec);
                        }
                    }
            
                    if (!Aurora.isEmpty(value)) {
                        jkpur5910_mask();
                        $('jkpur5910_rfx_quote_query_ds').setQueryParameter('item_category_id', value);
                        $('jkpur5910_rfx_quote_query_ds').query();
                    }
                }
            }
            
            
            function jkpur5910_rfx_quote_query_ds_loadFun(ds) {
                jkpur5910_unmask();
                var records = ds.getAll();
                for (var i = 0;i < records.length;i++) {
                    $('jkpur5910_rfx_quote_create_ds').add(records[i]);
                }
            }
            
            function jkpur5910_rfx_ln_items_ds_add(ds, record, index) {
                var business_unit_id = $('jkpur5910_rfx_headers_ds').getCurrentRecord().get('business_unit_id');
                if (Aurora.isEmpty(business_unit_id)) {
                    Aurora.showMessage('${l:PROMPT}', '${l:PUR5130.CHOOSE_BU_FIRST_THEN_ADD_ITEM}');
                    return false;
                }
                record.set('business_unit_id', business_unit_id);
                record.set('line_num', index + 1);
            }
            
            function jkpur5910_rfx_ln_items_ef(record, name) {
                if (name == 'item_category_desc') {
                    var item_id = record.get('item_id');
                    if (Aurora.isEmpty(item_id)) {
                        return 'jkpur5910_item_category_desc_lov';
                    }
                    return '';
                }
            }
            
            function jkpur5910_rfx_ln_vendors_ds_load(ds) {
                var records = ds.getAll();
                for (var i = 0;i < records.length;i++) {
                    var coop_company_id = records[i].get('coop_company_id');
                    if (!Aurora.isEmpty(coop_company_id)) {
                        records[i].getField('contact_person').setLovPara('vendor_company_id', coop_company_id);
                        records[i].getField('contact_person').setReadOnly(false);
                    }
                }
            }
            
            function jkpur5910_rfx_ln_vendors_ds_update(ds, record, name, value, oldvalue) {
                if (name == 'coop_company_id') {
                    record.set('vendor_contact_id', '');
                    record.set('contact_person', '');
                    record.set('contact_mobile', '');
                    record.set('e_mail', '');
                    if (Ext.isEmpty(value)) {
                        record.getField('contact_person').setLovPara('vendor_company_id', -1);
                        record.getField('contact_person').setReadOnly(true);
                    } else {
                        record.getField('contact_person').setLovPara('vendor_company_id', value);
                        record.getField('contact_person').setReadOnly(false);
                    }
                }
            }
            
            function jkpur5910_rfx_ln_vendors_ds_beforecreate(ds, object) {
                var rfx_method = $('jkpur5910_rfx_headers_ds').getCurrentRecord().get('rfx_method');
                if (rfx_method == 'OPEN') {
                    Aurora.showMessage('${l:PROMPT}', '${l:PUR5120.OPEN_RFX_VENDOR_REMAIN}');
                    return false;
                }
                return true;
            }
            
            function jkpur5910_mask() {
                Aurora.Masker.mask($('jkpur5910_rfx_manual_create_window').wrap, '${l:LOADING}');
            }
            
            function jkpur5910_unmask() {
                Aurora.Masker.unmask($('jkpur5910_rfx_manual_create_window').wrap);
            }
            
            //上传附件
            
            function jkpur5910_atch_num_rd(value, record, name) {
                var ds = $('jkpur5910_rfx_ln_attachments');
                var line_num = ds.indexOf(record);
            
                return (line_num + 1) * 10;
            
            }
            
            function jkpur5910_upload_render(value, record, name) {
                var atm_line_id = record.get('atm_line_id');
                if (!record.isNew && atm_line_id) {
                    return '<a href="javascript:jkpur5910_upload_file(' + atm_line_id + ')">${l:PROMPT.UPLOAD_DOWNLOAD}</a>';
                }
            }
            
            function jkpur5910_upload_file(id) {
                var url = "${/request/@context_path}/uploadFile.screen?table_name=PUR_RFX_HEADERS&header_id=" + id;
                new Aurora.Window({
                    url: url,
                    title: '${l:ATM.UPLOAD_ATTCHMENT}',
                    id: 'jkpur5910_upload_window',
                    width: 850,
                    height: 500
                }).on('beforeclose', function() {
                    $('jkpur5910_rfx_ln_attachments').query();
                });
            }
            
            //比较两个日期的大小
            
            function jkpur5910_compareDate(start, end) {
            
                if (typeof(start) == 'string') {
                    start = new Date(start.replace(/-/g, '/'));
                }
            
                if (typeof(end) == 'string') {
                    end = new Date(end.replace(/-/g, '/'));
                }
            
                if (start > end) {
                    return false;
                }
                return true;
            }
            
            
            function jkpur5910_vendors_grid_cellclick(grid, row, name, record) {
                var head_record = $('jkpur5910_rfx_headers_ds').getCurrentRecord();
                var company_id = head_record.get('company_id');
                if (name == 'vendor_code') {
                    record.getField('vendor_code').setLovPara('company_id', company_id);
                }
            }
            
            function jkpur5910_rfx_ln_vendors_ds_add(ds, record, index) {
                var business_unit_id = $('jkpur5910_rfx_headers_ds').getCurrentRecord().get('business_unit_id');
                if (Aurora.isEmpty(business_unit_id)) {
                    Aurora.showMessage('${l:PROMPT}', '${l:PUR5130.CHOOSE_BU_FIRST_THEN_ADD_VENDOR}');
                    return false;
                }
            }
            
            
            function jkpur5910_quoteCreateRendererFun(value, record, name) {
                var item_category_id = record.get('item_category_id');
                var quote_tmpl_flag = record.get('quote_tmpl_flag');
                if (!Aurora.isEmpty(item_category_id) && quote_tmpl_flag == 'Y') {
                    return '<a href="javascript:jkpur5910_quoteCreateFun(' + ')">${l:PUR_RFX_QUOTE_TITLE}</a>';
                }
                return '';
            }
            
            function jkpur5910_quoteCreateFun() {
                new Aurora.Window({
                    url: $('jkpur5910_rfx_quote_create_link').getUrl(),
                    title: '${l:PUR_RFX_QUOTE_TITLE}',
                    id: 'jkpur5910_rfx_quote_create_window',
                    width: 500,
                    height: 380
                });
            }
            //竞标规则                      
            function jkpur5910_config_agreement_open() {
                Aurora.Masker.mask(Ext.getBody(), '正在跳转竞标规则页面...');
                new Aurora.Window({
                    id:'jkpur5910_agreement_confirm_window',
                    url:$('jkpur5910_agreement_confirm_link').getUrl() + '?agreement_type=BCD' + '&owner_business_group=${/session/@business_group}',
                    fullScreen: true
                }).on('close',function(){
                    Aurora.Masker.unmask(Ext.getBody());
                });                
            } 
        ]]></script>
        <a:dataSets>
            <a:dataSet id="pur51302_bg_rfx_type_ds" autoCreate="true" loadData="true">
                <a:datas dataSource="/model/pur51302_bg_rfx_type"/>
            </a:dataSet>
            <a:dataSet id="jkpur5910_rfx_category_ds" lookupCode="PUR_RFX_CATEGORY"/>
            <a:dataSet id="jkpur5910_rfx_method_ds" lookupCode="JK_ZJB_METHOD"/>
            <a:dataSet id="jkpur5910_rfx_model_ds" lookupCode="JK_ZJB_MODEL"/>
            <a:dataSet id="jkpur5910_rfx_auction_directions_ds" lookupCode="PUR_RFX_AUCTION_DIRECTION"/>
            <a:dataSet id="jkpur5910_rfx_auction_rule_ds" lookupCode="PUR_RFX_AUCTION_RULE"/>
            <a:dataSet id="jkpur5910_rfx_open_rule_ds" lookupCode="PUR_RFX_OPEN_RULE"/>
            <a:dataSet id="jkpur5910_rfx_ranking_rule_ds" lookupCode="PUR_RFX_AUCTION_RANKING"/>
            <a:dataSet id="pur51302_price_category_ds" lookupCode="PUR_RFX_PRICE_CATEGORY"/>
            <a:dataSet id="jkpur5910_rfx_auction_ranking_ds" lookupCode="PUR_RFX_AUCTION_RANKING"/>
            <a:dataSet id="jkpur5910_rfx_document_type_ds" lookupCode="JK_ZJB_DOCUMENT_TYPE"/>
            <!-- <a:dataSet id="jkpur5910_pur_ln_type_ds" lookupCode="PUR_REQ_LINE_PURCHASE_TYPE"/> -->
            <!--  <a:dataSet id="jkpur5910_pur_ln_type_ds" autoQuery="true" loadData="true" model="pur.public.pur_line_type"/> -->
            <a:dataSet id="jkpur5910_payment_method_ds" autoCreate="true" loadData="true">
                <a:datas dataSource="/model/jkpur5910_payment_methods_source"/>
            </a:dataSet>
            <a:dataSet id="jkpur5910_currency_ds" autoCreate="true" loadData="true">
                <a:datas dataSource="/model/jkpur5910_currency_source"/>
            </a:dataSet>
            <a:dataSet id="jkpur5910_tax_type_code_ds" autoCreate="true" autoQuery="true" fetchAll="true" queryUrl="${/request/@context_path}/autocrud/public.fnd_tax_type_code_lov/query?business_group=${/session/@business_group}"/>
            <!--寻源类型-->
            <a:dataSet id="jkpur5910_source_type_ds" lookupCode="JK_ZJB_SOURCE_TYPE"/>
            <a:dataSet id="jkpur5910_rfx_headers_ds" autoCreate="true">
                <!--  <a:datas dataSource="/model/jkpur5910_rfx_header_init_source"/> -->
                <a:fields>
                    <a:field name="document_type_code" defaultValue="ZJB"/>
                    <a:field name="document_type" defaultValue="招竞标" displayField="code_value_name" options="jkpur5910_rfx_document_type_ds" readOnly="true" required="true" returnField="document_type_code" valueField="code_value"/>
                    <a:field name="rfx_header_id"/>
                    <a:field name="source_from" defaultValue="MANUAL"/>
                    <a:field name="rfx_number" readOnly="true"/>
                    <a:field name="company_id"/>
                    <a:field name="pur_organization_name" autoComplete="true" autoCompleteField="pur_organization_code_name" autoCompleteSize="2" lovHeight="480" lovService="public.pur_organization_lov" lovWidth="510" required="true" requiredMessage="${l:PUR_RFX_HEADERS.CHOOSE_ORG}" title="PUR_ORGANIZATIONS.PUR_ORGANIZATION">
                        <a:mapping>
                            <a:map from="pur_organization_id" to="pur_organization_id"/>
                            <a:map from="pur_organization_code" to="pur_organization_code"/>
                            <a:map from="pur_organization_name" to="pur_organization_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="business_unit_name" autoComplete="true" autoCompleteField="business_unit_code_name" autoCompleteSize="2" lovHeight="480" lovService="public.fnd_business_unit_lov" lovWidth="510" required="true" requiredMessage="${l:PUR_RFX_HEADERS.CHOOSE_BU}" title="FND_BUSINESS_UNITS.BUSINESS_UNIT_QUERY">
                        <a:mapping>
                            <a:map from="business_unit_id" to="business_unit_id"/>
                            <a:map from="business_unit_code" to="business_unit_code"/>
                            <a:map from="business_unit_name" to="business_unit_name"/>
                            <a:map from="company_id" to="company_id"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="title" required="true" requiredMessage="${l:PUR5130.PLEASE_FILL_RFX_TITLE}"/>
                    <!-- <a:field name="rfx_category"/>
                    <a:field name="rfx_category_desc" displayField="code_value_name" options="jkpur5910_rfx_category_ds" required="true" returnField="rfx_category" valueField="code_value"/>
                     -->
                    <a:field name="rfx_mode" displayField="code_value_name" options="jkpur5910_rfx_model_ds" required="true" returnField="rfx_mode_code" valueField="code_value"/>
                    <a:field name="rfx_method"/>
                    <a:field name="rfx_method_desc" displayField="code_value_name" options="jkpur5910_rfx_method_ds" required="true" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_RFX_MODE}" returnField="rfx_method" valueField="code_value"/>
                    <a:field name="auction_direction"/>
                    <a:field name="auction_direction_desc" displayField="code_value_name" options="jkpur5910_rfx_auction_directions_ds" required="true" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_BIDDING_DIRECTION}" returnField="auction_direction" valueField="code_value"/>
                    <a:field name="auction_rule"/>
                    <a:field name="auction_rule_desc" displayField="code_value_name" options="jkpur5910_rfx_auction_rule_ds" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_BIDDING_RULE}" returnField="auction_rule" valueField="code_value"/>
                    <a:field name="open_rule"/>
                    <a:field name="open_rule_desc" displayField="code_value_name" options="jkpur5910_rfx_open_rule_ds" required="true" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_BIDDING_RULE}" returnField="open_rule" valueField="code_value"/>
                    <a:field name="ranking_rule"/>
                    <a:field name="ranking_rule_desc" displayField="code_value_name" options="jkpur5910_rfx_ranking_rule_ds" required="true" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_RANK_RULE}" returnField="ranking_rule" valueField="code_value"/>
                    <a:field name="auction_ranking"/>
                    <a:field name="auction_ranking_desc" displayField="code_value_name" options="jkpur5910_rfx_auction_ranking_ds" returnField="auction_ranking" valueField="code_value"/>
                    <a:field name="payment_method_id"/>
                    <a:field name="payment_method_desc" displayField="payment_method_desc" options="jkpur5910_payment_method_ds" required="true" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_PAYMENT_TERM}" returnField="payment_method_id" valueField="payment_method_id"/>
                    <a:field name="currency_code"/>
                    <a:field name="currency_desc" displayField="currency_name" options="jkpur5910_currency_ds" required="true" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_CURRENCY}" returnField="currency_code" valueField="currency_code">
                        <a:mapping>
                            <a:map from="currency_name" to="currency_desc"/>
                            <a:map from="currency_code" to="currency_code"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="exchange_rate" readOnly="true" requiredMessage="${l:PUR5130.PLEASE_FILL_EXCHANGE_RATE}"/>
                    <a:field name="tax_included_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="tax_type_id"/>
                    <a:field name="tax_type_desc" lovHeight="480" lovService="public.fnd_tax_type_code_lov?business_group=${/session/@business_group}" lovWidth="500" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_TAX_CODE}" title="PUR_REQ_LINES.TAX_TYPE_RATE">
                        <a:mapping>
                            <a:map from="tax_type_id" to="tax_type_id"/>
                            <a:map from="tax_type_code" to="tax_type_code"/>
                            <a:map from="description" to="tax_type_desc"/>
                            <a:map from="tax_type_rate" to="tax_type_rate"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="tax_type_rate" readOnly="true"/>
                    <a:field name="place_of_delivery" required="true"/>
                    <a:field name="round" readOnly="true"/>
                    <a:field name="status_desc" readOnly="true"/>
                    <a:field name="feedback_range"/>
                    <a:field name="created_by"/>
                    <a:field name="created_by_desc" readOnly="true"/>
                    <a:field name="creation_date_desc" readOnly="true"/>
                    <a:field name="issued_date_desc" readOnly="true"/>
                    <a:field name="comments"/>
                    <a:field name="unique_template_flag"/>
                    <a:field name="sealed_bid_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="price_category_desc" displayField="code_value_name" options="pur51302_price_category_ds" required="true" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_PRICE_CATEGORY}" returnField="price_category" valueField="code_value"/>
                    <a:field name="source_type_desc" displayField="code_value_name" options="jkpur5910_source_type_ds" required="true" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_SOURCE_TYPE}" returnField="source_type" valueField="code_value"/>
                    <a:field name="department_approve_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="agent_name" autoComplete="true" autoCompleteField="code_name" lovGridHeight="320" lovHeight="480" lovService="public.pur_buyers_lov" lovWidth="500" required="true" requiredMessage="${l:PUR5130.RFX_GROUP_NOT_NULL}" title="PUR_HEADERS_ALL.PUR_BUYER">
                        <a:mapping>
                            <a:map from="buyer_id" to="agent_id"/>
                            <a:map from="buyer_code" to="agent_code"/>
                            <a:map from="description" to="agent_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="start_date" required="true"/>
                    <a:field name="end_date" required="true"/>
                    <a:field name="extend_date" required="true"/>
                    <a:field name="payment_description" autoComplete="true" autoCompleteField="payment_description_name" lovHeight="480" lovService="cux.JINKO.PUR.JKPUR5910.jkpur_rfx_payment_terms" lovWidth="510" required="true" title="付款条款">
                        <a:mapping>
                            <a:map from="payment_term_id" to="payment_term_id"/>
                            <a:map from="payment_term_code" to="payment_term_code"/>
                            <a:map from="payment_description" to="payment_description"/>
                        </a:mapping>
                    </a:field>
                </a:fields>
                <a:events>
                    <a:event name="update" handler="jkpur5910_rfx_headers_ds_update"/>
                    <a:event name="load" handler="jkpur5910_rfx_headers_ds_load"/>
                </a:events>
            </a:dataSet>
        </a:dataSets>
        <a:screenBody>
            <a:screenTopToolbar>
                <a:toolbarButton click="jkpur5910_rfx_create" style="margin-left:20px;" text="PUR5120.CREATE" width="100"/>
                <a:toolbarButton id="jkpur5910_reback_button" click="jkpur5910_reback" text="HAP_BACK" width="100"/>
                <a:toolbarButton id="jkpur5910_save_button" click="jkpur5910_save" text="HAP_SAVE" width="100"/>
            </a:screenTopToolbar>
            <a:vBox labelWidth="120" padding="0">
                <a:hBox labelWidth="120">
                    <a:textField name="rfx_number" bindTarget="jkpur5910_rfx_headers_ds" emptyText="PROMPT.NOT_GENERATED" prompt="竞标书单号" readOnly="true"/>
                    <a:lov name="pur_organization_name" bindTarget="jkpur5910_rfx_headers_ds" prompt="PUR_ORGANIZATIONS.PUR_ORG_NAME"/>
                    <a:lov name="agent_name" bindTarget="jkpur5910_rfx_headers_ds" prompt="PUR5130.RFX_GROUP"/>
                    <a:lov name="business_unit_name" bindTarget="jkpur5910_rfx_headers_ds" prompt="FND_BUSINESS_UNITS.BUSINESS_UNIT"/>
                </a:hBox>
                <a:hBox labelWidth="120">
                    <a:textField name="title" bindTarget="jkpur5910_rfx_headers_ds" prompt="竞标书标题"/>
                    <a:comboBox name="document_type" bindTarget="jkpur5910_rfx_headers_ds" prompt="单据类型"/>
                    <a:comboBox name="rfx_method_desc" bindTarget="jkpur5910_rfx_headers_ds" prompt="招竞标方式"/>
                    <a:comboBox name="auction_direction_desc" bindTarget="jkpur5910_rfx_headers_ds" prompt="竞标方向"/>
                </a:hBox>
                <a:hBox labelWidth="120">
                    <a:comboBox name="source_type_desc" bindTarget="jkpur5910_rfx_headers_ds" prompt="竞标类型"/>
                    <a:comboBox name="currency_desc" bindTarget="jkpur5910_rfx_headers_ds" prompt="PUR_RFX_HEADERS.CURRENCY_CODE"/>
                    <a:comboBox name="payment_method_desc" bindTarget="jkpur5910_rfx_headers_ds" prompt="PUR_RFX_HEADERS.PAYMENT_METHOD_ID"/>
                    <a:numberField name="exchange_rate" allowDecimals="true" allowFormat="true" allowNegative="false" bindTarget="jkpur5910_rfx_headers_ds" decimalPrecision="8" prompt="PUR_RFX_HEADERS.EXCHANGE_RATE"/>
                </a:hBox>
                <a:hBox labelWidth="120">
                    <a:lov name="payment_description" bindTarget="jkpur5910_rfx_headers_ds" prompt="付款条款"/>
                    <a:dateTimePicker name="start_date" bindTarget="jkpur5910_rfx_headers_ds" prompt="竞标开始时间"/>
                    <a:dateTimePicker name="end_date" bindTarget="jkpur5910_rfx_headers_ds" prompt="竞标截止时间"/>
                </a:hBox>
                <a:hBox labelWidth="120">
                    <a:textArea name="comments" bindTarget="jkpur5910_rfx_headers_ds" prompt="邀标条款" width="700"/>
                    <a href="javascript:jkpur5910_config_agreement_open()" style="margin-left: 50px;color: blue;"><![CDATA[竞标规则]]></a>
                </a:hBox>
                <a:hBox>
                    <a:accordionPanel id="pur5120_accordion_dim" height="180" showIcon="true" singleMode="false" width="1200">
                        <a:accordions>
                            <a:accordion prompt="PUR_RFX_HEADERS.OTHER_INFO" selected="true">
                                <a:vBox>
                                    <a:hBox labelWidth="120">
                                        <a:checkBox name="tax_included_flag" bindTarget="jkpur5910_rfx_headers_ds" prompt="PUR_RFX_HEADERS.TAX_INCLUDED_FLAG" width="152"/>
                                        <a:lov name="tax_type_desc" bindTarget="jkpur5910_rfx_headers_ds" prompt="PUR_RFX_HEADERS.TAX_CODE"/>
                                        <a:textField name="tax_type_rate" bindTarget="jkpur5910_rfx_headers_ds" prompt="PUR_RFX_HEADERS.TAX_RATE" width="185"/>
                                        <a:dateTimePicker name="creation_date_desc" bindTarget="jkpur5910_rfx_headers_ds" prompt="PUR_RFX_HEADERS.CREATION_DATE"/>
                                    </a:hBox>
                                    <a:hBox labelWidth="120">
                                        <a:textField name="created_by_desc" bindTarget="jkpur5910_rfx_headers_ds" prompt="创建人"/>
                                        <a:comboBox name="open_rule_desc" bindTarget="jkpur5910_rfx_headers_ds" prompt="PUR_RFX_HEADERS.OPEN_RULE"/>
                                        <a:comboBox name="ranking_rule_desc" bindTarget="jkpur5910_rfx_headers_ds" prompt="竞标排名规则" width="185"/>
                                        <a:textField name="place_of_delivery" bindTarget="jkpur5910_rfx_headers_ds" prompt="PUR_RFX_HEADERS.PLACE_OF_DELIVERY"/>
                                    </a:hBox>
                                    <a:hBox labelWidth="120" style="margin-left:-3px;">
                                        <a:comboBox name="rfx_mode" bindTarget="jkpur5910_rfx_headers_ds" prompt="竞标模式"/>
                                        <a:comboBox name="price_category_desc" bindTarget="jkpur5910_rfx_headers_ds" prompt="标准/样件"/>
                                        <a:numberField name="extend_date" allowNegative="false" bindTarget="jkpur5910_rfx_headers_ds" decimalPrecision="2" prompt="延长截标时间（m）" width="185"/>
                                    </a:hBox>
                                </a:vBox>
                            </a:accordion>
                        </a:accordions>
                    </a:accordionPanel>
                </a:hBox>
            </a:vBox>
        </a:screenBody>
        <script><![CDATA[
            Aurora.onReady(function() {
            });
        ]]></script>
    </a:view>
</a:screen>

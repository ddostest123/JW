<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author:  
    $Date:  
    $Revision: 1.0  
    $Purpose: 考评档案
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application">
    <a:init-procedure>
        <a:model-query defaultWhereClause="flex_value_set_code = &apos;VES_ARC_DETAIL_LINE_STATUS&apos;" fetchAll="true" model="public.fnd_flex_value_v_lov" rootPath="jk_ves5010_arc_detail_line_status_data"/>
        <a:model-query defaultWhereClause="flex_value_set_code = &apos;VES_ARC_TOTAL_LINE_STATUS&apos;" fetchAll="true" model="public.fnd_flex_value_v_lov" rootPath="jk_ves5010_arc_total_line_status_data"/>
        <a:model-query defaultWhereClause="flex_value_set_code = &apos;VES_ARCHIVE_SUGGESTION&apos;" fetchAll="true" model="public.fnd_flex_value_v_lov" rootPath="jk_ves5010_archive_suggestion_data"/>
        <a:model-query defaultWhereClause="flex_value_set_code = &apos;VES_ARCHIVE_RISK_LEVEL&apos;" fetchAll="true" model="public.fnd_flex_value_v_lov" rootPath="jk_ves5010_archive_risk_level_data"/>
    </a:init-procedure>
    <a:view>
        <a:link id="jk_ves5010_archive_check_link" model="cux.JINKO.VES.JK_VES5010.jk_ves_check_archive_evaled" modelaction="query"/>
        <a:link id="jk_ves5010_item_category_classify_link" url="${/request/@context_path}/modules/ves/VES5010/ves5010_category_classify_items.screen"/>
        <a:link id="jk_ves5010_archive_operation_records_link" url="${/request/@context_path}/modules/ves/ves_archive_operation_records.screen"/>
        <a:link id="jk_ves5010_archive_create_save_link" model="cux.JINKO.VES.JK_VES5010.jk_ves_archive_headers" modelaction="insert"/>
        <a:link id="jk_ves5010_archive_update_save_link" model="cux.JINKO.VES.JK_VES5010.jk_ves_archive_headers" modelaction="update"/>
        <a:link id="jk_ves5010_archive_disable_link" model="cux.JINKO.VES.JK_VES5010.jk_ves_archive_headers" modelaction="delete"/>
        <a:link id="jk_ves5010_archive_detail_line_compute_link" model="cux.JINKO.VES.JK_VES5010.jk_ves_archive_headers" modelaction="execute"/>
        <a:link id="jk_ves5010_archive_release_computation_link" model="ves.VES5010.ves_archive_release_computation" modelaction="execute"/>
        <a:link id="jk_ves5010_archive_summary_detail_link" model="cux.JINKO.VES.JK_VES5010.jk_ves_archive_summary_detail" modelaction="execute"/>
        <a:link id="jk_ves5010_archive_header_release_link" model="ves.VES5010.ves_archive_header_release" modelaction="execute"/>
        <script><![CDATA[
            function init() {
                var archive_header_id = '${/parameter/@archive_header_id}' || 0;
                if (archive_header_id) {
                    ves5010_archive_maintain_query(archive_header_id);
                } else {
                    $('jk_ves5010_archive_header_maintain_ds').create();
                }
            }
            
            //考评日期校检
            
            function ves5010_eval_date_validator(record, name, value) {
                if (name == "eval_start_date" || name == "eval_end_date") {
                    var start_date = record.get("eval_start_date");
                    var end_date = record.get("eval_end_date");
                    if (typeof(end_date) != 'undefined' && !Ext.isEmpty(end_date) && typeof(start_date) != 'undefined' && !Ext.isEmpty(start_date)) {
                        if (start_date > end_date) {
                            return '考评日期从不能大于考评日期至！';
                        }
                    }
                    return true;
                }
            }
            
            
            //保存
            
            function jk_ves5010_archive_maintain_save() {
                var ds = $('jk_ves5010_archive_header_maintain_ds');
                if (ds.validate()) {
            
                    var record = ds.getCurrentRecord();
                    var url, is_evaled;
            
                    //设置考评年度和季度
                    var eval_quarter = record.get('eval_monthly');
                    record.set('eval_year', eval_quarter.split('-')[0]);
                    record.set('eval_season', eval_quarter.split('-')[1]);
            
                    if (record.isNew) {
                        url = $('jk_ves5010_archive_create_save_link').getUrl();
                    } else {
                        url = $('jk_ves5010_archive_update_save_link').getUrl();
                    }
            
                    //判断当前模板，季度是否已经存在考评记录
                    Aurora.Masker.mask($('ves5010_archive_create_win').wrap, '正在提交...');
                    Aurora.request({
                        url: $('jk_ves5010_archive_check_link').getUrl(),
                        para: record.data,
                        success: function(res) {
                            if (res.result.record) {
                                is_evaled = res.result.record.is_evaled || '';
                            }
                            if (is_evaled == 'Y' && !record.get('archive_header_id')) {
                                //更新
                                Aurora.showConfirm('${l:PROMPT}', '已存在相同季度的考评档案，继续作业将导致前一版本的档案作废!', function() {
                                    Aurora.request({
                                        url: url,
                                        para: record.data,
                                        success: function(res) {
                                            var archive_header_id = res.result.archive_header_id ? res.result.archive_header_id : '${/parameter/@archive_header_id}';
                                            Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.SAVE_SUCCESS}', function() {
                                                ves5010_archive_maintain_query(archive_header_id);
                                                Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                                            });
                                        },
                                        error: function() {
                                            Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                                        },
                                        failure: function() {
                                            Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                                        },
                                        scope: this
                                    });
                                }, function() {
                                    Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                                    return;
                                }, 300, 120);
                            } else {
                                Aurora.request({
                                    url: url,
                                    para: record.data,
                                    success: function(res) {
                                        var archive_header_id = res.result.archive_header_id ? res.result.archive_header_id : '${/parameter/@archive_header_id}';
                                        Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.SAVE_SUCCESS}', function() {
                                            ves5010_archive_maintain_query(archive_header_id);
                                            Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                                        });
                                    },
                                    error: function() {
                                        Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                                    },
                                    failure: function() {
                                        Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                                    },
                                    scope: this
                                });
                            }
                        },
                        error: function() {
                            Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                        },
                        failure: function() {
                            Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                        },
                        scope: this
                    });
            
                }
            }
            
            //查询所有考评信息
            
            function ves5010_archive_maintain_query(archive_header_id) {
                $('jk_ves5010_archive_header_maintain_ds').setQueryParameter('archive_header_id', archive_header_id);
                $('jk_ves5010_archive_header_maintain_ds').query();
            
                //考评明细行查询
                $('jk_ves5010_archive_detail_line_maintain_ds').setQueryParameter('archive_header_id', archive_header_id);
                $('jk_ves5010_archive_detail_line_maintain_ds').query();
            
                //考评汇总行查询
                $('jk_ves5010_archive_total_line_maintain_ds').setQueryParameter('archive_header_id', archive_header_id);
                $('jk_ves5010_archive_total_line_maintain_ds').query();
            
                //参评供应商查询
                $('jk_ves5010_archive_assign_vendors_maintain_ds').setQueryParameter('archive_header_id', archive_header_id);
                $('jk_ves5010_archive_assign_vendors_maintain_ds').query();
            }
            
            //提交计算
            
            function jk_ves5010_archive_maintain_compute() {
                var record = $('jk_ves5010_archive_header_maintain_ds').getCurrentRecord(),
                    archive_header_id = record.get('archive_header_id') || 0;
                if (archive_header_id) {
                    if (record.get('archive_status') != '10_NEW') {
                        Aurora.showMessage('${l:PROMPT}', '只有新建状态的考评档案允许提交计算,请重新维护！', function() {}, 300, 120);
                        return;
                    }
                    Aurora.showConfirm('${l:PROMPT}', '是否确认提交计算？', function() {
                        Aurora.Masker.mask($('ves5010_archive_create_win').wrap, '正在提交...');
                        Aurora.request({
                            url: $('jk_ves5010_archive_detail_line_compute_link').getUrl(),
                            para: record.data,
                            success: function() {
                                Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.OPERATION_SUCCESS}', function() {
                                    //考评明细头查询
                                    $('jk_ves5010_archive_header_maintain_ds').setQueryParameter('archive_header_id', archive_header_id);
                                    $('jk_ves5010_archive_header_maintain_ds').query();
                                    //考评明细行查询
                                    $('jk_ves5010_archive_detail_line_maintain_ds').setQueryParameter('archive_header_id', archive_header_id);
                                    $('jk_ves5010_archive_detail_line_maintain_ds').query();
                                    Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                                });
                            },
                            error: function() {
                                Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                            },
                            failure: function() {
                                Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                            },
                            scope: this
                        });
                    }, function() {}, 300, 100);
                } else {
                    Aurora.showMessage('${l:PROMPT}', '数据尚未保存！');
                    return;
                }
            }
            
            //下发评分
            
            function jk_ves5010_archive_maintain_release_compute() {
                var record = $('jk_ves5010_archive_header_maintain_ds').getCurrentRecord(),
                    archive_header_id = record.get('archive_header_id') || 0;
                if (archive_header_id) {
                    if (record.get('archive_status') != '30_COMPUTE_SUCCESS') {
                        Aurora.showMessage('${l:PROMPT}', '只有计算完成的考评档案允许下发评分,请重新维护！', function() {}, 300, 120);
                        return;
                    }
                    Aurora.showConfirm('${l:PROMPT}', '是否确认下发评分？', function() {
                        Aurora.Masker.mask($('ves5010_archive_create_win').wrap, '正在提交...');
                        Aurora.request({
                            url: $('jk_ves5010_archive_release_computation_link').getUrl(),
                            para: record.data,
                            success: function() {
                                Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.OPERATION_SUCCESS}', function() {
                                    Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                                    jk_ves5010_archive_maintain_return();
                                });
                            },
                            error: function() {
                                Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                            },
                            failure: function() {
                                Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                            },
                            scope: this
                        });
                    }, function() {}, 300, 100);
                } else {
                    Aurora.showMessage('${l:PROMPT}', '数据尚未保存！');
                    return;
                }
            }
            
            //汇总统计
            
            function jk_ves5010_archive_maintain_summary() {
                var record = $('jk_ves5010_archive_header_maintain_ds').getCurrentRecord(),
                    archive_header_id = record.get('archive_header_id') || 0,
                    detail_line_records = $('jk_ves5010_archive_detail_line_maintain_ds').getAll();
                if (archive_header_id) {
                    //只有评分中的考评档案允许汇总统计
                    if (record.get('archive_status') != '50_EVALUATING') {
                        Aurora.showMessage('${l:PROMPT}', '只有评分中的考评档案允许汇总统计，请重新维护！', function() {}, 300, 120);
                        return;
                    }
                    //只有所有考评明细都维护评分了才可以进行汇总统计
                    for (var i = 0;i < detail_line_records.length;i++) {
                        if (detail_line_records[i].get('detail_line_status') == '10_NEW') {
                            Aurora.showMessage('${l:PROMPT}', '存在评分员未提交评分,无法进行汇总统计，请重新维护！', function() {}, 300, 120);
                            return;
                        }
                    }
            
                    Aurora.showConfirm('${l:PROMPT}', '是否确认汇总统计？', function() {
                        Aurora.Masker.mask($('ves5010_archive_create_win').wrap, '正在提交...');
                        Aurora.request({
                            url: $('jk_ves5010_archive_summary_detail_link').getUrl(),
                            para: record.data,
                            success: function() {
                                Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.OPERATION_SUCCESS}', function() {
                                    $('jk_ves5010_archive_header_maintain_ds').setQueryParameter('archive_header_id', archive_header_id);
                                    $('jk_ves5010_archive_header_maintain_ds').query();
                                    $('jk_ves5010_archive_total_line_maintain_ds').setQueryParameter('archive_header_id', archive_header_id);
                                    $('jk_ves5010_archive_total_line_maintain_ds').query();
                                    Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                                });
                            },
                            error: function() {
                                Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                            },
                            failure: function() {
                                Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                            },
                            scope: this
                        });
                    }, function() {}, 300, 100);
                } else {
                    Aurora.showMessage('${l:PROMPT}', '数据尚未保存！');
                    return;
                }
            }
            
            //发布
            
            function jk_ves5010_archive_maintain_release() {
                var record = $('jk_ves5010_archive_header_maintain_ds').getCurrentRecord(),
                    archive_header_id = record.get('archive_header_id') || 0;
                if (archive_header_id) {
                    if (record.get('archive_status') != '60_EVALUATE_FINISH') {
                        Aurora.showMessage('${l:PROMPT}', '只有汇总完成的考评档案允许发布,请重新维护！', function() {}, 300, 120);
                        return;
                    }
                    Aurora.showConfirm('${l:PROMPT}', '是否确认发布？', function() {
                        Aurora.Masker.mask($('ves5010_archive_create_win').wrap, '正在提交...');
                        Aurora.request({
                            url: $('jk_ves5010_archive_header_release_link').getUrl(),
                            para: record.data,
                            success: function() {
                                Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.OPERATION_SUCCESS}', function() {
                                    Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                                    jk_ves5010_archive_maintain_return();
                                });
                            },
                            error: function() {
                                Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                            },
                            failure: function() {
                                Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                            },
                            scope: this
                        });
                    }, function() {}, 300, 100);
                } else {
                    Aurora.showMessage('${l:PROMPT}', '数据尚未保存！');
                    return;
                }
            }
            
            //作废
            
            function jk_ves5010_archive_maintain_disable() {
                var record = $('jk_ves5010_archive_header_maintain_ds').getCurrentRecord(),
                    archive_header_id = record.get('archive_header_id') || 0;
                if (archive_header_id) {
                    Aurora.showConfirm('${l:PROMPT}', '是否确认作废？', function() {
                        Aurora.Masker.mask($('ves5010_archive_create_win').wrap, '正在提交...');
                        Aurora.request({
                            url: $('jk_ves5010_archive_disable_link').getUrl(),
                            para: record.data,
                            success: function() {
                                Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.OPERATION_SUCCESS}', function() {
                                    Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                                    jk_ves5010_archive_maintain_return();
                                });
                            },
                            error: function() {
                                Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                            },
                            failure: function() {
                                Aurora.Masker.unmask($('ves5010_archive_create_win').wrap);
                            },
                            scope: this
                        });
                    }, function() {}, 300, 100);
                } else {
                    Aurora.showMessage('${l:PROMPT}', '数据尚未保存！');
                    return;
                }
            }
            
            //操作记录
            
            function jk_ves5010_archive_maintain_operation_records() {
                new Aurora.Window({
                    id: 'ves5010_archive_operation_record_win',
                    title: '操作记录',
                    url: $('jk_ves5010_archive_operation_records_link').getUrl() + '?archive_id=${/parameter/@archive_header_id}',
                    width: 600,
                    height: 550
                });
            }
            
            //返回
            
            function jk_ves5010_archive_maintain_return() {
                $('ves5010_archive_create_win').close();
            }
            
            //数据集更改事件处理
            
            function jk_ves5010_archive_header_maintain_ds_update_handler(dataSet, record, name, value, oldvalue) {
                /*
                 if(name == 'template_id'){
                 //查询考评分明细和参评供应商
                 $('jk_ves5010_archive_detail_line_maintain_ds').setQueryParameter('template_id',value);
                 $('jk_ves5010_archive_detail_line_maintain_ds').query();
                 }   */
            }
            
            //头信息加载处理
            
            function jk_ves5010_archive_header_maintain_ds_load_handler(dataSet) {
                var record = dataSet.getCurrentRecord();
                //非新建状态的考评档案只能更新考评描述，开放系统计算值，考评说明
                if (record.get('archive_header_id')) {
                    record.getField('eval_quarter').setReadOnly(true);
                    record.getField('template_desc').setReadOnly(true);
                    if (record.get('archive_status') != '10_NEW') {
                        //record.getField('eval_quarter').setReadOnly(true);
                        //record.getField('template_desc').setReadOnly(true);
                        record.getField('eval_start_date').setReadOnly(true);
                        record.getField('eval_end_date').setReadOnly(true);
            
            
                        record.getField('archive_desc').setReadOnly(true);
                        record.getField('eval_desc').setReadOnly(true);
                    }
                }
                //状态为评分中的，档案描述不能修改
                if (record.get('archive_status') == '50_EVALUATING') {
                    record.getField('archive_desc').setReadOnly(true);
                }
            
            }
            
            
            //采购品类渲染
            
            function jk_ves5010_archive_assign_vendors_grid_renderer(value, record, name) {
                if (record.get('assign_id')) {
                    return '<a href="javascript:jk_ves5010_assign_category_maintain(' + record.get('item_category_id') + ');">' + value + '</a>';
                } else {
                    return;
                }
            }
            
            //采购品类窗口
            
            function jk_ves5010_assign_category_maintain(item_category_id) {
                new Aurora.Window({
                    id: 'ves5010_item_category_classify_win',
                    title: '采购品类明细',
                    url: $('jk_ves5010_item_category_classify_link').getUrl() + '?item_category_id=' + item_category_id,
                    width: 540,
                    height: 480
                });
            }
            
            //明细航查询
            
            function jk_ves5010_archive_maintain_detail_line_query() {
                var record = $('jk_ves5010_archive_header_maintain_ds').getCurrentRecord(),
                    archive_header_id = record.get('archive_header_id') || 0;
                if (archive_header_id) {
                    $('jk_ves5010_archive_detail_line_maintain_ds').setQueryParameter('archive_header_id', archive_header_id);
                    $('jk_ves5010_archive_detail_line_maintain_ds').query();
                    $('jk_ves5010_archive_total_line_maintain_ds').setQueryParameter('archive_header_id', archive_header_id);
                    $('jk_ves5010_archive_total_line_maintain_ds').query();
                } else {
                    Aurora.showMessage('${l:PROMPT}', '数据尚未保存！');
                    return;
                }
            }
            
            //风险等级渲染
            
            function jk_ves5010_risk_level_display_renderer(value, record, name) {
                if (record.get('risk_level') == 'HIGH') {
                    return '<div style="background-color:red;color:black;">' + value + '</div>';
                } else if (record.get('risk_level') == 'MIDDLE') {
                    return '<div style="background-color:yellow;color:black;">' + value + '</div>';
                } else if (record.get('risk_level') == 'LOW') {
                    return '<div style="background-color:green;color:black;">' + value + '</div>';
                }
            }
        ]]></script>
        <a:dataSets>
            <a:dataSet id="jk_ves5010_arc_detail_line_status_ds">
                <a:datas dataSource="jk_ves5010_arc_detail_line_status_data"/>
            </a:dataSet>
            <a:dataSet id="jk_ves5010_arc_total_line_status_ds">
                <a:datas dataSource="jk_ves5010_arc_total_line_status_data"/>
            </a:dataSet>
            <a:dataSet id="jk_ves5010_archive_suggestion_ds">
                <a:datas dataSource="jk_ves5010_archive_suggestion_data"/>
            </a:dataSet>
            <a:dataSet id="jk_ves5010_archive_risk_level_ds">
                <a:datas dataSource="jk_ves5010_archive_risk_level_data"/>
            </a:dataSet>
            <a:dataSet id="jk_ves5010_scoring_method_ds" lookupCode="XC_VE_SCORING_METHOD"/>
            <a:dataSet id="jk_ves5010_archive_header_maintain_ds" model="cux.JINKO.VES.JK_VES5010.jk_ves_archive_headers">
                <a:fields>
                    <a:field name="archive_status_display" displayField="flex_desc" options="jk_ves5010_archive_status_ds" returnField="archive_status" valueField="flex_value"/>
                    <a:field name="eval_start_date" validator="ves5010_eval_date_validator"/>
                    <a:field name="eval_end_date" validator="ves5010_eval_date_validator"/>
                    <a:field name="sys_value_open_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="eval_start_date" required="true"/>
                    <a:field name="eval_end_date" required="true"/>
                    <a:field name="eval_monthly" lovHeight="530" lovService="cux.JINKO.VES.JK_VES5010.jk_ves_monthly_lov" lovWidth="530" required="true" title="考评月度选择">
                        <a:mapping>
                            <a:map from="flex_value" to="eval_monthly"/>
                            <a:map from="start_date" to="eval_start_date"/>
                            <a:map from="end_date" to="eval_end_date"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="archive_desc" required="true"/>
                    <a:field name="template_desc" lovHeight="530" lovService="ves.ves_templates_lov" lovWidth="530" required="true" title="模板选择">
                        <a:mapping>
                            <a:map from="template_id" to="template_id"/>
                            <a:map from="template_desc" to="template_desc"/>
                            <a:map from="company_id" to="company_id"/>
                        </a:mapping>
                    </a:field>
                </a:fields>
                <a:events>
                    <a:event name="update" handler="jk_ves5010_archive_header_maintain_ds_update_handler"/>
                    <a:event name="load" handler="jk_ves5010_archive_header_maintain_ds_load_handler"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="jk_ves5010_archive_detail_line_query_ds">
                <a:fields>
                    <a:field name="vendor_desc" autoComplete="true" autoCompleteField="vendor_code_desc" lovHeight="530" lovService="ves.pur_vendors_lov" lovWidth="530" title="供应商选择">
                        <a:mapping>
                            <a:map from="vendor_id" to="vendor_id"/>
                            <a:map from="vendor_code" to="vendor_code"/>
                            <a:map from="vendor_name" to="vendor_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="item_category_desc" autoComplete="true" autoCompleteField="category_code_desc" lovHeight="530" lovService="ves.mtl_item_categories_lov" lovWidth="530" title="采购品类选择">
                        <a:mapping>
                            <a:map from="category_id" to="item_category_id"/>
                            <a:map from="category_code" to="item_category_code"/>
                            <a:map from="category_name" to="item_category_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="detail_criterion_name" lovHeight="530" lovService="ves.ves_all_detail_criteria_lov" lovWidth="530" title="考评细项选择">
                        <a:mapping>
                            <a:map from="detail_id" to="detail_id"/>
                            <a:map from="detail_name" to="detail_criterion_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="detail_line_status_display" displayField="flex_desc" options="jk_ves5010_arc_detail_line_status_ds" returnField="detail_line_status" valueField="flex_value"/>
                    <a:field name="scoring_method_display" displayField="code_value_name" options="jk_ves5010_scoring_method_ds" returnField="scoring_method" valueField="code_value"/>
                </a:fields>
            </a:dataSet>
            <a:dataSet id="jk_ves5010_archive_detail_line_maintain_ds" autoCount="true" autoPageSize="true" model="ves.VES5010.ves_archive_detail_lines" queryDataSet="jk_ves5010_archive_detail_line_query_ds">
                <a:fields>
                    <!--
                    <a:field name="detail_line_status_display" displayField="flex_desc" options="jk_ves5010_arc_detail_line_status_ds" returnField="detail_line_status" valueField="flex_value"/>
                    <a:field name="scoring_method_display" displayField="code_value_name" options="jk_ves5010_scoring_method_ds" returnField="scoring_method" valueField="code_value"/>
                    --><![CDATA[
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                    
                	
                ]]></a:fields>
            </a:dataSet>
            <a:dataSet id="jk_ves5010_archive_total_line_maintain_ds" autoCount="true" autoPageSize="true" model="ves.VES5010.ves_archive_total_lines" queryDataSet="jk_ves5010_archive_detail_line_query_ds">
                <a:fields>
                    <a:field name="total_line_status_display" displayField="flex_desc" options="jk_ves5010_arc_total_line_status_ds" returnField="total_line_status" valueField="flex_value"/>
                    <a:field name="suggestion_display" displayField="flex_desc" options="jk_ves5010_archive_suggestion_ds" returnField="suggestion" valueField="flex_value"/>
                    <a:field name="risk_level_display" displayField="flex_desc" options="jk_ves5010_archive_risk_level_ds" returnField="risk_level" valueField="flex_value"/>
                </a:fields>
            </a:dataSet>
            <!-- <a:dataSet id="sgves5010_archive_assign_categories_maintain_ds" model="cux.SUGON.SGVES.SGVES5010.sgves_arc_assign_cates"/> -->
            <a:dataSet id="jk_ves5010_archive_assign_vendors_maintain_ds" autoCount="true" autoPageSize="true" model="ves.VES5010.ves_arc_assign_vendors"/>
        </a:dataSets>
        <a:screenBody>
            <a:screenTopToolbar>
                <a:toolbarButton click="jk_ves5010_archive_maintain_detail_line_query" text="查询" width="100"/>
                <a:toolbarButton click="jk_ves5010_archive_maintain_save" text="PROMPT.SAVE" width="100"/>
                <a:toolbarButton click="jk_ves5010_archive_maintain_compute" text="提交计算" width="100"/>
                <a:toolbarButton click="jk_ves5010_archive_maintain_release_compute" text="下发评分" width="120"/>
                <a:toolbarButton click="jk_ves5010_archive_maintain_summary" text="汇总统计" width="100"/>
                <a:toolbarButton click="jk_ves5010_archive_maintain_release" text="发布" width="100"/>
                <a:toolbarButton click="jk_ves5010_archive_maintain_disable" text="作废" width="100"/>
                <a:toolbarButton click="jk_ves5010_archive_maintain_operation_records" text="操作记录" width="100"/>
                <a:toolbarButton click="jk_ves5010_archive_maintain_return" text="PROMPT.RETURN" width="100"/>
            </a:screenTopToolbar>
            <a:fieldSet column="1" title="快速定位">
                <a:hBox labelWidth="100">
                    <a:lov name="vendor_desc" bindTarget="jk_ves5010_archive_detail_line_query_ds" prompt="供应商" width="150"/>
                    <a:lov name="item_category_desc" bindTarget="jk_ves5010_archive_detail_line_query_ds" prompt="采购品类" width="150"/>
                    <a:lov name="detail_criterion_name" bindTarget="jk_ves5010_archive_detail_line_query_ds" prompt="考评细项" width="150"/>
                </a:hBox>
                <a:hBox labelWidth="100">
                    <a:comboBox name="detail_line_status_display" bindTarget="jk_ves5010_archive_detail_line_query_ds" prompt="状态" width="150"/>
                    <a:comboBox name="scoring_method_display" bindTarget="jk_ves5010_archive_detail_line_query_ds" prompt="评分方式" width="150"/>
                    <a:textField name="scored_by_display" bindTarget="jk_ves5010_archive_detail_line_query_ds" prompt="责任人" width="150"/>
                </a:hBox>
            </a:fieldSet>
            <a:accordionPanel id="bid5040_createAccordion_dim" height="180" showIcon="true" singleMode="false" width="900">
                <a:accordions>
                    <a:accordion prompt="基本信息" selected="true">
                        <a:hBox labelWidth="100">
                            <a:textField name="archive_code" bindTarget="jk_ves5010_archive_header_maintain_ds" readOnly="true" width="150"/>
                            <a:textField name="archive_desc" bindTarget="jk_ves5010_archive_header_maintain_ds" width="150"/>
                            <a:textField name="archive_status_display" bindTarget="jk_ves5010_archive_header_maintain_ds" prompt="状态" readOnly="true" width="150"/>
                        </a:hBox>
                        <a:hBox labelWidth="100">
                            <a:lov name="eval_monthly" bindTarget="jk_ves5010_archive_header_maintain_ds" prompt="考评月度" width="150"/>
                            <a:lov name="template_desc" bindTarget="jk_ves5010_archive_header_maintain_ds" prompt="考评模板" width="150"/>
                            <a:dateTimePicker name="creation_date" bindTarget="jk_ves5010_archive_header_maintain_ds" readOnly="true" renderer="Aurora.formatDateTime" width="150"/>
                        </a:hBox>
                        <a:hBox labelWidth="100">
                            <a:datePicker name="eval_start_date" bindTarget="jk_ves5010_archive_header_maintain_ds" renderer="Aurora.formatDate" width="150"/>
                            <a:datePicker name="eval_end_date" bindTarget="jk_ves5010_archive_header_maintain_ds" renderer="Aurora.formatDate" width="150"/>
                            <a:checkBox name="sys_value_open_flag" bindTarget="jk_ves5010_archive_header_maintain_ds" prompt="开放系统计算值"/>
                        </a:hBox>
                        <a:hBox labelWidth="100">
                            <a:textArea name="eval_desc" bindTarget="jk_ves5010_archive_header_maintain_ds" width="667"/>
                        </a:hBox>
                    </a:accordion>
                </a:accordions>
            </a:accordionPanel>
            <a:tabPanel marginHeight="240" marginWidth="80">
                <a:tabs>
                    <a:tab prompt="考评分明细" width="120">
                        <a:grid id="jk_ves5010_archive_detail_lines_grid" bindTarget="jk_ves5010_archive_detail_line_maintain_ds" marginHeight="286" marginWidth="100" navBar="true" width="950">
                            <a:columns>
                                <a:column name="detail_line_status_display" align="center" prompt="状态" sortable="true" width="60"/>
                                <a:column name="scoring_method_display" align="center" prompt="评分方式" sortable="true" width="60"/>
                                <a:column name="vendor_code" align="center" sortable="true" width="80"/>
                                <a:column name="vendor_desc" width="160"/>
                                <a:column name="item_category_desc"/>
                                <a:column name="detail_criterion_name"/>
                                <a:column name="detail_note_desc"/>
                                <a:column name="detail_score" align="right" renderer="Aurora.formatMoney" sortable="true" width="60"/>
                                <a:column name="scored_by_display" prompt="责任人" width="80"/>
                                <a:column name="score_from" align="right" sortable="true" width="60"/>
                                <a:column name="score_to" align="right" sortable="true" width="60"/>
                                <a:column name="comments" prompt="备注"/>
                            </a:columns>
                        </a:grid>
                    </a:tab>
                    <a:tab prompt="考评分汇总" width="120">
                        <a:grid id="jk_ves5010_archive_total_lines_grid" bindTarget="jk_ves5010_archive_total_line_maintain_ds" marginHeight="286" marginWidth="100" navBar="true" width="950">
                            <a:columns>
                                <a:column name="total_line_status_display" align="center" prompt="状态" width="60"/>
                                <a:column name="suggestion_display" align="center" prompt="建议策略" width="60"/>
                                <a:column name="risk_level_display" align="center" prompt="风险等级" renderer="jk_ves5010_risk_level_display_renderer" width="60"/>
                                <a:column name="vendor_code" align="center" sortable="true" width="80"/>
                                <a:column name="vendor_desc" width="160"/>
                                <a:column name="item_category_desc"/>
                                <a:column name="score" align="right" renderer="Aurora.formatMoney" sortable="true" width="60"/>
                                <a:column name="score_level" align="center" width="60"/>
                                <a:column name="feedback_desc"/>
                                <a:column name="ranking" align="right" sortable="true" width="60"/>
                            </a:columns>
                        </a:grid>
                    </a:tab>
                    <a:tab prompt="参评供应商" width="120">
                        <a:grid id="jk_ves5010_archive_assign_vendors_grid" bindTarget="jk_ves5010_archive_assign_vendors_maintain_ds" marginHeight="286" marginWidth="100" navBar="true" width="950">
                            <a:columns>
                                <a:column name="vendor_code" align="center" sortable="true" width="80"/>
                                <a:column name="vendor_desc" width="160"/>
                                <a:column name="vendor_type"/>
                                <a:column name="item_category_desc" renderer="jk_ves5010_archive_assign_vendors_grid_renderer"/>
                            </a:columns>
                        </a:grid>
                    </a:tab>
                </a:tabs>
            </a:tabPanel>
        </a:screenBody>
        <script><![CDATA[
        	init();
        ]]></script>
    </a:view>
</a:screen>

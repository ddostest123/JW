<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: weiqinglong  
    $Date: 2017-10-30 上午9:15:01  
    $Revision: 1.0  
    $Purpose: 
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application">
    <a:view>
        <a:link id="pur7041_submit_sap_link" url="${/request/@context_path}/modules/pur/PUR5180/pur_req_import_sap.svc"/>
        <a:link id="pur7041_submit_oa_link" url="${/request/@context_path}/modules/cux/NEWHOPE/PUR/PUR7041/pur_submit_oa.svc"/>
        <a:link id="pur7041_submit_weavar_oa_link" url="${/request/@context_path}/modules/pur/PUR5180/pur_req_import_oa.svc"/>
        <a:link id="pur_submit_sn_link" url="${/request/@context_path}/modules/cux/NEWHOPE/PUR/PUR7041/pur_submit_sn.svc"/>
        <a:link id="pur_submit_jd_link" url="${/request/@context_path}/modules/jd/vop/jd_vop_submitOrder.svc"/>
        <a:link id="pur7041_save_link" url="${/request/@context_path}/modules/cux/NEWHOPE/PUR/PUR7041/pur_application_save.svc"/>
        <a:link id="pur7041_do_submit_link" model="cux.NEWHOPE.PUR.PUR7041.pur_item_generate_application" modelaction="execute"/>
        <a:link id="pur7041_delete_link" model="cux.NEWHOPE.PUR.PUR7041.pur_item_generate_application" modelaction="delete"/>
        <a:link id="pur7041_delete_line_link" model="cux.NEWHOPE.PUR.PUR7041.pur_item_generate_application" modelaction="batch_update"/>
        <a:link id="pur7041_application_oa_submit_link" url="${/request/@context_path}/modules/cux/NEWHOPE/PUR/PUR7041/pur_application_srm_to_oa.svc"/>
        <a:link id="pur7041_logistics_query_link" url="${/request/@context_path}/modules/cux/NEWHOPE/PUR/PUR7041/pur_corder_track_check.screen"/>
        <script><![CDATA[
            var req_header_id;
            var line_num = 1;
            var account_company_code;
            var v_import_sap_flag = 'N';
            var v_import_oa_flag = 'N';
            var v_approve_method;
            var pur_po_type;
            
            function pur7041_return() {
                $('pur_catlog_item_submit_window').close();
            }
            
            function do_submit() {
                Aurora.request({
                    url: $('pur7041_do_submit_link').getUrl(),
                    para: {
                        'req_header_id': '${/parameter/@req_header_id}'
                    },
                    success: function() {
                        Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                        $('pur7041_req_ds').query();
                        pur7041_return();
                    },
                    failure: function() {
                        Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                        return;
                    },
                    error: function() {
                        Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                        return;
                    },
                    scope: this
                });
            }
            
            function submit_to_sap() {
                Aurora.request({
                    url: $('pur7041_submit_sap_link').getUrl(),
                    para: {
                        'req_header_id': '${/parameter/@req_header_id}'
                    },
                    success: function(res) {
                        var v_message = res.result.message;
                        //提交成功后执行提交动作
                        if (v_message.indexOf('成功')) {
                            Aurora.showMessage('${l:PROMPT}', v_message);
                            do_submit();
                        } else {
                            Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                            Aurora.showMessage('${l:PROMPT}', v_message);
                        }
                    },
                    failure: function() {
                        Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                        return;
                    },
                    error: function() {
                        Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                        return;
                    },
                    scope: this
                });
            }
            
            function submit_to_weavar_oa() {
                Aurora.request({
                    url: $('pur7041_submit_weavar_oa_link').getUrl(),
                    para: {
                        'req_header_id': '${/parameter/@req_header_id}'
                    },
                    success: function(res) {
                        Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                        var oa_instance_id = res.result.oa_instance_id;
                        var v_message;
                        if (oa_instance_id > 0) {
                            v_message = '${l:PUR7040.CHUFA_OA_PROCESS_S}' + res.result.oa_instance_id;
                            Aurora.showMessage('${l:PROMPT}', v_message);
                            do_submit();
                        } else {
                            v_message = '${l:PUR7040.CHUFA_OA_PROCESS_F}' + res.result.oa_instance_id;
                            Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                            Aurora.showMessage('${l:PROMPT}', v_message);
                            return;
                        }
                    },
                    failure: function() {
                        Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                        return;
                    },
                    error: function() {
                        Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                        return;
                    },
                    scope: this
                });
            }
            
            function submit_to_oa() {
                Aurora.request({
                    url: $('pur7041_submit_oa_link').getUrl(),
                    para: {
                        'API_CODE': 'SHOPPING_CART_SUBMIT',
                        'document_id': '${/parameter/@req_header_id}',
                        'table_name': 'PUR_REQ_LINES_TMP',
                        'title': $('pur7041_req_header_ds').getAt(0).get('title')
                    },
                    success: function() {
                        do_submit();
                    },
                    failure: function() {
                        Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                        return;
                    },
                    error: function() {
                        Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                        return;
                    },
                    scope: this
                });
            }
            
            function submit_sap_or_not() {
            
                //判断是否需要传到sap
                //如果需要
                if (v_import_sap_flag == 'Y') {
                    //则判断是否需要审批
                    if (v_approve_method == 'NO_APPROVAL') {
                        submit_to_sap();
                    } else {
                        do_submit();
                    }
                } else {
                    do_submit();
                }
            }
            
            function after_save(data_source) {
                Aurora.Masker.mask($('pur_catlog_item_submit_window').wrap, '${l:PROMPT.SUBMITING}');
                //苏宁的要预下订单，锁定库存和价格
                if (data_source == 'SN') {
                    Aurora.request({
                        url: $('pur_submit_sn_link').getUrl(),
                        para: {
                            'api_code': 'SN_ORDER_SUBMIT',
                            'req_header_id': '${/parameter/@req_header_id}'
                        },
                        success: function(res) {
                            var error_msg = res.result.error_msg;
                            //如果锁定成功
                            if (!Aurora.isEmpty(error_msg)) {
                                Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                                var v_message = '${l:PUR7040.SUNING_RETURN}' + error_msg;
                                Aurora.showMessage('${l:PROMPT}', v_message);
                                return;
                            } else {
                                //无需给OA审批
                                //submit_to_oa();
                                //中化国际，根据是否传oa
                                if (v_import_oa_flag == 'Y') {
                                    submit_to_weavar_oa();
                                } else {
                                    submit_sap_or_not();
                                }
                            }
                        },
                        failure: function() {
                            Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                            return;
                        },
                        error: function() {
                            Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                            return;
                        },
                        scope: this
                    });
                } else if (data_source == 'JD') {
                    Aurora.request({
                        url: $('pur_submit_jd_link').getUrl(),
                        para: {
                            'req_header_id': '${/parameter/@req_header_id}'
                        },
                        success: function(res) {
                            var error_msg = res.result.error_msg;
                            //如果锁定成功
                            if (!Aurora.isEmpty(error_msg)) {
                                Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                                var v_message = '${l:PUR7040.JD_RETURN}：' + error_msg;
                                Aurora.showMessage('${l:PROMPT}', v_message);
                                return;
                            } else {
                                //无需给OA审批
                                //submit_to_oa();
                                //中化国际，根据是否传oa
                                if (v_import_oa_flag == 'Y') {
                                    submit_to_weavar_oa();
                                } else {
                                    submit_sap_or_not();
                                }
                            }
                        },
                        failure: function() {
                            Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                            return;
                        },
                        error: function() {
                            Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                            return;
                        },
                        scope: this
                    });
                } else {
                    //无需给OA审批
                    //submit_to_oa();
                    //中化国际，根据是否传oa
                    if (v_import_oa_flag == 'Y') {
                        submit_to_weavar_oa();
                    } else {
                        submit_sap_or_not();
                    }
                }
            }
            
            function pur7041_req_save() {
                var headers_ds = $('pur7041_req_header_ds');
                var lines_ds = $('pur7041_ln_items_ds');
                var header_record = headers_ds.getCurrentRecord();
            
                var data = header_record.data;
            
                data['req_lines'] = lines_ds.getJsonData();
            
            
                if (headers_ds.validate() && lines_ds.validate()) {
            
                    Aurora.Masker.mask($('pur_catlog_item_submit_window').wrap, '${l:PROMPT.SUBMITING}');
                    Aurora.request({
                        url: $('pur7041_save_link').getUrl(),
                        para: data,
                        success: function() {
                            $('pur7041_req_header_ds').query();
                            $('pur7041_ln_items_ds').query();
                            Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                            Aurora.showMessage('${l:PROMPT}', '保存成功！');
                        },
                        failure: function() {
                            Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                            return;
                        },
                        error: function() {
                            Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                            return;
                        },
                        scope: this
                    });
                }
            }
            
            function pur7041_submit_to_oa() {
                debugger;
                var headers_ds = $('pur7041_req_header_ds');
                var lines_ds = $('pur7041_ln_items_ds');
                if (!headers_ds.validate() || !lines_ds.validate()) {
                    return;
                }
                //判断是否有修改
                if ($('pur7041_req_header_ds').isModified() || $('pur7041_ln_items_ds').isModified()) {
                    Aurora.showMessage('${l:PROMPT}', '请先保存再提交OA申请！', null);
                    return;
                }
            
                var ds = $('pur7041_req_header_ds');
                var record = ds.getAt(0);
                var req_header_id = record.get('req_header_id');
                Aurora.showConfirm('${l:PROMPT}', '是否确认提交OA审批？', function() {
                    Aurora.Masker.mask($('pur_catlog_item_submit_window').wrap);
                    Aurora.request({
                        url: $('pur7041_application_oa_submit_link').getUrl(),
                        para: {
                            'req_header_id': req_header_id,
                            'action_code': 'OA_SUBMIT'
                        },
                        success: function(res) {
                            Aurora.showMessage('${l:PROMPT}', '提交OA审批成功！', null);
                            Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                            pur7041_return();
                        },
                        failure: function() {
                            Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                        },
                        error: function() {
                            Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                        },
                        scope: this
                    });
                }, null, 200, 80);
            
            }
            
            function pur7041_req_submit() {
                var headers_ds = $('pur7041_req_header_ds');
                var lines_ds = $('pur7041_ln_items_ds');
                var header_record = headers_ds.getCurrentRecord();
            
                var data = header_record.data;
            
                data['req_lines'] = lines_ds.getJsonData();
            
            
                if (headers_ds.validate() && lines_ds.validate()) {
            
                    Aurora.Masker.mask($('pur_catlog_item_submit_window').wrap, '${l:PROMPT.SUBMITING}');
                    Aurora.request({
                        url: $('pur7041_save_link').getUrl(),
                        para: data,
                        success: function() {
                            var head_business_unit_id = header_record.get('business_unit_id');
                            var line_records = lines_ds.getAll();
                            var message = '',
                                message_flag = 'N';
            
                            var data_source = header_record.get('data_source');
                            for (var i = 0;i < line_records.length;i++) {
                                if (line_records[i].get('business_unit_id') != head_business_unit_id) {
                                    message_flag = 'Y';
                                    if (message == '' || message == null || message == 'undefined') {
                                        message = line_records[i].get('line_num');
                                    } else {
                                        message = message + ', ' + line_records[i].get('line_num');
                                    }
                                }
                            }
            
                            if (message_flag == 'Y') {
                                Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                                message = '${l:PUR7040.SHOW_MESSAGE1}' + message + '${l:PUR7040.SHOW_MESSAGE2}';
            
                                Aurora.showConfirm('${l:PROMPT}', message, function() {
                                    after_save(data_source);
                                }, null, 200, 80);
                            } else {
                                after_save(data_source);
                            }
                        },
                        failure: function() {
                            Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                            return;
                        },
                        error: function() {
                            Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                            return;
                        },
                        scope: this
                    });
                }
            }
            
            function pur7041_req_delete() {
            
                Aurora.showConfirm('${l:PROMPT}', '${l:PUR7040.SHOW_MESSAGE3}', function() {
                    Aurora.Masker.mask($('pur_catlog_item_submit_window').wrap, '${l:PROMPT.SUBMITING}');
                    Aurora.request({
                        url: $('pur7041_delete_link').getUrl(),
                        para: {
                            'req_header_id': '${/parameter/@req_header_id}'
                        },
                        success: function() {
                            Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                            $('pur7041_req_ds').query();
                            pur7041_return();
                        },
                        failure: function() {
                            Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                            return;
                        },
                        error: function() {
                            Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                            return;
                        },
                        scope: this
                    });
                }, null, 200, 80);
            }
            
            function pur7041_logistics_query() {
                debugger;
                var record = $('pur7041_req_header_ds').getCurrentRecord();
                var status = record.get('status');
                var data_source = record.get('data_source');
                if (status != 'OR_CONFRIM' && status != 'DELIVERED') {
                    Aurora.showMessage('${l:PROMPT}', '暂无物流信息！', null);
                    return;
                }
                var eb_order_id = record.get('eb_order_id');
                if (!Aurora.isEmpty(eb_order_id)) {
                    new Aurora.Window({
                        url: $('pur7041_logistics_query_link').getUrl() + '?eb_order_id=' + eb_order_id + '&data_source=' + data_source,
                        title: '物流信息查询',
                        id: 'pur7041_logistics_query_link_window',
                        width: 800,
                        height: 500
                    });
                }
            }
            
            function pur7041_delete_req_line() {
                //如果该申请单状态不为新建或OA审批拒绝则不可退回购物车！
                debugger;
                var header_record = $('pur7041_req_header_ds').getCurrentRecord();
                var status = header_record.get('status');
                if (status != '10_NEW' && status != 'OA_REJECTED') {
                    Aurora.showMessage('${l:PROMPT}', '该单据的状态不是新建或拒绝，不能退回购物车！', null);
                    return;
                }
                var records = $('pur7041_ln_items_ds').getSelected();
            
                if (records.length > 0) {
                    var datas = [];
            
                    for (var i = 0;i < records.length;i++) {
                        var data = {
                            'req_line_id': records[i].get('req_line_id'),
                            '_status': 'insert'
                        };
                        datas.push(data);
                    }
            
                    Aurora.showConfirm('${l:PROMPT}', '${l:PUR7040.SHOW_MESSAGE4}', function() {
                        Aurora.Masker.mask($('pur_catlog_item_submit_window').wrap, '${l:PROMPT.SUBMITING}');
                        Aurora.request({
                            url: $('pur7041_delete_line_link').getUrl(),
                            para: datas,
                            success: function() {
                                Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                                $('pur7041_ln_items_ds').query();
                                $('pur7041_req_header_ds').query();
                                $('pur7041_req_ds').query();
                            },
                            failure: function() {
                                Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                                return;
                            },
                            error: function() {
                                Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                                return;
                            },
                            scope: this
                        });
                    }, null, 200, 80);
                } else {
                    Aurora.showMessage('${l:PROMPT}', '${l:AT_LEAST_CHOICE_ONE}');
                }
            
            }
            //附件
            
            function pur7041_upload(req_line_id) {
                var url = '${/request/@context_path}/uploadFile.screen?table_name=PUR_REQ_LINES_TMP&header_id=' + req_line_id;
                new Aurora.Window({
                    url: url,
                    title: '${l:ATM.UPLOAD_ATTACHMENT}',
                    id: 'pur5180_entrustment_edit_atm_window',
                    width: 820,
                    height: 400
                });
            }
            
            function pur7041_ln_items_grid_renderer(value, record, name) {
                if (name == 'req_line_id') {
                    return '<a href="javascript:pur7041_upload(' + record.get('req_line_id') + ')">${l:PUR7040.UPLOAD_FILE}</a>';
                }
                return '';
            }
            
            function test_sn() {
                Aurora.Masker.mask($('pur_catlog_item_submit_window').wrap, '${l:PROMPT.SUBMITING}');
                Aurora.request({
                    url: $('pur_submit_sn_link').getUrl(),
                    para: {
                        'api_code': 'SN_ORDER_SUBMIT',
                        'req_header_id': '${/parameter/@req_header_id}'
                    },
                    success: function(res) {
                        error_msg = res.result.error_msg;
                        var orderid = res.result.orderid;
                        var orderitemid = res.result.orderitemid;
            
                        alert(orderitemid);
                        //如果锁定成功
                        if (!Aurora.isEmpty(orderitemid)) {
                            Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                            //将苏宁的id保存到采购申请头
                            alert(orderitemid);
                            //do_submit();
                        } else {
                            Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                            var v_message = error_msg;
                            if (Aurora.isEmpty(v_message)) {
                                v_message = 'orderitemid未解析出来';
                            }
                            Aurora.showMessage('${l:PROMPT}', v_message);
                            return;
                        }
                    },
                    failure: function() {
                        Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                        return;
                    },
                    error: function() {
                        Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                        return;
                    },
                    scope: this
                });
            }
            
            function pur7041_ln_items_grid_ef(record, name) {
                if (name == 'price') {
                    if (record.get('insurance_flag') == 'Y') {
                        return 'pur7041_ln_items_grid_nf';
                    }
                } else if (name == 'uom_desc') {
                    if (record.get('uom_edit_flag') == 'Y') {
                        return 'pur7041_ln_items_grid_lov';
                    }
                }
                return '';
            }
            
            function test_submit_to_oa() {
                Aurora.request({
                    url: $('pur7041_submit_oa_link').getUrl(),
                    para: {
                        'API_CODE': 'SHOPPING_CART_SUBMIT',
                        'document_id': '${/parameter/@req_header_id}',
                        'table_name': 'PUR_REQ_LINES_TMP',
                        'title': $('pur7041_req_header_ds').getAt(0).get('title')
                    },
                    success: function() {
                        do_submit(orderid);
                    },
                    failure: function() {
                        Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                        return;
                    },
                    error: function() {
                        Aurora.Masker.unmask($('pur_catlog_item_submit_window').wrap);
                        return;
                    },
                    scope: this
                });
            }
            
            function pur7041_req_header_ds_load(ds) {
                var record = ds.getAt(0);
                v_import_sap_flag = record.get('import_sap_flag');
                v_import_oa_flag = record.get('import_oa_flag');
                v_approve_method = record.get('approve_method');
                if (v_import_sap_flag == 'Y') {
                    record.getField('pur_po_type_desc').setRequired(true);
                    record.getField('pur_organization_name').setRequired(true);
            
                    var pur_po_type = record.get('pur_po_type');
            
                    record.getField('pur_buyer_name').setRequired(true);
                    if (pur_po_type == 'ZI01' || pur_po_type == 'ZI10') {
                        //设备ZI10——资产A——01（物料组）
                        record.getField('pur_buyer_name').setReadOnly(false);
                        record.getField('pur_buyer_name').setLovPara('buyer_code', 'G');
                    } else {
                        record.getField('pur_buyer_name').setReadOnly(true);
                    }
                }
            
                record.getField('acquire_location_desc').setLovPara('company_id', record.get('own_company_id'));
                record.getField('acquire_location_desc').setLovPara('address_source', 'JD');
            }
            
            function pur7041_req_header_ds_update(ds, record, name, value, oldvalue) {
                var item_records = $("pur7041_ln_items_ds").getAll();
            
                var quick_record = $('pur7041_quick_ds').getAt(0);
                if (name == 'need_by_date') {
                    for (var i = 0;i < item_records.length;i++) {
                        item_records[i].set('need_by_date', record.get('need_by_date'));
                    }
                } else if (name == 'pur_po_type') {
            
                    quick_record.set('knttp', '');
                    quick_record.set('knttp_desc', '');
                    var knttp_records = $('pur7041_knttp_ds').getAll();
                    $('pur7041_po_knttp_ds').removeAll();
                    var line_records = $('pur7041_ln_items_ds').getAll();
                    if (value == 'ZI01') {
                        //内贸ZI01——费用T——ZG开头（物料组）和ZI01——空（库存）——所有物料组都可选；
                        quick_record.getField('knttp_desc').setReadOnly(false);
                        record.getField('pur_buyer_name').setReadOnly(false);
                        record.getField('pur_buyer_name').setLovPara('buyer_code', 'G');
            
                        for (var i = 0;i < line_records.length;i++) {
                            line_records[i].getField('knttp_desc').setReadOnly(false);
                            line_records[i].set('item_category_desc', '');
                        }
                        for (var i = 0;i < knttp_records.length;i++) {
                            if (knttp_records[i].get('code_value') != 'A') {
                                var data = knttp_records[i].data;
                                $('pur7041_po_knttp_ds').create(data);
                            }
                        }
            
                    } else if (value == 'ZI10') {
                        //设备ZI10——资产A——01（物料组）
                        quick_record.set('knttp', 'A');
                        quick_record.set('knttp_desc', '资产');
                        quick_record.getField('knttp_desc').setReadOnly(true);
            
                        record.getField('pur_buyer_name').setReadOnly(false);
                        record.getField('pur_buyer_name').setLovPara('buyer_code', 'G');
            
                        for (var i = 0;i < line_records.length;i++) {
                            line_records[i].set('knttp', 'A');
                            line_records[i].set('knttp_desc', '资产');
                            line_records[i].getField('knttp_desc').setReadOnly(true);
                            line_records[i].set('item_category_desc', '');
                        }
                    } else {
                        quick_record.getField('knttp_desc').setReadOnly(false);
                        record.getField('pur_buyer_name').setLovPara('buyer_code', null);
            
                        for (var i = 0;i < line_records.length;i++) {
                            line_records[i].getField('knttp_desc').setReadOnly(false);
                            line_records[i].set('item_category_desc', '');
                        }
                        for (var i = 0;i < knttp_records.length;i++) {
                            var data = knttp_records[i].data;
                            $('pur7041_po_knttp_ds').create(data);
                        }
                    }
                }
                if (v_impor_sap_flag = 'Y') {
                    quick_record.getField('knttp_desc').setRequired(true);
                } else {
                    quick_record.getField('knttp_desc').setRequired(false);
                }
            }
            
            function pur7041_ln_items_ds_load(ds) {
                var length = ds.getAll().length;
                if (length == 0) {
                    $('pur7041_req_ds').query();
                    pur7041_return();
                } else {
                    var line_records = ds.getAll();
                    if (v_import_sap_flag == 'Y') {
                        for (var i = 0;i < line_records.length;i++) {
                            line_records[i].getField('knttp_desc').setRequired(true);
                            line_records[i].set('knttp', '');
                            line_records[i].set('knttp_desc', '');
                            line_records[i].getField('item_code').setReadOnly(true);
                            line_records[i].getField('item_category_desc').setRequired(true);
                            line_records[i].getField('item_category_desc').setReadOnly(true);
                            if (Aurora.isEmpty(line_records[i].get('knttp'))) {
                                line_records[i].getField('item_code').setLovPara('inv_organization_id', line_records[i].get('inv_organization_id'));
                                line_records[i].getField('item_code').setRequired(true);
                            }
                        }
                    } else {
                        for (var i = 0;i < line_records.length;i++) {
                            line_records[i].set('knttp', '');
                            line_records[i].set('knttp_desc', '');
                        }
            
                    }
                }
            }
            
            function pur7041_ln_items_ds_update(ds, record, name, value, oldvalue) {
                if (name == 'price') {
                    var header_record = $('pur7041_req_header_ds').getAt(0);
                    var line_records = ds.getAll();
                    var total_amount = 0;
                    for (var i = 0;i < line_records.length;i++) {
                        total_amount += line_records[i].get('quantity') * line_records[i].get('price');
                    }
                    header_record.set('total_amount', total_amount);
                } else if (name == 'knttp_desc') {
                    if (v_import_sap_flag == 'Y') {
                        record.set('item_category_desc', '');
                        record.getField('item_category_desc').setReadOnly(false);
                        if (record.get('knttp_desc') == '库存') {
                            record.getField('item_code').setRequired(true);
                            record.getField('item_code').setReadOnly(false);
                            record.getField('item_desc').setReadOnly(true);
                        } else {
                            record.set('item_code', '');
                            record.getField('item_code').setRequired(false);
                            record.getField('item_code').setReadOnly(true);
                            record.getField('item_desc').setRequired(true);
                            record.getField('item_desc').setReadOnly(false);
                        }
                    }
                }
            }
            
            function on_cellclick(grid, row, name, record) {
                var pur_po_type = $('pur7041_req_header_ds').getAt(0).get('pur_po_type');
                var knttp_desc = record.get('knttp_desc');
            
                //内贸ZI01——费用T——ZG开头（物料组）
                //内贸ZI01——空（库存）——所有物料组都可选
                //设备ZI10——资产A——01（物料组）
                if (name == 'item_category_desc') {
                    if (pur_po_type == 'ZI01') {
                        if (knttp_desc == '费用') {
                            record.getField('item_category_desc').setLovPara('category_code', 'ZG');
                        } else if (knttp_desc == '库存') {
                            record.getField('item_category_desc').setLovPara('category_code', '');
                        }
                    } else if (pur_po_type == 'ZI10' && knttp_desc == '资产') {
                        record.getField('item_category_desc').setLovPara('category_code', '01');
                    }
                }
            }
            
            function on_pur7041_quick_ds_add(dataSet, record, index) {
                var knttp_records = $('pur7040_knttp_ds').getAll();
                $('pur7041_po_knttp_ds').removeAll();
                if (pur_po_type == 'ZI01') {
                    //内贸ZI01——费用T——ZG开头（物料组）和ZI01——空（库存）——所有物料组都可选；
                    record.getField('knttp_desc').setReadOnly(false);
            
                    for (var i = 0;i < knttp_records.length;i++) {
                        if (knttp_records[i].get('code_value') != 'A') {
                            var data = knttp_records[i].data;
                            $('pur7041_po_knttp_ds').create(data);
                        }
                    }
            
                } else if (pur_po_type == 'ZI10') {
                    //设备ZI10——资产A——01（物料组）
                    record.set('knttp', 'A');
                    record.set('knttp_desc', '资产');
                    record.getField('knttp_desc').setReadOnly(true);
            
                } else {
                    record.getField('knttp_desc').setReadOnly(false);
            
                    for (var i = 0;i < knttp_records.length;i++) {
                        var data = knttp_records[i].data;
                        $('pur7041_po_knttp_ds').create(data);
                    }
                }
            
                if (v_import_sap_flag == 'Y') {
                    record.getField('knttp_desc').setRequired(true);
                } else {
                    record.getField('knttp_desc').setRequired(false);
                }
            }
            
            function on_pur7041_quick_ds_update(ds, record, name, value, oldvalue) {
                var line_records = $('pur7041_ln_items_ds').getAll();
                if (name == 'knttp') {
                    for (var i = 0;i < line_records.length;i++) {
                        line_records[i].set('knttp', record.get('knttp'));
                    }
                } else if (name == 'knttp_desc') {
                    for (var i = 0;i < line_records.length;i++) {
                        line_records[i].set('knttp_desc', record.get('knttp_desc'));
                    }
                } else if (name == 'need_by_date') {
                    for (var i = 0;i < line_records.length;i++) {
                        line_records[i].set('need_by_date', value);
                    }
                }
            }
        ]]></script>
        <a:dataSets>
            <!-- 订单类型：ZI01内贸；ZI10设备（ZI10，只能对应科目分配类别A） -->
            <a:dataSet id="pur7041_po_type_ds">
                <a:datas>
                    <a:record code_value="ZI01" code_value_name="内贸"/>
                    <a:record code_value="ZI10" code_value_name="设备"/>
                </a:datas>
            </a:dataSet>
            <a:dataSet id="pur7041_po_knttp_ds"/>
            <a:dataSet id="pur7041_knttp_ds">
                <a:datas>
                    <a:record code_value="A" code_value_name="资产"/>
                    <a:record code_value="T" code_value_name="费用"/>
                    <a:record code_value="" code_value_name="库存"/>
                </a:datas>
            </a:dataSet>
            <a:dataSet id="pur58601_invoice_type_ds" lookupCode="AP_INVOICE_TYPE"/>
            <a:dataSet id="pur7041_req_create_type_ds" loadData="true" lookupCode="PUR_REQUISITION_TYPES"/>
            <a:dataSet id="pur7041_req_create_currency_ds" autoQuery="true" loadData="true" model="public.currency_list"/>
            <a:dataSet id="pur7041_req_create_tax_ds" autoQuery="true" loadData="true" model="public.fnd_tax_type_code_lov"/>
            <a:dataSet id="pur7041_yes_no_ds" loadData="true" lookupCode="YES_OR_NO"/>
            <a:dataSet id="pur7041_req_header_ds" autoQuery="true" model="cux.NEWHOPE.PUR.PUR7041.pur_item_generate_application_header" queryUrl="${/request/@context_path}/autocrud/cux.NEWHOPE.PUR.PUR7041.pur_item_generate_application_header/query?req_header_id=${/parameter/@req_header_id}">
                <a:fields>
                    <a:field name="total_amount" readOnly="true"/>
                    <a:field name="applicant_unit" readOnly="true"/>
                    <a:field name="applicant_name" readOnly="true"/>
                    <a:field name="apply_date" readOnly="true" required="false"/>
                    <a:field name="authorization_status" readOnly="true"/>
                    <a:field name="authorization_status_code"/>
                    <a:field name="project_number"/>
                    <a:field name="data_source"/>
                    <a:field name="project_name"/>
                    <a:field name="project_leader" autoComplete="true" autoCompleteField="user_desc" lovGridHeight="350" lovHeight="500" lovService="public.sys_user_lov?business_group=${/session/@business_group}" lovWidth="500" title="PUR3010.PROJECT_MANAGER">
                        <a:mapping>
                            <a:map from="user_id" to="project_leader_id"/>
                            <a:map from="user_desc" to="project_leader"/>
                        </a:mapping>
                    </a:field>
                    <!-- <a:field name="acquire_location_desc" autoComplete="true" autoCompleteField="location_address" lovGridHeight="370" lovHeight="500" lovService="pur.PUR5860.pur_headers_all_acquire_addr" lovWidth="550" required="true" requiredMessage="${l:PUR5320.WRITE_SHOUDAN_ADDRESS}" title="PUR5860.ACQUIRE_LOCATION">
                        <a:mapping>
                            <a:map from="location_id" to="bill_delivery_id"/>
                            <a:map from="location_name" to="acquire_contact_name"/>
                            <a:map from="location_address" to="acquire_location_desc"/>
                            <a:map from="location_tel" to="acquire_contact_tel"/>
                        </a:mapping>
                    </a:field> -->
                    <a:field name="invoice_type_desc" displayField="code_value_name" options="pur58601_invoice_type_ds" requiredMessage="${l:ACP5220.WRITE_INVOICE_TYPE}" returnField="invoice_type" valueField="code_value"/>
                    <a:field name="project_leader_id"/>
                    <a:field name="equity_investment_desc" displayField="code_value_name" options="pur7041_yes_no_ds" readOnly="true" returnField="equity_investment" valueField="code_value"/>
                    <a:field name="equity_investment" readOnly="true"/>
                    <a:field name="investment_name" readOnly="true"/>
                    <a:field name="type_lookup_code"/>
                    <a:field name="type_lookup_name" displayField="code_value_name" options="pur7041_req_create_type_ds" required="false" requiredMessage="${l:PUR3010.REQUIRE_MESSAGE2}" returnField="type_lookup_code" valueField="code_value"/>
                    <a:field name="unit_desc" autoComplete="true" autoCompleteField="code_name" lovGridHeight="350" lovHeight="500" lovService="public.hrm_units_lov" lovWidth="500" title="PUR_REQUISITION_HDS.UNIT_ID">
                        <a:mapping>
                            <a:map from="unit_id" to="unit_id"/>
                            <a:map from="unit_desc" to="unit_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="pur_organization_name" autoComplete="true" autoCompleteField="pur_organization_code_name" lovHeight="480" lovService="public.pur_organization_lov" lovWidth="500" title="PUR_PUR_ORGS_INV_ORGS.PUR_ORGANIZATION_ID">
                        <a:mapping>
                            <a:map from="pur_organization_id" to="pur_organization_id"/>
                            <a:map from="pur_organization_name" to="pur_organization_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="business_unit_id"/>
                    <!-- <a:field name="business_unit_name" autoComplete="true" autoCompleteField="code_name" lovHeight="480" lovService="public.fnd_business_unit_lov" lovWidth="500" readOnly="true" required="true" requiredMessage="${l:PUR3010.REQUIRE_MESSAGE3}" title="PUR_REQUISITION_HDS.BUSINESS_UNIT_ID">
                        <a:mapping>
                            <a:map from="company_id" to="company_id"/>
                            <a:map from="business_unit_id" to="business_unit_id"/>
                            <a:map from="business_unit_name" to="business_unit_name"/>
                        </a:mapping>
                    </a:field> -->
                    <a:field name="pur_buyer_name" autoComplete="true" autoCompleteField="code_name" lovGridHeight="320" lovHeight="480" lovService="public.pur_buyers_lov" lovWidth="500" requiredMessage="${l:PUR3010.REQUIRE_MESSAGE4}" title="PUR_HEADERS_ALL.PUR_BUYER">
                        <a:mapping>
                            <a:map from="buyer_id" to="pur_buyer_id"/>
                            <a:map from="buyer_code" to="pur_buyer_code"/>
                            <a:map from="description" to="pur_buyer_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="header_comments" required="true" requiredMessage="请填写申请说明！"/>
                    <a:field name="title" required="true" requiredMessage="请填写标题！"/>
                    <a:field name="pur_po_type"/>
                    <a:field name="pur_po_type_desc" displayField="code_value_name" options="pur7041_po_type_ds" requiredMessage="${l:PUR3010.REQUIRE_MESSAGE5}" returnField="pur_po_type" valueField="code_value"/>
                </a:fields>
                <a:events>
                    <!-- <a:event name="load" handler="pur7041_req_header_ds_load"/> -->
                    <a:event name="update" handler="pur7041_req_header_ds_update"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="pur7041_ln_items_ds" autoQuery="true" fetchAll="true" model="cux.NEWHOPE.PUR.PUR7041.pur_item_generate_application_line" queryUrl="${/request/@context_path}/autocrud/cux.NEWHOPE.PUR.PUR7041.pur_item_generate_application_line/query?req_header_id=${/parameter/@req_header_id}" selectable="true">
                <a:fields>
                    <a:field name="line_num"/>
                    <a:field name="item_category_id"/>
                    <a:field name="item_category_desc" autoComplete="true" autoCompleteField="category_code_name" lovHeight="480" lovService="pur.PUR5130.mtl_categories_user_defined_vl" lovWidth="510" requiredMessage="${l:PUR5130.PLEASE_CHOOSE_MATL_CATEGORY}" title="PUR_REQUISITION_LNS.ITEM_CATEGORY_ID">
                        <a:mapping>
                            <a:map from="category_udf_id" to="item_category_id"/>
                            <a:map from="category_code" to="item_category_code"/>
                            <a:map from="quote_tmpl_flag" to="quote_tmpl_flag"/>
                            <a:map from="category_name" to="item_category_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="item_desc" required="true" requiredMessage="请输入物品名称"/>
                    <a:field name="item_code" autoComplete="true" autoCompleteField="code_name" lovGridHeight="350" lovHeight="550" lovService="public.mtl_system_item_relations_lov" lovWidth="650" requiredMessage="${l:PUR3010.REQUIRE_MESSAGE8}" title="PUR_REQUISITION_LNS.ITEM_ID">
                        <a:mapping>
                            <a:map from="item_id" to="item_id"/>
                            <a:map from="item_code" to="item_code"/>
                            <a:map from="item_name" to="item_desc"/>
                            <a:map from="item_category_id" to="item_category_id"/>
                            <a:map from="item_category_name" to="item_category_desc"/>
                            <a:map from="item_category_code" to="item_category_code"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="approve_number"/>
                    <a:field name="quantity" required="true" requiredMessage="请输入需求数量"/>
                    <a:field name="unit_meas_lookup_code"/>
                    <a:field name="uom_desc" autoComplete="true" autoCompleteField="code_name" lovGridHeight="350" lovHeight="500" lovService="public.fnd_uom_codes_lov" lovWidth="500" required="true" requiredMessage="${l:PUR3010.REQUIRE_MESSAGE9}" title="PUR_REQUISITION_LNS.PRIMARY_UOM">
                        <a:mapping>
                            <a:map from="uom_code" to="unit_meas_lookup_code"/>
                            <a:map from="uom_desc" to="uom_desc"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="ship_to_organization_name"/>
                    <a:field name="warehouse_name"/>
                    <a:field name="inv_location_name"/>
                    <a:field name="ship_to_location_name"/>
                    <a:field name="budget_price"/>
                    <a:field name="exchange_rate"/>
                    <a:field name="tax_amount"/>
                    <a:field name="line_amount"/>
                    <a:field name="functional_amount"/>
                    <a:field name="line_comments"/>
                    <a:field name="tax_flag"/>
                    <a:field name="tax"/>
                    <a:field name="currency_name"/>
                    <a:field name="specify_whether_desc"/>
                    <a:field name="specify_whether" defaultValue="N"/>
                    <a:field name="company_name" readOnly="true"/>
                    <a:field name="need_by_date" readOnly="false" required="true" requiredMessage="需求日期必填！"/>
                    <a:field name="reason_analysis" readOnly="false" required="false"/>
                    <a:field name="reasons_for_out" readOnly="false" required="false"/>
                    <a:field name="use_department"/>
                    <a:field name="use_department_id"/>
                    <a:field name="storage_location"/>
                    <a:field name="product_spec_req" readOnly="false" required="false"/>
                    <a:field name="technical_spec" readOnly="false" required="false"/>
                    <a:field name="preve_instr" readOnly="false" required="false"/>
                    <a:field name="delivery_address"/>
                    <a:field name="replenish_flag_desc"/>
                    <a:field name="replenish_flag" defaultValue="N"/>
                    <a:field name="knttp"/>
                    <a:field name="knttp_desc" displayField="code_value_name" options="pur7041_po_knttp_ds" requiredMessage="${l:PUR7040.REQUIRE_MESSAGE9}">
                        <a:mapping>
                            <a:map from="code_value" to="knttp"/>
                            <a:map from="code_value_name" to="knttp_desc"/>
                        </a:mapping>
                    </a:field>
                </a:fields>
                <a:events>
                    <!-- <a:event name="load" handler="pur7041_ln_items_ds_load"/> -->
                    <a:event name="update" handler="pur7041_ln_items_ds_update"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="pur7041_quick_ds" autoCreate="true">
                <a:fields>
                    <a:field name="knttp"/>
                    <a:field name="knttp_desc" displayField="code_value_name" options="pur7041_po_knttp_ds" requiredMessage="${l:PUR7040.REQUIRE_MESSAGE9}" returnField="knttp" valueField="code_value"/>
                </a:fields>
                <a:events>
                    <a:event name="update" handler="on_pur7041_quick_ds_update"/>
                </a:events>
            </a:dataSet>
        </a:dataSets>
        <a:screenBody>
            <a:screenTopToolbar>
                <!-- <a:toolbarButton click="test_submit_to_oa" text="测试OA" width="100"/> -->
                <!-- <a:toolbarButton click="test_sn" text="测试苏宁" width="100"/> -->
                <!-- <a:toolbarButton click="pur7041_req_submit" text="PROMPT.SUBMIT" width="100"/> -->
                <!-- <a:toolbarButton click="pur7041_req_delete" text="退回购物车" width="100"/> -->
                <a:toolbarButton click="pur7041_req_save" text="PROMPT.SAVE" width="100"/>
                <a:toolbarButton click="pur7041_submit_to_oa" text="提交OA" width="100"/>
                <a:toolbarButton click="pur7041_delete_req_line" text="PUR7040.BTN_TEXT1" width="100"/>
                <a:toolbarButton click="pur7041_logistics_query" text="物流查询" width="100"/>
                <a:toolbarButton click="pur7041_return" text="PROMPT.RETURN" width="100"/>
            </a:screenTopToolbar>
            <a:hBox labelWidth="120" padding="0">
                <a:textField name="title" bindTarget="pur7041_req_header_ds" height="60" prompt="PUR7040.PROMPT_TITLE" width="966"/>
            </a:hBox>
            <a:hBox labelWidth="120" padding="0">
                <a:textField name="req_number" bindTarget="pur7041_req_header_ds" emptyText="PROMPT.NOT_GENERATED" prompt="HLS.PROJECT_NUMBER" readOnly="true"/>
                <!-- <a:comboBox name="type_lookup_name" bindTarget="pur7041_req_header_ds" prompt="PUR_REQUISITION_HDS.PUR_REQUISITION_TYPE_ID"/> -->
                <a:lov name="business_unit_name" bindTarget="pur7041_req_header_ds" prompt="PUR_REQUISITION_HDS.BUSINESS_UNIT_ID"/>
                <a:textField name="apply_date" bindTarget="pur7041_req_header_ds" prompt="PUR7040.SUPPLY_DATE"/>
                <a:numberField name="total_amount" bindTarget="pur7041_req_header_ds" prompt="PUR7040.SUPPLY_AMOUNT"/>
            </a:hBox>
            <a:hBox labelWidth="120" padding="0">
                <a:textField name="applicant_name" bindTarget="pur7041_req_header_ds" prompt="PUR7040.SUPPLY_BY"/>
                <a:lov name="pur_buyer_name" bindTarget="pur7041_req_header_ds" prompt="PUR_HEADERS_ALL.PUR_BUYER"/>
                <a:comboBox name="invoice_type_desc" bindTarget="pur7041_req_header_ds" prompt="PUR5320.BILL_TYPE"/>
                <a:textField name="status_desc" bindTarget="pur7041_req_header_ds" prompt="状态" readOnly="true"/>
                <!-- <a:textField name="phone" bindTarget="pur7041_req_header_ds" prompt="PUR7040.CONTACT_PHONE"/>
                <a:comboBox name="pur_po_type_desc" bindTarget="pur7041_req_header_ds" prompt="PUR7040.ORDER_TYPE"/>
                <a:textField name="applicant_unit" bindTarget="pur7041_req_header_ds" prompt="申请部门"/> -->
                <!-- <a:lov name="pur_organization_name" bindTarget="pur7041_req_header_ds" prompt="PUR_PUR_ORGS_INV_ORGS.PUR_ORGANIZATION_ID"/> -->
            </a:hBox>
            <!-- <a:hBox labelWidth="120" padding="0">
                <a:lov name="acquire_location_desc" bindTarget="pur7041_req_header_ds" prompt="PUR5860.ACQUIRE_LOCATION"/>
                <a:textField name="release_num" bindTarget="pur7041_req_header_ds" maxLength="30" prompt="PUR_HEADERS_ALL.RELEASE_NUM"/>
            </a:hBox> -->
            <a:hBox labelWidth="120" padding="0">
                <a:textArea name="header_comments" bindTarget="pur7041_req_header_ds" height="60" prompt="PUR7040.SUPPLY_COMMENTS" width="960"/>
            </a:hBox>
            <a:grid id="pur7041_ln_items_grid" autoAppend="false" bindTarget="pur7041_ln_items_ds" height="360" marginWidth="65" width="1000">
                <a:columns>
                    <a:column name="line_num" align="center" prompt="PUR_REQUISITION_LNS.LINE_NUMBER" width="40"/>
                    <!-- <a:column name="ship_to_organization_name" align="left" prompt="PUR_REQUISITION_LNS.INV_ORG_ID" width="80"/>
                    <a:column name="knttp_desc" align="center" prompt="PUR7040.KEMU_CLASS" width="60"/> -->
                    <a:column name="catalog_item_code" align="left" prompt="PROMPT_PUBLIC.CATALOG_ITEM_CODE" width="80"/>
                    <a:column name="catalog_item_name" prompt="PROMPT_PUBLIC.CATALOG_ITEM_NAME" width="120"/>
                    <a:column name="catalog_name" prompt="PROMPT_PUBLIC.CATALOG_NAME" width="120"/>
                    <a:column name="item_code" align="left" prompt="PUR7040.PROMPT_PRODUCT_CODE" width="80"/>
                    <a:column name="item_desc" prompt="PUR7040.PROMPT_PRODUCT_NAME" width="120"/>
                    <a:column name="item_category_desc" prompt="PUR7040.PROMPT_PRODUCT_CLASS" width="120"/>
                    <a:column name="uom_desc" align="left" editorFunction="pur7041_ln_items_grid_ef" prompt="PUR_REQUISITION_LNS.PRIMARY_UOM" width="50"/>
                    <a:column name="quantity" align="right" prompt="PUR_LINES_ALL.QUANTITY" width="60"/>
                    <a:column name="tax_type_code" align="center" prompt="PUR7040.PROMPT_TAX_CLASS" width="40"/>
                    <a:column name="tax_rate" align="right" prompt="PROMPT_PUBLIC.TAX_RATE" width="40"/>
                    <a:column name="price" align="right" editorFunction="pur7041_ln_items_grid_ef" prompt="PROMPT_PUBLIC.UNIT_TAX_PRICE" width="60"/>
                    <a:column name="line_amount" align="right" prompt="PUR7040.PROMPT_LINE_AMOUNT" width="60"/>
                    <a:column name="need_by_date" align="center" editor="pur7041_ln_items_grid_dp" prompt="PUR_RFX_FILING_POOL.NEED_BY_DATE" renderer="Aurora.formatDate" width="90"/>
                    <a:column name="vendor_name" align="left" prompt="PROMPT_PUBLIC.VENDOR" width="150"/>
                    <a:column name="delivery_address" align="left" prompt="PUR7040.SHOUHUO_INFO" width="200"/>
                    <a:column name="delivery_time" align="center" prompt="采购提前期" width="200"/>
                    <a:column name="line_comments" align="left" editor="pur7041_ln_items_grid_tf" prompt="PROMPT_PUBLIC.COMMENTS" width="200"/>
                    <!-- <a:column name="req_line_id" align="center" prompt="PUR7040.UPLOAD_FILE" renderer="pur7041_ln_items_grid_renderer" width="60"/> -->
                </a:columns>
                <a:editors>
                    <a:numberField id="pur7041_ln_items_grid_nf" allowDecimals="true" allowNegative="false" decimalPrecision="2"/>
                    <a:datePicker id="pur7041_ln_items_grid_dp"/>
                    <a:textField id="pur7041_ln_items_grid_tf"/>
                    <a:lov id="pur7041_ln_items_grid_lov"/>
                </a:editors>
                <a:events>
                    <a:event name="cellclick" handler="on_cellclick"/>
                </a:events>
            </a:grid>
        </a:screenBody>
    </a:view>
</a:screen>

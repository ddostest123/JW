<?xml version="1.0" encoding="UTF-8"?>
<!--
    $Author: Lin.Chen
    $Date: 2017-04-12 
    $Revision: 1.0  
    $Purpose: 目录定义，入口页面
-->
<a:screen xmlns:a="http://www.aurora-framework.org/application" trace="true">
    <a:init-procedure>
        <a:model-query model="cux.NEWHOPE.PUR.PUR7011.pur_catelog_user_defined_maintain" rootPath="pur_catelogs_buyers_counts"/>
    </a:init-procedure>
    <a:view>
        <a:link id="pur7011_pur_catelog_user_defined_disable_link" model="cux.NEWHOPE.PUR.PUR7011.pur_catelog_user_defined_disable_enable" modelaction="delete"/>
        <a:link id="pur7011_pur_catelog_user_defined_enable_link" model="cux.NEWHOPE.PUR.PUR7011.pur_catelog_user_defined_disable_enable" modelaction="update"/>
        <a:link id="pur7011_reset_eb_code_link" model="cux.NEWHOPE.PUR.PUR7011.pur_catelog_map_catelog" modelaction="execute"/>
        <a:link id="pur7011_assign_pur_buyer_link" url="${/request/@context_path}/modules/cux/NEWHOPE/PUR/PUR7011/pur_assign_pur_buyer.screen"/>
        <a:link id="pur7011_copy_pur_buyer_link" url="${/request/@context_path}/modules/cux/NEWHOPE/PUR/PUR7011/pur_copy_pur_buyer.screen"/>
        <a:link id="pur7011_catelog_mapping_detail_link" url="${/request/@context_path}/modules/cux/NEWHOPE/PUR/PUR7011/pur_catelog_mapping_detail.screen"/>
        <a:link id="pur_catelog_batch_mapping_link" url="${/request/@context_path}/modules/cux/NEWHOPE/PUR/PUR7011/pur_catelog_batch_mapping.screen"/>
        <a:link id="pur7011_replace_pur_buyer_link" url="${/request/@context_path}/modules/cux/NEWHOPE/PUR/PUR7011/pur_replace_pur_buyer.screen"/>
        <a:link id="pur7011_assign_pur_buyer_approver_link" url="${/request/@context_path}/modules/cux/NEWHOPE/PUR/PUR7011/pur_assign_pur_buyer_approver.screen"/>
        <script><![CDATA[
            // 计算采购员的数量
            //  var BuyersCountTotal = '${/model/pur_catelogs_buyers_counts/record/@buyers_total_counts}';
            //   alert(BuyersCountTotal);
            var max_catelog_level = 3; //最多定义的目录层数
            
            //验证自定义目录表字段的有效性
            
            function pur7011_catelogUserDefinedValidator(record, name, value) {
                if (record.dirty) {
                    if (name == 'catelog_code') {
                        //验证目录代码的长度不能超过30
                        if (pur7011_getLength(value) >= 30) {
                            return '${l:PUR7010.CATELOG_CODE_OVERLENGTH}';
                        }
                        //验证目录代码不重复
                        /* if (pur7011_unique_catelog(value) == 0) {
                         return '${l:PUR7010.CATELOG_CODE_UNIQUE}';
                         } */
                    } else if (name == 'catelog_name') {
                        //验证目录名称的长度不能超过1000
                        if (pur7011_getLength(value) >= 1000) {
                            return '${l:PUR7010.CATELOG_NAME_OVERLENGTH}';
                        }
                        //验证目录名称不重复
                        /* if (pur7011_unique_catelog_name(value) == 0) {
                         return '${l:PUR7010.CATELOG_NAME_UNIQUE}';
                         } */
                    }
                }
                return true;
            }
            
            //返回字符串真实长度
            
            function pur7011_getLength(str) {
                var realLength = 0,
                    len = 0,
                    charCode = -1;
                if (!Aurora.isEmpty(str)) {
                    len = str.length;
                }
                for (var i = 0;i < len;i++) {
                    charCode = str.charCodeAt(i);
                    if (charCode >= 0 && charCode <= 128) {
                        realLength += 1;
                    } else {
                        realLength += 3;
                    }
                }
                return realLength;
            }
            
            //判断目录代码是否唯一
            
            function pur7011_unique_catelog(str) {
                var unique = 1;
                var count = 0;
                var records = $('pur7011_catelog_user_defined_maintain_ds').getAll();
                for (var i = 0;i < records.length;i++) {
                    if (str == records[i].get('catelog_code')) {
                        count++;
                    }
                }
                if (count > 1) {
                    unique = 0;
                }
                return unique;
            }
            
            //判断目录名称是否唯一
            
            function pur7011_unique_catelog_name(str) {
                var unique = 1;
                var count = 0;
                var records = $('pur7011_catelog_user_defined_maintain_ds').getAll();
                for (var i = 0;i < records.length;i++) {
                    if (str == records[i].get('catelog_name')) {
                        count++;
                    }
                }
                if (count > 1) {
                    unique = 0;
                }
                return unique;
            }
            
            function pur7011_catelogUserDefined_result_onQuery(ds) {
                //触发查询事件时，锁住按钮
                $('pur7011_catelogUserDefined_grid_addButton').disable();
                $('pur7011_catelogUserDefined_grid_saveButton').disable();
            }
            
            function pur7011_catelogUserDefined_result_onLoad(ds) {
                var records = ds.getAll();
                for (var i = 0;i < records.length;i++) {
                    if (records[i].get('approve_method') == 'SPECIFY_OA') {
                        records[i].getField('approve_area').setReadOnly(false);
                        records[i].getField('approve_area').setRequired(true);
                    } else {
                        records[i].getField('approve_area').setReadOnly(true);
                        records[i].getField('approve_area').setRequired(false);
                    }
                }
                //触发加载数据事件时，解锁按钮
                $('pur7011_catelogUserDefined_grid_addButton').enable();
                $('pur7011_catelogUserDefined_grid_saveButton').enable();
            }
            
            function pur7011_catelogUserDefined_result_update(dataSet , record, name, value, oldvalue) {
                if (record.get('catelog_level') == 1) {
            
                    if (record.get('approve_method') != 'SPECIFY_OA') {
                        record.set('approve_area', '');
                    }
            
                    if (name == 'oa_approve_flag' || name == 'catelog_flag' || name == 'mall_flag' || name == 'company_full_name' || name == 'approve_method' || name == 'approve_method_desc' || name == 'approve_area') {
                        var records = dataSet.getAll();
                        for (var i = 0;i < records.length;i++) {
            
                            if (records[i].get('catelog_level') == 2 && records[i].get('parent_catelog_udf_id') == record.get('catelog_udf_id')) {
                                records[i].set('oa_approve_flag', record.get('oa_approve_flag'));
                                records[i].set('catelog_flag', record.get('catelog_flag'));
                                records[i].set('mall_flag', record.get('mall_flag'));
                                records[i].set('company_id', record.get('company_id'));
                                records[i].set('company_full_name', record.get('company_full_name'));
                                records[i].set('approve_method', record.get('approve_method'));
                                records[i].set('approve_method_desc', record.get('approve_method_desc'));
                                records[i].set('approve_area', record.get('approve_area'));
                                for (var j = 0;j < records.length;j++) {
                                    if (records[j].get('catelog_level') == 3 && records[j].get('parent_catelog_udf_id') == records[i].get('catelog_udf_id')) {
                                        records[j].set('oa_approve_flag', record.get('oa_approve_flag'));
                                        records[j].set('catelog_flag', record.get('catelog_flag'));
                                        records[j].set('mall_flag', record.get('mall_flag'));
                                        records[j].set('company_id', record.get('company_id'));
                                        records[j].set('company_full_name', record.get('company_full_name'));
                                        records[j].set('approve_method', record.get('approve_method'));
                                        records[j].set('approve_method_desc', record.get('approve_method_desc'));
                                        records[j].set('approve_area', record.get('approve_area'));
                                    }
                                }
                            }
                        }
                    }
                }
            
                if (name == 'approve_method') {
                    if (record.get('approve_method') == 'SPECIFY_OA') {
                        record.getField('approve_area').setReadOnly(false);
                        record.getField('approve_area').setRequired(true);
                    } else {
                        record.getField('approve_area').setReadOnly(true);
                        record.getField('approve_area').setRequired(false);
                    }
                }
            }
            
            function pur7011_catelogUserDefined_result_onSubmit(ds) {
                Aurora.showMessage('${l:PROMPT}', '${l:PROMPT.SAVE_SUCCESS}');
                ds.query();
            }
            
            
            function pur7011_catelogUserDefinedMaintainDsTreeGridEditorFunction(record, name) {
                if (name == 'catelog_code') {
                    if (record.isNew) {
                        return 'pur7011_catelog_user_defined_maintain_ds_treegrid_tf';
                    } else {
                        return '';
                    }
                }
            
                if (name == 'catelog_name') {
                    if (record.get('enabled_flag') == 'Y') {
                        return 'pur7011_catelog_user_defined_maintain_ds_treegrid_tf';
                    } else {
                        return '';
                    }
                }
            
            }
            
            function pur7011_catelogUserDefinedMaintainAddRoot() {
                var ds = $('pur7011_catelog_user_defined_maintain_ds');
            
                var new_record = ds.create({
                    'catelog_udf_id': '',
                    'expanded': 'Y',
                    'catelog_code': '',
                    'catelog_name': '',
                    'catelog_level': 1,
                    'parent_catelog_udf_id': -1,
                    'enabled_flag': 'Y'
                });
            }
            
            //保存
            
            function pur7011_catelogUserDefinedMaintainSave() {
                var ds = $('pur7011_catelog_user_defined_maintain_ds');
                var records = ds.getAll();
                var count = 0;
                for (var i = 0;i < records.length;i++) {
                    if (!(records[i].dirty)) {
                        count++;
                    }
                }
                if (count == records.length) {
                    Aurora.showMessage('${l:PROMPT}', '${l:PUR_CONTRACT_ITEM_FLAG.NOT_MODIFY}');
                    return;
                }
                if (!(ds.validate())) {
                    return;
                }
                Aurora.showConfirm('${l:PROMPT}', '${l:PUR_CONTRACT_ITEM_FLAG.CONFIRM_SAVE}', function() {
                    ds.submit();
                });
            }
            
            function pur7011_catelogUserDefinedMaintainDsTreegridRenderer(value, record, name) {
                var catelog_level = record.get('catelog_level');
                var catelog_udf_id = record.get('catelog_udf_id');
                var enabled_flag = record.get('enabled_flag');
            
                if (name == 'addChild') {
                    if (!Aurora.isEmpty(catelog_udf_id) && enabled_flag == 'Y' && catelog_level < max_catelog_level) {
                        return '<a href="javascript:pur7011_catelogUserDefinedMaintainDsTreegridRendererAddChild(' + catelog_level + ',' + catelog_udf_id + ')">${l:PUR_CATELOGS_USER_DEFINED.ADD_CHILD_CATELOG}</a>';
                    } else if (enabled_flag == 'N') {
                        return '<div style="background:red">${l:PUR_CATELOGS_USER_DEFINED.DISABLED_CATELOG}</div>';
                    }
                } else if (name == 'removeCatelog') {
                    var parent_catelog_udf_id = record.get('parent_catelog_udf_id');
                    var records = $('pur7011_catelog_user_defined_maintain_ds').getAll();
            
                    if (!Aurora.isEmpty(catelog_udf_id) && enabled_flag == 'Y') {
                        if (catelog_level < max_catelog_level) {
                            return '<a href="javascript:pur7011_catelogUserDefinedMaintainDsTreegridRendererDisableCatelog(' + catelog_udf_id + ')">${l:PUR_CATELOGS_USER_DEFINED.DISABLE_CATELOG_AND_CHILD}</a>';
                        } else {
                            return '<a href="javascript:pur7011_catelogUserDefinedMaintainDsTreegridRendererDisableCatelog(' + catelog_udf_id + ')">${l:PUR_CATELOGS_USER_DEFINED.DISABLE_CATELOG_AND_CHILD}</a>';
                        }
                    } else if (record.isNew) {
                        return '<a href="javascript:pur7011_catelogUserDefinedMaintainDsTreegridRendererClearCatelog()">${l:PUR_CATELOGS_USER_DEFINED.CLEAR_LINE}</a>';
                    } else if (enabled_flag == 'N') {
                        if (parent_catelog_udf_id == -1) { //根级目录
                            return '<a href="javascript:pur7011_catelogUserDefinedMaintainDsTreegridRendererEnableCatelog(' + catelog_udf_id + ')">${l:PUR_CATELOGS_USER_DEFINED.ENABLE_CATELOG_AND_CHILD}</a>';
                        } else {
                            for (var i = 0;i < records.length;i++) { //判断上级目录是否启用，启用则显示，禁用则不显示
                                if (parent_catelog_udf_id == records[i].get('catelog_udf_id') && records[i].get('enabled_flag') == 'Y') {
                                    return '<a href="javascript:pur7011_catelogUserDefinedMaintainDsTreegridRendererEnableCatelog(' + catelog_udf_id + ')">${l:PUR_CATELOGS_USER_DEFINED.ENABLE_CATELOG_AND_CHILD}</a>';
                                }
                            }
                        }
                    }
                }
            }
            
            function pur7011_catelogUserDefinedMaintainDsTreegridRendererAddChild(catelog_level, catelog_udf_id) {
                var ds = $('pur7011_catelog_user_defined_maintain_ds');
            
                var record = ds.find('catelog_udf_id', catelog_udf_id);
            
                var new_record = ds.create({
                    'catelog_udf_id': '',
                    'expanded': 'Y',
                    'catelog_code': '',
                    'catelog_name': '',
                    'catelog_level': catelog_level + 1,
                    'parent_catelog_udf_id': catelog_udf_id,
                    'enabled_flag': 'Y',
                    'company_id': record.get('company_id'),
                    'company_full_name': record.get('company_full_name'),
                    'catelog_flag': record.get('catelog_flag'),
                    'mall_flag': record.get('mall_flag'),
                    'oa_approve_flag': record.get('oa_approve_flag'),
                    'approve_method': record.get('approve_method'),
                    'approve_method_desc': record.get('approve_method_desc'),
                    'approve_area': record.get('approve_area')
                });
            }
            //禁用
            
            function pur7011_catelogUserDefinedMaintainDsTreegridRendererDisableCatelog(catelog_udf_id) {
            
                //提交AjAX请求
                Aurora.showConfirm('${l:PROMPT}', '${l:PUR_CATELOGS_USER_DEFINED.SURE_TO_DISABLE_CATELOG}', function() {
                    Aurora.Masker.mask(Ext.getBody(), '${l:LOADING}');
                    Aurora.request({
                        url: $('pur7011_pur_catelog_user_defined_disable_link').getUrl(),
                        para: {
                            catelog_udf_id: catelog_udf_id
                        },
                        success: function() {
                            Aurora.Masker.unmask(Ext.getBody());
                            $('pur7011_catelog_user_defined_maintain_ds').query();
                        },
                        failure: function() {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        error: function() {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        scope: this
                    });
                });
            }
            
            //启用
            
            function pur7011_catelogUserDefinedMaintainDsTreegridRendererEnableCatelog(catelog_udf_id) {
            
                //提交AjAX请求
                Aurora.showConfirm('${l:PROMPT}', '${l:PUR_CATELOGS_USER_DEFINED.SURE_TO_ENABLE_CATELOG}', function() {
                    Aurora.Masker.mask(Ext.getBody(), '${l:LOADING}');
                    Aurora.request({
                        url: $('pur7011_pur_catelog_user_defined_enable_link').getUrl(),
                        para: {
                            catelog_udf_id: catelog_udf_id
                        },
                        success: function() {
                            Aurora.Masker.unmask(Ext.getBody());
                            $('pur7011_catelog_user_defined_maintain_ds').query();
                        },
                        failure: function() {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        error: function() {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        scope: this
                    });
                });
            }
            
            //清除此行
            
            function pur7011_catelogUserDefinedMaintainDsTreegridRendererClearCatelog() {
                var ds = $('pur7011_catelog_user_defined_maintain_ds');
                var record = ds.getCurrentRecord();
                ds.remove(record);
            }
            
            function pur7011_catelogUserDefinedQuery() {
                $('pur7011_catelog_user_defined_maintain_ds').query();
            }
            
            function pur7011_gridRenderer(value, record, name) {
                if (name == 'assign_approve_buyer') {
                    if (record.get('catelog_udf_id') && record.get('enabled_flag') == 'Y' && record.get('catelog_level') == 3 && record.get('assign_approver_flag') == 'Y') {
                        var title = '${l:CUX_NEWHOME.TEXT_POINT} [ ' + record.get('catelog_name') + ' ] ${l:CUX_NEWHOME.APPROVED_BY}';
                        return '<a href="javascript:pur7011_PurBuyerRendererAssignApprovePurBuyer(' + record.get('catelog_udf_id') + ',\'' + title + '\')">${l:CUX_NEWHOME.TEXT_POINT}${l:CUX_NEWHOME.APPROVED_BY}(' + record.get('approver_total_counts') + ')</a>';
                    }
                    //分配询价员
                } else if (name == 'assign_pur_buyer') {
            
                    if (record.get('catelog_udf_id') && record.get('enabled_flag') == 'Y' && record.get('catelog_level')) {
                        return '<a href="javascript:pur7011_assignPurBuyerRendererAssignPurBuyer(' + record.get('catelog_udf_id') + ')">${l:CUX_NEWHOME.FENPEI_RFXER}(' + record.get('buyers_total_counts') + ')</a>';
                    }
                } else if (name == 'copy_pur_buyer') {
                    if (record.get('catelog_udf_id') && record.get('enabled_flag') == 'Y' && record.get('catelog_level')) {
                        return '<a href="javascript:pur7011_copyPurBuyerRendererAssignPurBuyer(' + record.get('catelog_udf_id') + ')">${l:CUX_NEWHOME.TEXT_COPY}</a>';
                    }
                } else if (name == 'map_catlog') {
                    return '<a href="javascript:pur7011_map_catlog(\'' + record.get('data_source') + '\',\'' + record.get('data_source_id') + '\')">${l:CUX_NEWHOME.MAP_CATALOG}</a>';
                }
            
                return '';
            }
            
            function pur7011_replace_pur_buyer() {
                new Aurora.Window({
                    id: 'pur_replace_buyer_window',
                    url: $('pur7011_replace_pur_buyer_link').getUrl(),
                    title: '${l:CUX_NEWHOME.RETURN_RFXER}',
                    fullScreen: false,
                    width: 360,
                    height: 200
                });
            }
            
            function pur7011_PurBuyerRendererAssignApprovePurBuyer(catelog_udf_id, title) {
                new Aurora.Window({
                    id: 'pur7011_assign_pur_buyer_approver_window',
                    url: $('pur7011_assign_pur_buyer_approver_link').getUrl() + '?catelog_udf_id=' + catelog_udf_id,
                    title: title,
                    fullScreen: false,
                    width: 600,
                    height: 400
                });
            }
            
            function pur7011_assignPurBuyerRendererAssignPurBuyer(catelog_udf_id) {
                new Aurora.Window({
                    id: 'pur_assign_pur_buyer_window',
                    url: $('pur7011_assign_pur_buyer_link').getUrl() + '?catelog_udf_id=' + catelog_udf_id,
                    title: '${l:CUX_NEWHOME.FENPEI_RFXER}',
                    fullScreen: true
                });
            }
            
            function pur7011_copyPurBuyerRendererAssignPurBuyer(catelog_udf_id) {
                new Aurora.Window({
                    id: 'pur_copy_pur_buyer_window',
                    url: $('pur7011_copy_pur_buyer_link').getUrl() + '?catelog_udf_id=' + catelog_udf_id,
                    title: '${l:CUX_NEWHOME.COPY_RFXER}',
                    width: 360,
                    height: 160
                });
            }
            
            function pur7011_map_catlog(data_source, data_source_id) {
                new Aurora.Window({
                    id: 'pur_catelog_mapping_detail_result_window',
                    url: $('pur7011_catelog_mapping_detail_link').getUrl() + '?data_source=' + '&data_source_id=' + data_source_id,
                    title: '${l:CUX_NEWHOME.MAP_CATALOG}',
                    fullScreen: true
                });
            }
            
            function pur7011_batch_mapping_catlog() {
                var records = $('pur7011_catelog_mapping_result_ds').getSelected();
                if (records.length == 0) {
                    Aurora.showMessage('${l:PROMPT}', '${l:CUX_NEWHOME.SELECT_ONE_AT_LEAST1}');
                    return '';
                }
            
                var company_id = records[0].get('company_id');
            
                for (var i = 1;i < records.length;i++) {
                    if (company_id != records[i].get('company_id')) {
                        Aurora.showMessage('${l:PROMPT}', '${l:CUX_NEWHOME.SELECT_BOLONGS_ONE_COMPANY}');
                        return '';
                    }
                }
            
                new Aurora.Window({
                    id: 'pur_catelog_batch_mapping_window',
                    url: $('pur_catelog_batch_mapping_link').getUrl() + '?company_id=' + company_id,
                    title: '${l:CUX_NEWHOME.EXECUTE_MAPS}',
                    fullScreen: false,
                    width: 360,
                    height: 200
                });
            }
            
            function pur7011_catelog_user_defined_maintain_ds_treegrid_editorFunction(record, name) {
                if (record.get('catelog_level') == 3) {
                    if (name == 'assign_approver_flag' || name == 'atm_flag' || name == 'assign_approver_flag' || name == 'atm_flag') {
                        return 'pur7011_catelog_user_defined_maintain_ds_treegrid_cb';
                    }
                }
            
                if (record.get('catelog_level') == 1) {
                    if (name == 'oa_approve_flag' || name == 'mall_flag' || name == 'catelog_flag') {
                        return 'pur7011_catelog_user_defined_maintain_ds_treegrid_cb';
                    } else if (name == 'company_full_name') {
                        return 'pur7011_catelog_user_defined_maintain_ds_treegrid_lov';
                    } else if (name == 'approve_method_desc') {
                        return 'pur7011_catelog_user_defined_maintain_ds_treegrid_cbb';
                    } else if (name == 'approve_area') {
                        return 'pur7011_catelog_user_defined_maintain_ds_treegrid_tf2';
                    } else if (name == 'sap_flag') {
                        return 'pur7011_catelog_user_defined_maintain_ds_treegrid_cb';
                    } else if (name == 'srm_collect_goods') {
                        return 'pur7011_catelog_user_defined_maintain_ds_treegrid_cb';
                    }
                }
                return '';
            }
            
            function pur7011_reset_eb_code(catelog_udf_id) {
                //提交AjAX请求
                Aurora.showConfirm('${l:PROMPT}', '${l:CUX_NEWHOME.RESET_PRODUCT_CODE}', function() {
                    Aurora.Masker.mask(Ext.getBody(), '${l:LOADING}');
                    Aurora.request({
                        url: $('pur7011_reset_eb_code_link').getUrl(),
                        para: {},
                        success: function() {
                            Aurora.Masker.unmask(Ext.getBody());
                            Aurora.showMessage('${l:PROMPT}', '${l:CUX_NEWHOME.OPERATE_SUCCESS}');
                        },
                        failure: function() {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        error: function() {
                            Aurora.Masker.unmask(Ext.getBody());
                        },
                        scope: this
                    });
                });
            }
            
            function on_grid_cellclick(grid, row, name, record) {
                if (name == 'catelog_code') {
                    record.getField('catelog_code').setLovPara('company_id', record.get('company_id'));
                }
            }
            
            function on_pur7011_catelog_mapping_result_ds_submitsuccess() {
                $('pur7011_catelog_mapping_result_ds').query();
            }
        ]]></script>
        <a:dataSets>
            <a:dataSet id="pur7011_approve_method_ds" lookupCode="PUR_APPROVE_METHOD"/>
            <a:dataSet id="pur7011_b2b_ds" lookupCode="PUR_MAPPING_DATASOURCE"/>
            <a:dataSet id="pur7011_yes_no_ds" lookupCode="YES_OR_NO"/>
            <a:dataSet id="pur7011_catelog_user_defined_query_ds" autoCreate="true">
                <a:fields>
                    <a:field name="company_id"/>
                    <a:field name="company_full_name" autoComplete="true" autoCompleteField="code_name" lovHeight="500" lovService="public.fnd_companies_lov" lovWidth="550" title="CUX_NEWHOME.COMPANY_QUERY">
                        <a:mapping>
                            <a:map from="company_id" to="company_id"/>
                            <a:map from="company_full_name" to="company_full_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="hidden_flag" checkedValue="Y" defaultValue="Y" uncheckedValue="N"/>
                </a:fields>
            </a:dataSet>
            <a:dataSet id="pur7011_catelog_user_defined_maintain_ds" autoQuery="true" fetchAll="true" model="cux.NEWHOPE.PUR.PUR7011.pur_catelog_user_defined_maintain" queryDataSet="pur7011_catelog_user_defined_query_ds">
                <a:fields>
                    <a:field name="parent_catelog_udf_id"/>
                    <a:field name="catelog_code" required="true" requiredMessage="${l:PUR_CATELOGS_USER_DEFINED.CATELOG_CODE_NOT_NULL}" validator="pur7011_catelogUserDefinedValidator"/>
                    <a:field name="catelog_name" required="true" requiredMessage="${l:PUR_CATELOGS_USER_DEFINED.CATELOG_NAME_NOT_NULL}" validator="pur7011_catelogUserDefinedValidator"/>
                    <a:field name="catelog_level"/>
                    <a:field name="enabled_flag" checkedValue="Y" defaultValue="Y" uncheckedValue="N"/>
                    <a:field name="expanded" checkedValue="Y" uncheckedValue="N"/>
                    <a:field name="oa_approve_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="assign_approver_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="atm_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="sap_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="srm_collect_goods" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="catelog_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="mall_flag" checkedValue="Y" defaultValue="N" uncheckedValue="N"/>
                    <a:field name="approve_method_desc" displayField="code_value_name" options="pur7011_approve_method_ds" required="true" requiredMessage="${l:CUX_NEWHOME.SELECT_APPROVE_TYPE}" returnField="approve_method" valueField="code_value"/>
                    <a:field name="approve_area" required="false" requiredMessage="${l:CUX_NEWHOME.POINT_OA_CODE}"/>
                    <a:field name="company_id"/>
                    <a:field name="company_full_name" autoComplete="true" autoCompleteField="code_name" lovHeight="500" lovService="public.fnd_companies_lov" lovWidth="550" title="CUX_NEWHOME.COMPANY_QUERY">
                        <a:mapping>
                            <a:map from="company_id" to="company_id"/>
                            <a:map from="company_full_name" to="company_full_name"/>
                        </a:mapping>
                    </a:field>
                </a:fields>
                <a:events>
                    <a:event name="query" handler="pur7011_catelogUserDefined_result_onQuery"/>
                    <a:event name="load" handler="pur7011_catelogUserDefined_result_onLoad"/>
                    <a:event name="update" handler="pur7011_catelogUserDefined_result_update"/>
                    <a:event name="submitsuccess" handler="pur7011_catelogUserDefined_result_onSubmit"/>
                </a:events>
            </a:dataSet>
            <a:dataSet id="pur7011_catelog_mapping_query_ds" autoCreate="true">
                <a:fields>
                    <a:field name="data_source_desc" displayField="code_value_name" options="pur7011_b2b_ds" returnField="data_source" valueField="code_value"/>
                    <a:field name="category_name"/>
                    <a:field name="catelog_name" lovHeight="500" lovUrl="${/request/@context_path}/modules/public/pur_catelogs_user_defined_lov.screen" lovWidth="550" title="CUX_NEWHOME.CATALOG_CLASS_QUERY">
                        <a:mapping>
                            <a:map from="catelog_udf_id" to="catelog_udf_id"/>
                            <a:map from="catelog_code" to="catelog_code"/>
                            <a:map from="catelog_name" to="catelog_name"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="mapping_flag_desc" displayField="code_value_name" options="pur7011_yes_no_ds" returnField="mapping_flag" valueField="code_value"/>
                    <a:field name="company_id"/>
                    <a:field name="company_full_name" autoComplete="true" autoCompleteField="code_name" lovHeight="500" lovService="public.fnd_companies_lov" lovWidth="550" title="CUX_NEWHOME.COMPANY_QUERY">
                        <a:mapping>
                            <a:map from="company_id" to="company_id"/>
                            <a:map from="company_full_name" to="company_full_name"/>
                        </a:mapping>
                    </a:field>
                </a:fields>
            </a:dataSet>
            <a:dataSet id="pur7011_catelog_mapping_result_ds" autoCount="true" autoPageSize="true" autoQuery="true" model="cux.NEWHOPE.PUR.PUR7011.pur_catelog_map_catelog" queryDataSet="pur7011_catelog_mapping_query_ds" selectable="true">
                <a:fields>
                    <a:field name="mapping_id"/>
                    <a:field name="catelog_udf_id"/>
                    <a:field name="category_udf_id"/>
                    <a:field name="catelog_code" lovHeight="500" lovUrl="${/request/@context_path}/modules/public/pur_catelogs_user_defined_lov.screen" lovWidth="550" title="CUX_NEWHOME.CATALOG_CLASS_QUERY">
                        <a:mapping>
                            <a:map from="catelog_udf_id" to="catelog_udf_id"/>
                            <a:map from="catelog_level" to="catelog_level"/>
                            <a:map from="catelog_name" to="catelog_name"/>
                            <a:map from="catelog_code" to="catelog_code"/>
                        </a:mapping>
                    </a:field>
                    <a:field name="catelog_name"/>
                    <a:field name="catelog_level"/>
                    <a:field name="data_source"/>
                    <a:field name="data_source_desc"/>
                    <a:field name="category_name"/>
                    <a:field name="company_id"/>
                    <a:field name="company_full_name"/>
                </a:fields>
                <a:events>
                    <a:event name="submitsuccess" handler="on_pur7011_catelog_mapping_result_ds_submitsuccess"/>
                </a:events>
            </a:dataSet>
        </a:dataSets>
        <a:screenBody>
            <a:tabPanel marginWidth="30">
                <a:tabs>
                    <a:tab prompt="CUX_NEWHOME.SRM_PLATFORM_CATALOG" width="100">
                        <a:screenTopToolbar>
                            <a:toolbarButton id="pur7011_catelogUserDefined_grid_addButton" click="pur7011_catelogUserDefinedMaintainAddRoot" style="margin-left:20px;" text="PUR_CATELOGS_USER_DEFINED.NEW_TOP_CATELOG" width="100"/>
                            <a:toolbarButton id="pur7011_catelogUserDefined_grid_saveButton" click="pur7011_catelogUserDefinedMaintainSave" style="margin-left:20px;" text="PROMPT.SAVE" width="100"/>
                            <!-- <a:toolbarButton id="pur7011_catelogUserDefined_grid_replaceButton" click="pur7011_replace_pur_buyer" style="margin-left:20px;" text="替换询价员" width="100"/> -->
                        </a:screenTopToolbar>
                        <a:queryForm bindTarget="pur7011_catelog_user_defined_query_ds" resultTarget="pur7011_catelog_user_defined_maintain_ds" style="width:100%;border:none">
                            <a:formToolBar>
                                <a:hBox labelWidth="120">
                                    <a:lov name="company_full_name" prompt="PROMPT_PUBLIC.PROMPT_COMPANY">
                                        <a:events>
                                            <a:event name="enterdown" handler="pur7011_catelogUserDefinedQuery"/>
                                        </a:events>
                                    </a:lov>
                                    <a:textField name="catelog_code" prompt="PUR_CATELOGS_USER_DEFINED.CATELOG_CODE">
                                        <a:events>
                                            <a:event name="enterdown" handler="pur7011_catelogUserDefinedQuery"/>
                                        </a:events>
                                    </a:textField>
                                    <a:textField name="catelog_name" prompt="PUR_CATELOGS_USER_DEFINED.CATELOG_NAME">
                                        <a:events>
                                            <a:event name="enterdown" handler="pur7011_catelogUserDefinedQuery"/>
                                        </a:events>
                                    </a:textField>
                                    <a:checkBox name="hidden_flag" prompt="CUX_NEWHOME.HIDE_ENABLED">
                                        <a:events>
                                            <a:event name="enterdown" handler="pur7011_catelogUserDefinedQuery"/>
                                        </a:events>
                                    </a:checkBox>
                                </a:hBox>
                            </a:formToolBar>
                        </a:queryForm>
                        <a:form title="PUR_CATELOGS_USER_DEFINED.TITLE_CATELOG_LIST">
                            <a:treeGrid id="pur7011_catelog_user_defined_maintain_ds_treegrid" bindTarget="pur7011_catelog_user_defined_maintain_ds" expandField="expanded" idField="catelog_udf_id" marginHeight="220" marginWidth="80" navBar="true" parentField="parent_catelog_udf_id" showCheckBox="false" width="1000">
                                <a:columns>
                                    <a:column name="catelog_code" align="left" editorFunction="pur7011_catelogUserDefinedMaintainDsTreeGridEditorFunction" prompt="PUR_CATELOGS_USER_DEFINED.CATELOG_CODE" width="120"/>
                                    <a:column name="catelog_name" align="left" editorFunction="pur7011_catelogUserDefinedMaintainDsTreeGridEditorFunction" prompt="PUR_CATELOGS_USER_DEFINED.CATELOG_NAME" width="110"/>
                                    <a:column name="company_full_name" align="center" editorFunction="pur7011_catelog_user_defined_maintain_ds_treegrid_editorFunction" prompt="PROMPT_PUBLIC.PROMPT_COMPANY" sortable="true" width="110"/>
                                    <a:column name="catelog_level" align="center" width="50"/>
                                    <a:column name="addChild" align="center" prompt="PUR_CATELOGS_USER_DEFINED.CATELOG_OPERATION" renderer="pur7011_catelogUserDefinedMaintainDsTreegridRenderer" width="50"/>
                                    <a:column name="removeCatelog" align="center" renderer="pur7011_catelogUserDefinedMaintainDsTreegridRenderer" width="50"/>
                                    <!--    <a:column name="catelog_flag" align="center" editorFunction="pur7011_catelog_user_defined_maintain_ds_treegrid_editorFunction" prompt="CUX_NEWHOME.CATALOG_HUA" width="60"/>
                                    <a:column name="mall_flag" align="center" editorFunction="pur7011_catelog_user_defined_maintain_ds_treegrid_editorFunction" prompt="CUX_NEWHOME.SHANGCHENG_SHIYONG" width="60"/> -->
                                    <a:column name="approve_method_desc" align="left" editorFunction="pur7011_catelog_user_defined_maintain_ds_treegrid_editorFunction" prompt="CUX_NEWHOME.APPROVE_TYPE" width="100"/>
                                    <a:column name="approve_area" align="left" editorFunction="pur7011_catelog_user_defined_maintain_ds_treegrid_editorFunction" prompt="CUX_NEWHOME.APPROVE_RANGE" width="100"/>
                                    <a:column name="sap_flag" align="center" editorFunction="pur7011_catelog_user_defined_maintain_ds_treegrid_editorFunction" prompt="是否传SAP" width="100"/>
                                    <a:column name="srm_collect_goods" align="center" editorFunction="pur7011_catelog_user_defined_maintain_ds_treegrid_editorFunction" prompt="是否在SRM收货" width="100"/>
                                    <!-- <a:column name="oa_approve_flag" align="center" editorFunction="pur7011_catelog_user_defined_maintain_ds_treegrid_editorFunction" prompt="OA审批" width="60"/> -->
                                    <a:column name="atm_flag" align="center" editorFunction="pur7011_catelog_user_defined_maintain_ds_treegrid_editorFunction" prompt="CUX_NEWHOME.PRODUCT_ATTACHMENT_REQUIRE" width="70"/>
                                    <!-- <a:column name="assign_approver_flag" align="center" editorFunction="pur7011_catelog_user_defined_maintain_ds_treegrid_editorFunction" hidden="true" prompt="集采目录" width="50"/>
                                    <a:column name="assign_approve_buyer" align="center" hidden="true" prompt="指定审批人" renderer="pur7011_gridRenderer" width="60"/>
                                    <a:column name="assign_pur_buyer" align="center" hidden="true" prompt="分配询价员" renderer="pur7011_gridRenderer" width="60"/>
                                    <a:column name="copy_pur_buyer" align="center" hidden="true" prompt="复制询价员" renderer="pur7011_gridRenderer" width="60"/> -->
                                </a:columns>
                                <a:editors>
                                    <a:checkBox id="pur7011_catelog_user_defined_maintain_ds_treegrid_cb"/>
                                    <a:comboBox id="pur7011_catelog_user_defined_maintain_ds_treegrid_cbb"/>
                                    <a:textField id="pur7011_catelog_user_defined_maintain_ds_treegrid_tf"/>
                                    <a:textField id="pur7011_catelog_user_defined_maintain_ds_treegrid_tf2" maxLength="30" typeCase="upper"/>
                                    <a:lov id="pur7011_catelog_user_defined_maintain_ds_treegrid_lov"/>
                                </a:editors>
                            </a:treeGrid>
                        </a:form>
                    </a:tab>
                    <!--   <a:tab prompt="CUX_NEWHOME.CATALOG_MAP" width="100">
                        <a:screenTopToolbar>
                            <a:toolbarButton click="pur7011_batch_mapping_catlog" style="margin-left:20px;" text="CUX_NEWHOME.BATCH_MAP" width="100"/>
                            <a:gridButton bind="pur7011_catelog_mapping_result_ds_grid" style="margin-left:20px;" type="save" width="100"/>
                            <a:toolbarButton click="pur7011_reset_eb_code" style="margin-left:20px;" text="初始化商品编码" width="100"/> 
                            <a:gridButton bind="pur7011_catelog_mapping_result_ds_grid" style="margin-left:20px;" type="excel" width="100"/>
                        </a:screenTopToolbar>
                        <a:queryForm bindTarget="pur7011_catelog_mapping_query_ds" resultTarget="pur7011_catelog_mapping_result_ds" style="width:100%;border:none">
                            <a:formToolBar>
                                <a:hBox labelWidth="120">
                                    <a:lov name="company_full_name" prompt="PROMPT_PUBLIC.PROMPT_COMPANY">
                                        <a:events>
                                            <a:event name="enterdown" handler="pur7011_catelogUserDefinedQuery"/>
                                        </a:events>
                                    </a:lov>
                                    <a:comboBox name="data_source_desc" prompt="PROMPT_PUBLIC.PROMPT_PLATFORM_NAME">
                                        <a:events>
                                            <a:event name="enterdown" handler="pur7011_catelogUserDefinedQuery"/>
                                        </a:events>
                                    </a:comboBox>
                                    <a:textField name="category_name" prompt="PROMPT_PUBLIC.PROMPT_CLASS">
                                        <a:events>
                                            <a:event name="enterdown" handler="pur7011_catelogUserDefinedQuery"/>
                                        </a:events>
                                    </a:textField>
                                    <a:lov name="catelog_name" prompt="CUX_NEWHOME.PROMPT_CATALOG">
                                        <a:events>
                                            <a:event name="enterdown" handler="pur7011_catelogUserDefinedQuery"/>
                                        </a:events>
                                    </a:lov>
                                </a:hBox>
                            </a:formToolBar>
                            <a:formBody>
                                <a:hBox labelWidth="120">
                                    <a:comboBox name="mapping_flag_desc" prompt="CUX_NEWHOME.IS_MAP">
                                        <a:events>
                                            <a:event name="enterdown" handler="pur7011_catelogUserDefinedQuery"/>
                                        </a:events>
                                    </a:comboBox>
                                </a:hBox>
                            </a:formBody>
                        </a:queryForm>
                        <a:form title="PUR_CATELOGS_USER_DEFINED.TITLE_CATELOG_LIST">
                            <a:grid id="pur7011_catelog_mapping_result_ds_grid" bindTarget="pur7011_catelog_mapping_result_ds" marginHeight="220" marginWidth="80" navBar="true" width="1000">
                                <a:columns>
                                    <a:column name="data_source_desc" align="center" prompt="PROMPT_PUBLIC.PROMPT_PLATFORM_NAME" sortable="true" width="60"/>
                                    <a:column name="category_name" align="left" prompt="PROMPT_PUBLIC.PROMPT_PLATFORM_CLASS" sortable="true" width="150"/>
                                    <a:column name="company_full_name" align="left" prompt="PROMPT_PUBLIC.PROMPT_COMPANY" sortable="true" width="150"/>
                                    <a:column name="catelog_code" align="left" editor="pur7011_catelog_mapping_result_ds_grid_lov" prompt="PUR_CATELOGS_USER_DEFINED.CATELOG_CODE" sortable="true" width="100"/>
                                    <a:column name="catelog_name" align="left" prompt="PUR_CATELOGS_USER_DEFINED.CATELOG_NAME" sortable="true" width="150"/>
                                    <a:column name="catelog_level" align="center" prompt="CUX_NEWHOME.CATALOG_LEVEL" sortable="true" width="50"/>
                                </a:columns>
                                <a:events>
                                    <a:event name="cellclick" handler="on_grid_cellclick"/>
                                </a:events>
                                <a:editors>
                                    <a:lov id="pur7011_catelog_mapping_result_ds_grid_lov"/>
                                </a:editors>
                            </a:grid>
                        </a:form>
                    </a:tab> -->
                </a:tabs>
            </a:tabPanel>
        </a:screenBody>
    </a:view>
</a:screen>
